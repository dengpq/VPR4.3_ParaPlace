cscope 15 $HOME/astyled_vpr/vpr4.3_double/vpr/src -q 0000002749 0000781421
	@check_netlist.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"hash.h
"

6 
	~"v´_uts.h
"

7 
	~"check_Ãi¡.h
"

12 
check_cÚÃùiÚs_to_glob®_şb_pšs
(
š‘
);

14 
check_şb_cÚn
(
iblk
, 
num_cÚÃùiÚs
);

16 
check_fÜ_muÉË_sšk_cÚÃùiÚs
();

18 
check_fÜ_du¶iÿ‹_block_Çmes
();

20 
g‘_num_cÚn
(
block_num
);

22 
check_subblocks
(
iblk
, 
subblock_d©a_t
* 
subblock_d©a_±r
,

23 * 
num_u£s_of_şb_pš
, * 
num_u£s_of_sblk_İš
);

25 
check_subblock_pš
(
şb_pš
, 
mš_v®
, 
max_v®
,

26 
pš_ty³s_t
 
pš_ty³
, 
iblk
, 
isubblk
, 
subblock_t


27 *
subblock_šf
);

29 
check_š‹º®_subblock_cÚÃùiÚs
(
subblock_d©a_t


30 *
subblock_d©a_±r
, 
iblk
, * 
num_u£s_of_sblk_İš
);

32 
check_şb_to_subblock_cÚÃùiÚs
(
iblk
, 
subblock_t


33 *
subblock_šf
, 
num_subblocks
, * 
num_u£s_of_şb_pš
);

38 
	$check_Ãi¡
(
subblock_d©a_t
* 
subblock_d©a_±r
, * 
num_driv”
)

42 * 
num_subblocks_³r_block
 = 
subblock_d©a_±r
->num_subblocks_per_block;

43 
subblock_d©a_±r
->
num_ff
 = 0;

44 
subblock_d©a_±r
->
num_cÚ¡_g’
 = 0;

45 
”rÜ
 = 0;

46 * 
num_u£s_of_şb_pš
 = (*)
	`my_m®loc
(
max_pšs_³r_şb
 * ());

47 * 
num_u£s_of_sblk_İš
 = (*)
	`my_m®loc
(

48 
subblock_d©a_±r
->
max_subblocks_³r_block
 * ());

51 
Ãt_šdex
 = -1;

52 
Ãt_šdex
 = 0;‚‘_šdex < 
num_Ãts
; ++net_index) {

53 ià(
num_driv”
[
Ãt_šdex
] != 1) {

54 
	`´štf
("Error:‚et %s has %d signals driving it.\n",

55 
Ãt
[
Ãt_šdex
].
Çme
,

56 
num_driv”
[
Ãt_šdex
]);

57 ++
”rÜ
;

60 ià((
Ãt
[
Ãt_šdex
].
num_Ãt_pšs
 - 
num_driv”
[net_index]) < 1) {

61 
	`´štf
("Error:‚et %s has‚o fanout.\n",

62 
Ãt
[
Ãt_šdex
].
Çme
);

63 ++
”rÜ
;

65 
”rÜ
 +ğ
	`check_cÚÃùiÚs_to_glob®_şb_pšs
(
Ãt_šdex
);

69 
num_cÚÃùiÚs
 = 0;

70 
block_šdex
 = -1;

71 
block_šdex
 = 0; block_šdex < 
num_blocks
; ++block_index) {

72 
num_cÚÃùiÚs
 = 
	`g‘_num_cÚn
(
block_šdex
);

74 ià(
blocks
[
block_šdex
].
block_ty³
 =ğ
B_CLB_TYPE
) {

75 
”rÜ
 +ğ
	`check_şb_cÚn
(
block_šdex
,

76 
num_cÚÃùiÚs
);

77 
”rÜ
 +ğ
	`check_subblocks
(
block_šdex
,

78 
subblock_d©a_±r
,

79 
num_u£s_of_şb_pš
,

80 
num_u£s_of_sblk_İš
);

83 ià(
num_cÚÃùiÚs
 != 1) {

84 
	`´štf
("Error: io blocks #%d (%s) ofype %d"

85 "ha %d…šs.\n", 
block_šdex
, 
blocks
[block_šdex].
Çme
,

86 
blocks
[
block_šdex
].
block_ty³
,

87 
num_cÚÃùiÚs
);

88 
”rÜ
++;

92 ià(
num_subblocks_³r_block
[
block_šdex
] != 0) {

93 
	`´štf
("Error: IO_TYPE blocks #%d (%s) contains %d subblocks.\n"

94 "Ex³ùed 0.\n", 
block_šdex
, 
blocks
[block_šdex].
Çme
, 
num_subblocks_³r_block
[block_index]);

95 
”rÜ
++;

100 
	`check_fÜ_muÉË_sšk_cÚÃùiÚs
();

101 
”rÜ
 +ğ
	`check_fÜ_du¶iÿ‹_block_Çmes
();

102 
	`ä“
(
num_u£s_of_şb_pš
);

103 
	`ä“
(
num_u£s_of_sblk_İš
);

105 ià(
”rÜ
 != 0) {

106 
	`´štf
("Found %d f©® E¼Ü šhšpuˆÃi¡.\n", 
”rÜ
);

107 
	`ex™
(1);

109 
	}
}

114 
	$check_cÚÃùiÚs_to_glob®_şb_pšs
(
š‘
)

116 
”rÜ
 = 0;

121 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

122 
š
 = -1;

123 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

124 
iblk
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

126 ià(
blocks
[
iblk
].
block_ty³
 =ğ
B_CLB_TYPE
) {

127 
blk_pš
 = 
Ãt
[
š‘
].
node_block_pšs
[
š
];

129 ià(
is_glob®_şb_pš
[
blk_pš
] !ğ
is_glob®
[
š‘
]) {

131 ià(
š
 =ğ0 && 
is_glob®
[
š‘
]) {

132 
	`´štf
("Warning in check_connections_to_global_clb_pins:\n"

134 "\tÚ block #%d (%s).\n", 
š‘
, 
Ãt
[š‘].
Çme
,

135 
blk_pš
, 
iblk
, 
blocks
[iblk].
Çme
);

137 
	`´štf
("Error in check_connections_to_global_clb_pins:\n"

140 
š
,

141 
š‘
,

142 
Ãt
[
š‘
].
Çme
,

143 
blk_pš
,

144 
iblk
,

145 
blocks
[
iblk
].
Çme
);

146 ++
”rÜ
;

149 ià(
is_glob®
[
š‘
]) {

150 
	`´štf
("\tNet is global, but CLB_TYPE…in is‚ot.\n\n");

152 
	`´štf
("\tCLB…in is global, but‚et is‚ot.\n\n");

158  
”rÜ
;

159 
	}
}

162 
	$check_şb_cÚn
(
iblk
,

163 
num_cÚÃùiÚs
)

166 
işass
, 
š
;

167 
”rÜ
 = 0;

169 ià(
num_cÚÃùiÚs
 < 2) {

170 
	`´štf
("Warning:†ogic blocks #%d (%s) has only %d…in.\n",

171 
iblk
, 
blocks
[iblk].
Çme
, 
num_cÚÃùiÚs
);

177 ià(
num_cÚÃùiÚs
 == 1) {

178 
š
 = 0; ipš < 
max_pšs_³r_şb
; ++ipin) {

179 ià(
blocks
[
iblk
].
Ãts
[
š
] !ğ
OPEN
) {

180 
işass
 = 
şb_pš_şass
[
š
];

182 ià(
şass_šf
[
işass
].
ty³
 !ğ
DRIVER
) {

183 ++
”rÜ
;

185 
	`´štf
("\tPin is‡n output -- may be‡ constant generator.\n"

192 ++
”rÜ
;

198 ià(
num_cÚÃùiÚs
 > 
max_pšs_³r_şb
) {

199 
	`´štf
("Error:†ogic blocks #%d with output %s has %d…ins.\n",

200 
iblk
, 
blocks
[iblk].
Çme
, 
num_cÚÃùiÚs
);

201 ++
”rÜ
;

204  
”rÜ
;

205 
	}
}

208 
	$check_fÜ_du¶iÿ‹_block_Çmes
()

212 
”rÜ
, 
iblk
;

213 
hash_t
** 
block_hash_bË
, *
h_±r
;

214 
s_hash_™”©Ü
 
hash_™”©Ü
;

215 
”rÜ
 = 0;

216 
block_hash_bË
 = 
	`®loc_hash_bË
();

218 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

219 
h_±r
 = 
	`š£¹_š_hash_bË
(
block_hash_bË
, 
blocks
[
iblk
].
Çme
, iblk);

222 
hash_™”©Ü
 = 
	`¡¬t_hash_bË_™”©Ü
();

223 
h_±r
 = 
	`g‘_Ãxt_hash
(
block_hash_bË
, &
hash_™”©Ü
);

225 
h_±r
 !ğ
NULL
) {

226 ià(
h_±r
->
couÁ
 != 1) {

227 
	`´štf
("Error: %d blocks‡re‚amed %s. Block‚ames must be unique."

228 "\n", 
h_±r
->
couÁ
, h_±r->
Çme
);

229 
”rÜ
++;

232 
h_±r
 = 
	`g‘_Ãxt_hash
(
block_hash_bË
, &
hash_™”©Ü
);

235 
	`ä“_hash_bË
(
block_hash_bË
);

236  (
”rÜ
);

237 
	}
}

242 
	$check_subblocks
(
iblk
,

243 
subblock_d©a_t
* 
subblock_d©a_±r
,

244 * 
num_u£s_of_şb_pš
,

245 * 
num_u£s_of_sblk_İš
)

247 
”rÜ
 = 0;

248 
subblock_t
* 
subblock_šf
 = 
subblock_d©a_±r
->subblock_šf[
iblk
];

249 
num_subblocks
 = 
subblock_d©a_±r
->
num_subblocks_³r_block
[
iblk
];

250 
max_subblocks_³r_block
 = 
subblock_d©a_±r
->max_subblocks_per_block;

251 
subblock_lut_size
 = 
subblock_d©a_±r
->subblock_lut_size;

253 ià(
num_subblocks
 < 1 ||‚um_subblock > 
max_subblocks_³r_block
) {

254 
	`´štf
("Error: blocks #%d (%s) contains %d subblocks.\n",

255 
iblk
, 
blocks
[iblk].
Çme
, 
num_subblocks
);

256 ++
”rÜ
;

261 
isub
, 
š
, 
i
;

262 
isub
 = 0; isub < 
num_subblocks
; ++isub) {

263 
š
 = 0; ipš < 
subblock_lut_size
; ++ipin) {

264 
şb_šput_pš
 = 
subblock_šf
[
isub
].
šputs
[
š
];

265 
”rÜ
 +ğ
	`check_subblock_pš
(
şb_šput_pš
,

267 
max_pšs_³r_şb
 + 
num_subblocks
 - 1,

268 
RECEIVER
,

269 
iblk
,

270 
isub
,

271 
subblock_šf
);

275 
şb_ouut_pš
 = 
subblock_šf
[
isub
].
ouut
;

276 
”rÜ
 +ğ
	`check_subblock_pš
(
şb_ouut_pš
,

278 
max_pšs_³r_şb
 - 1,

279 
DRIVER
,

280 
iblk
,

281 
isub
,

282 
subblock_šf
);

284 
şb_şock_pš
 = 
subblock_šf
[
isub
].
şock
;

285 
”rÜ
 +ğ
	`check_subblock_pš
(
şb_şock_pš
,

287 
max_pšs_³r_şb
 + 
num_subblocks
 - 1,

288 
RECEIVER
,

289 
iblk
,

290 
isub
,

291 
subblock_šf
);

295 ià(
”rÜ
 != 0) {

296  
”rÜ
;

300 
i
 = 0; i < 
max_pšs_³r_şb
; ++i) {

301 
num_u£s_of_şb_pš
[
i
] = 0;

303 
i
 = 0; i < 
num_subblocks
; ++i) {

304 
num_u£s_of_sblk_İš
[
i
] = 0;

307 
	`lßd_Úe_şb_çnout_couÁ
(
subblock_lut_size
,

308 
subblock_šf
,

309 
num_subblocks
,

310 
num_u£s_of_şb_pš
,

311 
num_u£s_of_sblk_İš
,

312 
iblk
);

313 
”rÜ
 +ğ
	`check_şb_to_subblock_cÚÃùiÚs
(
iblk
,

314 
subblock_šf
,

315 
num_subblocks
,

316 
num_u£s_of_şb_pš
);

317 
”rÜ
 +ğ
	`check_š‹º®_subblock_cÚÃùiÚs
(
subblock_d©a_±r
,

318 
iblk
,

319 
num_u£s_of_sblk_İš
);

321  
”rÜ
;

322 
	}
}

324 
	$check_subblock_pš
(
şb_pš
, 
mš_v®
, 
max_v®
,

325 
pš_ty³s_t
 
pš_ty³
, 
iblk
, 
isubblk
, 
subblock_t


326 *
subblock_šf
)

330 
işass
;

332 ià(
şb_pš
 !ğ
OPEN
) {

333 ià(
şb_pš
 < 
mš_v®
 || clb_pš > 
max_v®
) {

334 
	`´štf
("Error: Block #%d (%s) subblock #%d (%s)"

335 "cÚÃù tØnÚexi¡’ˆşb…š #%d.\n", 
iblk
, 
blocks
[iblk].
Çme
,

336 
isubblk
, 
subblock_šf
[isubblk].
Çme
, 
şb_pš
);

340 ià(
şb_pš
 < 
max_pšs_³r_şb
) {

341 
işass
 = 
şb_pš_şass
[
şb_pš
];

343 ià(
şass_šf
[
işass
].
ty³
 !ğ
pš_ty³
) {

344 
	`´štf
("Error: Block #%d (%s) subblock #%d (%s)…in connects\n"

345 "\‰Øşb…š (#%dèoàwrÚg iÅut/ouuˆty³.\n", 
iblk
,

346 
blocks
[
iblk
].
Çme
, 
isubblk
, 
subblock_šf
[isubblk].name,

347 
şb_pš
);

354 
	}
}

357 
	$check_fÜ_muÉË_sšk_cÚÃùiÚs
()

363 
iblk
, 
š
, 
š‘
, 
işass
, 
şass_pš
;

364 * 
num_pšs_cÚÃùed
;

365 
num_pšs_cÚÃùed
 = 
	`my_ÿÎoc
(
num_Ãts
, ());

370 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

371 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

374 ià(
şass_šf
[
işass
].
ty³
 =ğ
DRIVER
) {

378 
şass_pš
 = 0; cÏss_pš < 
şass_šf
[
işass
].
num_pšs
; class_pin++) {

379 
š
 = 
şass_šf
[
işass
].
pšli¡
[
şass_pš
];

380 
š‘
 = 
blocks
[
iblk
].
Ãts
[
š
];

382 ià(
š‘
 !ğ
OPEN
) {

383 
num_pšs_cÚÃùed
[
š‘
]++;

387 
şass_pš
 = 0; cÏss_pš < 
şass_šf
[
işass
].
num_pšs
; class_pin++) {

388 
š
 = 
şass_šf
[
işass
].
pšli¡
[
şass_pš
];

389 
š‘
 = 
blocks
[
iblk
].
Ãts
[
š
];

391 ià(
š‘
 !ğ
OPEN
) {

392 ià(
num_pšs_cÚÃùed
[
š‘
] > 1) {

393 
	`´štf
("Warning: blocks %d (%s) connects %d…ins of class "

394 "%dØÃˆ%d (%s).\n", 
iblk
, 
blocks
[iblk].
Çme
,

395 
num_pšs_cÚÃùed
[
š‘
], 
işass
, iÃt, 
Ãt
[š‘].
Çme
);

396 
	`´štf
("\tThis does‚ot make sense for many†ogic blocks "

401 
num_pšs_cÚÃùed
[
š‘
] = 0;

407 
	`ä“
(
num_pšs_cÚÃùed
);

408 
	}
}

411 
	$g‘_num_cÚn
(
block_num
)

414 
i
 = -1;

415 
num_cÚÃùiÚs
 = 0;

416 
i
 = 0; i < 
max_pšs_³r_şb
; ++i) {

417 ià(
blocks
[
block_num
].
Ãts
[
i
] !ğ
OPEN
) {

418 ++
num_cÚÃùiÚs
;

422  
num_cÚÃùiÚs
;

423 
	}
}

426 
	$check_š‹º®_subblock_cÚÃùiÚs
(
subblock_d©a_t
* 
subblock_d©a_±r
,

427 
iblk
,

428 * 
num_u£s_of_sblk_İš
)

434 
num_cÚ¡_g’
, 
num_ff
, 
isub
, 
š
, 
”rÜ
;

435 
boŞ—n
 
has_šputs
;

436 
subblock_lut_size
;

437 
num_subblocks
;

438 
subblock_t
* 
subblock_šf
;

439 
subblock_lut_size
 = 
subblock_d©a_±r
->subblock_lut_size;

440 
num_subblocks
 = 
subblock_d©a_±r
->
num_subblocks_³r_block
[
iblk
];

441 
subblock_šf
 = 
subblock_d©a_±r
->subblock_šf[
iblk
];

442 
num_cÚ¡_g’
 = 0;

443 
num_ff
 = 0;

444 
”rÜ
 = 0;

446 
isub
 = 0; isub < 
num_subblocks
; isub++) {

447 
has_šputs
 = 
FALSE
;

449 
š
 = 0; ipš < 
subblock_lut_size
; ipin++) {

450 ià(
subblock_šf
[
isub
].
šputs
[
š
] !ğ
OPEN
) {

451 
has_šputs
 = 
TRUE
;

456 ià(
num_u£s_of_sblk_İš
[
isub
] == 0) {

457 ià(
has_šputs
 || 
subblock_šf
[
isub
].
şock
 !ğ
OPEN
) {

458 
	`´štf
("Error: output of subblock #%d (%s) of blocks #%d (%s) is "

459 "Ãv” u£d.\n", 
isub
, 
subblock_šf
[isub].
Çme
, 
iblk
,

460 
blocks
[
iblk
].
Çme
);

461 
”rÜ
++;

466 ià(!
has_šputs
) {

467 ià(
subblock_šf
[
isub
].
şock
 =ğ
OPEN
) {

468 
	`´štf
("Warning: blocks #%d (%s), subblock #%d (%s) is‡ "

469 "cÚ¡ªˆg’”©Ü.\n\t(Ha nØšputs.)\n", 
iblk
,

470 
blocks
[
iblk
].
Çme
, 
isub
, 
subblock_šf
[isub].name);

471 
num_cÚ¡_g’
++;

473 
	`´štf
("Error: blocks #%d (%s), subblock #%d (%s) is‡ CLOCKED "

475 
iblk
, 
blocks
[iblk].
Çme
, 
isub
, 
subblock_šf
[isub].name);

476 
num_cÚ¡_g’
++;

477 
”rÜ
++;

480 ià(
subblock_šf
[
isub
].
şock
 !ğ
OPEN
) {

481 
num_ff
++;

487 
subblock_d©a_±r
->
num_cÚ¡_g’
 +=‚um_const_gen;

488 
subblock_d©a_±r
->
num_ff
 +=‚um_ff;

489  (
”rÜ
);

490 
	}
}

493 
	$check_şb_to_subblock_cÚÃùiÚs
(
iblk
, 
subblock_t


494 *
subblock_šf
, 
num_subblocks
, * 
num_u£s_of_şb_pš
)

502 
š
, 
isub
, 
şb_pš
, 
”rÜ
;

503 
”rÜ
 = 0;

507 
isub
 = 0; isub < 
num_subblocks
; isub++) {

508 
şb_pš
 = 
subblock_šf
[
isub
].
ouut
;

510 ià(
şb_pš
 !ğ
OPEN
) {

511 
num_u£s_of_şb_pš
[
şb_pš
]++;

515 
š
 = 0; ipš < 
max_pšs_³r_şb
; ++ipin) {

516 ià(
blocks
[
iblk
].
Ãts
[
š
] !ğ
OPEN
) {

517 ià(
	`is_İš
(
š
)) {

518 ià(
num_u£s_of_şb_pš
[
š
] == 0) {

519 
	`´štf
("Error: output…in %d on blocks #%d (%s) is‚ot driven "

520 "by‡ny subblock.\n", 
š
, 
iblk
, 
blocks
[iblk].
Çme
);

521 
”rÜ
++;

522 } ià(
num_u£s_of_şb_pš
[
š
] > 1) {

523 
	`´štf
("Error: output…in %d on blocks #%d (%s) is driven "

524 "by %d subblocks.\n", 
š
, 
iblk
, 
blocks
[iblk].
Çme
,

525 
num_u£s_of_şb_pš
[
š
]);

526 
”rÜ
++;

529 ià(
num_u£s_of_şb_pš
[
š
] <= 0) {

530 
	`´štf
("Error:…in %d on blocks #%d (%s) does‚ot fanouto‡ny "

531 "subblocks.\n", 
š
, 
iblk
, 
blocks
[iblk].
Çme
);

532 
”rÜ
++;

536 ià(
	`is_İš
(
š
)) {

537 ià(
num_u£s_of_şb_pš
[
š
] > 1) {

538 
	`´štf
("Error:…in %d on blocks #%d (%s) is driven by %d "

539 "subblocks.\n", 
š
, 
iblk
, 
blocks
[iblk].
Çme
,

540 
num_u£s_of_şb_pš
[
š
]);

541 
”rÜ
++;

546  (
”rÜ
);

547 
	}
}

	@check_netlist.h

1 #iâdeà
CHECK_NETLIST_H


2 
	#CHECK_NETLIST_H


	)

4 
	~"v´_ty³s.h
"

6 
check_Ãi¡
(
subblock_d©a_t
* 
subblock_d©a_±r
, * 
num_driv”
);

	@check_route.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"rou‹_expÜt.h
"

6 
	~"check_rou‹.h
"

7 
	~"check_¼_g¿ph.h
"

12 
check_node_ªd_¿nge
(
ivex
, 
rou‹r_ty³s_t
 
rou‹_ty³
);

13 
check_sourû
(
ivex
, 
š‘
);

14 
check_sšk
(
ivex
, 
š‘
, 
boŞ—n
* 
pš_dÚe
);

15 
check_sw™ch
(
s_Œaû
* 
Œ
, 
num_sw™ch
);

16 
boŞ—n
 
check_adjaûÁ
(
äom_node
, 
to_node
);

17 
pš_ªd_chª_adjaûÁ
(
pš_node
, 
chª_node
);

18 
chªx_chªy_adjaûÁ
(
chªx_node
, 
chªy_node
);

19 
»£t_æags
(
š‘
, 
boŞ—n
* 
cÚÃùed_to_rou‹
);

20 
»compu‹_occu·ncy_äom_sü©ch
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
);

21 
check_loÿÎy_u£d_şb_İšs
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
,

22 
rou‹r_ty³s_t
 
rou‹_ty³
);

28 
	$check_rou‹
(
rou‹r_ty³s_t
 
rou‹_ty³
, 
num_sw™ch
,

29 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
)

36 
š‘
, 
š
, 
max_pšs
, 
ivex
, 
´ev_node
;

37 
boŞ—n
 
v®id
, 
cÚÃùs
;

38 
boŞ—n
* 
cÚÃùed_to_rou‹
;

39 
s_Œaû
* 
Œ
;

40 
boŞ—n
* 
pš_dÚe
;

41 
	`´štf
("\nCheckingoƒnsure„outing is†egal ...\n");

45 
	`»compu‹_occu·ncy_äom_sü©ch
(
şb_İšs_u£d_loÿÎy
);

46 
v®id
 = 
	`ãasibË_routšg
();

48 ià(
v®id
 =ğ
FALSE
) {

49 
	`´štf
("Error in check_route --„outing„esources‡re overused.\n");

50 
	`ex™
(1);

53 
	`check_loÿÎy_u£d_şb_İšs
(
şb_İšs_u£d_loÿÎy
, 
rou‹_ty³
);

54 
cÚÃùed_to_rou‹
 = (
boŞ—n
*è
	`my_ÿÎoc
(
num_¼_nodes
, (boolean));

55 
max_pšs
 = 0;

57 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

58 
max_pšs
 = 
	`max
(max_pšs, 
Ãt
[
š‘
].
num_Ãt_pšs
);

61 
pš_dÚe
 = (
boŞ—n
*)
	`my_m®loc
(
max_pšs
 * (boolean));

65 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

66 ià(
is_glob®
[
š‘
]) {

70 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

71 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

72 
pš_dÚe
[
š
] = 
FALSE
;

76 
Œ
 = 
Œaû_h—d
[
š‘
];

78 ià(
Œ
 =ğ
NULL
) {

79 
	`´štf
("E¼Ü iÀcheck_rou‹:‚‘ %d ha nØroutšg.\n", 
š‘
);

80 
	`ex™
(1);

83 
ivex
 = 
Œ
->
šdex
;

84 
	`check_node_ªd_¿nge
(
ivex
, 
rou‹_ty³
);

85 
	`check_sw™ch
(
Œ
, 
num_sw™ch
);

86 
cÚÃùed_to_rou‹
[
ivex
] = 
TRUE
;

87 
	`check_sourû
(
ivex
, 
š‘
);

88 
pš_dÚe
[0] = 
TRUE
;

89 
´ev_node
 = 
ivex
;

90 
Œ
 =±r->
Ãxt
;

93 
Œ
 !ğ
NULL
) {

94 
ivex
 = 
Œ
->
šdex
;

95 
	`check_node_ªd_¿nge
(
ivex
, 
rou‹_ty³
);

96 
	`check_sw™ch
(
Œ
, 
num_sw™ch
);

98 ià(
¼_node
[
´ev_node
].
ty³
 =ğ
SINK
) {

99 ià(
cÚÃùed_to_rou‹
[
ivex
] =ğ
FALSE
) {

100 
	`´štf
("Error in check_route. Node %d does‚ot†ink "

101 "štØthexi¡šg„outšg fÜ‚‘ %d.\n", 
ivex
, 
š‘
);

102 
	`ex™
(1);

105 
cÚÃùs
 = 
	`check_adjaûÁ
(
´ev_node
, 
ivex
);

106 ià(!
cÚÃùs
) {

107 
	`´štf
("Error in check_route while checking‚et %d.\n",

108 
š‘
);

109 
	`´štf
("Non-adjacent segments inraceback.\n");

110 
	`ex™
(1);

113 ià(
cÚÃùed_to_rou‹
[
ivex
] && 
¼_node
[ivex].
ty³
 !ğ
SINK
) {

116 
	`´štf
("Error in check_route:‚et %d„outing is‚ot‡ree.\n",

117 
š‘
);

118 
	`ex™
(1);

121 
cÚÃùed_to_rou‹
[
ivex
] = 
TRUE
;

123 ià(
¼_node
[
ivex
].
ty³
 =ğ
SINK
) {

124 
	`check_sšk
(
ivex
, 
š‘
, 
pš_dÚe
);

128 
´ev_node
 = 
ivex
;

129 
Œ
 =±r->
Ãxt
;

132 ià(
¼_node
[
´ev_node
].
ty³
 !ğ
SINK
) {

133 
	`´štf
("E¼Ü iÀcheck_rou‹. N‘ %d dÛ nÙƒnd\n", 
š‘
);

134 
	`´štf
("with‡ SINK.\n");

135 
	`ex™
(1);

138 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

139 ià(
pš_dÚe
[
š
] =ğ
FALSE
) {

140 
	`´štf
("E¼Ü iÀcheck_rou‹. N‘ %d dÛ nÙ \n", 
š‘
);

141 
	`´štf
("cÚÃùØpš %d.\n", 
š
);

142 
	`ex™
(1);

146 
	`»£t_æags
(
š‘
, 
cÚÃùed_to_rou‹
);

149 
	`ä“
(
pš_dÚe
);

150 
	`ä“
(
cÚÃùed_to_rou‹
);

151 
	`´štf
("Completed„outing consistency check successfully.\n\n");

152 
	}
}

155 
	$check_sšk
(
ivex
, 
š‘
, 
boŞ—n
* 
pš_dÚe
)

159 
i
 = 
¼_node
[
ivex
].
xlow
;

160 
j
 = 
¼_node
[
ivex
].
ylow
;

161 
±c_num
 = 
¼_node
[
ivex
].ptc_num;

162 
ifound
 = 0;

164 
š
, 
block_num
, 
işass
, 
blk_pš
;

165 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

166 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[0];

168 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

169 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

170 ià(
Ãt
[
š‘
].
node_blocks
[
š
] =ğ
block_num
) {

171 
blk_pš
 = 
Ãt
[
š‘
].
node_block_pšs
[
š
];

172 
işass
 = 
şb_pš_şass
[
blk_pš
];

174 ià(
işass
 =ğ
±c_num
) {

177 ià(
pš_dÚe
[
š
] =ğ
FALSE
) {

178 
ifound
++;

179 
pš_dÚe
[
š
] = 
TRUE
;

186 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[
±c_num
];

188 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

189 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

190 ià(
Ãt
[
š‘
].
node_blocks
[
š
] =ğ
block_num
) {

191 
ifound
++;

192 
pš_dÚe
[
š
] = 
TRUE
;

197 ià(
ifound
 > 1) {

198 
	`´štf
("Error in check_sink: found %derminals of‚et %d of class/pad"

199 "\À%d‡ˆloÿtiÚ (%d, %d).\n", 
ifound
, 
š‘
, 
±c_num
, 
i
, 
j
);

200 
	`ex™
(1);

203 ià(
ifound
 < 1) {

204 
	`´štf
("Error in check_sink:‚ode %d does‚ot connecto‡nyerminal "

205 "\ÀoàÃˆ%d.\n", 
ivex
, 
š‘
);

206 
	`ex™
(1);

208 
	}
}

211 
	$check_sourû
(
ivex
, 
š‘
)

214 
¼_ty³s_t
 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

215 ià(
¼_ty³
 !ğ
SOURCE
) {

216 
	`´štf
("Error in check_source:‚et %d begins with‡‚ode ofype %d.\n",

217 
š‘
, 
¼_ty³
);

218 
	`ex™
(1);

221 
i
 = 
¼_node
[
ivex
].
xlow
;

222 
j
 = 
¼_node
[
ivex
].
ylow
;

223 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[0];

224 ià(
blocks
[
block_num
].
x
 !ğ
i
 || blocks[block_num].
y
 !ğ
j
) {

225 
	`´štf
("Error in check_source:‚et SOURCE is in wrong†ocation (%d,%d)."

226 "\n", 
i
, 
j
);

227 
	`ex™
(1);

230 
blk_pš
, 
işass
;

231 
±c_num
 = 
¼_node
[
ivex
].ptc_num;

232 ià(
blocks
[
block_num
].
block_ty³
 =ğ
B_CLB_TYPE
) {

233 
blk_pš
 = 
Ãt
[
š‘
].
node_block_pšs
[0];

234 
işass
 = 
şb_pš_şass
[
blk_pš
];

236 ià(
±c_num
 !ğ
işass
) {

237 
	`´štf
("Error in check_source:‚et SOURCE is of wrong class (%d).\n",

238 
±c_num
);

239 
	`ex™
(1);

242 ià(
bš_grids
[
i
][
j
].
š_blocks
[
±c_num
] !ğ
block_num
) {

243 
	`´štf
("Error in check_source:‚et SOURCE is‡t wrong…ad (pad #%d)."

244 "\n", 
±c_num
);

245 
	`ex™
(1);

248 
	}
}

251 
	$check_sw™ch
(
s_Œaû
* 
Œ
, 
num_sw™ch
)

255 
ivex
;

256 
sw™ch_ty³
;

257 
ivex
 = 
Œ
->
šdex
;

258 
sw™ch_ty³
 = 
Œ
->
isw™ch
;

260 ià(
¼_node
[
ivex
].
ty³
 !ğ
SINK
) {

261 ià(
sw™ch_ty³
 < 0 || sw™ch_ty³ >ğ
num_sw™ch
) {

262 
	`´štf
("Error in check_switch:„r_node %d†eft via switchype %d.\n",

263 
ivex
, 
sw™ch_ty³
);

264 
	`´štf
("Switchype is out of„ange.\n");

265 
	`ex™
(1);

271 ià(
sw™ch_ty³
 !ğ
OPEN
) {

272 
	`´štf
("Error in check_switch:„r_node %d is‡ SINK, but‡ttempts \n"

273 "tØu£‡ sw™ch oàty³ %d.\n", 
ivex
, 
sw™ch_ty³
);

274 
	`ex™
(1);

277 
	}
}

280 
	$»£t_æags
(
š‘
, 
boŞ—n
* 
cÚÃùed_to_rou‹
)

286 
s_Œaû
* 
Œ
;

287 
ivex
;

288 
Œ
 = 
Œaû_h—d
[
š‘
];

290 
Œ
 !ğ
NULL
) {

291 
ivex
 = 
Œ
->
šdex
;

292 
cÚÃùed_to_rou‹
[
ivex
] = 
FALSE
;

293 
Œ
 =±r->
Ãxt
;

295 
	}
}

298 
boŞ—n
 
	$check_adjaûÁ
(
äom_node
, 
to_node
)

304 
boŞ—n
 
»ached
 = 
FALSE
;

305 
icÚn
 = -1;

306 
icÚn
 = 0; icÚÀ< 
¼_node
[
äom_node
].
num_edges
; ++iconn) {

307 ià(
¼_node
[
äom_node
].
edges
[
icÚn
] =ğ
to_node
) {

308 
»ached
 = 
TRUE
;

313 ià(!
»ached
) {

314  (
FALSE
);

319 
num_adj
 = 0;

320 
¼_ty³s_t
 
äom_ty³
 = 
¼_node
[
äom_node
].
ty³
;

321 
äom_xlow
 = 
¼_node
[
äom_node
].
xlow
;

322 
äom_ylow
 = 
¼_node
[
äom_node
].
ylow
;

323 
äom_±c
 = 
¼_node
[
äom_node
].
±c_num
;

325 
¼_ty³s_t
 
to_ty³
 = 
¼_node
[
to_node
].
ty³
;

326 
to_xlow
 = 
¼_node
[
to_node
].
xlow
;

327 
to_ylow
 = 
¼_node
[
to_node
].
ylow
;

328 
to_±c
 = 
¼_node
[
to_node
].
±c_num
;

330 
to_xhigh
, 
to_yhigh
, 
äom_xhigh
, 
äom_yhigh
;

331 
äom_ty³
) {

332 
SOURCE
:

333 ià(
to_ty³
 =ğ
OPIN
) {

334 ià(
äom_xlow
 =ğ
to_xlow
 && 
äom_ylow
 =ğ
to_ylow
) {

335 ià(
bš_grids
[
to_xlow
][
to_ylow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

336 
işass
 = 
şb_pš_şass
[
to_±c
];

337 ià(
işass
 =ğ
äom_±c
) {

338 ++
num_adj
;

341 ià(
to_±c
 =ğ
äom_±c
) {

342 ++
num_adj
;

349 
SINK
:

350 ià(
to_ty³
 =ğ
SOURCE
) {

351 ià(
äom_xlow
 =ğ
to_xlow
 && 
äom_ylow
 =ğ
to_ylow
 &&

352 
bš_grids
[
to_xlow
][
to_ylow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

353 ++
num_adj
;

358 
OPIN
:

359 ià(
to_ty³
 =ğ
CHANX
 ||o_ty³ =ğ
CHANY
) {

360 
num_adj
 +ğ
	`pš_ªd_chª_adjaûÁ
(
äom_node
, 
to_node
);

365 
IPIN
:

366 ià(
to_ty³
 =ğ
SINK
 && 
äom_xlow
 =ğ
to_xlow
 && 
äom_ylow
 =ğ
to_ylow
) {

367 ià(
bš_grids
[
äom_xlow
][
äom_ylow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

369 
işass
 = 
şb_pš_şass
[
äom_±c
];

370 ià(
işass
 =ğ
to_±c
) {

371 ++
num_adj
;

374 ià(
äom_±c
 =ğ
to_±c
) {

375 ++
num_adj
;

381 
CHANX
:

382 ià(
to_ty³
 =ğ
IPIN
) {

383 
num_adj
 +ğ
	`pš_ªd_chª_adjaûÁ
(
to_node
, 
äom_node
);

384 } ià(
to_ty³
 =ğ
CHANX
) {

385 
äom_xhigh
 = 
¼_node
[
äom_node
].
xhigh
;

386 
to_xhigh
 = 
¼_node
[
to_node
].
xhigh
;

388 ià(
äom_ylow
 =ğ
to_ylow
) {

389 ià(
to_xhigh
 =ğ
äom_xlow
 - 1 || 
äom_xhigh
 =ğ
to_xlow
 - 1) {

390 ++
num_adj
;

393 } ià(
to_ty³
 =ğ
CHANY
) {

394 
num_adj
 +ğ
	`chªx_chªy_adjaûÁ
(
äom_node
, 
to_node
);

399 
CHANY
:

400 ià(
to_ty³
 =ğ
IPIN
) {

401 
num_adj
 +ğ
	`pš_ªd_chª_adjaûÁ
(
to_node
, 
äom_node
);

402 } ià(
to_ty³
 =ğ
CHANY
) {

403 
äom_yhigh
 = 
¼_node
[
äom_node
].
yhigh
;

404 
to_yhigh
 = 
¼_node
[
to_node
].
yhigh
;

406 ià(
äom_xlow
 =ğ
to_xlow
) {

407 ià(
to_yhigh
 =ğ
äom_ylow
 - 1 || 
äom_yhigh
 =ğ
to_ylow
 - 1) {

408 ++
num_adj
;

411 } ià(
to_ty³
 =ğ
CHANX
) {

412 
num_adj
 +ğ
	`chªx_chªy_adjaûÁ
(
to_node
, 
äom_node
);

421 ià(
num_adj
 == 1) {

422  (
TRUE
);

423 } ià(
num_adj
 == 0) {

424  (
FALSE
);

427 
	`´štf
("E¼Ü iÀcheck_adjaûÁ:‚um_adj = %d. Ex³ùed 0 o¸1.\n", 
num_adj
);

428 
	`ex™
(1);

429 
	}
}

432 
	$chªx_chªy_adjaûÁ
(
chªx_node
, 
chªy_node
)

436 
chªx_y
 = 
¼_node
[
chªx_node
].
ylow
;

437 
chªx_xlow
 = 
¼_node
[
chªx_node
].
xlow
;

438 
chªx_xhigh
 = 
¼_node
[
chªx_node
].
xhigh
;

440 
chªy_x
 = 
¼_node
[
chªy_node
].
xlow
;

441 
chªy_ylow
 = 
¼_node
[
chªy_node
].
ylow
;

442 
chªy_yhigh
 = 
¼_node
[
chªy_node
].
yhigh
;

444 ià(
chªy_ylow
 > 
chªx_y
 + 1 || 
chªy_yhigh
 < chanx_y

445 || 
chªx_xlow
 > 
chªy_x
 + 1 || 
chªx_xhigh
 < chany_x) {

450 
	}
}

453 
	$pš_ªd_chª_adjaûÁ
(
pš_node
, 
chª_node
)

458 
num_adj
 = 0;

459 
pš_x
 = 
¼_node
[
pš_node
].
xlow
;

460 
pš_y
 = 
¼_node
[
pš_node
].
ylow
;

461 
pš_±c
 = 
¼_node
[
pš_node
].
±c_num
;

462 
¼_ty³s_t
 
chª_ty³
 = 
¼_node
[
chª_node
].
ty³
;

463 
chª_xlow
 = 
¼_node
[
chª_node
].
xlow
;

464 
chª_ylow
 = 
¼_node
[
chª_node
].
ylow
;

465 
chª_xhigh
 = 
¼_node
[
chª_node
].
xhigh
;

466 
chª_yhigh
 = 
¼_node
[
chª_node
].
yhigh
;

468 ià(
bš_grids
[
pš_x
][
pš_y
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

469 ià(
chª_ty³
 =ğ
CHANX
) {

470 ià(
chª_ylow
 =ğ
pš_y
) {

471 ià(
pšloc
[
TOP
][
pš_±c
] =ğ1 && 
pš_x
 <ğ
chª_xhigh
 &&

472 
pš_x
 >ğ
chª_xlow
) {

473 
num_adj
++;

475 } ià(
chª_ylow
 =ğ
pš_y
 - 1) {

476 ià(
pšloc
[
BOTTOM
][
pš_±c
] =ğ1 && 
pš_x
 <ğ
chª_xhigh
 &&

477 
pš_x
 >ğ
chª_xlow
) {

478 
num_adj
++;

481 } ià(
chª_ty³
 =ğ
CHANY
) {

482 ià(
chª_xlow
 =ğ
pš_x
) {

483 ià(
pšloc
[
RIGHT
][
pš_±c
] =ğ1 && 
pš_y
 <ğ
chª_yhigh
 &&

484 
pš_y
 >ğ
chª_ylow
) {

485 
num_adj
++;

487 } ià(
chª_xlow
 =ğ
pš_x
 - 1) {

488 ià(
pšloc
[
LEFT
][
pš_±c
] =ğ1 && 
pš_y
 <ğ
chª_yhigh
 &&

489 
pš_y
 >ğ
chª_ylow
) {

490 
num_adj
++;

495 ià(
pš_y
 == 0) {

496 ià(
chª_ty³
 =ğ
CHANX
 && 
chª_ylow
 =ğ0 && 
pš_x
 <ğ
chª_xhigh
 &&

497 
pš_x
 >ğ
chª_xlow
) {

498 
num_adj
++;

500 } ià(
pš_y
 =ğ
num_grid_rows
 + 1) {

501 ià(
chª_ty³
 =ğ
CHANX
 && 
chª_ylow
 =ğ
num_grid_rows
 && 
pš_x
 <ğ
chª_xhigh
 &&

502 
pš_x
 >ğ
chª_xlow
) {

503 
num_adj
++;

505 } ià(
pš_x
 == 0) {

506 ià(
chª_ty³
 =ğ
CHANY
 && 
chª_xlow
 =ğ0 && 
pš_y
 <ğ
chª_yhigh
 &&

507 
pš_y
 >ğ
chª_ylow
) {

508 
num_adj
++;

510 } ià(
pš_x
 =ğ
num_grid_cŞumns
 + 1) {

511 ià(
chª_ty³
 =ğ
CHANY
 && 
chª_xlow
 =ğ
num_grid_cŞumns
 && 
pš_y
 <ğ
chª_yhigh
 &&

512 
pš_y
 >ğ
chª_ylow
) {

513 
num_adj
++;

518  (
num_adj
);

519 
	}
}

522 
	$»compu‹_occu·ncy_äom_sü©ch
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
)

527 
ivex
, 
š‘
, 
iblk
, 
işass
, 
š
, 
num_loÿl_İšs
;

528 
s_Œaû
* 
Œ
;

532 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

533 
¼_node
[
ivex
].
m_u§ge
 = 0;

538 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

539 ià(
is_glob®
[
š‘
]) {

543 
Œ
 = 
Œaû_h—d
[
š‘
];

545 ià(
Œ
 =ğ
NULL
) {

550 
ivex
 = 
Œ
->
šdex
;

551 
¼_node
[
ivex
].
m_u§ge
++;

553 ià(
¼_node
[
ivex
].
ty³
 =ğ
SINK
) {

554 
Œ
 =±r->
Ãxt
;

556 ià(
Œ
 =ğ
NULL
) {

561 
Œ
 =±r->
Ãxt
;

569 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

570 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

571 
num_loÿl_İšs
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

574 
š
 = 0; ipš < 
num_loÿl_İšs
; ipin++) {

575 
ivex
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
];

576 
¼_node
[
ivex
].
m_u§ge
++;

580 
	}
}

583 
	$check_loÿÎy_u£d_şb_İšs
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
,

584 
rou‹r_ty³s_t
 
rou‹_ty³
)

588 
işass
, 
iblk
, 
num_loÿl_İšs
, 
ivex
, 
š
;

589 
¼_ty³s_t
 
¼_ty³
;

591 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

592 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

593 
num_loÿl_İšs
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

596 
š
 = 0; ipš < 
num_loÿl_İšs
; ipin++) {

597 
ivex
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
];

598 
	`check_node_ªd_¿nge
(
ivex
, 
rou‹_ty³
);

600 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

602 ià(
¼_ty³
 !ğ
OPIN
) {

603 
	`´štf
("Error in check_locally_used_opins: Block #%d (%s)\n"

605 "\t™ i ¼_nod#%d oàty³ %d.\n", 
iblk
,

606 
blocks
[
iblk
].
Çme
, 
işass
, 
ivex
, 
¼_ty³
);

607 
	`ex™
(1);

610 
š
 = 
¼_node
[
ivex
].
±c_num
;

612 ià(
şb_pš_şass
[
š
] !ğ
işass
) {

613 
	`´štf
("Error in check_locally_used_opins: Block #%d (%s):\n"

615 "\Œr_nod#: %d.\n", 
iblk
, 
blocks
[iblk].
Çme
, 
işass
,

616 
şb_pš_şass
[
š
], 
ivex
);

617 
	`ex™
(1);

622 
	}
}

625 
	$check_node_ªd_¿nge
(
ivex
, 
rou‹r_ty³s_t
 
rou‹_ty³
)

629 ià(
ivex
 < 0 || ivex >ğ
num_¼_nodes
) {

630 
	`´štf
("Error in check_node_and_range:„r_node #%d is out of†egal "

631 "\Œªg(0Ø%d).\n", 
ivex
, 
num_¼_nodes
 - 1);

632 
	`ex™
(1);

635 
	`check_node
(
ivex
, 
rou‹_ty³
);

636 
	}
}

	@check_route.h

1 #iâdeà
CHECK_ROUTE_H


2 
	#CHECK_ROUTE_H


	)

4 
	~"v´_ty³s.h
"

6 
check_rou‹
(
rou‹r_ty³s_t
 
rou‹_ty³
, 
num_sw™ch
,

7 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
);

	@check_rr_graph.c

1 
	~"ut.h
"

2 
	~"v´_ty³s.h
"

3 
	~"glob®s.h
"

4 
	~"¼_g¿ph.h
"

5 
	~"check_¼_g¿ph.h
"

9 
	#BUF_FLAG
 1

	)

10 
	#PTRANS_FLAG
 2

	)

11 
	#BUF_AND_PTRANS_FLAG
 3

	)

15 
boŞ—n
 
¼_node_is_glob®_şb_š
(
ivex
);

17 
check_·ss_Œªsi¡Üs
(
äom_node
);

21 
	$check_¼_g¿ph
(
rou‹r_ty³s_t
 
rou‹_ty³
, 
num_sw™ch
)

27 * 
num_edges_äom_cu¼’t_to_node
;

28 * 
tÙ®_edges_to_node
;

29 * 
sw™ch_ty³s_äom_cu¼’t_to_node
;

30 
ivex
, 
›dge
, 
to_node
, 
num_edges
;

31 
sw™ch_ty³
;

32 
¼_ty³s_t
 
¼_ty³
, 
to_¼_ty³
;

33 
tÙ®_edges_to_node
 = (*è
	`my_ÿÎoc
(
num_¼_nodes
, ());

34 
num_edges_äom_cu¼’t_to_node
 = (*è
	`my_ÿÎoc
(
num_¼_nodes
,

36 
sw™ch_ty³s_äom_cu¼’t_to_node
 = (*è
	`my_ÿÎoc
(
num_¼_nodes
,

39 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

40 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

41 
num_edges
 = 
¼_node
[
ivex
].num_edges;

42 
	`check_node
(
ivex
, 
rou‹_ty³
);

45 
›dge
 = 0; iedg< 
num_edges
; iedge++) {

46 
to_node
 = 
¼_node
[
ivex
].
edges
[
›dge
];

48 ià(
to_node
 < 0 ||o_nod>ğ
num_¼_nodes
) {

49 
	`´štf
("Error in check_rr_graph:‚ode %d has‡nƒdge %d.\n"

50 "Edgi ouˆoà¿nge.\n", 
ivex
, 
to_node
);

51 
	`ex™
(1);

54 
num_edges_äom_cu¼’t_to_node
[
to_node
]++;

55 
tÙ®_edges_to_node
[
to_node
]++;

56 
sw™ch_ty³
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

58 ià(
sw™ch_ty³
 < 0 || sw™ch_ty³ >ğ
num_sw™ch
) {

59 
	`´štf
("Error in check_rr_graph:‚ode %d has‡ switchype %d.\n"

60 "Sw™chy³ i ouˆoà¿nge.\n", 
ivex
, 
sw™ch_ty³
);

61 
	`ex™
(1);

64 ià(
sw™ch_šf
[
sw™ch_ty³
].
bufã»d
) {

65 
sw™ch_ty³s_äom_cu¼’t_to_node
[
to_node
] |ğ
BUF_FLAG
;

67 
sw™ch_ty³s_äom_cu¼’t_to_node
[
to_node
] |ğ
PTRANS_FLAG
;

71 
›dge
 = 0; iedg< 
num_edges
; iedge++) {

72 
to_node
 = 
¼_node
[
ivex
].
edges
[
›dge
];

74 ià(
num_edges_äom_cu¼’t_to_node
[
to_node
] > 1) {

75 
to_¼_ty³
 = 
¼_node
[
to_node
].
ty³
;

77 ià((
to_¼_ty³
 !ğ
CHANX
 &&o_¼_ty³ !ğ
CHANY
) ||

78 (
¼_ty³
 !ğ
CHANX
 &&„r_ty³ !ğ
CHANY
)) {

79 
	`´štf
("Error in check_rr_graph:‚ode %d connectso‚ode %d "

80 "%dimes.\n", 
ivex
, 
to_node
,

81 
num_edges_äom_cu¼’t_to_node
[
to_node
]);

82 
	`ex™
(1);

86 ià(
num_edges_äom_cu¼’t_to_node
[
to_node
] != 2 ||

87 
sw™ch_ty³s_äom_cu¼’t_to_node
[
to_node
] !=

88 
BUF_AND_PTRANS_FLAG
) {

89 
	`´štf
("Error in check_rr_graph:‚ode %d connectso‚ode %d "

90 "%dimes.\n", 
ivex
, 
to_node
,

91 
num_edges_äom_cu¼’t_to_node
[
to_node
]);

92 
	`ex™
(1);

96 
num_edges_äom_cu¼’t_to_node
[
to_node
] = 0;

97 
sw™ch_ty³s_äom_cu¼’t_to_node
[
to_node
] = 0;

101 #ifdeà
DEBUG


102 
	`check_·ss_Œªsi¡Üs
(
ivex
);

109 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

110 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

112 ià(
¼_ty³
 !ğ
SOURCE
) {

113 ià(
tÙ®_edges_to_node
[
ivex
] < 1 &&

114 !
	`¼_node_is_glob®_şb_š
(
ivex
)) {

117 
	`´štf
("E¼Ü iÀcheck_¼_g¿ph:‚od%d ha nØçnš.\n", 
ivex
);

118 
	`ex™
(1);

121 ià(
tÙ®_edges_to_node
[
ivex
] != 0) {

122 
	`´štf
("Error in check_rr_graph: SOURCE‚ode %d has‡ fanin\n"

123 "\toà%d,ƒx³ùed 0.\n", 
ivex
, 
tÙ®_edges_to_node
[ivex]);

124 
	`ex™
(1);

129 
	`ä“
(
num_edges_äom_cu¼’t_to_node
);

130 
	`ä“
(
tÙ®_edges_to_node
);

131 
	`ä“
(
sw™ch_ty³s_äom_cu¼’t_to_node
);

132 
	}
}

135 
boŞ—n
 
	$¼_node_is_glob®_şb_š
(
ivex
)

138 
š
;

140 ià(
¼_node
[
ivex
].
ty³
 !ğ
IPIN
) {

141  (
FALSE
);

144 ià(
¼_node
[
ivex
].
xlow
 =ğ0 ||„r_node[ivex].xlow =ğ
num_grid_cŞumns
 + 1 ||

145 
¼_node
[
ivex
].
ylow
 =ğ0 ||„r_node[ivex].ylow =ğ
num_grid_rows
 + 1) {

146  (
FALSE
);

149 
š
 = 
¼_node
[
ivex
].
±c_num
;

150  (
is_glob®_şb_pš
[
š
]);

151 
	}
}

154 
	$check_node
(
ivex
, 
rou‹r_ty³s_t
 
rou‹_ty³
)

158 
xlow
, 
ylow
, 
xhigh
, 
yhigh
, 
±c_num
, 
ÿ·c™y
;

159 
¼_ty³s_t
 
¼_ty³
;

160 
nodes_³r_chª
, 
Œacks_³r_node
, 
num_edges
, 
co¡_šdex
;

161 
C
, 
R
;

162 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

163 
xlow
 = 
¼_node
[
ivex
].xlow;

164 
xhigh
 = 
¼_node
[
ivex
].xhigh;

165 
ylow
 = 
¼_node
[
ivex
].ylow;

166 
yhigh
 = 
¼_node
[
ivex
].yhigh;

167 
±c_num
 = 
¼_node
[
ivex
].ptc_num;

168 
ÿ·c™y
 = 
¼_node
[
ivex
].capacity;

170 ià(
xlow
 > 
xhigh
 || 
ylow
 > 
yhigh
) {

171 
	`´štf
("Error in check_node:„rƒndpoints‡re (%d,%d)‡nd (%d,%d).\n",

172 
xlow
, 
ylow
, 
xhigh
, 
yhigh
);

173 
	`ex™
(1);

176 ià(
xlow
 < 0 || 
xhigh
 > 
num_grid_cŞumns
 + 1 || 
ylow
 < 0 || 
yhigh
 > 
num_grid_rows
 + 1) {

177 
	`´štf
("Error in check_node:„rƒndpoints, (%d,%d)‡nd (%d,%d), \n"

178 "¬ouˆoà¿nge.\n", 
xlow
, 
ylow
, 
xhigh
, 
yhigh
);

179 
	`ex™
(1);

182 ià(
±c_num
 < 0) {

183 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

184 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

185 
	`ex™
(1);

190 
¼_ty³
) {

191 
SOURCE
:

192 
SINK
:

193 
IPIN
:

194 
OPIN
:

195 ià(
xlow
 !ğ
xhigh
 || 
ylow
 !ğ
yhigh
) {

196 
	`´štf
("Error in check_node: Node %d (type %d) hasƒndpoints of\n"

197 "(%d,%dèªd (%d,%d)\n", 
ivex
, 
¼_ty³
, 
xlow
, 
ylow
, 
xhigh
, 
yhigh
);

198 
	`ex™
(1);

201 ià(
bš_grids
[
xlow
][
ylow
].
grid_ty³
 !ğ
B_CLB_TYPE


202 && 
bš_grids
[
xlow
][
ylow
].
grid_ty³
 !ğ
IO_TYPE
) {

203 
	`´štf
("Error in check_node: Node %d (type %d) is‡t‡n illegal\n"

204 " clb[%d][%d]).\n", 
ivex
, 
¼_ty³
, 
xlow
, 
ylow
);

205 
	`ex™
(1);

210 
CHANX
:

211 ià(
xlow
 < 1 || 
xhigh
 > 
num_grid_cŞumns
 || 
yhigh
 > 
num_grid_rows
 || yhigh !ğ
ylow
) {

212 
	`´štf
("Error in check_node: CHANX out of„ange.\n");

213 
	`´štf
("Endpošts: (%d,%dèªd (%d,%d)\n", 
xlow
, 
ylow
, 
xhigh
, 
yhigh
);

214 
	`ex™
(1);

217 ià(
rou‹_ty³
 =ğ
GLOBAL
 && 
xlow
 !ğ
xhigh
) {

218 
	`´štf
("E¼Ü iÀcheck_node:‚od%d s·n muÉË chªÃÈ£gm’ts\n" "which i nÙ‡Îowed w™h glob®„outšg.\n", 
ivex
);

219 
	`ex™
(1);

224 
CHANY
:

225 ià(
xhigh
 > 
num_grid_cŞumns
 || 
ylow
 < 1 || 
yhigh
 > 
num_grid_rows
 || 
xlow
 != xhigh) {

226 
	`´štf
("Error in check_node: CHANY out of„ange.\n");

227 
	`´štf
("Endpošts: (%d,%dèªd (%d,%d)\n", 
xlow
, 
ylow
, 
xhigh
, 
yhigh
);

228 
	`ex™
(1);

231 ià(
rou‹_ty³
 =ğ
GLOBAL
 && 
ylow
 !ğ
yhigh
) {

232 
	`´štf
("E¼Ü iÀcheck_node:‚od%d s·n muÉË chªÃÈ£gm’ts\n" "which i nÙ‡Îowed w™h glob®„outšg.\n", 
ivex
);

233 
	`ex™
(1);

239 
	`´štf
("E¼Ü iÀcheck_node: UÃx³ùed segm’ˆty³: %d\n", 
¼_ty³
);

240 
	`ex™
(1);

245 
¼_ty³
) {

246 
SOURCE
:

247 ià(
bš_grids
[
xlow
][
ylow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

248 ià(
±c_num
 >ğ
num_pš_şass
 || 
şass_šf
[±c_num].
ty³
 !ğ
DRIVER
) {

249 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

250 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

251 
	`ex™
(1);

254 ià(
şass_šf
[
±c_num
].
num_pšs
 !ğ
ÿ·c™y
) {

255 
	`´štf
("Error in check_node. Inode %d (type %d) had‡ capacity\n"

256 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

257 
	`ex™
(1);

260 ià(
±c_num
 >ğ
io_¿tio
) {

261 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

262 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

263 
	`ex™
(1);

266 ià(
ÿ·c™y
 != 1) {

267 
	`´štf
("Error in check_node: Inode %d (type %d) had‡ capacity\n"

268 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

269 
	`ex™
(1);

275 
SINK
:

276 ià(
bš_grids
[
xlow
][
ylow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

277 ià(
±c_num
 >ğ
num_pš_şass
 || 
şass_šf
[±c_num].
ty³
 !ğ
RECEIVER
) {

278 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

279 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

280 
	`ex™
(1);

283 ià(
şass_šf
[
±c_num
].
num_pšs
 !ğ
ÿ·c™y
) {

284 
	`´štf
("Error in check_node. Inode %d (type %d) has‡ capacity\n"

285 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

286 
	`ex™
(1);

289 ià(
±c_num
 >ğ
io_¿tio
) {

290 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

291 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

292 
	`ex™
(1);

295 ià(
ÿ·c™y
 != 1) {

296 
	`´štf
("Error in check_node: Inode %d (type %d) has‡ capacity\n"

297 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

298 
	`ex™
(1);

304 
OPIN
:

305 ià(
bš_grids
[
xlow
][
ylow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

306 ià(
±c_num
 >ğ
max_pšs_³r_şb
 || 
şass_šf
[
şb_pš_şass
[±c_num]].
ty³


307 !ğ
DRIVER
) {

308 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

309 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

310 
	`ex™
(1);

313 ià(
±c_num
 >ğ
io_¿tio
) {

314 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

315 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

316 
	`ex™
(1);

320 ià(
ÿ·c™y
 != 1) {

321 
	`´štf
("Error in check_node: Inode %d (type %d) has‡ capacity\n"

322 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

323 
	`ex™
(1);

328 
IPIN
:

329 ià(
bš_grids
[
xlow
][
ylow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

330 ià(
±c_num
 >ğ
max_pšs_³r_şb
 || 
şass_šf
[
şb_pš_şass
[±c_num]].
ty³


331 !ğ
RECEIVER
) {

332 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

333 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

334 
	`ex™
(1);

337 ià(
±c_num
 >ğ
io_¿tio
) {

338 
	`´štf
("Error in check_node. Inode %d (type %d) had‡…tc_num\n"

339 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

340 
	`ex™
(1);

344 ià(
ÿ·c™y
 != 1) {

345 
	`´štf
("Error in check_node: Inode %d (type %d) has‡ capacity\n"

346 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

347 
	`ex™
(1);

352 
CHANX
:

353 ià(
rou‹_ty³
 =ğ
DETAILED
) {

354 
nodes_³r_chª
 = 
chª_width_x
[
ylow
];

355 
Œacks_³r_node
 = 1;

357 
nodes_³r_chª
 = 1;

358 
Œacks_³r_node
 = 
chª_width_x
[
ylow
];

361 ià(
±c_num
 >ğ
nodes_³r_chª
) {

362 
	`´štf
("Error in check_node: Inode %d (type %d) has‡…tc_num\n"

363 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

364 
	`ex™
(1);

367 ià(
ÿ·c™y
 !ğ
Œacks_³r_node
) {

368 
	`´štf
("Error in check_node: Inode %d (type %d) has‡ capacity\n"

369 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

370 
	`ex™
(1);

375 
CHANY
:

376 ià(
rou‹_ty³
 =ğ
DETAILED
) {

377 
nodes_³r_chª
 = 
chª_width_y
[
xlow
];

378 
Œacks_³r_node
 = 1;

380 
nodes_³r_chª
 = 1;

381 
Œacks_³r_node
 = 
chª_width_y
[
xlow
];

384 ià(
±c_num
 >ğ
nodes_³r_chª
) {

385 
	`´štf
("Error in check_node: Inode %d (type %d) has‡…tc_num\n"

386 "oà%d.\n", 
ivex
, 
¼_ty³
, 
±c_num
);

387 
	`ex™
(1);

390 ià(
ÿ·c™y
 !ğ
Œacks_³r_node
) {

391 
	`´štf
("Error in check_node: Inode %d (type %d) has‡ capacity\n"

392 "oà%d.\n", 
ivex
, 
¼_ty³
, 
ÿ·c™y
);

393 
	`ex™
(1);

399 
	`´štf
("E¼Ü iÀcheck_node: UÃx³ùed segm’ˆty³: %d\n", 
¼_ty³
);

400 
	`ex™
(1);

404 
num_edges
 = 
¼_node
[
ivex
].num_edges;

406 ià(
¼_ty³
 !ğ
SINK
) {

407 ià(
num_edges
 <= 0) {

408 
	`´štf
("E¼Ü iÀcheck_node:‚od%d ha nØedges.\n", 
ivex
);

409 
	`ex™
(1);

412 ià(
num_edges
 != 0) {

413 
	`´štf
("Error in check_node:‚ode %d is‡ sink, but has "

414 "%dƒdges.\n", 
ivex
, 
num_edges
);

415 
	`ex™
(1);

420 
C
 = 
¼_node
[
ivex
].C;

421 
R
 = 
¼_node
[
ivex
].R;

423 ià(
¼_ty³
 =ğ
CHANX
 ||„r_ty³ =ğ
CHANY
) {

424 ià(
C
 < 0. || 
R
 < 0.) {

425 
	`´štf
("Error in check_node:‚ode %d ofype %d has R = %g "

426 "ªd C = %g.\n", 
ivex
, 
¼_ty³
, 
R
, 
C
);

427 
	`ex™
(1);

430 ià(
C
 !ğ0. || 
R
 != 0.) {

431 
	`´štf
("Error in check_node:‚ode %d ofype %d has R = %g "

432 "ªd C = %g.\n", 
ivex
, 
¼_ty³
, 
R
, 
C
);

433 
	`ex™
(1);

437 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

439 ià(
co¡_šdex
 < 0 || co¡_šdex >ğ
num_¼_šdexed_d©a
) {

440 
	`´štf
("Error in check_node:‚ode %d cost index (%d) is out of "

441 "¿nge.\n", 
ivex
, 
co¡_šdex
);

442 
	`ex™
(1);

444 
	}
}

447 
	$check_·ss_Œªsi¡Üs
(
äom_node
)

451 
äom_edge
, 
to_node
, 
to_edge
, 
äom_num_edges
, 
to_num_edges
;

452 
¼_ty³s_t
 
äom_¼_ty³
, 
to_¼_ty³
;

453 
äom_sw™ch_ty³
;

454 
boŞ—n
 
Œªs_m©ched
;

455 
äom_¼_ty³
 = 
¼_node
[
äom_node
].
ty³
;

457 ià(
äom_¼_ty³
 !ğ
CHANX
 && from_¼_ty³ !ğ
CHANY
) {

461 
äom_num_edges
 = 
¼_node
[
äom_node
].
num_edges
;

463 
äom_edge
 = 0; from_edg< 
äom_num_edges
; from_edge++) {

464 
to_node
 = 
¼_node
[
äom_node
].
edges
[
äom_edge
];

465 
to_¼_ty³
 = 
¼_node
[
to_node
].
ty³
;

467 ià(
to_¼_ty³
 !ğ
CHANX
 &&o_¼_ty³ !ğ
CHANY
) {

471 
äom_sw™ch_ty³
 = 
¼_node
[
äom_node
].
sw™ches
[
äom_edge
];

473 ià(
sw™ch_šf
[
äom_sw™ch_ty³
].
bufã»d
) {

480 
to_num_edges
 = 
¼_node
[
to_node
].
num_edges
;

481 
Œªs_m©ched
 = 
FALSE
;

483 
to_edge
 = 0;o_edg< 
to_num_edges
;o_edge++) {

484 ià(
¼_node
[
to_node
].
edges
[
to_edge
] =ğ
äom_node
 &&

485 
¼_node
[
to_node
].
sw™ches
[
to_edge
] =ğ
äom_sw™ch_ty³
) {

486 
Œªs_m©ched
 = 
TRUE
;

491 ià(
Œªs_m©ched
 =ğ
FALSE
) {

492 
	`´štf
("Error in check_pass_transistors: Connection from‚ode %do\n"

495 
äom_node
, 
to_node
, 
äom_sw™ch_ty³
);

496 
	`ex™
(1);

499 
	}
}

	@check_rr_graph.h

1 #iâdeà
CHECK_RR_GRAPH_H


2 
	#CHECK_RR_GRAPH_H


	)

4 
	~"v´_ty³s.h
"

6 
check_¼_g¿ph
(
rou‹r_ty³s_t
 
rou‹_ty³
, 
num_sw™ch
);

8 
check_node
(
ivex
, 
rou‹r_ty³s_t
 
rou‹_ty³
);

	@draw.c

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~<m©h.h
>

4 
	~"ut.h
"

5 
	~"v´_ty³s.h
"

6 
	~"glob®s.h
"

7 
	~"g¿phics.h
"

8 
	~"·th_d–ay.h
"

9 
	~"d¿w.h
"

12 
	#EMPTY
 -1

	)

15 
	ee_d¿w_¼_toggË
 {
	mDRAW_NO_RR
 = 0, 
	mDRAW_ALL_RR
, 
	mDRAW_ALL_BUT_BUFFERS_RR
,

16 
	mDRAW_NODES_AND_SBOX_RR
, 
	mDRAW_NODES_RR


19 
	ee_d¿w_Ãt_ty³
 {
	mALL_NETS
, 
	mHIGHLIGHTED
};

21 
	ee_edge_dœ
 {
	mFROM_X_TO_Y
, 
	mFROM_Y_TO_X
};

26 
boŞ—n
 
	gshow_Ãts
 = 
FALSE
;

31 
e_d¿w_¼_toggË
 
	gd¿w_¼_toggË
 = 
DRAW_NO_RR
;

33 
rou‹r_ty³s_t
 
	gd¿w_rou‹_ty³
;

37 
boŞ—n
 
	gshow_cÚge¡iÚ
 = 
FALSE
;

39 
boŞ—n
 
	gshow_g¿phics
;

41 
	gdeçuÉ_mes§ge
[
BUFSIZE
];

43 
	ggr_automode
;

46 
pic_ty³
 
	gpic_Ú_sü“n
 = 
NO_PICTURE
;

48 * 
	gx_şb_Ëá
, *
	gy_şb_bÙtom
;

57 
	gşb_width
, 
	gpš_size
;

61 
cŞÜ_ty³s
* 
	gÃt_cŞÜ
, *
	gblock_cŞÜ
;

68 
toggË_Ãts
((*
d¿wsü“n
)());

69 
	`toggË_¼
((*
d¿wsü“n
)());

70 
	`toggË_cÚge¡iÚ
((*
d¿wsü“n
)());

71 
	`highlight_ü™_·th
((*
d¿wsü“n_±r
)());

73 
	`d¿wsü“n
();

74 
	`»d¿w_sü“n
();

75 
	`d¿w¶aû
();

76 
	`d¿wÃts
();

77 
	`d¿wrou‹
(
e_d¿w_Ãt_ty³
 
d¿w_Ãt_ty³
);

78 
	`d¿w_cÚge¡iÚ
();

80 
	`highlight_blocks
(
x
, 
y
);

81 
	`g‘_block_ûÁ”
(
block_num
, * 
x
, * 
y
);

82 
	`de£Ëù_®l
();

84 
	`d¿w_¼
();

85 
	`d¿w_¼_edges
(
äom_node
);

86 
	`d¿w_¼_pš
(
ivex
, 
cŞÜ_ty³s
 
cŞÜ
);

87 
	`d¿w_¼_chªx
(
ivex
, 
™¿ck
);

88 
	`d¿w_¼_chªy
(
ivex
, 
™¿ck
);

89 
	`g‘_¼_pš_d¿w_coÜds
(
ivex
, 
iside
, * 
xûn
,

90 * 
yûn
);

91 
	`d¿w_pš_to_chª_edge
(
pš_node
, 
chª_node
, 
™¿ck
,

92 
boŞ—n
 
m¬k_cÚn
);

93 
	`d¿w_x
(
x
, 
y
, 
size
);

94 
	`d¿w_chªy_to_chªy_edge
(
äom_node
, 
äom_Œack
,

95 
to_node
, 
to_Œack
, 
sw™ch_ty³
);

96 
	`d¿w_chªx_to_chªx_edge
(
äom_node
, 
äom_Œack
,

97 
to_node
, 
to_Œack
, 
sw™ch_ty³
);

98 
	`d¿w_chªx_to_chªy_edge
(
chªx_node
, 
chªx_Œack
,

99 
chªy_node
, 
chªy_Œack
, 
e_edge_dœ
 
edge_dœ
,

100 
sw™ch_ty³
);

101 
	`g‘_Œack_num
(
ivex
, ** 
chªx_Œack
, ** 
chªy_Œack
);

102 
	`d¿w_¼_sw™ch
(
äom_x
, 
äom_y
, 
to_x
, 
to_y
,

103 
boŞ—n
 
bufã»d
);

110 
	$£t_g¿phics_¡©e
(
boŞ—n
 
show_g¿phics_v®
, 
gr_automode_v®
,

111 
rou‹r_ty³s_t
 
rou‹_ty³
)

116 
show_g¿phics
 = 
show_g¿phics_v®
;

117 
gr_automode
 = 
gr_automode_v®
;

118 
d¿w_rou‹_ty³
 = 
rou‹_ty³
;

119 
	}
}

122 
	$upd©e_sü“n
(
´iÜ™y
, * 
msg
, 
pic_ty³


123 
pic_Ú_sü“n_v®
, 
boŞ—n
 
ü™_·th_bu‰Ú_’abËd
)

128 ià(!
show_g¿phics
) {

135 ià(
pic_Ú_sü“n
 !ğ
pic_Ú_sü“n_v®
) {

136 ià(
pic_Ú_sü“n_v®
 =ğ
PLACEMENT
 && 
pic_Ú_sü“n
 =ğ
NO_PICTURE
) {

137 
	`ü—‹_bu‰Ú
("Wšdow", "ToggË N‘s", 
toggË_Ãts
);

138 } ià(
pic_Ú_sü“n_v®
 =ğ
ROUTING
 && 
pic_Ú_sü“n
 =ğ
PLACEMENT
) {

139 
	`ü—‹_bu‰Ú
("ToggË N‘s", "ToggË RR", 
toggË_¼
);

140 
	`ü—‹_bu‰Ú
("ToggË RR", "CÚge¡iÚ", 
toggË_cÚge¡iÚ
);

142 ià(
ü™_·th_bu‰Ú_’abËd
) {

143 
	`ü—‹_bu‰Ú
("CÚge¡iÚ", "Cr™. P©h", 
highlight_ü™_·th
);

145 } ià(
pic_Ú_sü“n_v®
 =ğ
PLACEMENT
 && 
pic_Ú_sü“n
 =ğ
ROUTING
) {

146 
	`de¡roy_bu‰Ú
("Toggle RR");

147 
	`de¡roy_bu‰Ú
("Congestion");

149 ià(
ü™_·th_bu‰Ú_’abËd
) {

150 
	`de¡roy_bu‰Ú
("Crit. Path");

156 
	`¡ºıy
(
deçuÉ_mes§ge
, 
msg
, 
BUFSIZE
);

157 
pic_Ú_sü“n
 = 
pic_Ú_sü“n_v®
;

158 
	`upd©e_mes§ge
(
msg
);

159 
	`d¿wsü“n
();

161 ià(
´iÜ™y
 >ğ
gr_automode
) {

162 
	`ev’t_loİ
(
highlight_blocks
, 
d¿wsü“n
);

164 
	`æushšput
();

166 
	}
}

169 
	$d¿wsü“n
()

174 
	`ş—rsü“n
();

175 
	`»d¿w_sü“n
();

176 
	}
}

179 
	$»d¿w_sü“n
()

185 ià(
pic_Ú_sü“n
 =ğ
PLACEMENT
) {

186 
	`d¿w¶aû
();

188 ià(
show_Ãts
) {

189 
	`d¿wÃts
();

192 
	`d¿w¶aû
();

194 ià(
show_Ãts
) {

195 
	`d¿wrou‹
(
ALL_NETS
);

197 
	`d¿w_¼
();

200 ià(
show_cÚge¡iÚ
) {

201 
	`d¿w_cÚge¡iÚ
();

204 
	}
}

207 
toggË_Ãts
((*
d¿wsü“n_±r
)())

212 
show_Ãts
 = !show_nets;

213 
d¿w_¼_toggË
 = 
DRAW_NO_RR
;

214 
show_cÚge¡iÚ
 = 
FALSE
;

215 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

216 
	`d¿wsü“n_±r
();

217 
	}
}

220 
toggË_¼
((*
d¿wsü“n_±r
)())

228 
d¿w_¼_toggË
 = (d¿w_¼_toggË + 1è% (
DRAW_NODES_RR
 + 1);

229 
show_Ãts
 = 
FALSE
;

230 
show_cÚge¡iÚ
 = 
FALSE
;

231 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

232 
	`d¿wsü“n_±r
();

233 
	}
}

236 
toggË_cÚge¡iÚ
((*
d¿wsü“n_±r
)())

239 
msg
[
BUFSIZE
];

240 
ivex
, 
num_cÚge¡ed
;

241 
show_Ãts
 = 
FALSE
;

242 
d¿w_¼_toggË
 = 
DRAW_NO_RR
;

243 
show_cÚge¡iÚ
 = !show_congestion;

245 ià(!
show_cÚge¡iÚ
) {

246 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

248 
num_cÚge¡ed
 = 0;

250 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

251 ià(
¼_node
[
ivex
].
m_u§ge
 >„r_node[ivex].
ÿ·c™y
) {

252 
num_cÚge¡ed
++;

256 
	`¥rštf
(
msg
, "%d„outšg„esourû ¬ov”u£d.", 
num_cÚge¡ed
);

257 
	`upd©e_mes§ge
(
msg
);

260 
	`d¿wsü“n_±r
();

261 
	}
}

264 
highlight_ü™_·th
((*
d¿wsü“n_±r
)())

267 
ivex
, 
iblk
, 
š‘
;

269 
Ãts_to_highlight
 = 1;

270 ià(
Ãts_to_highlight
 == 0) {

271 
Ãts_to_highlight
 = 1;

272 
	`de£Ëù_®l
();

273 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

274 
	`d¿wsü“n_±r
();

278 
t_lšked_št
* 
ü™iÿl_·th_h—d
 = 
	`®loÿ‹_ªd_lßd_ü™iÿl_·th
();

279 
t_lšked_št
* 
ü™iÿl_·th_node
 = 
ü™iÿl_·th_h—d
;

280 
num_Ãts_£’
 = 0;

282 
ü™iÿl_·th_node
 !ğ
NULL
) {

283 
ivex
 = 
ü™iÿl_·th_node
->
d©a
;

284 
	`g‘_Šode_block_ªd_ouut_Ãt
(
ivex
, &
iblk
, &
š‘
);

286 ià(
num_Ãts_£’
 =ğ
Ãts_to_highlight
) {

287 
block_cŞÜ
[
iblk
] = 
MAGENTA
;

288 } ià(
num_Ãts_£’
 =ğ
Ãts_to_highlight
 - 1) {

289 
block_cŞÜ
[
iblk
] = 
YELLOW
;

290 } ià(
num_Ãts_£’
 < 
Ãts_to_highlight
) {

291 
block_cŞÜ
[
iblk
] = 
DARKGREEN
;

294 ià(
š‘
 !ğ
OPEN
) {

295 
num_Ãts_£’
++;

297 ià(
num_Ãts_£’
 < 
Ãts_to_highlight
) {

298 
Ãt_cŞÜ
[
š‘
] = 
DARKGREEN
;

299 } ià(
num_Ãts_£’
 =ğ
Ãts_to_highlight
) {

300 
Ãt_cŞÜ
[
š‘
] = 
CYAN
;

304 
ü™iÿl_·th_node
 = cr™iÿl_·th_node->
Ãxt
;

307 
msg
[
BUFSIZE
];

308 ià(
Ãts_to_highlight
 =ğ
num_Ãts_£’
) {

309 
Ãts_to_highlight
 = 0;

310 
	`¥rštf
(
msg
, "All %d‚ets onhe critical…ath highlighted.",

311 
num_Ãts_£’
);

313 
	`¥rštf
(
msg
, "First %d‚ets onhe critical…ath highlighted.",

314 
Ãts_to_highlight
);

315 
Ãts_to_highlight
++;

318 
	`ä“_št_li¡
(&
ü™iÿl_·th_h—d
);

319 
	`upd©e_mes§ge
(
msg
);

320 
	`d¿wsü“n_±r
();

321 
	}
}

324 
	$®loc_d¿w_¡ruùs
()

328 
x_şb_Ëá
 = (*è
	`my_m®loc
((
num_grid_cŞumns
 + 2) * ());

329 
y_şb_bÙtom
 = (*è
	`my_m®loc
((
num_grid_rows
 + 2) * ());

330 
Ãt_cŞÜ
 = (
cŞÜ_ty³s
*è
	`my_m®loc
(
num_Ãts
 *

331 (
cŞÜ_ty³s
));

332 
block_cŞÜ
 = (
cŞÜ_ty³s
*è
	`my_m®loc
(
num_blocks
 *

333 (
cŞÜ_ty³s
));

334 
	`de£Ëù_®l
();

335 
	}
}

338 
	$š™_d¿w_coÜds
(
şb_width_v®
)

343 
i
;

345 ià(!
show_g¿phics
) {

349 
şb_width
 = 
şb_width_v®
;

350 
pš_size
 = 
şb_width
 / (4. * 
max_pšs_³r_şb
);

351 
pš_size
 = 
	`mš
Õš_size, 
şb_width
 / (4. * 
io_¿tio
));

352 
pš_size
 = 
	`mš
(pin_size, 0.3);

353 
x_şb_Ëá
[0] = 0.;

355 
i
 = 1; i <ğ
num_grid_cŞumns
 + 1; i++) {

356 
x_şb_Ëá
[
i
] = x_şb_Ëá[˜- 1] + 
şb_width
 + 
chª_width_y
[i - 1] + 1.;

359 
y_şb_bÙtom
[0] = 0.;

361 
i
 = 1; i <ğ
num_grid_rows
 + 1; i++)

362 
y_şb_bÙtom
[
i
] = y_şb_bÙtom[˜- 1] + 
şb_width
 +

363 
chª_width_x
[
i
 - 1] + 1.;

365 
	`š™_wÜld
(0., 
y_şb_bÙtom
[
num_grid_rows
 + 1] + 
şb_width
,

366 
x_şb_Ëá
[
num_grid_cŞumns
 + 1] + 
şb_width
, 0.);

367 
	}
}

370 
	$d¿w¶aû
()

374 
io_¡•
 = 
şb_width
 / 
io_¿tio
;

375 
x1
, 
y1
, 
x2
, 
y2
;

376 
i
, 
j
, 
k
, 
block_num
;

378 
	`£šewidth
(0);

380 cÚ¡ 
kio_grid_ÿ·c™y
 = 
g_grid_ÿ·c™y
[
IO_TYPE
];

381 
i
 = 1; i <ğ
num_grid_cŞumns
; i++) {

383 
j
 = 0; j <ğ
num_grid_rows
 + 1; j +=‚um_grid_rows + 1) {

384 
y1
 = 
y_şb_bÙtom
[
j
];

385 
y2
 = 
y1
 + 
şb_width
;

386 
	`£še¡yË
(
SOLID
);

389 
k
 = 0; k < 
kio_grid_ÿ·c™y
; ++k) {

390 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

391 ià(
block_num
 =ğ
EMPTY
) {

394 
	`£tcŞÜ
(
block_cŞÜ
[
block_num
]);

395 
x1
 = 
x_şb_Ëá
[
i
] + 
k
 * 
io_¡•
;

396 
x2
 = 
x1
 + 
io_¡•
;

397 
	`fÌeù
(
x1
, 
y1
, 
x2
, 
y2
);

398 
	`£tcŞÜ
(
BLACK
);

399 
	`d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
);

401 
	`d¿w‹xt
((
x1
 + 
x2
è/ 2., 
y1
 + 
io_¡•
 * (
k
 + 0.5),

402 
blocks
[
bš_grids
[
i
][
j
].
š_blocks
[
k
]].
Çme
, 
şb_width
);

405 
	`£še¡yË
(
DASHED
);

406 
	`£tcŞÜ
(
BLACK
);

408 
k
 = 
bš_grids
[
i
][
j
].
m_u§ge
; k < 
io_¿tio
; k++) {

409 
x1
 = 
x_şb_Ëá
[
i
] + 
k
 * 
io_¡•
;

410 
x2
 = 
x1
 + 
io_¡•
;

411 
	`d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
);

417 
j
 = 1; j <ğ
num_grid_rows
; j++) {

418 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; i +=‚um_grid_columns + 1) {

419 
x1
 = 
x_şb_Ëá
[
i
];

420 
x2
 = 
x1
 + 
şb_width
;

421 
	`£še¡yË
(
SOLID
);

423 
k
 = 0; k < 
kio_grid_ÿ·c™y
; ++k) {

424 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

425 
	`£tcŞÜ
(
block_cŞÜ
[
block_num
]);

426 
y1
 = 
y_şb_bÙtom
[
j
] + 
k
 * 
io_¡•
;

427 
y2
 = 
y1
 + 
io_¡•
;

428 
	`fÌeù
(
x1
, 
y1
, 
x2
, 
y2
);

429 
	`£tcŞÜ
(
BLACK
);

430 
	`d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
);

431 
	`d¿w‹xt
((
x1
 + 
x2
è/ 2., (
y1
 + 
y2
) / 2.,

432 
blocks
[
bš_grids
[
i
][
j
].
š_blocks
[
k
]].
Çme
, 
şb_width
);

435 
	`£še¡yË
(
DASHED
);

436 
	`£tcŞÜ
(
BLACK
);

438 
k
 = 
bš_grids
[
i
][
j
].
m_u§ge
; k < 
io_¿tio
; ++k) {

439 
y1
 = 
y_şb_bÙtom
[
j
] + 
k
 * 
io_¡•
;

440 
y2
 = 
y1
 + 
io_¡•
;

441 
	`d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
);

447 
i
 = 1; i <ğ
num_grid_cŞumns
; i++) {

448 
x1
 = 
x_şb_Ëá
[
i
];

449 
x2
 = 
x1
 + 
şb_width
;

451 
j
 = 1; j <ğ
num_grid_rows
; j++) {

452 
y1
 = 
y_şb_bÙtom
[
j
];

453 
y2
 = 
y1
 + 
şb_width
;

455 ià(
bš_grids
[
i
][
j
].
m_u§ge
 != 0) {

456 
	`£še¡yË
(
SOLID
);

458 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[0];

460 
	`£tcŞÜ
(
block_cŞÜ
[
block_num
]);

461 
	`fÌeù
(
x1
, 
y1
, 
x2
, 
y2
);

462 
	`£tcŞÜ
(
BLACK
);

463 
	`d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
);

464 
	`d¿w‹xt
((
x1
 + 
x2
è/ 2., (
y1
 + 
y2
) / 2.,

465 
blocks
[
bš_grids
[
i
][
j
].
š_blocks
[0]].
Çme
,

466 
şb_width
);

468 
	`£še¡yË
(
DASHED
);

469 
	`£tcŞÜ
(
BLACK
);

470 
	`d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
);

474 
	}
}

477 
	$d¿wÃts
()

482 
š‘
, 
š
, 
b1
, 
b2
;

483 
x1
, 
y1
, 
x2
, 
y2
;

484 
	`£še¡yË
(
SOLID
);

485 
	`£šewidth
(0);

490 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

491 ià(
is_glob®
[
š‘
]) {

495 
	`£tcŞÜ
(
Ãt_cŞÜ
[
š‘
]);

496 
b1
 = 
Ãt
[
š‘
].
node_blocks
[0];

497 
	`g‘_block_ûÁ”
(
b1
, &
x1
, &
y1
);

499 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

500 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

501 
b2
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

502 
	`g‘_block_ûÁ”
(
b2
, &
x2
, &
y2
);

503 
	`d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
);

508 
	}
}

511 
	$g‘_block_ûÁ”
(
block_num
, * 
x
, * 
y
)

515 
i
 = 
blocks
[
block_num
].
x
;

516 
j
 = 
blocks
[
block_num
].
y
;

518 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

519 *
x
 = 
x_şb_Ëá
[
i
] + 
şb_width
 / 2.;

520 *
y
 = 
y_şb_bÙtom
[
j
] + 
şb_width
 / 2.;

522 cÚ¡ 
kio_grid_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

523 
k
 = -1;

524 
k
 = 0; k < 
kio_grid_ÿ·c™y
; ++k) {

525 ià(
bš_grids
[
i
][
j
].
š_blocks
[
k
] =ğ
block_num
) {

530 ià(
i
 =ğ0 || i =ğ
num_grid_cŞumns
 + 1) {

531 *
x
 = 
x_şb_Ëá
[
i
] + 
şb_width
 / 2.;

532 *
y
 = 
y_şb_bÙtom
[
j
] + (
k
 + 0.5è* 
şb_width
 / (è
io_¿tio
;

534 *
x
 = 
x_şb_Ëá
[
i
] + (
k
 + 0.5è* 
şb_width
 / (è
io_¿tio
;

535 *
y
 = 
y_şb_bÙtom
[
j
] + 
şb_width
 / 2.;

538 
	}
}

541 
	$d¿w_cÚge¡iÚ
()

544 
ivex
, 
™¿ck
;

545 
	`£tcŞÜ
(
RED
);

546 
	`£šewidth
(2);

548 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

549 ià(
¼_node
[
ivex
].
m_u§ge
 >„r_node[ivex].
ÿ·c™y
) {

550 
¼_node
[
ivex
].
ty³
) {

551 
CHANX
:

552 
™¿ck
 = 
¼_node
[
ivex
].
±c_num
;

553 
	`d¿w_¼_chªx
(
ivex
, 
™¿ck
);

556 
CHANY
:

557 
™¿ck
 = 
¼_node
[
ivex
].
±c_num
;

558 
	`d¿w_¼_chªy
(
ivex
, 
™¿ck
);

561 
IPIN
:

562 
OPIN
:

563 
	`d¿w_¼_pš
(
ivex
, 
RED
);

571 
	}
}

574 
	$d¿w_¼
()

578 
ivex
, 
™¿ck
;

580 ià(
d¿w_¼_toggË
 =ğ
DRAW_NO_RR
) {

581 
	`£šewidth
(3);

582 
	`d¿wrou‹
(
HIGHLIGHTED
);

583 
	`£šewidth
(0);

587 
	`£še¡yË
(
SOLID
);

588 
	`£šewidth
(0);

590 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

591 
¼_node
[
ivex
].
ty³
) {

592 
SOURCE
:

593 
SINK
:

596 
CHANX
:

597 
	`£tcŞÜ
(
BLACK
);

598 
™¿ck
 = 
¼_node
[
ivex
].
±c_num
;

599 
	`d¿w_¼_chªx
(
ivex
, 
™¿ck
);

600 
	`d¿w_¼_edges
(
ivex
);

603 
CHANY
:

604 
	`£tcŞÜ
(
BLACK
);

605 
™¿ck
 = 
¼_node
[
ivex
].
±c_num
;

606 
	`d¿w_¼_chªy
(
ivex
, 
™¿ck
);

607 
	`d¿w_¼_edges
(
ivex
);

610 
IPIN
:

611 
	`d¿w_¼_pš
(
ivex
, 
BLUE
);

614 
OPIN
:

615 
	`d¿w_¼_pš
(
ivex
, 
RED
);

616 
	`£tcŞÜ
(
RED
);

617 
	`d¿w_¼_edges
(
ivex
);

621 
	`´štf
("Error in draw_rr: Unexpected„r_nodeype: %d.\n",

622 
¼_node
[
ivex
].
ty³
);

623 
	`ex™
(1);

627 
	`£šewidth
(3);

628 
	`d¿wrou‹
(
HIGHLIGHTED
);

629 
	`£šewidth
(0);

630 
	}
}

633 
	$d¿w_¼_chªx
(
ivex
, 
™¿ck
)

636 
x1
, 
x2
, 
y
;

638 
x1
 = 
x_şb_Ëá
[
¼_node
[
ivex
].
xlow
];

639 
x2
 = 
x_şb_Ëá
[
¼_node
[
ivex
].
xhigh
] + 
şb_width
;

640 
y
 = 
y_şb_bÙtom
[
¼_node
[
ivex
].
ylow
] + 1. + 
™¿ck
 + 
şb_width
;

641 
	`d¿wlše
(
x1
, 
y
, 
x2
, y);

642 
	}
}

645 
	$d¿w_¼_chªy
(
ivex
, 
™¿ck
)

648 
x
, 
y1
, 
y2
;

650 
x
 = 
x_şb_Ëá
[
¼_node
[
ivex
].
xlow
] + 1. + 
™¿ck
 + 
şb_width
;

651 
y1
 = 
y_şb_bÙtom
[
¼_node
[
ivex
].
ylow
];

652 
y2
 = 
y_şb_bÙtom
[
¼_node
[
ivex
].
yhigh
] + 
şb_width
;

653 
	`d¿wlše
(
x
, 
y1
, x, 
y2
);

654 
	}
}

657 
	$d¿w_¼_edges
(
ivex
)

661 
¼_ty³s_t
 
äom_ty³
, 
to_ty³
;

662 
›dge
, 
to_node
, 
äom_±c_num
, 
to_±c_num
;

663 
sw™ch_ty³
;

664 
äom_ty³
 = 
¼_node
[
ivex
].
ty³
;

666 ià(
d¿w_¼_toggË
 =ğ
DRAW_NODES_RR
 || (draw_rr_toggle ==

667 
DRAW_NODES_AND_SBOX_RR
 && 
äom_ty³
 =ğ
OPIN
)) {

671 
äom_±c_num
 = 
¼_node
[
ivex
].
±c_num
;

673 
›dge
 = 0; iedg< 
¼_node
[
ivex
].
num_edges
; iedge++) {

674 
to_node
 = 
¼_node
[
ivex
].
edges
[
›dge
];

675 
to_ty³
 = 
¼_node
[
to_node
].
ty³
;

676 
to_±c_num
 = 
¼_node
[
to_node
].
±c_num
;

678 
äom_ty³
) {

679 
OPIN
:

680 
to_ty³
) {

681 
CHANX
:

682 
CHANY
:

683 
	`£tcŞÜ
(
RED
);

684 
	`d¿w_pš_to_chª_edge
(
ivex
, 
to_node
, 
to_±c_num
, 
TRUE
);

688 
	`´štf
("Error in draw_rr_edges:‚ode %d (type: %d) connectso \n"

689 "nod%d (ty³: %d).\n", 
ivex
, 
äom_ty³
, 
to_node
, 
to_ty³
);

690 
	`ex™
(1);

696 
CHANX
:

697 
to_ty³
) {

698 
IPIN
:

699 ià(
d¿w_¼_toggË
 =ğ
DRAW_NODES_AND_SBOX_RR
) {

703 
	`£tcŞÜ
(
BLUE
);

704 
	`d¿w_pš_to_chª_edge
(
to_node
, 
ivex
, 
äom_±c_num
, 
TRUE
);

707 
CHANX
:

708 
	`£tcŞÜ
(
DARKGREEN
);

709 
sw™ch_ty³
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

710 
	`d¿w_chªx_to_chªx_edge
(
ivex
, 
äom_±c_num
, 
to_node
,

711 
to_±c_num
, 
sw™ch_ty³
);

714 
CHANY
:

715 
	`£tcŞÜ
(
DARKGREEN
);

716 
sw™ch_ty³
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

717 
	`d¿w_chªx_to_chªy_edge
(
ivex
, 
äom_±c_num
, 
to_node
,

718 
to_±c_num
, 
FROM_X_TO_Y
, 
sw™ch_ty³
);

722 
	`´štf
("Error in draw_rr_edges:‚ode %d (type: %d) connectso \n"

723 "nod%d (ty³: %d).\n", 
ivex
, 
äom_ty³
, 
to_node
, 
to_ty³
);

724 
	`ex™
(1);

730 
CHANY
:

731 
to_ty³
) {

732 
IPIN
:

733 ià(
d¿w_¼_toggË
 =ğ
DRAW_NODES_AND_SBOX_RR
) {

737 
	`£tcŞÜ
(
BLUE
);

738 
	`d¿w_pš_to_chª_edge
(
to_node
, 
ivex
, 
äom_±c_num
, 
TRUE
);

741 
CHANX
:

742 
	`£tcŞÜ
(
DARKGREEN
);

743 
sw™ch_ty³
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

744 
	`d¿w_chªx_to_chªy_edge
(
to_node
, 
to_±c_num
, 
ivex
,

745 
äom_±c_num
, 
FROM_Y_TO_X
, 
sw™ch_ty³
);

748 
CHANY
:

749 
	`£tcŞÜ
(
DARKGREEN
);

750 
sw™ch_ty³
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

751 
	`d¿w_chªy_to_chªy_edge
(
ivex
, 
äom_±c_num
, 
to_node
,

752 
to_±c_num
, 
sw™ch_ty³
);

756 
	`´štf
("Error in draw_rr_edges:‚ode %d (type: %d) connectso \n"

757 "nod%d (ty³: %d).\n", 
ivex
, 
äom_ty³
, 
to_node
, 
to_ty³
);

758 
	`ex™
(1);

765 
	`´štf
("Error: draw_rr_edges called with‚ode %d ofype %d.\n",

766 
ivex
, 
äom_ty³
);

767 
	`ex™
(1);

771 
	}
}

774 
	$d¿w_pš_to_chª_edge
(
pš_node
, 
chª_node
, 
™¿ck
,

775 
boŞ—n
 
m¬k_cÚn
)

783 
¼_ty³s_t
 
chª_ty³
;

784 
pš_x
, 
pš_y
, 
chª_xlow
, 
chª_ylow
;

785 
x1
, 
x2
, 
y1
, 
y2
;

786 
pš_x
 = 
¼_node
[
pš_node
].
xlow
;

787 
pš_y
 = 
¼_node
[
pš_node
].
ylow
;

788 
chª_ty³
 = 
¼_node
[
chª_node
].
ty³
;

790 
chª_ty³
) {

791 
CHANX
:

792 
chª_ylow
 = 
¼_node
[
chª_node
].
ylow
;

794 ià(
pš_y
 =ğ
chª_ylow
) {

795 
	`g‘_¼_pš_d¿w_coÜds
(
pš_node
, 
TOP
, &
x1
, &
y1
);

796 
y1
 +ğ
pš_size
;

798 
	`g‘_¼_pš_d¿w_coÜds
(
pš_node
, 
BOTTOM
, &
x1
, &
y1
);

799 
y1
 -ğ
pš_size
;

802 
y2
 = 
y_şb_bÙtom
[
chª_ylow
] + 
şb_width
 + 1 + 
™¿ck
;

803 
x2
 = 
x1
;

806 
CHANY
:

807 
chª_xlow
 = 
¼_node
[
chª_node
].
xlow
;

809 ià(
pš_x
 =ğ
chª_xlow
) {

810 
	`g‘_¼_pš_d¿w_coÜds
(
pš_node
, 
RIGHT
, &
x1
, &
y1
);

811 
x1
 +ğ
pš_size
;

813 
	`g‘_¼_pš_d¿w_coÜds
(
pš_node
, 
LEFT
, &
x1
, &
y1
);

814 
x1
 -ğ
pš_size
;

817 
x2
 = 
x_şb_Ëá
[
chª_xlow
] + 
şb_width
 + 1 + 
™¿ck
;

818 
y2
 = 
y1
;

822 
	`´štf
("Error in draw_pin_to_chan_edge: invalid channel‚ode %d.\n",

823 
chª_node
);

824 
	`ex™
(1);

827 
	`d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
);

829 ià(
m¬k_cÚn
) {

830 
	`d¿w_x
(
x2
, 
y2
, 0.7 * 
pš_size
);

832 
	}
}

835 
	$d¿w_x
(
x
, 
y
, 
size
)

839 
	`d¿wlše
(
x
 - 
size
, 
y
 + size, x + size, y - size);

840 
	`d¿wlše
(
x
 - 
size
, 
y
 - size, x + size, y + size);

841 
	}
}

844 
	$d¿w_chªx_to_chªy_edge
(
chªx_node
, 
chªx_Œack
,

845 
chªy_node
, 
chªy_Œack
, 
e_edge_dœ
 
edge_dœ
, 

846 
sw™ch_ty³
)

850 
x1
, 
y1
, 
x2
, 
y2
;

851 
chªx_y
, 
chªy_x
, 
chªx_xlow
, 
chªy_ylow
;

852 
chªx_y
 = 
¼_node
[
chªx_node
].
ylow
;

853 
chªx_xlow
 = 
¼_node
[
chªx_node
].
xlow
;

854 
chªy_x
 = 
¼_node
[
chªy_node
].
xlow
;

855 
chªy_ylow
 = 
¼_node
[
chªy_node
].
ylow
;

857 
y1
 = 
y_şb_bÙtom
[
chªx_y
] + 
şb_width
 + 1. + 
chªx_Œack
;

858 
x2
 = 
x_şb_Ëá
[
chªy_x
] + 
şb_width
 + 1. + 
chªy_Œack
;

860 ià(
chªx_xlow
 <ğ
chªy_x
) {

861 
x1
 = 
x_şb_Ëá
[
chªy_x
] + 
şb_width
;

863 
x1
 = 
x_şb_Ëá
[
chªx_xlow
];

866 ià(
chªy_ylow
 <ğ
chªx_y
) {

867 
y2
 = 
y_şb_bÙtom
[
chªx_y
] + 
şb_width
;

869 
y2
 = 
y_şb_bÙtom
[
chªy_ylow
];

872 
	`d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
);

874 ià(
d¿w_¼_toggË
 !ğ
DRAW_ALL_RR
) {

878 ià(
edge_dœ
 =ğ
FROM_X_TO_Y
) {

879 
	`d¿w_¼_sw™ch
(
x1
, 
y1
, 
x2
, 
y2
, 
sw™ch_šf
[
sw™ch_ty³
].
bufã»d
);

881 
	`d¿w_¼_sw™ch
(
x2
, 
y2
, 
x1
, 
y1
, 
sw™ch_šf
[
sw™ch_ty³
].
bufã»d
);

883 
	}
}

886 
	$d¿w_chªx_to_chªx_edge
(
äom_node
, 
äom_Œack
,

887 
to_node
, 
to_Œack
, 
sw™ch_ty³
)

892 
x1
, 
x2
, 
y1
, 
y2
;

893 
äom_y
, 
to_y
, 
äom_xlow
, 
to_xlow
, 
äom_xhigh
, 
to_xhigh
;

894 
äom_y
 = 
¼_node
[
äom_node
].
ylow
;

895 
äom_xlow
 = 
¼_node
[
äom_node
].
xlow
;

896 
äom_xhigh
 = 
¼_node
[
äom_node
].
xhigh
;

897 
to_y
 = 
¼_node
[
to_node
].
ylow
;

898 
to_xlow
 = 
¼_node
[
to_node
].
xlow
;

899 
to_xhigh
 = 
¼_node
[
to_node
].
xhigh
;

901 
y1
 = 
y_şb_bÙtom
[
äom_y
] + 
şb_width
 + 1 + 
äom_Œack
;

902 
y2
 = 
y_şb_bÙtom
[
to_y
] + 
şb_width
 + 1 + 
to_Œack
;

904 ià(
to_xhigh
 < 
äom_xlow
) {

905 
x1
 = 
x_şb_Ëá
[
äom_xlow
];

906 
x2
 = 
x_şb_Ëá
[
to_xhigh
] + 
şb_width
;

907 } ià(
to_xlow
 > 
äom_xhigh
) {

908 
x1
 = 
x_şb_Ëá
[
äom_xhigh
] + 
şb_width
;

909 
x2
 = 
x_şb_Ëá
[
to_xlow
];

914 ià(
to_xlow
 < 
äom_xlow
) {

915 
x1
 = 
x_şb_Ëá
[
äom_xlow
];

916 
x2
 = 
x_şb_Ëá
[
äom_xlow
 - 1] + 
şb_width
;

917 } ià(
äom_xlow
 < 
to_xlow
) {

918 
x1
 = 
x_şb_Ëá
[
to_xlow
 - 1] + 
şb_width
;

919 
x2
 = 
x_şb_Ëá
[
to_xlow
];

920 } ià(
to_xhigh
 > 
äom_xhigh
) {

921 
x1
 = 
x_şb_Ëá
[
äom_xhigh
] + 
şb_width
;

922 
x2
 = 
x_şb_Ëá
[
äom_xhigh
 + 1];

923 } ià(
äom_xhigh
 > 
to_xhigh
) {

924 
x1
 = 
x_şb_Ëá
[
to_xhigh
 + 1];

925 
x2
 = 
x_şb_Ëá
[
to_xhigh
] + 
şb_width
;

927 
x1
 = 
x_şb_Ëá
[
äom_xlow
];

928 
x2
 = 
x_şb_Ëá
[
äom_xlow
] + 
şb_width
;

931 
	`d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
);

933 ià(
d¿w_¼_toggË
 =ğ
DRAW_ALL_RR
) {

934 
	`d¿w_¼_sw™ch
(
x1
, 
y1
, 
x2
, 
y2
, 
sw™ch_šf
[
sw™ch_ty³
].
bufã»d
);

936 
	}
}

939 
	$d¿w_chªy_to_chªy_edge
(
äom_node
, 
äom_Œack
,

940 
to_node
, 
to_Œack
, 
sw™ch_ty³
)

945 
x1
, 
x2
, 
y1
, 
y2
;

946 
äom_x
, 
to_x
, 
äom_ylow
, 
to_ylow
, 
äom_yhigh
, 
to_yhigh
;

947 
äom_x
 = 
¼_node
[
äom_node
].
xlow
;

948 
äom_ylow
 = 
¼_node
[
äom_node
].
ylow
;

949 
äom_yhigh
 = 
¼_node
[
äom_node
].
yhigh
;

950 
to_x
 = 
¼_node
[
to_node
].
xlow
;

951 
to_ylow
 = 
¼_node
[
to_node
].
ylow
;

952 
to_yhigh
 = 
¼_node
[
to_node
].
yhigh
;

954 
x1
 = 
x_şb_Ëá
[
äom_x
] + 
şb_width
 + 1 + 
äom_Œack
;

955 
x2
 = 
x_şb_Ëá
[
to_x
] + 
şb_width
 + 1 + 
to_Œack
;

957 ià(
to_yhigh
 < 
äom_ylow
) {

958 
y1
 = 
y_şb_bÙtom
[
äom_ylow
];

959 
y2
 = 
y_şb_bÙtom
[
to_yhigh
] + 
şb_width
;

960 } ià(
to_ylow
 > 
äom_yhigh
) {

961 
y1
 = 
y_şb_bÙtom
[
äom_yhigh
] + 
şb_width
;

962 
y2
 = 
y_şb_bÙtom
[
to_ylow
];

967 ià(
to_ylow
 < 
äom_ylow
) {

968 
y1
 = 
y_şb_bÙtom
[
äom_ylow
];

969 
y2
 = 
y_şb_bÙtom
[
äom_ylow
 - 1] + 
şb_width
;

970 } ià(
äom_ylow
 < 
to_ylow
) {

971 
y1
 = 
y_şb_bÙtom
[
to_ylow
 - 1] + 
şb_width
;

972 
y2
 = 
y_şb_bÙtom
[
to_ylow
];

973 } ià(
to_yhigh
 > 
äom_yhigh
) {

974 
y1
 = 
y_şb_bÙtom
[
äom_yhigh
] + 
şb_width
;

975 
y2
 = 
y_şb_bÙtom
[
äom_yhigh
 + 1];

976 } ià(
äom_yhigh
 > 
to_yhigh
) {

977 
y1
 = 
y_şb_bÙtom
[
to_yhigh
 + 1];

978 
y2
 = 
y_şb_bÙtom
[
to_yhigh
] + 
şb_width
;

980 
y1
 = 
y_şb_bÙtom
[
äom_ylow
];

981 
y2
 = 
y_şb_bÙtom
[
äom_ylow
] + 
şb_width
;

984 
	`d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
);

986 ià(
d¿w_¼_toggË
 =ğ
DRAW_ALL_RR
) {

987 
	`d¿w_¼_sw™ch
(
x1
, 
y1
, 
x2
, 
y2
, 
sw™ch_šf
[
sw™ch_ty³
].
bufã»d
);

989 
	}
}

992 
	$d¿w_¼_sw™ch
(
äom_x
, 
äom_y
, 
to_x
, 
to_y
,

993 
boŞ—n
 
bufã»d
)

998 cÚ¡ 
sw™ch_¿d
 = 0.15;

999 
magn™ude
, 
xûn
, 
yûn
, 
xd–
, 
yd–
, 
xba£lše
, 
yba£lše
;

1000 
xun™
, 
yun™
;

1001 
t_pošt
 
pŞy
[3];

1002 
xûn
 = 
äom_x
 + (
to_x
 - from_x) / 10.;

1003 
yûn
 = 
äom_y
 + (
to_y
 - from_y) / 10.;

1005 ià(!
bufã»d
) {

1006 
	`d¿w¬c
(
xûn
, 
yûn
, 
sw™ch_¿d
, 0., 360.);

1008 
xd–
 = 
to_x
 - 
äom_x
;

1009 
yd–
 = 
to_y
 - 
äom_y
;

1010 
magn™ude
 = 
	`sq¹
(
xd–
 * xd– + 
yd–
 * ydelta);

1011 
xun™
 = 
xd–
 / 
magn™ude
;

1012 
yun™
 = 
yd–
 / 
magn™ude
;

1013 
pŞy
[0].
x
 = 
xûn
 + 
xun™
 * 
sw™ch_¿d
;

1014 
pŞy
[0].
y
 = 
yûn
 + 
yun™
 * 
sw™ch_¿d
;

1015 
xba£lše
 = 
xûn
 - 
xun™
 * 
sw™ch_¿d
;

1016 
yba£lše
 = 
yûn
 - 
yun™
 * 
sw™ch_¿d
;

1019 
pŞy
[1].
x
 = 
xba£lše
 + 
yun™
 * 
sw™ch_¿d
;

1020 
pŞy
[1].
y
 = 
yba£lše
 - 
xun™
 * 
sw™ch_¿d
;

1021 
pŞy
[2].
x
 = 
xba£lše
 - 
yun™
 * 
sw™ch_¿d
;

1022 
pŞy
[2].
y
 = 
yba£lše
 + 
xun™
 * 
sw™ch_¿d
;

1023 
	`fÍŞy
(
pŞy
, 3);

1025 
	}
}

1028 
	$d¿w_¼_pš
(
ivex
, 
cŞÜ_ty³s
 
cŞÜ
)

1033 
xûn
, 
yûn
;

1034 
¡r
[
BUFSIZE
];

1035 
i
 = 
¼_node
[
ivex
].
xlow
;

1036 
j
 = 
¼_node
[
ivex
].
ylow
;

1037 
š
 = 
¼_node
[
ivex
].
±c_num
;

1038 
	`£tcŞÜ
(
cŞÜ
);

1040 
iside
 = -1;

1041 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

1042 
iside
 = 0; iside <= 3; ++iside) {

1043 ià(
pšloc
[
iside
][
š
] == 1) {

1044 
	`g‘_¼_pš_d¿w_coÜds
(
ivex
, 
iside
, &
xûn
, &
yûn
);

1045 
	`fÌeù
(
xûn
 - 
pš_size
, 
yûn
 -…in_size, xcen +…in_size, ycen +…in_size);

1046 
	`¥rštf
(
¡r
, "%d", 
š
);

1047 
	`£tcŞÜ
(
BLACK
);

1048 
	`d¿w‹xt
(
xûn
, 
yûn
, 
¡r
, 2 * 
pš_size
);

1049 
	`£tcŞÜ
(
cŞÜ
);

1053 ià(
i
 == 0) {

1054 
iside
 = 
RIGHT
;

1055 } ià(
j
 == 0) {

1056 
iside
 = 
TOP
;

1057 } ià(
i
 =ğ
num_grid_cŞumns
 + 1) {

1058 
iside
 = 
LEFT
;

1060 
iside
 = 
BOTTOM
;

1063 
	`g‘_¼_pš_d¿w_coÜds
(
ivex
, 
iside
, &
xûn
, &
yûn
);

1064 
	`fÌeù
(
xûn
 - 
pš_size
, 
yûn
 -…in_size, xcen +…in_size, ycen +…in_size);

1066 
	}
}

1069 
	$g‘_¼_pš_d¿w_coÜds
(
ivex
, 
iside
, * 
xûn
,

1070 * 
yûn
)

1075 
i
, 
j
, 
š
, 
ad
;

1076 
¡•_size
, 
off£t
, 
xc
, 
yc
;

1077 
i
 = 
¼_node
[
ivex
].
xlow
;

1078 
j
 = 
¼_node
[
ivex
].
ylow
;

1079 
xc
 = 
x_şb_Ëá
[
i
];

1080 
yc
 = 
y_şb_bÙtom
[
j
];

1082 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

1083 
š
 = 
¼_node
[
ivex
].
±c_num
;

1084 
¡•_size
 = 
şb_width
 / (
max_pšs_³r_şb
 + 1.);

1085 
off£t
 = (
š
 + 1.è* 
¡•_size
;

1087 
ad
 = 
¼_node
[
ivex
].
±c_num
;

1088 
¡•_size
 = 
şb_width
 / (è
io_¿tio
;

1089 
off£t
 = 
ad
 * 
¡•_size
 + 
şb_width
 / (3. * 
io_¿tio
);

1093 ià(
¼_node
[
ivex
].
ty³
 =ğ
IPIN
) {

1094 
off£t
 +ğ
şb_width
 / (3. * 
io_¿tio
);

1098 
iside
) {

1099 
LEFT
:

1100 
yc
 +ğ
off£t
;

1103 
RIGHT
:

1104 
xc
 +ğ
şb_width
;

1105 
yc
 +ğ
off£t
;

1108 
BOTTOM
:

1109 
xc
 +ğ
off£t
;

1112 
TOP
:

1113 
xc
 +ğ
off£t
;

1114 
yc
 +ğ
şb_width
;

1118 
	`´štf
("Error in get_rr_pin_draw_coords: Unexpected iside %d.\n",

1119 
iside
);

1120 
	`ex™
(1);

1124 *
xûn
 = 
xc
;

1125 *
yûn
 = 
yc
;

1126 
	}
}

1129 
	$d¿wrou‹
(
e_d¿w_Ãt_ty³
 
d¿w_Ãt_ty³
)

1135 ** 
chªx_Œack
 = 
NULL
;

1136 ** 
chªy_Œack
 = 
NULL
;

1137 
š‘
, 
i
, 
j
, 
ivex
, 
´ev_node
, 
´ev_Œack
, 
™¿ck
;

1138 
sw™ch_ty³
;

1139 
s_Œaû
* 
Œ
;

1140 
¼_ty³s_t
 
¼_ty³
, 
´ev_ty³
;

1142 ià(
d¿w_rou‹_ty³
 =ğ
GLOBAL
) {

1144 ià(
chªx_Œack
 =ğ
NULL
) {

1145 
chªx_Œack
 = (**è
	`®loc_m©rix
(1, 
num_grid_cŞumns
, 0, 
num_grid_rows
, ());

1148 ià(
chªy_Œack
 =ğ
NULL
) {

1149 
chªy_Œack
 = (**è
	`®loc_m©rix
(0, 
num_grid_cŞumns
, 1, 
num_grid_rows
, ());

1152 
i
 = 1; i <ğ
num_grid_cŞumns
; i++)

1153 
j
 = 0; j <ğ
num_grid_rows
; j++) {

1154 
chªx_Œack
[
i
][
j
] = -1;

1157 
i
 = 0; i <ğ
num_grid_cŞumns
; i++)

1158 
j
 = 1; j <ğ
num_grid_rows
; j++) {

1159 
chªy_Œack
[
i
][
j
] = -1;

1163 
	`£še¡yË
(
SOLID
);

1167 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

1168 ià(
is_glob®
[
š‘
]) {

1172 ià(
Œaû_h—d
[
š‘
] =ğ
NULL
) {

1176 ià(
d¿w_Ãt_ty³
 =ğ
HIGHLIGHTED
 && 
Ãt_cŞÜ
[
š‘
] =ğ
BLACK
) {

1180 
	`£tcŞÜ
(
Ãt_cŞÜ
[
š‘
]);

1181 
Œ
 = 
Œaû_h—d
[
š‘
];

1182 
ivex
 = 
Œ
->
šdex
;

1183 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

1186 
´ev_node
 = 
ivex
;

1187 
´ev_ty³
 = 
¼_ty³
;

1188 
sw™ch_ty³
 = 
Œ
->
isw™ch
;

1189 
Œ
 =±r->
Ãxt
;

1190 
ivex
 = 
Œ
->
šdex
;

1191 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

1193 
¼_ty³
) {

1194 
OPIN
:

1195 
	`d¿w_¼_pš
(
ivex
, 
Ãt_cŞÜ
[
š‘
]);

1198 
IPIN
:

1199 
	`d¿w_¼_pš
(
ivex
, 
Ãt_cŞÜ
[
š‘
]);

1200 
´ev_Œack
 = 
	`g‘_Œack_num
(
´ev_node
, 
chªx_Œack
, 
chªy_Œack
);

1201 
	`d¿w_pš_to_chª_edge
(
ivex
, 
´ev_node
, 
´ev_Œack
, 
FALSE
);

1204 
CHANX
:

1205 ià(
d¿w_rou‹_ty³
 =ğ
GLOBAL
) {

1206 
chªx_Œack
[
¼_node
[
ivex
].
xlow
][¼_node[ivex].
ylow
]++;

1209 
™¿ck
 = 
	`g‘_Œack_num
(
ivex
, 
chªx_Œack
, 
chªy_Œack
);

1210 
	`d¿w_¼_chªx
(
ivex
, 
™¿ck
);

1212 
´ev_ty³
) {

1213 
CHANX
:

1214 
´ev_Œack
 = 
	`g‘_Œack_num
(
´ev_node
, 
chªx_Œack
, 
chªy_Œack
);

1215 
	`d¿w_chªx_to_chªx_edge
(
´ev_node
, 
´ev_Œack
, 
ivex
, 
™¿ck
,

1216 
sw™ch_ty³
);

1219 
CHANY
:

1220 
´ev_Œack
 = 
	`g‘_Œack_num
(
´ev_node
, 
chªx_Œack
, 
chªy_Œack
);

1221 
	`d¿w_chªx_to_chªy_edge
(
ivex
, 
™¿ck
, 
´ev_node
, 
´ev_Œack
,

1222 
FROM_Y_TO_X
, 
sw™ch_ty³
);

1225 
OPIN
:

1226 
	`d¿w_pš_to_chª_edge
(
´ev_node
, 
ivex
, 
™¿ck
, 
FALSE
);

1230 
	`´štf
("Error in drawroute: Unexpected connection from‡n \n"

1231 "¼_nodoàty³ %dØÚoàty³ %d.\n", 
´ev_ty³
, 
¼_ty³
);

1232 
	`ex™
(1);

1237 
CHANY
:

1238 ià(
d¿w_rou‹_ty³
 =ğ
GLOBAL
) {

1239 
chªy_Œack
[
¼_node
[
ivex
].
xlow
][¼_node[ivex].
ylow
]++;

1242 
™¿ck
 = 
	`g‘_Œack_num
(
ivex
, 
chªx_Œack
, 
chªy_Œack
);

1243 
	`d¿w_¼_chªy
(
ivex
, 
™¿ck
);

1245 
´ev_ty³
) {

1246 
CHANX
:

1247 
´ev_Œack
 = 
	`g‘_Œack_num
(
´ev_node
, 
chªx_Œack
, 
chªy_Œack
);

1248 
	`d¿w_chªx_to_chªy_edge
(
´ev_node
, 
´ev_Œack
, 
ivex
, 
™¿ck
,

1249 
FROM_X_TO_Y
, 
sw™ch_ty³
);

1252 
CHANY
:

1253 
´ev_Œack
 = 
	`g‘_Œack_num
(
´ev_node
, 
chªx_Œack
, 
chªy_Œack
);

1254 
	`d¿w_chªy_to_chªy_edge
(
´ev_node
, 
´ev_Œack
, 
ivex
, 
™¿ck
,

1255 
sw™ch_ty³
);

1258 
OPIN
:

1259 
	`d¿w_pš_to_chª_edge
(
´ev_node
, 
ivex
, 
™¿ck
, 
FALSE
);

1263 
	`´štf
("Error in drawroute: Unexpected connection from‡n \n"

1264 "¼_nodoàty³ %dØÚoàty³ %d.\n", 
´ev_ty³
, 
¼_ty³
);

1265 
	`ex™
(1);

1274 ià(
¼_ty³
 =ğ
SINK
) {

1275 
Œ
 =±r->
Ãxt
;

1277 ià(
Œ
 =ğ
NULL
) {

1281 
ivex
 = 
Œ
->
šdex
;

1282 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

1286 
	}
}

1289 
	$g‘_Œack_num
(
ivex
, ** 
chªx_Œack
, ** 
chªy_Œack
)

1292 
i
, 
j
;

1293 
¼_ty³s_t
 
¼_ty³
;

1295 ià(
d¿w_rou‹_ty³
 =ğ
DETAILED
) {

1296  (
¼_node
[
ivex
].
±c_num
);

1300 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

1301 
i
 = 
¼_node
[
ivex
].
xlow
;

1302 
j
 = 
¼_node
[
ivex
].
ylow
;

1304 
¼_ty³
) {

1305 
CHANX
:

1306  (
chªx_Œack
[
i
][
j
]);

1308 
CHANY
:

1309  (
chªy_Œack
[
i
][
j
]);

1312 
	`´štf
("Error in get_track_num: unexpected‚odeype %d for‚ode %d."

1313 "\n", 
¼_ty³
, 
ivex
);

1314 
	`ex™
(1);

1316 
	}
}

1326 
	$highlight_blocks
(
x
, 
y
)

1329 
i
, 
j
, 
k
, 
block_num
, 
š
, 
ÃŠum
, 
çnblk
;

1330 
şass
 = 0;

1331 
msg
[
BUFSIZE
];

1332 
io_¡•
 = 
şb_width
 / 
io_¿tio
;

1333 
	`de£Ëù_®l
();

1335 
h™
 = 0;

1336 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; i++) {

1337 ià(
x
 <ğ
x_şb_Ëá
[
i
] + 
şb_width
) {

1338 ià(
x
 >ğ
x_şb_Ëá
[
i
]) {

1339 
h™
 = 1;

1346 ià(!
h™
) {

1347 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

1348 
	`d¿wsü“n
();

1352 
h™
 = 0;

1353 
j
 = 0; j <ğ
num_grid_rows
 + 1; j++) {

1354 ià(
y
 <ğ
y_şb_bÙtom
[
j
] + 
şb_width
) {

1355 ià(
y
 >ğ
y_şb_bÙtom
[
j
]) {

1356 
h™
 = 1;

1363 ià(!
h™
) {

1364 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

1365 
	`d¿wsü“n
();

1370 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

1371 ià(
bš_grids
[
i
][
j
].
m_u§ge
 == 0) {

1372 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

1373 
	`d¿wsü“n
();

1377 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[0];

1379 ià(
i
 =ğ0 || i =ğ
num_grid_cŞumns
 + 1) {

1380 
k
 = ()((
y
 - 
y_şb_bÙtom
[
j
]è/ 
io_¡•
);

1382 
k
 = ()((
x
 - 
x_şb_Ëá
[
i
]è/ 
io_¡•
);

1385 ià(
k
 >ğ
bš_grids
[
i
][
j
].
m_u§ge
) {

1386 
	`upd©e_mes§ge
(
deçuÉ_mes§ge
);

1387 
	`d¿wsü“n
();

1391 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

1396 ià(
blocks
[
block_num
].
block_ty³
 =ğ
OUTPAD_TYPE
) {

1397 
ÃŠum
 = 
blocks
[
block_num
].
Ãts
[0];

1398 
Ãt_cŞÜ
[
ÃŠum
] = 
BLUE
;

1399 
çnblk
 = 
Ãt
[
ÃŠum
].
node_blocks
[0];

1400 
block_cŞÜ
[
çnblk
] = 
BLUE
;

1401 } ià(
blocks
[
block_num
].
block_ty³
 =ğ
INPAD_TYPE
) {

1402 
ÃŠum
 = 
blocks
[
block_num
].
Ãts
[0];

1403 
Ãt_cŞÜ
[
ÃŠum
] = 
RED
;

1406 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
ÃŠum
].
num_Ãt_pšs
;

1407 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

1408 
çnblk
 = 
Ãt
[
ÃŠum
].
node_blocks
[
š
];

1409 
block_cŞÜ
[
çnblk
] = 
RED
;

1412 
k
 = 0; k < 
max_pšs_³r_şb
; k++) {

1413 
ÃŠum
 = 
blocks
[
block_num
].
Ãts
[
k
];

1414 ià(
ÃŠum
 =ğ
OPEN
) {

1418 
şass
 = 
şb_pš_şass
[
k
];

1419 ià(
şass_šf
[
şass
].
ty³
 =ğ
DRIVER
) {

1420 
Ãt_cŞÜ
[
ÃŠum
] = 
RED
;

1422 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
ÃŠum
].
num_Ãt_pšs
;

1423 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

1424 
çnblk
 = 
Ãt
[
ÃŠum
].
node_blocks
[
š
];

1425 
block_cŞÜ
[
çnblk
] = 
RED
;

1428 
Ãt_cŞÜ
[
ÃŠum
] = 
BLUE
;

1429 
çnblk
 = 
Ãt
[
ÃŠum
].
node_blocks
[0];

1430 
block_cŞÜ
[
çnblk
] = 
BLUE
;

1435 
block_cŞÜ
[
block_num
] = 
GREEN
;

1436 
	`¥rštf
(
msg
, "Block %d (%sè© (%d, %dè£Ëùed.", 
block_num
, 
blocks
[block_num].
Çme
,

1437 
i
, 
j
);

1438 
	`upd©e_mes§ge
(
msg
);

1439 
	`d¿wsü“n
();

1440 
	}
}

1443 
	$de£Ëù_®l
()

1446 
i
;

1448 
i
 = 0; i < 
num_blocks
; i++) {

1449 
block_cŞÜ
[
i
] = 
LIGHTGREY
;

1452 
i
 = 0; i < 
num_Ãts
; i++) {

1453 
Ãt_cŞÜ
[
i
] = 
BLACK
;

1455 
	}
}

	@draw.h

1 #iâdeà
DRAW_H


2 
	#DRAW_H


	)

4 
	~"v´_ty³s.h
"

6 
upd©e_sü“n
(
´iÜ™y
, * 
msg
, 
pic_ty³
 
pic_Ú_sü“n_v®
,

7 
boŞ—n
 
ü™_·th_bu‰Ú_’abËd
);

9 
®loc_d¿w_¡ruùs
();

11 
š™_d¿w_coÜds
(
şb_width
);

13 
£t_g¿phics_¡©e
(
boŞ—n
 
show_g¿phics_v®
, 
gr_automode_v®
,

14 
rou‹r_ty³s_t
 
rou‹_ty³
);

	@globals.h

1 #iâdeà
GLOBALS_H


2 
	#GLOBALS_H


	)

4 
	~"v´_ty³s.h
"

8 
g_num_grid_ty³s
;

11 * 
g_grid_ÿ·c™y
;

13 
Ãt_t
* 
Ãt
;

14 
num_Ãts
;

15 
boŞ—n
* 
is_glob®
;

16 
num_glob®s
;

19 
block_t
* 
blocks
;

20 
num_blocks
;

21 
num_şbs
;

22 
num_´im¬y_šputs
;

23 
num_´im¬y_ouuts
;

27 
num_grid_cŞumns
, 
num_grid_rows
, 
io_¿tio
, 
max_pšs_³r_şb
;

28 ** 
pšloc
;

29 * 
şb_pš_şass
;

30 
boŞ—n
* 
is_glob®_şb_pš
;

31 
pš_şass_t
* 
şass_šf
;

32 
num_pš_şass
;

35 * 
chª_width_x
;

36 * 
chª_width_y
;

39 
grid_te_t
** 
bš_grids
;

42 
s_Œaû
** 
Œaû_h—d
;

43 
s_Œaû
** 
Œaû_
;

46 
num_¼_nodes
;

47 
¼_node_t
* 
¼_node
;

48 
num_¼_šdexed_d©a
;

49 
¼_šdexed_d©a_t
* 
¼_šdexed_d©a
;

50 ** 
Ãt_¼_‹rmš®s
;

51 
sw™ch_šfo_t
* 
sw™ch_šf
;

52 ** 
¼_şb_sourû
;

54 * 
g_pšs_Ú_block
;

	@graphics.c

1 
	~<m©h.h
>

2 
	~<¡dlib.h
>

3 
	~<¡dio.h
>

4 
	~<¡ršg.h
>

6 
	~"ut.h
"

7 
	~"g¿phics.h
"

8 
	~"v´_ty³s.h
"

11 #iâdeà
NO_GRAPHICS


13 
	~<X11/Xlib.h
>

14 
	~<X11/Xut.h
>

15 
	~<X11/Xos.h
>

16 
	~<X11/X©om.h
>

69 #iâdeà
NO_GRAPHICS


75 
	#XPOST
(
wÜldx
è(((wÜldx)-
xËá
)*
ps_xmuÉ
 + 
ps_Ëá
)

	)

76 
	#YPOST
(
wÜldy
è(((wÜldy)-
ybÙ
)*
ps_ymuÉ
 + 
ps_bÙ
)

	)

81 
	#XTOWORLD
(
x
è(((èx)/
xmuÉ
 + 
xËá
)

	)

82 
	#YTOWORLD
(
y
è(((èy)/
ymuÉ
 + 
ytİ
)

	)

84 
	#max
(
a
,
b
è((×è> (b))? (aè: (b))

	)

85 
	#mš
(
a
,
b
è(×è> (b)? (bè: (a))

	)

87 
	#MWIDTH
 104

	)

88 
	#T_AREA_HEIGHT
 24

	)

89 
	#MAX_FONT_SIZE
 40

	)

90 
	#PI
 3.141592654

	)

92 
	#BUTTON_TEXT_LEN
 20

	)

95 
	mwidth
;

96 
	mheight
;

97 
	mxËá
;

98 
	mytİ
;

99 (*
	mfú
)((*
	md¿wsü“n
)());

100 
Wšdow
 
	mwš
;

101 
	mi¡ext
;

102 
	m‹xt
[
BUTTON_TEXT_LEN
];

103 
	mi¥Şy
;

104 
	mpŞy
[3][2];

105 
	mi¥»s£d
;

106 } 
	tt_bu‰Ú
;

113 cÚ¡ 
	gm’u_fÚt_size
 = 14;

115 
t_bu‰Ú
* 
	gbu‰Ú
;

116 
	gnum_bu‰Ús
;

118 
	gdi¥_ty³
;

119 
Di¥Ïy
* 
	gdi¥Ïy
;

120 
	gsü“n_num
;

121 
GC
 
	ggc
, 
	ggcxÜ
, 
	ggc_m’us
;

122 
XFÚtSŒuù
* 
	gfÚt_šfo
[
MAX_FONT_SIZE
 + 1];

123 
	gfÚt_is_lßded
[
MAX_FONT_SIZE
 + 1];

124 
	gdi¥Ïy_width
, 
	gdi¥Ïy_height
;

125 
	gtİ_width
, 
	gtİ_height
;

126 
Wšdow
 
	gtİËv–
, 
	gm’u
, 
	g‹x»a
;

127 
	gxËá
, 
	gxright
, 
	gytİ
, 
	gybÙ
;

129 
	g§ved_xËá
, 
	g§ved_xright
, 
	g§ved_ytİ
, 
	g§ved_ybÙ
;

131 
	gps_Ëá
, 
	gps_right
, 
	gps_tİ
, 
	gps_bÙ
;

133 
	gps_xmuÉ
, 
	gps_ymuÉ
;

134 
	gxmuÉ
, 
	gymuÉ
;

135 
CŞÜm­
 
	g´iv©e_cm­
;

138 
	gcu¼’tcŞÜ
 = 
BLACK
;

139 
	gcu¼’še¡yË
 = 
SOLID
;

140 
	gcu¼’šewidth
 = 0;

141 
	gcu¼’tfÚtsize
 = 10;

143 
	gmes§ge
[
BUFSIZE
] = "\0";

146 
	gcŞÜs
[
NUM_COLOR
];

149 
FILE
* 
	gps
;

154 
	#MAXPIXEL
 15000

	)

155 
	#MINPIXEL
 -15000

	)

162 
Œª¦©e_up
((*
d¿wsü“n
)());

163 
	`Œª¦©e_Ëá
((*
d¿wsü“n
)());

164 
	`Œª¦©e_right
((*
d¿wsü“n
)());

165 
	`Œª¦©e_down
((*
d¿wsü“n
)());

166 
	`zoom_š
((*
d¿wsü“n
)());

167 
	`zoom_out
((*
d¿wsü“n
)());

168 
	`zoom_f™
((*
d¿wsü“n
)());

169 
	`adju¡wš
((*
d¿wsü“n
)());

170 
	`po¡süt
((*
d¿wsü“n
)());

171 
	`´oûed
((*
d¿wsü“n
)());

172 
	`qu™
((*
d¿wsü“n
)());

174 
BoŞ
 
	`‹¡_if_expo£d
(
Di¥Ïy
* 
di¥
, 
XEv’t
* 
ev’t_±r
,

175 
XPoš‹r
 
dummy
);

176 
	`m­_bu‰Ú
(
block_num
);

177 
	`unm­_bu‰Ú
(
block_num
);

184 
	$xcoÜd
(
wÜldx
)

188 
wšx
;

189 
wšx
 = ()((
wÜldx
 - 
xËá
è* 
xmuÉ
 + 0.5);

199 
wšx
 = 
	`max
(wšx, 
MINPIXEL
);

200 
wšx
 = 
	`mš
(wšx, 
MAXPIXEL
);

201  (
wšx
);

202 
	}
}

205 
	$ycoÜd
(
wÜldy
)

209 
wšy
;

210 
wšy
 = ()((
wÜldy
 - 
ytİ
è* 
ymuÉ
 + 0.5);

212 
wšy
 = 
	`max
(wšy, 
MINPIXEL
);

213 
wšy
 = 
	`mš
(wšy, 
MAXPIXEL
);

214  (
wšy
);

215 
	}
}

218 
	$lßd_fÚt
(
poštsize
)

223 
fÚŠame
[44];

224 
	`¥rštf
(
fÚŠame
, "-*-helvetica-medium-r-*--*-%d0-*-*-*-*-*-*",

225 
poštsize
);

226 #ifdeà
VERBOSE


227 
	`´štf
("Lßdšg fÚt:…ošˆsize: %d, fÚŠame: %s\n", 
poštsize
, 
fÚŠame
);

232 ià((
fÚt_šfo
[
poštsize
] = 
	`XLßdQu”yFÚt
(
di¥Ïy
, 
fÚŠame
)è=ğ
NULL
) {

233 
	`årštf
(
¡d”r
, "Cannot open desired font\n");

234 
	`ex™
(-1);

236 
	}
}

239 
	$fÜû_£tcŞÜ
(
cšdex
)

241 * 
ps_úames
[
NUM_COLOR
] = {"white", "black", "grey55", "grey75",

244 
cu¼’tcŞÜ
 = 
cšdex
;

246 ià(
di¥_ty³
 =ğ
SCREEN
) {

247 
	`XS‘FÜeground
(
di¥Ïy
, 
gc
, 
cŞÜs
[
cšdex
]);

249 
	`årštf
(
ps
, "%s\n", 
ps_úames
[
cšdex
]);

251 
	}
}

254 
	$£tcŞÜ
(
cšdex
)

256 ià(
cu¼’tcŞÜ
 !ğ
cšdex
) {

257 
	`fÜû_£tcŞÜ
(
cšdex
);

259 
	}
}

262 
	$fÜû_£še¡yË
(
lše¡yË
)

266 * 
ps_‹xt
[2] = {"linesolid", "linedashed"};

267 
x_v®s
[2] = {
LšeSŞid
, 
LšeOnOffDash
};

268 
cu¼’še¡yË
 = 
lše¡yË
;

270 ià(
di¥_ty³
 =ğ
SCREEN
) {

271 
	`XS‘LšeA‰ribu‹s
(
di¥Ïy
, 
gc
, 
cu¼’šewidth
, 
x_v®s
[
lše¡yË
],

272 
C­Bu‰
, 
JošM™”
);

274 
	`årštf
(
ps
, "%s\n", 
ps_‹xt
[
lše¡yË
]);

276 
	}
}

279 
	$£še¡yË
(
lše¡yË
)

281 ià(
lše¡yË
 !ğ
cu¼’še¡yË
) {

282 
	`fÜû_£še¡yË
(
lše¡yË
);

284 
	}
}

287 
	$fÜû_£šewidth
(
lšewidth
)

291 
x_v®s
[2] = {
LšeSŞid
, 
LšeOnOffDash
};

292 
cu¼’šewidth
 = 
lšewidth
;

294 ià(
di¥_ty³
 =ğ
SCREEN
) {

295 
	`XS‘LšeA‰ribu‹s
(
di¥Ïy
, 
gc
, 
lšewidth
, 
x_v®s
[
cu¼’še¡yË
],

296 
C­Bu‰
, 
JošM™”
);

298 
	`årštf
(
ps
, "%d s‘lšewidth\n", 
lšewidth
);

300 
	}
}

303 
	$£šewidth
(
lšewidth
)

305 ià(
lšewidth
 !ğ
cu¼’šewidth
) {

306 
	`fÜû_£šewidth
(
lšewidth
);

308 
	}
}

311 
	$fÜû_£tfÚtsize
(
poštsize
)

314 ià(
poštsize
 < 1) {

315 
poštsize
 = 1;

316 } ià(
poštsize
 > 
MAX_FONT_SIZE
) {

317 
poštsize
 = 
MAX_FONT_SIZE
;

320 
cu¼’tfÚtsize
 = 
poštsize
;

322 ià(
di¥_ty³
 =ğ
SCREEN
) {

323 ià(!
fÚt_is_lßded
[
poštsize
]) {

324 
	`lßd_fÚt
(
poštsize
);

325 
fÚt_is_lßded
[
poštsize
] = 1;

328 
	`XS‘FÚt
(
di¥Ïy
, 
gc
, 
fÚt_šfo
[
poštsize
]->
fid
);

331 
	`årštf
(
ps
, "%d s‘fÚtsize\n", 
poštsize
);

333 
	}
}

336 
	$£tfÚtsize
(
poštsize
)

342 ià(
poštsize
 !ğ
cu¼’tfÚtsize
) {

343 
	`fÜû_£tfÚtsize
(
poštsize
);

345 
	}
}

348 
	$bud_‹x»a
()

351 
XS‘WšdowA‰ribu‹s
 
m’u_©Œibu‹s
;

352 
v®uemask
;

353 
‹x»a
 = 
	`XC»©eSim¶eWšdow
(
di¥Ïy
, 
tİËv–
,

354 0, 
tİ_height
 - 
T_AREA_HEIGHT
, 
di¥Ïy_width
, T_AREA_HEIGHT - 4, 2,

355 
cŞÜs
[
BLACK
], cŞÜs[
LIGHTGREY
]);

356 
m’u_©Œibu‹s
.
ev’t_mask
 = 
Exposu»Mask
;

358 
m’u_©Œibu‹s
.
do_nÙ_´İag©e_mask
 = 
Bu‰ÚP»ssMask
;

360 
m’u_©Œibu‹s
.
wš_g¿v™y
 = 
SouthWe¡G¿v™y
;

361 
v®uemask
 = 
CWWšG¿v™y
 | 
CWEv’tMask
 | 
CWDÚtPrİag©e
;

362 
	`XChªgeWšdowA‰ribu‹s
(
di¥Ïy
, 
‹x»a
, 
v®uemask
, &
m’u_©Œibu‹s
);

363 
	`XM­Wšdow
(
di¥Ïy
, 
‹x»a
);

364 
	}
}

367 
	$£Şy
(
block_num
, 
xc
, 
yc
, 
r
, 
th‘a
)

370 
i
;

371 
bu‰Ú
[
block_num
].
i¡ext
 = 0;

372 
bu‰Ú
[
block_num
].
i¥Şy
 = 1;

374 
i
 = 0; i < 3; i++) {

375 
bu‰Ú
[
block_num
].
pŞy
[
i
][0] = ()(
xc
 + 
r
 * 
	`cos
(
th‘a
) + 0.5);

376 
bu‰Ú
[
block_num
].
pŞy
[
i
][1] = ()(
yc
 + 
r
 * 
	`sš
(
th‘a
) + 0.5);

377 
th‘a
 +ğ2 * 
PI
 / 3;

379 
	}
}

382 
	$bud_deçuÉ_m’u
()

385 
XS‘WšdowA‰ribu‹s
 
m’u_©Œibu‹s
;

386 
v®uemask
;

387 
i
, 
xûn
, 
x1
, 
y1
, 
bwid
, 
bheight
, 
¥aû
;

388 
m’u
 = 
	`XC»©eSim¶eWšdow
(
di¥Ïy
, 
tİËv–
,

389 
tİ_width
 - 
MWIDTH
, 0, MWIDTH - 4, 
di¥Ïy_height
, 2,

390 
cŞÜs
[
BLACK
], cŞÜs[
LIGHTGREY
]);

391 
m’u_©Œibu‹s
.
ev’t_mask
 = 
Exposu»Mask
;

393 
m’u_©Œibu‹s
.
do_nÙ_´İag©e_mask
 = 
Bu‰ÚP»ssMask
;

395 
m’u_©Œibu‹s
.
wš_g¿v™y
 = 
NÜthEa¡G¿v™y
;

396 
v®uemask
 = 
CWWšG¿v™y
 | 
CWEv’tMask
 | 
CWDÚtPrİag©e
;

397 
	`XChªgeWšdowA‰ribu‹s
(
di¥Ïy
, 
m’u
, 
v®uemask
, &
m’u_©Œibu‹s
);

398 
	`XM­Wšdow
(
di¥Ïy
, 
m’u
);

399 
num_bu‰Ús
 = 11;

400 
bu‰Ú
 = (
t_bu‰Ú
*è
	`my_m®loc
(
num_bu‰Ús
 * (t_button));

402 
bwid
 = 28;

403 
¥aû
 = 3;

404 
y1
 = 10;

405 
xûn
 = 51;

406 
x1
 = 
xûn
 - 
bwid
 / 2;

407 
bu‰Ú
[0].
xËá
 = 
x1
;

408 
bu‰Ú
[0].
ytİ
 = 
y1
;

409 
	`£Şy
(0, 
bwid
 / 2, bwid / 2, bwid / 3, -
PI
 / 2.);

410 
bu‰Ú
[0].
fú
 = 
Œª¦©e_up
;

411 
y1
 +ğ
bwid
 + 
¥aû
;

412 
x1
 = 
xûn
 - 3 * 
bwid
 / 2 - 
¥aû
;

413 
bu‰Ú
[1].
xËá
 = 
x1
;

414 
bu‰Ú
[1].
ytİ
 = 
y1
;

415 
	`£Şy
(1, 
bwid
 / 2, bwid / 2, bwid / 3, 
PI
);

416 
bu‰Ú
[1].
fú
 = 
Œª¦©e_Ëá
;

417 
x1
 = 
xûn
 + 
bwid
 / 2 + 
¥aû
;

418 
bu‰Ú
[2].
xËá
 = 
x1
;

419 
bu‰Ú
[2].
ytİ
 = 
y1
;

420 
	`£Şy
(2, 
bwid
 / 2, bwid / 2, bwid / 3, 0);

421 
bu‰Ú
[2].
fú
 = 
Œª¦©e_right
;

422 
y1
 +ğ
bwid
 + 
¥aû
;

423 
x1
 = 
xûn
 - 
bwid
 / 2;

424 
bu‰Ú
[3].
xËá
 = 
x1
;

425 
bu‰Ú
[3].
ytİ
 = 
y1
;

426 
	`£Şy
(3, 
bwid
 / 2, bwid / 2, bwid / 3, +
PI
 / 2.);

427 
bu‰Ú
[3].
fú
 = 
Œª¦©e_down
;

429 
i
 = 0; i < 4; i++) {

430 
bu‰Ú
[
i
].
width
 = 
bwid
;

431 
bu‰Ú
[
i
].
height
 = 
bwid
;

435 
y1
 +ğ
bwid
 + 
¥aû
 + 6;

436 
¥aû
 = 8;

437 
bwid
 = 90;

438 
bheight
 = 26;

439 
x1
 = 
xûn
 - 
bwid
 / 2;

441 
i
 = 4; i < 
num_bu‰Ús
; i++) {

442 
bu‰Ú
[
i
].
xËá
 = 
x1
;

443 
bu‰Ú
[
i
].
ytİ
 = 
y1
;

444 
y1
 +ğ
bheight
 + 
¥aû
;

445 
bu‰Ú
[
i
].
i¡ext
 = 1;

446 
bu‰Ú
[
i
].
i¥Şy
 = 0;

447 
bu‰Ú
[
i
].
width
 = 
bwid
;

448 
bu‰Ú
[
i
].
height
 = 
bheight
;

451 
	`¡rıy
(
bu‰Ú
[4].
‹xt
, "Zoom In");

452 
	`¡rıy
(
bu‰Ú
[5].
‹xt
, "Zoom Out");

453 
	`¡rıy
(
bu‰Ú
[6].
‹xt
, "Zoom Fit");

454 
	`¡rıy
(
bu‰Ú
[7].
‹xt
, "Window");

455 
	`¡rıy
(
bu‰Ú
[8].
‹xt
, "PostScript");

456 
	`¡rıy
(
bu‰Ú
[9].
‹xt
, "Proceed");

457 
	`¡rıy
(
bu‰Ú
[10].
‹xt
, "Exit");

458 
bu‰Ú
[4].
fú
 = 
zoom_š
;

459 
bu‰Ú
[5].
fú
 = 
zoom_out
;

460 
bu‰Ú
[6].
fú
 = 
zoom_f™
;

461 
bu‰Ú
[7].
fú
 = 
adju¡wš
;

462 
bu‰Ú
[8].
fú
 = 
po¡süt
;

463 
bu‰Ú
[9].
fú
 = 
´oûed
;

464 
bu‰Ú
[10].
fú
 = 
qu™
;

466 
i
 = 0; i < 
num_bu‰Ús
; i++) {

467 
	`m­_bu‰Ú
(
i
);

469 
	}
}

472 
	$m­_bu‰Ú
(
block_num
)

475 
bu‰Ú
[
block_num
].
wš
 = 
	`XC»©eSim¶eWšdow
(
di¥Ïy
, 
m’u
,

476 
bu‰Ú
[
block_num
].
xËá
, bu‰Ú[block_num].
ytİ
, bu‰Ú[block_num].
width
,

477 
bu‰Ú
[
block_num
].
height
, 0, 
cŞÜs
[
WHITE
], cŞÜs[
LIGHTGREY
]);

478 
	`XM­Wšdow
(
di¥Ïy
, 
bu‰Ú
[
block_num
].
wš
);

479 
	`XS–eùIÅut
(
di¥Ïy
, 
bu‰Ú
[
block_num
].
wš
, 
Bu‰ÚP»ssMask
);

480 
bu‰Ú
[
block_num
].
i¥»s£d
 = 1;

481 
	}
}

484 
	$unm­_bu‰Ú
(
block_num
)

487 
	`XUnm­Wšdow
(
di¥Ïy
, 
bu‰Ú
[
block_num
].
wš
);

488 
	}
}

491 
ü—‹_bu‰Ú
(* 
´ev_bu‰Ú_‹xt
 , * 
bu‰Ú_‹xt
,

492 (*
bu‰Ú_func
)((*
d¿wsü“n
)()))

497 
i
, 
block_num
, 
¥aû
;

498 
¥aû
 = 8;

500 
block_num
 = -1;

502 
i
 = 4; i < 
num_bu‰Ús
; i++) {

503 ià(
bu‰Ú
[
i
].
i¡ext
 == 1 &&

504 
	`¡rcmp
(
bu‰Ú
[
i
].
‹xt
, 
´ev_bu‰Ú_‹xt
) == 0) {

505 
block_num
 = 
i
 + 1;

510 ià(
block_num
 == -1) {

511 
	`´štf
("Error in create_button: button withext %s‚ot found.\n",

512 
´ev_bu‰Ú_‹xt
);

513 
	`ex™
(1);

516 
num_bu‰Ús
++;

517 
bu‰Ú
 = (
t_bu‰Ú
*è
	`my_»®loc
(bu‰Ú, 
num_bu‰Ús
 * (t_button));

520 
bu‰Ú
[
num_bu‰Ús
 - 1].
xËá
 = button[num_buttons - 2].xleft;

521 
bu‰Ú
[
num_bu‰Ús
 - 1].
ytİ
 = button[num_buttons - 2].ytop +

522 
bu‰Ú
[
num_bu‰Ús
 - 2].
height
 + 
¥aû
;

523 
bu‰Ú
[
num_bu‰Ús
 - 1].
height
 = button[num_buttons - 2].height;

524 
bu‰Ú
[
num_bu‰Ús
 - 1].
width
 = button[num_buttons - 2].width;

525 
	`m­_bu‰Ú
(
num_bu‰Ús
 - 1);

527 
i
 = 
num_bu‰Ús
 - 1; i > 
block_num
; i--) {

528 
bu‰Ú
[
i
].
i¥Şy
 = button[i - 1].ispoly;

531 
bu‰Ú
[
i
].
i¡ext
 = button[i - 1].istext;

532 
	`¡rıy
(
bu‰Ú
[
i
].
‹xt
, button[i - 1].text);

533 
bu‰Ú
[
i
].
fú
 = button[i - 1].fcn;

534 
bu‰Ú
[
i
].
i¥»s£d
 = button[i - 1].ispressed;

537 
bu‰Ú
[
block_num
].
i¡ext
 = 1;

538 
bu‰Ú
[
block_num
].
i¥Şy
 = 0;

539 
	`¡ºıy
(
bu‰Ú
[
block_num
].
‹xt
, 
bu‰Ú_‹xt
, 
BUTTON_TEXT_LEN
);

540 
bu‰Ú
[
block_num
].
fú
 = 
bu‰Ú_func
;

541 
bu‰Ú
[
block_num
].
i¥»s£d
 = 1;

542 
	}
}

545 
	$de¡roy_bu‰Ú
(* 
bu‰Ú_‹xt
)

548 
i
, 
block_num
;

549 
block_num
 = -1;

551 
i
 = 4; i < 
num_bu‰Ús
; i++) {

552 ià(
bu‰Ú
[
i
].
i¡ext
 == 1 &&

553 
	`¡rcmp
(
bu‰Ú
[
i
].
‹xt
, 
bu‰Ú_‹xt
) == 0) {

554 
block_num
 = 
i
;

559 ià(
block_num
 == -1) {

560 
	`´štf
("Error in destroy_button: button withext %s‚ot found.\n",

561 
bu‰Ú_‹xt
);

562 
	`ex™
(1);

565 
i
 = 
block_num
 + 1; i < 
num_bu‰Ús
; i++) {

566 
bu‰Ú
[
i
 - 1].
i¥Şy
 = button[i].ispoly;

569 
bu‰Ú
[
i
 - 1].
i¡ext
 = button[i].istext;

570 
	`¡rıy
(
bu‰Ú
[
i
 - 1].
‹xt
, button[i].text);

571 
bu‰Ú
[
i
 - 1].
fú
 = button[i].fcn;

572 
bu‰Ú
[
i
 - 1].
i¥»s£d
 = button[i].ispressed;

575 
	`unm­_bu‰Ú
(
num_bu‰Ús
 - 1);

576 
num_bu‰Ús
--;

577 
bu‰Ú
 = (
t_bu‰Ú
*è
	`my_»®loc
(bu‰Ú, 
num_bu‰Ús
 * (t_button));

578 
	}
}

581 
	$š™_g¿phics
(* 
wšdow_Çme
)

586 * 
di¥Ïy_Çme
 = 
NULL
;

587 
x
, 
y
;

588 
bÜd”_width
 = 2;

589 
XTextPrİ”ty
 
wšdowName
;

591 * 
úames
[
NUM_COLOR
] = {"white", "black", "grey55", "grey75", "blue",

594 
XCŞÜ
 
exaù_def
;

595 
CŞÜm­
 
cm­
;

596 
i
;

597 
v®uemask
 = 0;

598 
XGCV®ues
 
v®ues
;

599 
XEv’t
 
ev’t
;

600 
di¥_ty³
 = 
SCREEN
;

602 
i
 = 0; i <ğ
MAX_FONT_SIZE
; i++) {

603 
fÚt_is_lßded
[
i
] = 0;

608 ià((
di¥Ïy
 = 
	`XO³nDi¥Ïy
(
di¥Ïy_Çme
)è=ğ
NULL
) {

609 
	`årštf
(
¡d”r
, "Cannot connecto X server %s\n",

610 
	`XDi¥ÏyName
(
di¥Ïy_Çme
));

611 
	`ex™
(-1);

615 
sü“n_num
 = 
	`DeçuÉSü“n
(
di¥Ïy
);

616 
di¥Ïy_width
 = 
	`Di¥ÏyWidth
(
di¥Ïy
, 
sü“n_num
);

617 
di¥Ïy_height
 = 
	`Di¥ÏyHeight
(
di¥Ïy
, 
sü“n_num
);

618 
x
 = 
y
 = 0;

619 
tİ_width
 = 2 * 
di¥Ïy_width
 / 3;

620 
tİ_height
 = 4 * 
di¥Ïy_height
 / 5;

621 
cm­
 = 
	`DeçuÉCŞÜm­
(
di¥Ïy
, 
sü“n_num
);

622 
´iv©e_cm­
 = 
NÚe
;

624 
i
 = 0; i < 
NUM_COLOR
; i++) {

625 ià(!
	`XP¬£CŞÜ
(
di¥Ïy
, 
cm­
, 
úames
[
i
], &
exaù_def
)) {

626 
	`årštf
(
¡d”r
, "CŞÜ‚am% nÙ iÀd©aba£", 
úames
[
i
]);

627 
	`ex™
(-1);

630 ià(!
	`XAÎocCŞÜ
(
di¥Ïy
, 
cm­
, &
exaù_def
)) {

631 
	`årštf
(
¡d”r
, "Couldn'ˆ®loÿ‹ cŞÜ %s.\n", 
úames
[
i
]);

633 ià(
´iv©e_cm­
 =ğ
NÚe
) {

634 
	`årštf
(
¡d”r
, "Willryo‡llocate‡…rivate colourmap.\n");

635 
	`årštf
(
¡d”r
, "Colours will only display correctly when your "

639 
´iv©e_cm­
 = 
	`XCİyCŞÜm­AndF»e
(
di¥Ïy
, 
cm­
);

640 
cm­
 = 
´iv©e_cm­
;

642 ià(!
	`XAÎocCŞÜ
(
di¥Ïy
, 
cm­
, &
exaù_def
)) {

643 
	`årštf
(
¡d”r
, "Couldn't‡llocate color %s‡s…rivate.\n",

644 
úames
[
i
]);

645 
	`ex™
(1);

648 
	`årštf
(
¡d”r
, "Couldn't‡llocate color %s‡s…rivate.\n",

649 
úames
[
i
]);

650 
	`ex™
(1);

654 
cŞÜs
[
i
] = 
exaù_def
.
pix–
;

657 
tİËv–
 = 
	`XC»©eSim¶eWšdow
(
di¥Ïy
, 
	`RoÙWšdow
(di¥Ïy, 
sü“n_num
),

658 
x
, 
y
, 
tİ_width
, 
tİ_height
, 
bÜd”_width
, 
cŞÜs
[
BLACK
],

659 
cŞÜs
[
WHITE
]);

661 ià(
´iv©e_cm­
 !ğ
NÚe
) {

662 
	`XS‘WšdowCŞÜm­
(
di¥Ïy
, 
tİËv–
, 
´iv©e_cm­
);

666 
	`XS–eùIÅut
(
di¥Ïy
, 
tİËv–
, 
Exposu»Mask
 | 
SŒuùu»NÙifyMask
 |

667 
Bu‰ÚP»ssMask
);

669 
gc
 = 
	`XC»©eGC
(
di¥Ïy
, 
tİËv–
, 
v®uemask
, &
v®ues
);

670 
gc_m’us
 = 
	`XC»©eGC
(
di¥Ïy
, 
tİËv–
, 
v®uemask
, &
v®ues
);

672 
v®ues
.
funùiÚ
 = 
GXxÜ
;

673 
v®ues
.
fÜeground
 = 
cŞÜs
[
BLACK
];

674 
gcxÜ
 = 
	`XC»©eGC
(
di¥Ïy
, 
tİËv–
, (
GCFunùiÚ
 | 
GCFÜeground
),

675 &
v®ues
);

677 
	`lßd_fÚt
(
m’u_fÚt_size
);

678 
fÚt_is_lßded
[
m’u_fÚt_size
] = 1;

679 
	`XS‘FÚt
(
di¥Ïy
, 
gc_m’us
, 
fÚt_šfo
[
m’u_fÚt_size
]->
fid
);

682 
	`fÜû_£tfÚtsize
(
cu¼’tfÚtsize
);

683 
	`fÜû_£tcŞÜ
(
cu¼’tcŞÜ
);

684 
	`fÜû_£še¡yË
(
cu¼’še¡yË
);

685 
	`fÜû_£šewidth
(
cu¼’šewidth
);

686 
	`XSŒšgLi¡ToTextPrİ”ty
(&
wšdow_Çme
, 1, &
wšdowName
);

687 
	`XS‘WMName
(
di¥Ïy
, 
tİËv–
, &
wšdowName
);

691 
	`ä“
(
wšdowName
.
v®ue
);

692 
	`XM­Wšdow
(
di¥Ïy
, 
tİËv–
);

693 
	`bud_‹x»a
();

694 
	`bud_deçuÉ_m’u
();

701 
	`XP“kIfEv’t
(
di¥Ïy
, &
ev’t
, 
‹¡_if_expo£d
, 
NULL
);

702 
	}
}

705 
BoŞ
 
	$‹¡_if_expo£d
(
Di¥Ïy
* 
di¥
, 
XEv’t
* 
ev’t_±r
,

706 
XPoš‹r
 
dummy
)

710 ià(
ev’t_±r
->
ty³
 =ğ
Expo£
) {

711  (
True
);

714  (
F®£
);

715 
	}
}

718 
	$m’u‹xt
(
Wšdow
 
wš
, 
xc
, 
yc
, * 
‹xt
)

721 
Ën
, 
width
;

722 
Ën
 = 
	`¡¾’
(
‹xt
);

723 
width
 = 
	`XTextWidth
(
fÚt_šfo
[
m’u_fÚt_size
], 
‹xt
, 
Ën
);

724 
	`XD¿wSŒšg
(
di¥Ïy
, 
wš
, 
gc_m’us
, 
xc
 - 
width
 / 2, 
yc
 +

725 (
fÚt_šfo
[
m’u_fÚt_size
]->
asûÁ
 - fÚt_šfo[m’u_fÚt_size]->
desûÁ
) / 2,

726 
‹xt
, 
Ën
);

727 
	}
}

730 
	$d¿wbut
(
block_num
)

733 
width
, 
height
, 
thick
, 
i
, 
i¥»s£d
;

734 
XPošt
 
mypŞy
[6];

735 
i¥»s£d
 = 
bu‰Ú
[
block_num
].ispressed;

736 
thick
 = 2;

737 
width
 = 
bu‰Ú
[
block_num
].width;

738 
height
 = 
bu‰Ú
[
block_num
].height;

741 ià(
i¥»s£d
) {

742 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
BLACK
]);

744 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
WHITE
]);

750 
mypŞy
[0].
x
 = 0;

751 
mypŞy
[0].
y
 = 
height
;

752 
mypŞy
[1].
x
 = 0;

753 
mypŞy
[1].
y
 = 0;

754 
mypŞy
[2].
x
 = 
width
;

755 
mypŞy
[2].
y
 = 0;

756 
mypŞy
[3].
x
 = 
width
 - 
thick
;

757 
mypŞy
[3].
y
 = 
thick
;

758 
mypŞy
[4].
x
 = 
thick
;

759 
mypŞy
[4].
y
 = 
thick
;

760 
mypŞy
[5].
x
 = 
thick
;

761 
mypŞy
[5].
y
 = 
height
 - 
thick
;

762 
	`XFlPŞygÚ
(
di¥Ïy
, 
bu‰Ú
[
block_num
].
wš
, 
gc_m’us
, 
mypŞy
, 6, 
CÚvex
,

763 
CoÜdModeOrigš
);

766 ià(
i¥»s£d
) {

767 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
WHITE
]);

769 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
BLACK
]);

772 
mypŞy
[0].
x
 = 0;

773 
mypŞy
[0].
y
 = 
height
;

774 
mypŞy
[1].
x
 = 
width
;

775 
mypŞy
[1].
y
 = 
height
;

776 
mypŞy
[2].
x
 = 
width
;

777 
mypŞy
[2].
y
 = 0;

778 
mypŞy
[3].
x
 = 
width
 - 
thick
;

779 
mypŞy
[3].
y
 = 
thick
;

780 
mypŞy
[4].
x
 = 
width
 - 
thick
;

781 
mypŞy
[4].
y
 = 
height
 - 
thick
;

782 
mypŞy
[5].
x
 = 
thick
;

783 
mypŞy
[5].
y
 = 
height
 - 
thick
;

784 
	`XFlPŞygÚ
(
di¥Ïy
, 
bu‰Ú
[
block_num
].
wš
, 
gc_m’us
, 
mypŞy
, 6, 
CÚvex
,

785 
CoÜdModeOrigš
);

788 ià(
i¥»s£d
) {

789 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
DARKGREY
]);

791 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
LIGHTGREY
]);

795 
	`XFlReùªgË
(
di¥Ïy
, 
bu‰Ú
[
block_num
].
wš
, 
gc_m’us
, 
thick
,hick,

796 
width
 - 2 * 
thick
, 
height
 - 2 *hick);

799 ià(
bu‰Ú
[
block_num
].
i¥Şy
) {

800 
i
 = 0; i < 3; i++) {

801 
mypŞy
[
i
].
x
 = 
bu‰Ú
[
block_num
].
pŞy
[i][0];

802 
mypŞy
[
i
].
y
 = 
bu‰Ú
[
block_num
].
pŞy
[i][1];

805 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
BLACK
]);

806 
	`XFlPŞygÚ
(
di¥Ïy
, 
bu‰Ú
[
block_num
].
wš
, 
gc_m’us
, 
mypŞy
, 3, 
CÚvex
,

807 
CoÜdModeOrigš
);

811 ià(
bu‰Ú
[
block_num
].
i¡ext
) {

812 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
BLACK
]);

813 
	`m’u‹xt
(
bu‰Ú
[
block_num
].
wš
, bu‰Ú[block_num].
width
 / 2,

814 
bu‰Ú
[
block_num
].
height
 / 2, bu‰Ú[block_num].
‹xt
);

816 
	}
}

819 
	$tuº_Ú_off
(
´es£d
)

823 
i
;

825 
i
 = 0; i < 
num_bu‰Ús
; i++) {

826 
bu‰Ú
[
i
].
i¥»s£d
 = 
´es£d
;

827 
	`d¿wbut
(
i
);

829 
	}
}

832 
	$which_bu‰Ú
(
Wšdow
 
wš
)

834 
i
;

836 
i
 = 0; i < 
num_bu‰Ús
; i++) {

837 ià(
bu‰Ú
[
i
].
wš
 == win) {

838 (
i
);

842 
	`´štf
("Error: Unknown button ID in which_button.\n");

844 
	}
}

847 
	$d¿wm’u
()

849 
i
;

851 
i
 = 0; i < 
num_bu‰Ús
; i++) {

852 
	`d¿wbut
(
i
);

854 
	}
}

857 
	$upd©e_ŒªsfÜm
()

861 
muÉ
, 
y1
, 
y2
, 
x1
, 
x2
;

863 
xmuÉ
 = ((è
tİ_width
 - 1. - 
MWIDTH
è/ (
xright
 - 
xËá
);

864 
ymuÉ
 = ((è
tİ_height
 - 1. - 
T_AREA_HEIGHT
è/ (
ybÙ
 - 
ytİ
);

867 ià(
	`çbs
(
xmuÉ
è<ğçbs(
ymuÉ
)) {

868 
muÉ
 = 
	`çbs
(
ymuÉ
 / 
xmuÉ
);

869 
y1
 = 
ytİ
 - (
ybÙ
 - ytİè* (
muÉ
 - 1.) / 2.;

870 
y2
 = 
ybÙ
 + (ybÙ - 
ytİ
è* (
muÉ
 - 1.) / 2.;

871 
ytİ
 = 
y1
;

872 
ybÙ
 = 
y2
;

874 
muÉ
 = 
	`çbs
(
xmuÉ
 / 
ymuÉ
);

875 
x1
 = 
xËá
 - (
xright
 - xËáè* (
muÉ
 - 1.) / 2.;

876 
x2
 = 
xright
 + (xrighˆ- 
xËá
è* (
muÉ
 - 1.) / 2.;

877 
xËá
 = 
x1
;

878 
xright
 = 
x2
;

881 
xmuÉ
 = ((è
tİ_width
 - 1. - 
MWIDTH
è/ (
xright
 - 
xËá
);

882 
ymuÉ
 = ((è
tİ_height
 - 1. - 
T_AREA_HEIGHT
è/ (
ybÙ
 - 
ytİ
);

883 
	}
}

886 
	$upd©e_ps_ŒªsfÜm
()

893 
ps_width
, 
ps_height
;

894 
ps_width
 = 540.;

895 
ps_height
 = 720.;

896 
ps_xmuÉ
 = 
ps_width
 / (
xright
 - 
xËá
);

897 
ps_ymuÉ
 = 
ps_height
 / (
ytİ
 - 
ybÙ
);

902 ià(
	`çbs
(
ps_xmuÉ
è<ğçbs(
ps_ymuÉ
)) {

903 
ps_Ëá
 = 36.;

904 
ps_right
 = 36. + 
ps_width
;

905 
ps_bÙ
 = 396. - 
	`çbs
(
ps_xmuÉ
 * (
ytİ
 - 
ybÙ
)) / 2.;

906 
ps_tİ
 = 396. + 
	`çbs
(
ps_xmuÉ
 * (
ytİ
 - 
ybÙ
)) / 2.;

908 
ps_ymuÉ
 = (
ps_xmuÉ
 *…s_ymult < 0) ? -ps_xmult :…s_xmult;

910 
ps_bÙ
 = 36.;

911 
ps_tİ
 = 36. + 
ps_height
;

912 
ps_Ëá
 = 306. - 
	`çbs
(
ps_ymuÉ
 * (
xright
 - 
xËá
)) / 2.;

913 
ps_right
 = 306. + 
	`çbs
(
ps_ymuÉ
 * (
xright
 - 
xËá
)) / 2.;

915 
ps_xmuÉ
 = (ps_xmuÉ * 
ps_ymuÉ
 < 0) ? -ps_ymult :…s_ymult;

917 
	}
}

920 
ev’t_loİ
((*
aù_Ú_bu‰Ú
)(
x
, 
y
),

921 (*
d¿wsü“n
)())

927 
XEv’t
 
»pÜt
;

928 
block_num
;

929 
x
, 
y
;

930 
	#OFF
 1

	)

931 
	#ON
 0

	)

932 
	`tuº_Ú_off
(
ON
);

935 
	`XNextEv’t
(
di¥Ïy
, &
»pÜt
);

937 
»pÜt
.
ty³
) {

938 
Expo£
:

939 #ifdeà
VERBOSE


940 
	`´štf
("Got‡nƒxposeƒvent.\n");

941 
	`´štf
("CouÁ is: %d.\n", 
»pÜt
.
xexpo£
.
couÁ
);

942 
	`´štf
("Wšdow ID is: %d.\n", 
»pÜt
.
xexpo£
.
wšdow
);

945 ià(
»pÜt
.
xexpo£
.
couÁ
 != 0) {

949 ià(
»pÜt
.
xexpo£
.
wšdow
 =ğ
m’u
) {

950 
	`d¿wm’u
();

951 } ià(
»pÜt
.
xexpo£
.
wšdow
 =ğ
tİËv–
) {

952 
	`d¿wsü“n
();

953 } ià(
»pÜt
.
xexpo£
.
wšdow
 =ğ
‹x»a
) {

954 
	`d¿w_mes§ge
();

959 
CÚfigu»NÙify
:

960 
tİ_width
 = 
»pÜt
.
xcÚfigu»
.
width
;

961 
tİ_height
 = 
»pÜt
.
xcÚfigu»
.
height
;

962 
	`upd©e_ŒªsfÜm
();

963 #ifdeà
VERBOSE


964 
	`´štf
("Got‡ ConfigureNotify.\n");

965 
	`´štf
("New width: %d New height: %d.\n", 
tİ_width
, 
tİ_height
);

969 
Bu‰ÚP»ss
:

970 #ifdeà
VERBOSE


971 
	`´štf
("Got‡ buttonpress.\n");

972 
	`´štf
("Wšdow ID is: %d.\n", 
»pÜt
.
xbu‰Ú
.
wšdow
);

975 ià(
»pÜt
.
xbu‰Ú
.
wšdow
 =ğ
tİËv–
) {

976 
x
 = 
	`XTOWORLD
(
»pÜt
.
xbu‰Ú
.x);

977 
y
 = 
	`YTOWORLD
(
»pÜt
.
xbu‰Ú
.y);

978 
	`aù_Ú_bu‰Ú
(
x
, 
y
);

980 
block_num
 = 
	`which_bu‰Ú
(
»pÜt
.
xbu‰Ú
.
wšdow
);

981 #ifdeà
VERBOSE


982 
	`´štf
("Bu‰Ú‚umb” i %d\n", 
block_num
);

984 
bu‰Ú
[
block_num
].
i¥»s£d
 = 1;

985 
	`d¿wbut
(
block_num
);

986 
	`XFlush
(
di¥Ïy
);

987 
bu‰Ú
[
block_num
].
	`fú
(
d¿wsü“n
);

988 
bu‰Ú
[
block_num
].
i¥»s£d
 = 0;

989 
	`d¿wbut
(
block_num
);

991 ià(
bu‰Ú
[
block_num
].
fú
 =ğ
´oûed
) {

992 
	`tuº_Ú_off
(
OFF
);

993 
	`æushšput
();

1002 
	}
}

1006 
	$ş—rsü“n
()

1008 
§vecŞÜ
;

1010 ià(
di¥_ty³
 =ğ
SCREEN
) {

1011 
	`XCË¬Wšdow
(
di¥Ïy
, 
tİËv–
);

1016 
§vecŞÜ
 = 
cu¼’tcŞÜ
;

1017 
	`£tcŞÜ
(
WHITE
);

1018 
	`årštf
(
ps
, "clippath fill\n\n");

1019 
	`£tcŞÜ
(
§vecŞÜ
);

1021 
	}
}

1023 
	$»ù_off_sü“n
(
x1
, 
y1
, 
x2
, 
y2
)

1031 
xmš
, 
xmax
, 
ymš
, 
ymax
;

1032 
xmš
 = 
	`mš
(
xËá
, 
xright
);

1034 ià(
x1
 < 
xmš
 && 
x2
 < xmin) {

1038 
xmax
 = 
	`max
(
xËá
, 
xright
);

1040 ià(
x1
 > 
xmax
 && 
x2
 > xmax) {

1044 
ymš
 = 
	`mš
(
ytİ
, 
ybÙ
);

1046 ià(
y1
 < 
ymš
 && 
y2
 < ymin) {

1050 
ymax
 = 
	`max
(
ytİ
, 
ybÙ
);

1052 ià(
y1
 > 
ymax
 && 
y2
 > ymax) {

1057 
	}
}

1060 
	$d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
)

1064 ià(
	`»ù_off_sü“n
(
x1
, 
y1
, 
x2
, 
y2
)) {

1068 ià(
di¥_ty³
 =ğ
SCREEN
) {

1070 
	`XD¿wLše
(
di¥Ïy
, 
tİËv–
, 
gc
, 
	`xcoÜd
(
x1
), 
	`ycoÜd
(
y1
),

1071 
	`xcoÜd
(
x2
), 
	`ycoÜd
(
y2
));

1073 
	`årštf
(
ps
, "%.2à%.2à%.2à%.2àd¿wlše\n", 
	`XPOST
(
x1
), 
	`YPOST
(
y1
),

1074 
	`XPOST
(
x2
), 
	`YPOST
(
y2
));

1076 
	}
}

1078 
	$d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
)

1081 
width
, 
height
;

1082 
xw1
, 
yw1
, 
xw2
, 
yw2
, 
xl
, 
yt
;

1084 ià(
	`»ù_off_sü“n
(
x1
, 
y1
, 
x2
, 
y2
)) {

1088 ià(
di¥_ty³
 =ğ
SCREEN
) {

1090 
xw1
 = 
	`xcoÜd
(
x1
);

1091 
xw2
 = 
	`xcoÜd
(
x2
);

1092 
yw1
 = 
	`ycoÜd
(
y1
);

1093 
yw2
 = 
	`ycoÜd
(
y2
);

1094 
xl
 = 
	`mš
(
xw1
, 
xw2
);

1095 
yt
 = 
	`mš
(
yw1
, 
yw2
);

1096 
width
 = 
	`abs
(
xw1
 - 
xw2
);

1097 
height
 = 
	`abs
(
yw1
 - 
yw2
);

1098 
	`XD¿wReùªgË
(
di¥Ïy
, 
tİËv–
, 
gc
, 
xl
, 
yt
, 
width
, 
height
);

1100 
	`årštf
(
ps
, "%.2à%.2à%.2à%.2àd¿w»ù\n", 
	`XPOST
(
x1
), 
	`YPOST
(
y1
),

1101 
	`XPOST
(
x2
), 
	`YPOST
(
y2
));

1103 
	}
}

1106 
	$fÌeù
(
x1
, 
y1
, 
x2
, 
y2
)

1109 
width
, 
height
;

1110 
xw1
, 
yw1
, 
xw2
, 
yw2
, 
xl
, 
yt
;

1112 ià(
	`»ù_off_sü“n
(
x1
, 
y1
, 
x2
, 
y2
)) {

1116 ià(
di¥_ty³
 =ğ
SCREEN
) {

1118 
xw1
 = 
	`xcoÜd
(
x1
);

1119 
xw2
 = 
	`xcoÜd
(
x2
);

1120 
yw1
 = 
	`ycoÜd
(
y1
);

1121 
yw2
 = 
	`ycoÜd
(
y2
);

1122 
xl
 = 
	`mš
(
xw1
, 
xw2
);

1123 
yt
 = 
	`mš
(
yw1
, 
yw2
);

1124 
width
 = 
	`abs
(
xw1
 - 
xw2
);

1125 
height
 = 
	`abs
(
yw1
 - 
yw2
);

1126 
	`XFlReùªgË
(
di¥Ïy
, 
tİËv–
, 
gc
, 
xl
, 
yt
, 
width
, 
height
);

1128 
	`årštf
(
ps
, "%.2à%.2à%.2à%.2àfÌeù\n", 
	`XPOST
(
x1
), 
	`YPOST
(
y1
),

1129 
	`XPOST
(
x2
), 
	`YPOST
(
y2
));

1131 
	}
}

1134 
	$ªgnÜm
(
ªg
)

1137 
sÿË
;

1139 ià(
ªg
 < 0) {

1140 
sÿË
 = ()(
ªg
 / 360. - 1);

1142 
sÿË
 = ()(
ªg
 / 360.);

1145 
ªg
 =‡ng - 
sÿË
 * 360.;

1146  (
ªg
);

1147 
	}
}

1150 
	$d¿w¬c
(
xc
, 
yc
, 
¿d
, 
¡¬ng
,

1151 
ªgex‹Á
)

1158 
xl
, 
yt
;

1159 
width
, 
height
;

1164 ià(
	`»ù_off_sü“n
(
xc
 - 
¿d
, 
yc
 -„ad, xc +„ad, yc +„ad)) {

1170 ià(
	`çbs
(
ªgex‹Á
) > 360.) {

1171 
ªgex‹Á
 = 360.;

1174 
¡¬ng
 = 
	`ªgnÜm
(startang);

1176 ià(
di¥_ty³
 =ğ
SCREEN
) {

1177 
xl
 = ()(
	`xcoÜd
(
xc
è- 
	`çbs
(
xmuÉ
 * 
¿d
));

1178 
yt
 = ()(
	`ycoÜd
(
yc
è- 
	`çbs
(
ymuÉ
 * 
¿d
));

1179 
width
 = ()(2 * 
	`çbs
(
xmuÉ
 * 
¿d
));

1180 
height
 = 
width
;

1181 
	`XD¿wArc
(
di¥Ïy
, 
tİËv–
, 
gc
, 
xl
, 
yt
, 
width
, 
height
,

1182 ()(
¡¬ng
 * 64), ()(
ªgex‹Á
 * 64));

1184 
	`årštf
(
ps
, "%.2à%.2à%.2à%.2à%.2à% ¡roke\n", 
	`XPOST
(
xc
),

1185 
	`YPOST
(
yc
), 
	`çbs
(
¿d
 * 
ps_xmuÉ
), 
¡¬ng
, s¹ªg + 
ªgex‹Á
,

1186 (
ªgex‹Á
 < 0) ? "drawarcn" : "drawarc") ;

1188 
	}
}

1191 
	$fÏrc
(
xc
, 
yc
, 
¿d
, 
¡¬ng
,

1192 
ªgex‹Á
)

1196 
xl
, 
yt
;

1197 
width
, 
height
;

1202 ià(
	`»ù_off_sü“n
(
xc
 - 
¿d
, 
yc
 -„ad, xc +„ad, yc +„ad)) {

1209 ià(
	`çbs
(
ªgex‹Á
) > 360.) {

1210 
ªgex‹Á
 = 360.;

1213 
¡¬ng
 = 
	`ªgnÜm
(startang);

1215 ià(
di¥_ty³
 =ğ
SCREEN
) {

1216 
xl
 = ()(
	`xcoÜd
(
xc
è- 
	`çbs
(
xmuÉ
 * 
¿d
));

1217 
yt
 = ()(
	`ycoÜd
(
yc
è- 
	`çbs
(
ymuÉ
 * 
¿d
));

1218 
width
 = ()(2 * 
	`çbs
(
xmuÉ
 * 
¿d
));

1219 
height
 = 
width
;

1220 
	`XFlArc
(
di¥Ïy
, 
tİËv–
, 
gc
, 
xl
, 
yt
, 
width
, 
height
,

1221 ()(
¡¬ng
 * 64), ()(
ªgex‹Á
 * 64));

1223 
	`årštf
(
ps
, "%.2à%.2à%.2à%.2à%.2à%s\n", 
	`çbs
(
¿d
 * 
ps_xmuÉ
),

1224 
¡¬ng
, s¹ªg + 
ªgex‹Á
, 
	`XPOST
(
xc
), 
	`YPOST
(
yc
),

1225 (
ªgex‹Á
 < 0) ? "fillarcn" : "fillarc") ;

1227 
	}
}

1230 
	$fÍŞy
(
t_pošt
* 
pošts
, 
Åošts
)

1232 
XPošt
 
Œª¥ošts
[
MAXPTS
];

1233 
i
;

1234 
xmš
, 
ymš
, 
xmax
, 
ymax
;

1236 ià(
Åošts
 > 
MAXPTS
) {

1237 
	`´štf
("Error in fillpoly: Only %d…oints‡llowed…er…olygon.\n",

1238 
MAXPTS
);

1239 
	`´štf
("%d…ošt w”»que¡ed. PŞygÚ i nÙ d¿wn.\n", 
Åošts
);

1245 
xmš
 = 
xmax
 = 
pošts
[0].
x
;

1246 
ymš
 = 
ymax
 = 
pošts
[0].
y
;

1248 
i
 = 1; i < 
Åošts
; i++) {

1249 
xmš
 = 
	`mš
(xmš, 
pošts
[
i
].
x
);

1250 
xmax
 = 
	`max
(xmax, 
pošts
[
i
].
x
);

1251 
ymš
 = 
	`mš
(ymš, 
pošts
[
i
].
y
);

1252 
ymax
 = 
	`max
(ymax, 
pošts
[
i
].
y
);

1255 ià(
	`»ù_off_sü“n
(
xmš
, 
ymš
, 
xmax
, 
ymax
)) {

1259 ià(
di¥_ty³
 =ğ
SCREEN
) {

1260 
i
 = 0; i < 
Åošts
; i++) {

1261 
Œª¥ošts
[
i
].
x
 = (è
	`xcoÜd
(
pošts
[i].x);

1262 
Œª¥ošts
[
i
].
y
 = (è
	`ycoÜd
(
pošts
[i].y);

1265 
	`XFlPŞygÚ
(
di¥Ïy
, 
tİËv–
, 
gc
, 
Œª¥ošts
, 
Åošts
, 
Com¶ex
,

1266 
CoÜdModeOrigš
);

1268 
	`årštf
(
ps
, "\n");

1270 
i
 = 
Åošts
 - 1; i >= 0; i--) {

1271 
	`årštf
(
ps
, "%.2à%.2f\n", 
	`XPOST
(
pošts
[
i
].
x
), 
	`YPOST
Õošts[i].
y
));

1274 
	`årštf
(
ps
, "%d fÍŞy\n", 
Åošts
);

1276 
	}
}

1278 
	$d¿w‹xt
(
xc
, 
yc
, * 
‹xt
, 
boundx
)

1281 
Ën
, 
width
, 
xw_off
, 
yw_off
;

1282 
Ën
 = 
	`¡¾’
(
‹xt
);

1283 
width
 = 
	`XTextWidth
(
fÚt_šfo
[
cu¼’tfÚtsize
], 
‹xt
, 
Ën
);

1285 ià(
width
 > 
	`çbs
(
boundx
 * 
xmuÉ
)) {

1289 
xw_off
 = 
width
 / (2.*
xmuÉ
);

1291 
yw_off
 = (
fÚt_šfo
[
cu¼’tfÚtsize
]->
asûÁ
 +

1292 2 * 
fÚt_šfo
[
cu¼’tfÚtsize
]->
desûÁ
è/ (2.*
ymuÉ
);

1299 ià(
	`»ù_off_sü“n
(
xc
 - 
xw_off
, 
yc
 - 
yw_off
, xc + xw_off, yc + yw_off)) {

1303 ià(
di¥_ty³
 =ğ
SCREEN
) {

1304 
	`XD¿wSŒšg
(
di¥Ïy
, 
tİËv–
, 
gc
, 
	`xcoÜd
(
xc
è- 
width
 / 2, 
	`ycoÜd
(
yc
) +

1305 (
fÚt_šfo
[
cu¼’tfÚtsize
]->
asûÁ
 - fÚt_šfo[cu¼’tfÚtsize]->
desûÁ
) / 2,

1306 
‹xt
, 
Ën
);

1308 
	`årštf
(
ps
, "(%sè%.2à%.2àûnshow\n", 
‹xt
, 
	`XPOST
(
xc
), 
	`YPOST
(
yc
));

1310 
	}
}

1313 
	$æushšput
()

1315 ià(
di¥_ty³
 !ğ
SCREEN
) {

1319 
	`XFlush
(
di¥Ïy
);

1320 
	}
}

1323 
	$š™_wÜld
(
x1
, 
y1
, 
x2
, 
y2
)

1326 
xËá
 = 
x1
;

1327 
xright
 = 
x2
;

1328 
ytİ
 = 
y1
;

1329 
ybÙ
 = 
y2
;

1330 
§ved_xËá
 = 
xËá
;

1331 
§ved_xright
 = 
xright
;

1332 
§ved_ytİ
 = 
ytİ
;

1333 
§ved_ybÙ
 = 
ybÙ
;

1335 ià(
di¥_ty³
 =ğ
SCREEN
) {

1336 
	`upd©e_ŒªsfÜm
();

1338 
	`upd©e_ps_ŒªsfÜm
();

1340 
	}
}

1343 
	$d¿w_mes§ge
()

1346 
Ën
, 
width
, 
§vefÚtsize
, 
§vecŞÜ
;

1347 
ylow
;

1349 ià(
di¥_ty³
 =ğ
SCREEN
) {

1350 
	`XCË¬Wšdow
(
di¥Ïy
, 
‹x»a
);

1351 
Ën
 = 
	`¡¾’
(
mes§ge
);

1352 
width
 = 
	`XTextWidth
(
fÚt_šfo
[
m’u_fÚt_size
], 
mes§ge
, 
Ën
);

1353 
	`XS‘FÜeground
(
di¥Ïy
, 
gc_m’us
, 
cŞÜs
[
BLACK
]);

1354 
	`XD¿wSŒšg
(
di¥Ïy
, 
‹x»a
, 
gc_m’us
,

1355 (
tİ_width
 - 
MWIDTH
 - 
width
) / 2,

1356 (
T_AREA_HEIGHT
 - 4è/ 2 + (
fÚt_šfo
[
m’u_fÚt_size
]->
asûÁ
 -

1357 
fÚt_šfo
[
m’u_fÚt_size
]->
desûÁ
è/ 2, 
mes§ge
, 
Ën
);

1361 
§vecŞÜ
 = 
cu¼’tcŞÜ
;

1362 
	`£tcŞÜ
(
BLACK
);

1363 
§vefÚtsize
 = 
cu¼’tfÚtsize
;

1364 
	`£tfÚtsize
(
m’u_fÚt_size
 - 2);

1365 
ylow
 = 
ps_bÙ
 - 8.;

1366 
	`årštf
(
ps
, "(%sè%.2à%.2àûnshow\n", 
mes§ge
, (
ps_Ëá
 + 
ps_right
) / 2.,

1367 
ylow
);

1368 
	`£tcŞÜ
(
§vecŞÜ
);

1369 
	`£tfÚtsize
(
§vefÚtsize
);

1371 
	}
}

1374 
	$upd©e_mes§ge
(* 
msg
)

1377 
	`¡ºıy
(
mes§ge
, 
msg
, 
BUFSIZE
);

1378 
	`d¿w_mes§ge
();

1379 
	}
}

1382 
zoom_š
((*
d¿wsü“n
)())

1385 
xdiff
, 
ydiff
;

1386 
xdiff
 = 
xright
 - 
xËá
;

1387 
ydiff
 = 
ybÙ
 - 
ytİ
;

1388 
xËá
 +ğ
xdiff
 / 5.;

1389 
xright
 -ğ
xdiff
 / 5.;

1390 
ytİ
 +ğ
ydiff
 / 5.;

1391 
ybÙ
 -ğ
ydiff
 / 5.;

1392 
	`upd©e_ŒªsfÜm
();

1393 
	`d¿wsü“n
();

1394 
	}
}

1397 
zoom_out
((*
d¿wsü“n
)())

1400 
xdiff
, 
ydiff
;

1401 
xdiff
 = 
xright
 - 
xËá
;

1402 
ydiff
 = 
ybÙ
 - 
ytİ
;

1403 
xËá
 -ğ
xdiff
 / 3.;

1404 
xright
 +ğ
xdiff
 / 3.;

1405 
ytİ
 -ğ
ydiff
 / 3.;

1406 
ybÙ
 +ğ
ydiff
 / 3.;

1407 
	`upd©e_ŒªsfÜm
();

1408 
	`d¿wsü“n
();

1409 
	}
}

1412 
zoom_f™
((*
d¿wsü“n
)())

1416 
xËá
 = 
§ved_xËá
;

1417 
xright
 = 
§ved_xright
;

1418 
ytİ
 = 
§ved_ytİ
;

1419 
ybÙ
 = 
§ved_ybÙ
;

1420 
	`upd©e_ŒªsfÜm
();

1421 
	`d¿wsü“n
();

1422 
	}
}

1425 
Œª¦©e_up
((*
d¿wsü“n
)())

1428 
y¡•
;

1429 
y¡•
 = (
ybÙ
 - 
ytİ
) / 2.;

1430 
ytİ
 -ğ
y¡•
;

1431 
ybÙ
 -ğ
y¡•
;

1432 
	`upd©e_ŒªsfÜm
();

1433 
	`d¿wsü“n
();

1434 
	}
}

1437 
Œª¦©e_down
((*
d¿wsü“n
)())

1440 
y¡•
;

1441 
y¡•
 = (
ybÙ
 - 
ytİ
) / 2.;

1442 
ytİ
 +ğ
y¡•
;

1443 
ybÙ
 +ğ
y¡•
;

1444 
	`upd©e_ŒªsfÜm
();

1445 
	`d¿wsü“n
();

1446 
	}
}

1449 
Œª¦©e_Ëá
((*
d¿wsü“n
)())

1452 
x¡•
;

1453 
x¡•
 = (
xright
 - 
xËá
) / 2.;

1454 
xËá
 -ğ
x¡•
;

1455 
xright
 -ğ
x¡•
;

1456 
	`upd©e_ŒªsfÜm
();

1457 
	`d¿wsü“n
();

1458 
	}
}

1461 
Œª¦©e_right
((*
d¿wsü“n
)())

1464 
x¡•
;

1465 
x¡•
 = (
xright
 - 
xËá
) / 2.;

1466 
xËá
 +ğ
x¡•
;

1467 
xright
 +ğ
x¡•
;

1468 
	`upd©e_ŒªsfÜm
();

1469 
	`d¿wsü“n
();

1470 
	}
}

1473 
upd©e_wš
(
x
[2], 
y
[2], (*
d¿wsü“n
)())

1475 
x1
, 
x2
, 
y1
, 
y2
;

1476 
x
[0] = 
	`mš
(x[0], 
tİ_width
 - 
MWIDTH
);

1477 
x
[1] = 
	`mš
(x[1], 
tİ_width
 - 
MWIDTH
);

1478 
y
[0] = 
	`mš
(y[0], 
tİ_height
 - 
T_AREA_HEIGHT
);

1479 
y
[1] = 
	`mš
(y[1], 
tİ_height
 - 
T_AREA_HEIGHT
);

1481 ià((
x
[0] =ğx[1]è|| (
y
[0] == y[1])) {

1482 
	`´štf
("Illegal (zero‡rea) window. Window unchanged.\n");

1486 
x1
 = 
	`XTOWORLD
(
	`mš
(
x
[0], x[1]));

1487 
x2
 = 
	`XTOWORLD
(
	`max
(
x
[0], x[1]));

1488 
y1
 = 
	`YTOWORLD
(
	`mš
(
y
[0], y[1]));

1489 
y2
 = 
	`YTOWORLD
(
	`max
(
y
[0], y[1]));

1490 
xËá
 = 
x1
;

1491 
xright
 = 
x2
;

1492 
ytİ
 = 
y1
;

1493 
ybÙ
 = 
y2
;

1494 
	`upd©e_ŒªsfÜm
();

1495 
	`d¿wsü“n
();

1496 
	}
}

1499 
adju¡wš
((*
d¿wsü“n
)())

1503 
XEv’t
 
»pÜt
;

1504 
cÜÃr
, 
xŞd
, 
yŞd
, 
x
[2], 
y
[2];

1505 
cÜÃr
 = 0;

1506 
xŞd
 = -1;

1507 
yŞd
 = -1;

1509 
cÜÃr
 < 2) {

1510 
	`XNextEv’t
(
di¥Ïy
, &
»pÜt
);

1512 
»pÜt
.
ty³
) {

1513 
Expo£
:

1514 #ifdeà
VERBOSE


1515 
	`´štf
("Got‡nƒxposeƒvent.\n");

1516 
	`´štf
("CouÁ is: %d.\n", 
»pÜt
.
xexpo£
.
couÁ
);

1517 
	`´štf
("Wšdow ID is: %d.\n", 
»pÜt
.
xexpo£
.
wšdow
);

1520 ià(
»pÜt
.
xexpo£
.
couÁ
 != 0) {

1524 ià(
»pÜt
.
xexpo£
.
wšdow
 =ğ
m’u
) {

1525 
	`d¿wm’u
();

1526 } ià(
»pÜt
.
xexpo£
.
wšdow
 =ğ
tİËv–
) {

1527 
	`d¿wsü“n
();

1528 
xŞd
 = -1;

1529 } ià(
»pÜt
.
xexpo£
.
wšdow
 =ğ
‹x»a
) {

1530 
	`d¿w_mes§ge
();

1535 
CÚfigu»NÙify
:

1536 
tİ_width
 = 
»pÜt
.
xcÚfigu»
.
width
;

1537 
tİ_height
 = 
»pÜt
.
xcÚfigu»
.
height
;

1538 
	`upd©e_ŒªsfÜm
();

1539 #ifdeà
VERBOSE


1540 
	`´štf
("Got‡ ConfigureNotify.\n");

1541 
	`´štf
("New width: %d New height: %d.\n", 
tİ_width
, 
tİ_height
);

1545 
Bu‰ÚP»ss
:

1546 #ifdeà
VERBOSE


1547 
	`´štf
("Got‡ buttonpress.\n");

1548 
	`´štf
("Wšdow ID is: %d.\n", 
»pÜt
.
xbu‰Ú
.
wšdow
);

1549 
	`´štf
("LoÿtiÚ (%d, %d).\n", 
»pÜt
.
xbu‰Ú
.
x
,

1550 
»pÜt
.
xbu‰Ú
.
y
);

1553 ià(
»pÜt
.
xbu‰Ú
.
wšdow
 !ğ
tİËv–
) {

1557 
x
[
cÜÃr
] = 
»pÜt
.
xbu‰Ú
.x;

1558 
y
[
cÜÃr
] = 
»pÜt
.
xbu‰Ú
.y;

1560 ià(
cÜÃr
 == 0) {

1561 
	`XS–eùIÅut
(
di¥Ïy
, 
tİËv–
, 
Exposu»Mask
 |

1562 
SŒuùu»NÙifyMask
 | 
Bu‰ÚP»ssMask
 | 
Poš‹rMÙiÚMask
);

1564 
	`upd©e_wš
(
x
, 
y
, 
d¿wsü“n
);

1567 
cÜÃr
++;

1570 
MÙiÚNÙify
:

1571 #ifdeà
VERBOSE


1572 
	`´štf
("Got‡ MotionNotify Event.\n");

1573 
	`´štf
("x: %d y: %d\n", 
»pÜt
.
xmÙiÚ
.
x
,„•Üt.xmÙiÚ.
y
);

1576 ià(
xŞd
 >= 0) {

1577 
	`XD¿wReùªgË
(
di¥Ïy
, 
tİËv–
, 
gcxÜ
, 
	`mš
(
x
[0], 
xŞd
),

1578 
	`mš
(
y
[0], 
yŞd
), 
	`abs
(
x
[0] - 
xŞd
),‡bs(y[0] - yold));

1582 
xŞd
 = 
	`mš
(
»pÜt
.
xmÙiÚ
.
x
, 
tİ_width
 - 1 - 
MWIDTH
);

1583 
yŞd
 = 
»pÜt
.
xmÙiÚ
.
y
;

1584 
	`XD¿wReùªgË
(
di¥Ïy
, 
tİËv–
, 
gcxÜ
, 
	`mš
(
x
[0], 
xŞd
),

1585 
	`mš
(
y
[0], 
yŞd
), 
	`abs
(
x
[0] - 
xŞd
),‡bs(y[0] - yold));

1590 
	`XS–eùIÅut
(
di¥Ïy
, 
tİËv–
, 
Exposu»Mask
 | 
SŒuùu»NÙifyMask


1591 | 
Bu‰ÚP»ssMask
);

1592 
	}
}

1595 
po¡süt
((*
d¿wsü“n
)())

1599 
piccouÁ
 = 1;

1600 
sucûss
;

1601 
âame
[20];

1602 
	`¥rštf
(
âame
, "pic%d.ps", 
piccouÁ
);

1603 
sucûss
 = 
	`š™_po¡süt
(
âame
);

1605 ià(
sucûss
 == 0) {

1609 
	`d¿wsü“n
();

1610 
	`şo£_po¡süt
();

1611 
piccouÁ
++;

1612 
	}
}

1615 
´oûed
((*
d¿wsü“n
)())

1618 
	}
}

1621 
qu™
((*
d¿wsü“n
)())

1623 
	`şo£_g¿phics
();

1624 
	`ex™
(0);

1625 
	}
}

1628 
	$şo£_g¿phics
()

1632 
i
;

1634 
i
 = 1; i <ğ
MAX_FONT_SIZE
; i++)

1635 ià(
fÚt_is_lßded
[
i
]) {

1636 
	`XF»eFÚt
(
di¥Ïy
, 
fÚt_šfo
[
i
]);

1639 
	`XF»eGC
(
di¥Ïy
, 
gc
);

1640 
	`XF»eGC
(
di¥Ïy
, 
gcxÜ
);

1641 
	`XF»eGC
(
di¥Ïy
, 
gc_m’us
);

1643 ià(
´iv©e_cm­
 !ğ
NÚe
) {

1644 
	`XF»eCŞÜm­
(
di¥Ïy
, 
´iv©e_cm­
);

1647 
	`XClo£Di¥Ïy
(
di¥Ïy
);

1648 
	`ä“
(
bu‰Ú
);

1649 
	}
}

1652 
	$š™_po¡süt
(* 
âame
)

1657 
ps
 = 
	`fİ’
(
âame
, "w");

1659 ià(
ps
 =ğ
NULL
) {

1660 
	`´štf
("E¼Ü: could‚Ù o³À% fÜ Po¡Süˆouut.\n", 
âame
);

1661 
	`´štf
("Drawingo screen instead.\n");

1665 
di¥_ty³
 = 
POSTSCRIPT
;

1667 
	`årštf
(
ps
, "%%!PS-Adobe-1.0\n");

1668 
	`årštf
(
ps
, "%%%%DocumentFonts: Helvetica\n");

1669 
	`årštf
(
ps
, "%%%%Pages: 1\n");

1671 
	`upd©e_ps_ŒªsfÜm
();

1673 
	`årštf
(
ps
, "%%%%BoundingBox: %.2f %.2f %.2f %.2f\n",

1674 
ps_Ëá
, 
ps_bÙ
 - 15., 
ps_right
, 
ps_tİ
);

1675 
	`årštf
(
ps
, "%%%%EndComments\n");

1676 
	`årštf
(
ps
, "/censhow %%draw‡ centered string\n");

1677 
	`årštf
(
ps
, " { moveto %% moveo…roper spot\n");

1678 
	`årštf
(
ps
, " dup stringwidth…op %% get x†ength of string\n");

1679 
	`årštf
(
ps
, " -2 div %% Proper†eft start\n");

1680 
	`årštf
(
ps
, " yoff„moveto %% Move†efthat much‡nd down half font height\n");

1681 
	`årštf
(
ps
, " show‚ewpath } def %% showhe string\n\n");

1682 
	`årštf
(
ps
, "/setfontsize %% set fonto desired size‡nd compute "

1684 
	`årštf
(
ps
, " { /Helvetica findfont\n");

1685 
	`årštf
(
ps
, "ƒxch scalefont\n");

1686 
	`årštf
(
ps
, " setfont %% Font size set ...\n\n");

1687 
	`årštf
(
ps
, " 0 0 moveto %% Get vertical centering offset\n");

1688 
	`årštf
(
ps
, " (Xg)rue charpath\n");

1689 
	`årštf
(
ps
, " flattenpath…athbbox\n");

1690 
	`årštf
(
ps
, " /ascentƒxch def…op -1 mul /descentƒxch def…op\n");

1691 
	`årštf
(
ps
, "‚ewpath\n");

1692 
	`årštf
(
ps
, " descent‡scent sub 2 div /yoffƒxch def } def\n\n");

1693 
	`årštf
(
ps
, "%% Nextwo†ines for debugging only.\n");

1694 
	`årštf
(
ps
, "/str 20 string def\n");

1695 
	`årštf
(
ps
, "/pnum {str cvs…rint ( )…rint} def\n");

1696 
	`årštf
(
ps
, "/drawline %% draw‡†ine from (x2,y2)o (x1,y1)\n");

1697 
	`årštf
(
ps
, " { moveto†ineto stroke } def\n\n");

1698 
	`årštf
(
ps
, "/rect %% outline‡„ectangle \n");

1699 
	`årštf
(
ps
, " { /y2ƒxch def /x2ƒxch def /y1ƒxch def /x1ƒxch def\n");

1700 
	`årštf
(
ps
, " x1 y1 moveto\n");

1701 
	`årštf
(
ps
, " x2 y1†ineto\n");

1702 
	`årštf
(
ps
, " x2 y2†ineto\n");

1703 
	`årštf
(
ps
, " x1 y2†ineto\n");

1704 
	`årštf
(
ps
, " closepath } def\n\n");

1705 
	`årštf
(
ps
, "/drawrect %% draw outline of‡„ectanagle\n");

1706 
	`årštf
(
ps
, " {„ect stroke } def\n\n");

1707 
	`årštf
(
ps
, "/fillrect %% fill in‡„ectanagle\n");

1708 
	`årštf
(
ps
, " {„ect fill } def\n\n");

1709 
	`årštf
(
ps
, "/drawarc {‡rc stroke } def %% draw‡n‡rc\n");

1710 
	`årštf
(
ps
, "/drawarcn {‡rcn stroke } def "

1712 
	`årštf
(
ps
, "%%Fill‡ counterclockwise or clockwise‡rc sector, "

1714 
	`årštf
(
ps
, "/fillarc { moveto currentpoint 5 2„oll‡rc closepath fill } "

1716 
	`årštf
(
ps
, "/fillarcn { moveto currentpoint 5 2„oll‡rcn closepath fill } "

1718 
	`årštf
(
ps
, "/fillpoly { 3 1„oll moveto %% moveo first…oint\n"

1721 
	`årštf
(
ps
, "%%Color Definitions:\n");

1722 
	`årštf
(
ps
, "/white { 1 setgray } def\n");

1723 
	`årštf
(
ps
, "/black { 0 setgray } def\n");

1724 
	`årštf
(
ps
, "/grey55 { .55 setgray } def\n");

1725 
	`årštf
(
ps
, "/grey75 { .75 setgray } def\n");

1726 
	`årštf
(
ps
, "/blue { 0 0 1 setrgbcolor } def\n");

1727 
	`årštf
(
ps
, "/green { 0 1 0 setrgbcolor } def\n");

1728 
	`årštf
(
ps
, "/yellow { 1 1 0 setrgbcolor } def\n");

1729 
	`årštf
(
ps
, "/cyan { 0 1 1 setrgbcolor } def\n");

1730 
	`årštf
(
ps
, "/red { 1 0 0 setrgbcolor } def\n");

1731 
	`årštf
(
ps
, "/darkgreen { 0 0.5 0 setrgbcolor } def\n");

1732 
	`årštf
(
ps
, "/magenta { 1 0 1 setrgbcolor } def\n");

1733 
	`årštf
(
ps
, "\n%%Solid‡nd dashed†ine definitions:\n");

1734 
	`årštf
(
ps
, "/linesolid {[] 0 setdash} def\n");

1735 
	`årštf
(
ps
, "/linedashed {[3 3] 0 setdash} def\n");

1736 
	`årštf
(
ps
, "\n%%%%EndProlog\n");

1737 
	`årštf
(
ps
, "%%%%Page: 1 1\n\n");

1739 
	`fÜû_£tcŞÜ
(
cu¼’tcŞÜ
);

1740 
	`fÜû_£še¡yË
(
cu¼’še¡yË
);

1741 
	`fÜû_£šewidth
(
cu¼’šewidth
);

1742 
	`fÜû_£tfÚtsize
(
cu¼’tfÚtsize
);

1744 
	`d¿w_mes§ge
();

1746 
	`årštf
(
ps
, "%.2à%.2à%.2à%.2à»ù ", 
ps_Ëá
, 
ps_bÙ
, 
ps_right
, 
ps_tİ
);

1747 
	`årštf
(
ps
, "clip‚ewpath\n\n");

1749 
	}
}

1751 
	$şo£_po¡süt
()

1754 
	`årštf
(
ps
, "showpage\n");

1755 
	`årštf
(
ps
, "\n%%%%Trailer\n");

1756 
	`fşo£
(
ps
);

1757 
di¥_ty³
 = 
SCREEN
;

1758 
	`upd©e_ŒªsfÜm
();

1763 
	`fÜû_£tcŞÜ
(
cu¼’tcŞÜ
);

1764 
	`fÜû_£še¡yË
(
cu¼’še¡yË
);

1765 
	`fÜû_£šewidth
(
cu¼’šewidth
);

1766 
	`fÜû_£tfÚtsize
(
cu¼’tfÚtsize
);

1767 
	}
}

1771 
ev’t_loİ
((*
aù_Ú_bu‰Ú
)(
x
, 
y
),

1772 (*
d¿wsü“n
)()è{ 
	}
}

1774 
	$š™_g¿phics
(* 
wšdow_Çme
è{ 
	}
}

1775 
	$şo£_g¿phics
(è{ 
	}
}

1776 
	$upd©e_mes§ge
(* 
msg
è{ 
	}
}

1777 
	$d¿w_mes§ge
(è{ 
	}
}

1778 
	$š™_wÜld
(
xl
, 
yt
, 
xr
, 
yb
è{ 
	}
}

1779 
	$æushšput
(è{ 
	}
}

1780 
	$£tcŞÜ
(
cšdex
è{ 
	}
}

1781 
	$£še¡yË
(
lše¡yË
è{ 
	}
}

1782 
	$£šewidth
(
lšewidth
è{ 
	}
}

1783 
	$£tfÚtsize
(
poštsize
è{ 
	}
}

1784 
	$d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
è{ 
	}
}

1785 
	$d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
è{ 
	}
}

1786 
	$fÌeù
(
x1
, 
y1
, 
x2
, 
y2
è{ 
	}
}

1787 
	$fÍŞy
(
t_pošt
* 
pošts
, 
Åošts
è{ 
	}
}

1788 
	$d¿w¬c
(
xûn
, 
yûn
, 
¿d
, 
¡¬ng
,

1789 
ªgex‹Á
è{ 
	}
}

1791 
	$fÏrc
(
xûn
, 
yûn
, 
¿d
, 
¡¬ng
,

1792 
ªgex‹Á
è{ 
	}
}

1794 
	$d¿w‹xt
(
xc
, 
yc
, * 
‹xt
, 
boundx
è{ 
	}
}

1795 
	$ş—rsü“n
(è{ 
	}
}

1797 
ü—‹_bu‰Ú
(* 
´ev_bu‰Ú_‹xt
 , * 
bu‰Ú_‹xt
,

1798 (*
bu‰Ú_func
)((*
d¿wsü“n
)())è{ 
	}
}

1800 
	$de¡roy_bu‰Ú
(* 
bu‰Ú_‹xt
è{ 
	}
}

1802 
	$š™_po¡süt
(* 
âame
)

1805 
	}
}

1807 
	$şo£_po¡süt
(è{ 
	}
}

	@graphics.h

1 #iâdeà
GRAPHICS_H


2 
	#GRAPHICS_H


	)

4 
	#SCREEN
 0

	)

5 
	#POSTSCRIPT
 1

	)

7 
	#NUM_COLOR
 11

	)

9 
	ecŞÜ_ty³s
 {

10 
	mWHITE
,

11 
	mBLACK
,

12 
	mDARKGREY
,

13 
	mLIGHTGREY
,

14 
	mBLUE
,

15 
	mGREEN
,

16 
	mYELLOW
,

17 
	mCYAN
,

18 
	mRED
,

19 
	mDARKGREEN
,

20 
	mMAGENTA


23 
	elše_ty³s
 {

24 
	mSOLID
,

25 
	mDASHED


28 
	#MAXPTS
 100

	)

30 
	mx
;

31 
	my
;

32 } 
	tt_pošt
;

39 
ev’t_loİ
((*
aù_Ú_bu‰Ú
)(
x
, 
y
),

40 (*
d¿wsü“n
)());

42 
	`š™_g¿phics
(* 
wšdow_Çme
);

43 
	`şo£_g¿phics
();

46 
	`upd©e_mes§ge
(* 
msg
);

52 
	`d¿w_mes§ge
();

55 
	`š™_wÜld
(
xl
, 
yt
, 
xr
, 
yb
);

57 
	`æushšput
();

62 
	`£tcŞÜ
(
cšdex
);

63 
	`£še¡yË
(
lše¡yË
);

64 
	`£šewidth
(
lšewidth
);

65 
	`£tfÚtsize
(
poštsize
);

66 
	`d¿wlše
(
x1
, 
y1
, 
x2
, 
y2
);

67 
	`d¿w»ù
(
x1
, 
y1
, 
x2
, 
y2
);

68 
	`fÌeù
(
x1
, 
y1
, 
x2
, 
y2
);

69 
	`fÍŞy
(
t_pošt
* 
pošts
, 
Åošts
);

75 
	`d¿w¬c
(
xûn
, 
yûn
, 
¿d
, 
¡¬ng
,

76 
ªgex‹Á
);

77 
	`fÏrc
(
xûn
, 
yûn
, 
¿d
, 
¡¬ng
,

78 
ªgex‹Á
);

83 
	`d¿w‹xt
(
xc
, 
yc
, * 
‹xt
, 
boundx
);

84 
	`ş—rsü“n
();

89 
	`ü—‹_bu‰Ú
(* 
´ev_bu‰Ú_‹xt
 , * 
bu‰Ú_‹xt
,

90 (*
bu‰Ú_func
)((*
d¿wsü“n
)()));

91 
	`de¡roy_bu‰Ú
(* 
bu‰Ú_‹xt
);

97 
	`š™_po¡süt
(* 
âame
);

101 
	`şo£_po¡süt
();

	@hash.c

1 
	~<¡dlib.h
>

2 
	~<¡ršg.h
>

3 
	~"hash.h
"

4 
	~"ut.h
"

6 
	#HASHSIZE
 4093

	)

8 
hash_v®ue
(* 
Çme
);

12 
hash_t
** 
	$®loc_hash_bË
() {

16 
hash_t
** 
hash_bË
;

18 
hash_bË
 = (
hash_t
**è
	`my_ÿÎoc
((hash_t*),

19 
HASHSIZE
);

20  (
hash_bË
);

21 
	}
}

24 
	$ä“_hash_bË
(
hash_t
** 
hash_bË
)

27 
i
;

28 
hash_t
* 
h_±r
, *
‹mp_±r
;

30 
i
 = 0; i < 
HASHSIZE
; i++) {

31 
h_±r
 = 
hash_bË
[
i
];

33 
h_±r
 !ğ
NULL
) {

34 
	`ä“
(
h_±r
->
Çme
);

35 
‹mp_±r
 = 
h_±r
->
Ãxt
;

36 
	`ä“
(
h_±r
);

37 
h_±r
 = 
‹mp_±r
;

41 
	`ä“
(
hash_bË
);

42 
	}
}

45 
s_hash_™”©Ü
 
	$¡¬t_hash_bË_™”©Ü
() {

50 
s_hash_™”©Ü
 
hash_™”©Ü
;

52 
hash_™”©Ü
.
i
 = -1;

53 
hash_™”©Ü
.
h_±r
 = 
NULL
;

54  (
hash_™”©Ü
);

55 
	}
}

58 
hash_t
* 
	$g‘_Ãxt_hash
(
hash_t
** 
hash_bË
, 

59 
s_hash_™”©Ü
* 
hash_™”©Ü
) {

64 
i
;

65 
hash_t
* 
h_±r
;

67 
i
 = 
hash_™”©Ü
->i;

68 
h_±r
 = 
hash_™”©Ü
->h_ptr;

70 
h_±r
 =ğ
NULL
) {

71 
i
++;

73 ià(
i
 >ğ
HASHSIZE
) {

74  (
NULL
);

77 
h_±r
 = 
hash_bË
[
i
];

80 
hash_™”©Ü
->
h_±r
 = h_±r->
Ãxt
;

81 
hash_™”©Ü
->
i
 = i;

82  (
h_±r
);

83 
	}
}

86 
hash_t
* 
	$š£¹_š_hash_bË
(
hash_t
** 
hash_bË
, * 
Çme
,

87 
Ãxt_ä“_šdex
) {

95 
i
;

96 
hash_t
* 
h_±r
, *
´ev_±r
;

98 
i
 = 
	`hash_v®ue
(
Çme
);

99 
´ev_±r
 = 
NULL
;

100 
h_±r
 = 
hash_bË
[
i
];

102 
h_±r
 !ğ
NULL
) {

103 ià(
	`¡rcmp
(
h_±r
->
Çme
,‚ame) == 0) {

104 
h_±r
->
couÁ
++;

105  (
h_±r
);

108 
´ev_±r
 = 
h_±r
;

109 
h_±r
 = h_±r->
Ãxt
;

114 
h_±r
 = (
hash_t
*è
	`my_m®loc
((hash_t));

116 ià(
´ev_±r
 =ğ
NULL
) {

117 
hash_bË
[
i
] = 
h_±r
;

119 
´ev_±r
->
Ãxt
 = 
h_±r
;

122 
h_±r
->
Ãxt
 = 
NULL
;

123 
h_±r
->
šdex
 = 
Ãxt_ä“_šdex
;

124 
h_±r
->
couÁ
 = 1;

125 
h_±r
->
Çme
 = (*è
	`my_m®loc
((
	`¡¾’
(name) + 1) * ());

126 
	`¡rıy
(
h_±r
->
Çme
,‚ame);

127  (
h_±r
);

128 
	}
}

131 
hash_t
* 
	$g‘_hash_’Œy
(
hash_t
** 
hash_bË
, * 
Çme
) {

136 
i
;

137 
hash_t
* 
h_±r
;

139 
i
 = 
	`hash_v®ue
(
Çme
);

140 
h_±r
 = 
hash_bË
[
i
];

142 
h_±r
 !ğ
NULL
) {

143 ià(
	`¡rcmp
(
h_±r
->
Çme
,‚ame) == 0) {

144  (
h_±r
);

147 
h_±r
 = h_±r->
Ãxt
;

150  (
NULL
);

151 
	}
}

154 
	$hash_v®ue
(* 
Çme
)

158 
i
, 
k
;

159 
v®
 = 0, 
muÉ
 = 1;

160 
i
 = 
	`¡¾’
(
Çme
);

161 
k
 = 
	`max
(
i
 - 8, 0);

163 
i
 = 
	`¡¾’
(
Çme
è- 1; i >ğ
k
; i--) {

164 
v®
 +ğ
muÉ
 * ((è
Çme
[
i
]);

165 
muÉ
 *= 7;

168 
v®
 +ğ(è
Çme
[0];

169 
v®
 %ğ
HASHSIZE
;

170 (
v®
);

171 
	}
}

	@hash.h

1 #iâdeà
HASH_H


2 
	#HASH_H


	)

4 
	ss_hash_t
 {

5 * 
	mÇme
;

6 
	mšdex
;

7 
	mcouÁ
;

8 
s_hash_t
* 
	mÃxt
;

9 } 
	thash_t
;

17 
	ss_hash_™”©Ü
 {

18 
	mi
;

19 
hash_t
* 
	mh_±r
;

28 
hash_t
** 
®loc_hash_bË
();

29 
ä“_hash_bË
(
hash_t
** 
hash_bË
);

30 
s_hash_™”©Ü
 
¡¬t_hash_bË_™”©Ü
();

31 
hash_t
* 
g‘_Ãxt_hash
(hash_t** 
hash_bË
, 

32 
s_hash_™”©Ü
* 
hash_™”©Ü
);

33 
hash_t
* 
š£¹_š_hash_bË
(hash_t** 
hash_bË
, * 
Çme
,

34 
Ãxt_ä“_šdex
);

35 
hash_t
* 
g‘_hash_’Œy
(hash_t** 
hash_bË
, * 
Çme
);

	@heapsort.c

1 
	~"h—psÜt.h
"

5 
add_to_sÜt_h—p
(* 
h—p
, * 
sÜt_v®ues
, 
šdex
,

6 
h—p_
);

8 
g‘_tİ_of_h—p_šdex
(* 
h—p
, * 
sÜt_v®ues
, 

9 
h—p_
);

14 
	$h—psÜt
(* 
sÜt_šdex
, * 
sÜt_v®ues
, 
ÃËm
)

21 
i
;

22 
i
 = 1; i <ğ
ÃËm
; i++) {

23 
	`add_to_sÜt_h—p
(
sÜt_šdex
, 
sÜt_v®ues
, 
i
, i);

30 
i
 = 
ÃËm
; i >= 1; i--) {

31 
sÜt_šdex
[
i
] = 
	`g‘_tİ_of_h—p_šdex
(sÜt_šdex, 
sÜt_v®ues
, i);

33 
	}
}

36 
	$add_to_sÜt_h—p
(* 
h—p
, * 
sÜt_v®ues
, 
šdex
,

37 
h—p_
)

41 
iäom
, 
™o
;

42 
‹mp
;

43 
h—p
[
h—p_
] = 
šdex
;

44 
iäom
 = 
h—p_
;

45 
™o
 = 
iäom
 / 2;

47 
™o
 >ğ1 && 
sÜt_v®ues
[
h—p
[
iäom
]] < sort_values[heap[ito]]) {

48 
‹mp
 = 
h—p
[
™o
];

49 
h—p
[
™o
] = h—p[
iäom
];

50 
h—p
[
iäom
] = 
‹mp
;

51 
iäom
 = 
™o
;

52 
™o
 = 
iäom
 / 2;

54 
	}
}

57 
	$g‘_tİ_of_h—p_šdex
(* 
h—p
, * 
sÜt_v®ues
, 

58 
h—p_
)

63 
šdex_of_sm®Ë¡
, 
‹mp
;

64 
iäom
, 
™o
, 
h—p_’d
;

65 
šdex_of_sm®Ë¡
 = 
h—p
[1];

66 
h—p
[1] = h—p[
h—p_
];

67 
h—p_’d
 = 
h—p_
 - 1;

68 
iäom
 = 1;

69 
™o
 = 2 * 
iäom
;

71 
™o
 <ğ
h—p_’d
) {

72 ià(
sÜt_v®ues
[
h—p
[
™o
 + 1]] < sort_values[heap[ito]]) {

73 
™o
++;

76 ià(
sÜt_v®ues
[
h—p
[
™o
]] > sÜt_v®ues[h—p[
iäom
]]) {

80 
‹mp
 = 
h—p
[
™o
];

81 
h—p
[
™o
] = h—p[
iäom
];

82 
h—p
[
iäom
] = 
‹mp
;

83 
iäom
 = 
™o
;

84 
™o
 = 2 * 
iäom
;

87  (
šdex_of_sm®Ë¡
);

88 
	}
}

	@heapsort.h

1 #iâdeà
HEAPSORT_H


2 
	#HEAPSORT_H


	)

4 
h—psÜt
(* 
sÜt_šdex
, * 
sÜt_v®ues
, 
ÃËm
);

	@main.c

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~<time.h
>

5 
	~"ut.h
"

6 
	~"v´_ty³s.h
"

7 
	~"glob®s.h
"

8 
	~"g¿phics.h
"

9 
	~"»ad_Ãi¡.h
"

10 
	~"´št_Ãi¡.h
"

11 
	~"»ad_¬ch.h
"

12 
	~"d¿w.h
"

13 
	~"¶aû_ªd_rou‹.h
"

14 
	~"¡©s.h
"

15 
	~"·th_d–ay.h
"

19 
block_t
* 
	gblocks
;

20 
	gnum_blocks
;

21 
	gnum_´im¬y_šputs
;

22 
	gnum_´im¬y_ouuts
;

23 
	gnum_şbs
;

25 
Ãt_t
* 
	gÃt
;

26 
	gnum_Ãts
;

27 
	gnum_glob®s
;

29 
boŞ—n
* 
	gis_glob®
;

34 
	gg_num_grid_ty³s
;

35 * 
	gg_grid_ÿ·c™y
;

37 
	gground_num
;

40 
	gnum_grid_cŞumns
;

41 
	gnum_grid_rows
;

42 
	gio_¿tio
;

43 
	gmax_pšs_³r_şb
;

48 ** 
	gpšloc
;

51 * 
	gşb_pš_şass
;

59 
boŞ—n
* 
	gis_glob®_şb_pš
;

61 
pš_şass_t
* 
	gşass_šf
;

63 
	gnum_pš_şass
;

65 * 
	gchª_width_x
, *
	gchª_width_y
;

67 
grid_te_t
** 
	gbš_grids
;

72 
s_Œaû
** 
	gŒaû_h—d
;

73 
s_Œaû
** 
	gŒaû_
;

77 
	gnum_¼_nodes
;

78 
¼_node_t
* 
	g¼_node
;

80 
	gnum_¼_šdexed_d©a
;

81 
¼_šdexed_d©a_t
* 
	g¼_šdexed_d©a
;

85 ** 
	gÃt_¼_‹rmš®s
;

90 
sw™ch_šfo_t
* 
	gsw™ch_šf
;

94 ** 
	g¼_şb_sourû
;

97 * 
	gg_pšs_Ú_block
;

100 
g‘_šput
(* 
Ãi¡_fe
, * 
¬ch_fe
, 
¶aû_co¡_ty³
,

101 
num_»giÚs
, 
a¥eù_¿tio
, 
boŞ—n
 
u£r_sized
,

102 
rou‹r_ty³s_t
 
rou‹_ty³
, 
d‘a_routšg_¬ch_t


103 *
d‘_routšg_¬ch
, 
£gm’t_šfo_t
** 
£gm’t_šf_±r
,

104 
timšg_šfo_t
* 
timšg_šf_±r
, 
subblock_d©a_t
* 
subblock_d©a_±r
,

105 
chª_width_di¡r_t
* 
chª_width_di¡_±r
);

107 
·r£_commªd
(
¬gc
,

108 * 
¬gv
[],

109 * 
Ãi¡_fe
,

110 * 
¬ch_fe
,

111 * 
¶aû_fe
,

112 * 
rou‹_fe
,

113 
İ”©iÚ_ty³s_t
* 
İ”©iÚ
,

114 * 
a¥eù_¿tio
,

115 
boŞ—n
* 
fuÎ_¡©s
,

116 
boŞ—n
* 
u£r_sized
,

117 
boŞ—n
* 
v”ify_bš¬y_£¬ch
,

118 * 
gr_automode
,

119 
boŞ—n
* 
show_g¿phics
,

120 
ªÃ®šg_sched_t
* 
ªÃ®šg_sched
,

121 
¶aûr_İts_t
* 
¶aûr_İts
,

122 
rou‹r_İts_t
* 
rou‹r_İts
,

123 
boŞ—n
* 
timšg_ª®ysis_’abËd
,

124 * 
cÚ¡ªt_Ãt_d–ay
);

126 
»ad_št_İtiÚ
(
¬gc
, * 
¬gv
[], 
Ÿrg
);

127 
»ad_doubË_İtiÚ
(
¬gc
, * 
¬gv
[], 
Ÿrg
);

131 
	$maš
(
¬gc
, * 
¬gv
[])

133 
t™Ë
[] = "\n\nVPR FPGA Placement‡nd Routing Program Version 4.3\n"

136 "Sourû com¶‘ed M¬ch 25, 2000; comped " 
__DATE__
 ".\n"

138 
	`´štf
("%s", 
t™Ë
);

140 
Ãi¡_fe
[
BUFSIZE
];

141 
¬ch_fe
[
BUFSIZE
];

143 
¶aû_fe
[
BUFSIZE
];

144 
rou‹_fe
[
BUFSIZE
];

146 
a¥eù_¿tio
;

147 
boŞ—n
 
fuÎ_¡©s
, 
u£r_sized
;

148 
·d_loc_fe
[
BUFSIZE
];

150 
İ”©iÚ_ty³s_t
 
İ”©iÚ
;

152 
boŞ—n
 
v”ify_bš¬y_£¬ch
;

153 
boŞ—n
 
show_g¿phics
;

155 
gr_automode
;

156 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
;

157 
¶aûr_İts_t
 
¶aûr_İts
;

158 
rou‹r_İts_t
 
rou‹r_İts
;

159 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
;

160 
£gm’t_šfo_t
* 
£gm’t_šf
;

161 
timšg_šfo_t
 
timšg_šf
;

162 
subblock_d©a_t
 
subblock_d©a
;

163 
chª_width_di¡r_t
 
chª_width_di¡
;

164 
cÚ¡ªt_Ãt_d–ay
;

165 
¶aûr_İts
.
·d_loc_fe
 =…ad_loc_file;

167 
	`·r£_commªd
(
¬gc
,

168 
¬gv
,

169 
Ãi¡_fe
,

170 
¬ch_fe
,

171 
¶aû_fe
,

172 
rou‹_fe
,

173 &
İ”©iÚ
,

174 &
a¥eù_¿tio
,

175 &
fuÎ_¡©s
,

176 &
u£r_sized
,

177 &
v”ify_bš¬y_£¬ch
,

178 &
gr_automode
,

179 &
show_g¿phics
,

180 &
ªÃ®šg_sched
,

181 &
¶aûr_İts
,

182 &
rou‹r_İts
,

183 &
timšg_šf
.
timšg_ª®ysis_’abËd
,

184 &
cÚ¡ªt_Ãt_d–ay
);

185 
	`´štf
("šÃr_num = %f\n", 
ªÃ®šg_sched
.
šÃr_num
);

188 
	`g‘_šput
(
Ãi¡_fe
,

189 
¬ch_fe
,

190 
¶aûr_İts
.
¶aû_co¡_ty³
,

191 
¶aûr_İts
.
num_»giÚs
,

192 
a¥eù_¿tio
, 
u£r_sized
,

193 
rou‹r_İts
.
rou‹_ty³
,

194 &
d‘_routšg_¬ch
,

195 &
£gm’t_šf
,

196 &
timšg_šf
,

197 &
subblock_d©a
,

198 &
chª_width_di¡
);

200 ià(
fuÎ_¡©s
 =ğ
TRUE
) {

201 
	`´št_Ïmbda
();

204 #ifdeà
DEBUG


205 
	`´št_Ãi¡
("netlist.echo",

206 
Ãi¡_fe
,

207 
subblock_d©a
);

208 
	`´št_¬ch
(
¬ch_fe
,

209 
rou‹r_İts
.
rou‹_ty³
,

210 
d‘_routšg_¬ch
,

211 
£gm’t_šf
,

212 
timšg_šf
,

213 
subblock_d©a
,

214 
chª_width_di¡
);

217 ià(
İ”©iÚ
 =ğ
TIMING_ANALYSIS_ONLY
) {

218 
	`do_cÚ¡ªt_Ãt_d–ay_timšg_ª®ysis
(
¶aûr_İts
,

219 
timšg_šf
,

220 
subblock_d©a
,

221 
cÚ¡ªt_Ãt_d–ay
);

222 
	`ä“_subblock_d©a
(&
subblock_d©a
);

223 
	`ex™
(0);

226 
	`£t_g¿phics_¡©e
(
show_g¿phics
,

227 
gr_automode
,

228 
rou‹r_İts
.
rou‹_ty³
);

230 ià(
show_g¿phics
) {

232 
	`š™_g¿phics
("VPR: Versatile Place‡nd Route for FPGAs");

233 
	`®loc_d¿w_¡ruùs
();

236 
	`fæush
(
¡dout
);

237 
	`¶aû_ªd_rou‹
(
İ”©iÚ
,

238 
¶aûr_İts
,

239 
¶aû_fe
,

240 
Ãi¡_fe
,

241 
¬ch_fe
,

242 
rou‹_fe
,

243 
fuÎ_¡©s
,

244 
v”ify_bš¬y_£¬ch
,

245 
ªÃ®šg_sched
,

246 
rou‹r_İts
,

247 
d‘_routšg_¬ch
,

248 
£gm’t_šf
,

249 
timšg_šf
,

250 &
subblock_d©a
,

251 
chª_width_di¡
);

254 
	}
}

256 
	$·r£_commªd
(
¬gc
,

257 * 
¬gv
[],

258 * 
Ãi¡_fe
,

259 * 
¬ch_fe
,

260 * 
¶aû_fe
,

261 * 
rou‹_fe
,

262 
İ”©iÚ_ty³s_t
* 
İ”©iÚ
,

263 * 
a¥eù_¿tio
,

264 
boŞ—n
* 
fuÎ_¡©s
,

265 
boŞ—n
* 
u£r_sized
,

266 
boŞ—n
* 
v”ify_bš¬y_£¬ch
,

267 * 
gr_automode
,

268 
boŞ—n
* 
show_g¿phics
,

269 
ªÃ®šg_sched_t
* 
ªÃ®šg_sched
,

270 
¶aûr_İts_t
* 
¶aûr_İts
,

271 
rou‹r_İts_t
* 
rou‹r_İts
,

272 
boŞ—n
* 
timšg_ª®ysis_’abËd
,

273 * 
cÚ¡ªt_Ãt_d–ay
)

277 
£ed
 = 1;

279 
boŞ—n
 
do_Úe_nÚlš—r_¶aû
 = 
FALSE
;

280 
boŞ—n
 
b’d_co¡_£t
 = 
FALSE
;

281 
boŞ—n
 
rou‹r_ba£_co¡_ty³_£t
 = 
FALSE
;

283 
num_grid_cŞumns
 = 0;

284 
num_grid_rows
 = 0;

285 *
İ”©iÚ
 = 
PLACE_AND_ROUTE
;

286 
ªÃ®šg_sched
->
ty³
 = 
AUTO_SCHED
;

287 
ªÃ®šg_sched
->
šÃr_num
 = 10.0;

288 
ªÃ®šg_sched
->
š™_t
 = 100.0;

289 
ªÃ®šg_sched
->
®pha_t
 = 0.8;

290 
ªÃ®šg_sched
->
ex™_t
 = 0.01;

291 
¶aûr_İts
->
¶aû_®gÜ™hm
 = 
PATH_TIMING_DRIVEN_PLACE
;

292 
¶aûr_İts
->
timšg_Œadeoff
 = 0.5;

293 
¶aûr_İts
->
block_di¡
 = 1;

294 
¶aûr_İts
->
¶aû_co¡_exp
 = 1.0;

295 
¶aûr_İts
->
¶aû_co¡_ty³
 = 
LINEAR_CONG
;

296 
¶aûr_İts
->
num_»giÚs
 = 4;

297 
¶aûr_İts
->
¶aû_äeq
 = 
PLACE_ONCE
;

298 
¶aûr_İts
->
¶aû_chª_width
 = 100;

299 
¶aûr_İts
->
·d_loc_ty³
 = 
FREE
;

300 
¶aûr_İts
->
·d_loc_fe
[0] = '\0';

301 
¶aûr_İts
->
»compu‹_ü™_™”
 = 1;

302 
¶aûr_İts
->
’abË_timšg_computiÚs
 = 
FALSE
;

303 
¶aûr_İts
->
šÃr_loİ_»compu‹_divid”
 = 0;

305 
¶aûr_İts
->
td_¶aû_exp_fœ¡
 = 1;

306 
¶aûr_İts
->
td_¶aû_exp_Ï¡
 = 8;

308 
¶aûr_İts
->
¶aû_·¿Î–
 = 
FALSE
;

309 
¶aûr_İts
->
m_´ob
 = 10;

312 
rou‹r_İts
->
rou‹r_®gÜ™hm
 = 
TIMING_DRIVEN
;

313 
rou‹r_İts
->
fœ¡_™”_´es_çc
 = 0.5;

314 
rou‹r_İts
->
š™Ÿl_´es_çc
 = 0.5;

315 
rou‹r_İts
->
´es_çc_muÉ
 = 2;

316 
rou‹r_İts
->
acc_çc
 = 1;

317 
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 = 
DEMAND_ONLY
;

318 
rou‹r_İts
->
b’d_co¡
 = 1.;

319 
rou‹r_İts
->
max_rou‹r_™”©iÚs
 = 30;

320 
rou‹r_İts
->
bb_çùÜ
 = 3;

321 
rou‹r_İts
->
rou‹_ty³
 = 
DETAILED
;

322 
rou‹r_İts
->
fixed_chªÃl_width
 = 
NO_FIXED_CHANNEL_WIDTH
;

323 
rou‹r_İts
->
a¡¬_çc
 = 1.2;

324 
rou‹r_İts
->
max_ü™iÿl™y
 = 0.99;

325 
rou‹r_İts
->
ü™iÿl™y_exp
 = 1.0;

326 *
timšg_ª®ysis_’abËd
 = 
TRUE
;

327 *
a¥eù_¿tio
 = 1.0;

328 *
fuÎ_¡©s
 = 
FALSE
;

329 *
u£r_sized
 = 
FALSE
;

330 *
v”ify_bš¬y_£¬ch
 = 
FALSE
;

331 *
show_g¿phics
 = 
TRUE
;

332 *
gr_automode
 = 1;

333 *
cÚ¡ªt_Ãt_d–ay
 = -1;

337 ià(
¬gc
 < 5) {

338 
	`´štf
("Usage: vpr circuit.net fpga.arch…laced.out„outed.out "

340 
	`´štf
("General Options: [-nodisp] [-auto <int>] [-route_only]\n");

341 
	`´štf
("\t[-place_only] [-timing_analyze_only_with_net_delay <double>]\n");

342 
	`´štf
("\t[-aspect_ratio <double>] [-num_grid_columns <int>] [-num_grid_rows <int>] [-fast]\n");

343 
	`´štf
("\t[-full_stats] [-timing_analysis on | off]\n");

344 
	`´štf
("\nPlacer Options: \n");

345 
	`´štf
("\t[-place_algorithm bounding_box |‚et_timing_driven |…ath_timing_driven |‚ew_timing_driven]\n");

346 
	`´štf
("\t[-ground_num <double>]\n");

348 
	`´štf
("\t[-place_parallel on | off]");

349 
	`´štf
("\t[-init_t <double>] [-exit_t <double>]\n");

350 
	`´štf
("\t[-alpha_t <double>] [-inner_num <double>] [-seed <int>]\n");

351 
	`´štf
("\t[-place_cost_exp <double>] [-place_cost_type†inear | "

353 
	`´štf
("\t[-place_chan_width <int>] [-num_regions <int>] \n");

354 
	`´štf
("\t[-fix_pins„andom | <file.pads>]\n");

355 
	`´štf
("\t[-enable_timing_computations on | off]\n");

356 
	`´štf
("\t[-block_dist <int>]\n");

357 
	`´štf
("\nPlacement Options Valid Only for Timing-Driven Placement:\n");

358 
	`´štf
("\t[-timing_tradeoff <double>]\n");

359 
	`´štf
("\t[-recompute_crit_iter <int>]\n");

360 
	`´štf
("\t[-inner_loop_recompute_divider <int>]\n");

361 
	`´štf
("\t[-td_place_exp_first <double>]\n");

362 
	`´štf
("\t[-td_place_exp_last <double>]\n");

363 
	`´štf
("\nRouter Options: [-max_router_iterations <int>] "

365 
	`´štf
("\t[-initial_pres_fac <double>] [-pres_fac_mult <double>]\n"

372 
	`´štf
("\nRouting options valid only foriming-driven„outing:\n"

375 
	`ex™
(1);

377 
	`¡ºıy
(
Ãi¡_fe
, 
¬gv
[1], 
BUFSIZE
);

378 
	`¡ºıy
(
¬ch_fe
, 
¬gv
[2], 
BUFSIZE
);

379 
	`¡ºıy
(
¶aû_fe
, 
¬gv
[3], 
BUFSIZE
);

380 
	`¡ºıy
(
rou‹_fe
, 
¬gv
[4], 
BUFSIZE
);

383 
i
 = 5;

384 
i
 < 
¬gc
) {

385 ià(
	`¡rcmp
(
¬gv
[
i
], "-aspect_ratio") == 0) {

386 *
a¥eù_¿tio
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

388 ià(*
a¥eù_¿tio
 <= 0.) {

389 
	`´štf
("Error: Aspect„atio must be > 0.\n");

390 
	`ex™
(1);

393 
i
 += 2;

397 ià(
	`¡rcmp
(
¬gv
[
i
], "-nodisp") == 0) {

398 *
show_g¿phics
 = 
FALSE
;

399 
i
++;

403 ià(
	`¡rcmp
(
¬gv
[
i
], "-auto") == 0) {

404 *
gr_automode
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

406 ià((*
gr_automode
 > 2) || (*gr_automode < 0)) {

407 
	`´štf
("Error: -auto value must be between 0‡nd 2.\n");

408 
	`ex™
(1);

411 
i
 += 2;

415 ià(
	`¡rcmp
(
¬gv
[
i
], "-recompute_crit_iter") == 0) {

416 
¶aûr_İts
->
»compu‹_ü™_™”
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

418 ià(
¶aûr_İts
->
»compu‹_ü™_™”
 < 1) {

419 
	`´štf
("Error: -recompute_crit_iter must be 1 or more \n");

420 
	`ex™
(1);

423 
i
 += 2;

427 ià(
	`¡rcmp
(
¬gv
[
i
], "-inner_loop_recompute_divider") == 0) {

428 
¶aûr_İts
->
šÃr_loİ_»compu‹_divid”
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

430 ià(
¶aûr_İts
->
šÃr_loİ_»compu‹_divid”
 < 1) {

431 
	`´štf
("Error: -inner_loop_recompute_divider must be 1 or more \n");

432 
	`ex™
(1);

435 
i
 += 2;

439 ià(
	`¡rcmp
(
¬gv
[
i
], "-fix_pins") == 0) {

440 ià(
¬gc
 <ğ
i
 + 1) {

441 
	`´štf
("Error: -fix_pins option„equires‡ string…arameter.\n");

442 
	`ex™
(1);

445 ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "random") == 0) {

446 
¶aûr_İts
->
·d_loc_ty³
 = 
RANDOM
;

448 
¶aûr_İts
->
·d_loc_ty³
 = 
USER
;

449 
	`¡ºıy
(
¶aûr_İts
->
·d_loc_fe
, 
¬gv
[
i
 + 1], 
BUFSIZE
);

452 
i
 += 2;

456 ià(
	`¡rcmp
(
¬gv
[
i
], "-full_stats") == 0) {

457 *
fuÎ_¡©s
 = 
TRUE
;

458 
i
 += 1;

462 ià(
	`¡rcmp
(
¬gv
[
i
], "-num_grid_columns") == 0) {

463 
num_grid_cŞumns
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

464 *
u£r_sized
 = 
TRUE
;

466 ià(
num_grid_cŞumns
 <= 0) {

467 
	`´štf
("Error: -num_grid_columns value must be greaterhan 0.\n");

468 
	`ex™
(1);

471 
i
 += 2;

475 ià(
	`¡rcmp
(
¬gv
[
i
], "-num_grid_rows") == 0) {

476 
num_grid_rows
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

477 *
u£r_sized
 = 
TRUE
;

479 ià(
num_grid_rows
 <= 0) {

480 
	`´štf
("Error: -num_grid_rows value must be greaterhan 0.\n");

481 
	`ex™
(1);

484 
i
 += 2;

488 ià(
	`¡rcmp
(
¬gv
[
i
], "-fast") == 0) {

490 
ªÃ®šg_sched
->
šÃr_num
 = 1.0;

491 
rou‹r_İts
->
fœ¡_™”_´es_çc
 = 10000;

492 
rou‹r_İts
->
š™Ÿl_´es_çc
 = 10000;

493 
rou‹r_İts
->
bb_çùÜ
 = 0;

494 
rou‹r_İts
->
max_rou‹r_™”©iÚs
 = 10;

495 
i
++;

499 ià(
	`¡rcmp
(
¬gv
[
i
], "-timing_analysis") == 0) {

500 ià(
¬gc
 <ğ
i
 + 1) {

501 
	`´štf
("Error: -timing_analysis option„equires‡ string "

503 
	`ex™
(1);

506 ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "on") == 0) {

507 *
timšg_ª®ysis_’abËd
 = 
TRUE
;

508 } ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "off") == 0) {

509 *
timšg_ª®ysis_’abËd
 = 
FALSE
;

511 
	`´štf
("Error: -timing_analysis must be on or off.\n");

512 
	`ex™
(1);

515 
i
 += 2;

519 ià(
	`¡rcmp
(
¬gv
[
i
], "-timing_analyze_only_with_net_delay") == 0) {

520 *
İ”©iÚ
 = 
TIMING_ANALYSIS_ONLY
;

521 *
cÚ¡ªt_Ãt_d–ay
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

523 ià(*
cÚ¡ªt_Ãt_d–ay
 < 0.) {

524 
	`´štf
("Error: -timing_analyze_only_with_net_delay value must "

526 
	`ex™
(1);

529 
i
 += 2;

533 ià(
	`¡rcmp
(
¬gv
[
i
], "-init_t") == 0) {

534 
ªÃ®šg_sched
->
š™_t
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

536 ià(
ªÃ®šg_sched
->
š™_t
 < 0) {

537 
	`´štf
("Error: -init_t value must be‚onnegative 0.\n");

538 
	`ex™
(1);

541 
ªÃ®šg_sched
->
ty³
 = 
USER_SCHED
;

542 
i
 += 2;

546 ià(
	`¡rcmp
(
¬gv
[
i
], "-alpha_t") == 0) {

547 
ªÃ®šg_sched
->
®pha_t
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

548 ià((
ªÃ®šg_sched
->
®pha_t
 <= 0) ||

549 (
ªÃ®šg_sched
->
®pha_t
 >= 1.)) {

550 
	`´štf
("Error: -alpha_t value must be between 0.‡nd 1.\n");

551 
	`ex™
(1);

554 
ªÃ®šg_sched
->
ty³
 = 
USER_SCHED
;

555 
i
 += 2;

559 ià(
	`¡rcmp
(
¬gv
[
i
], "-exit_t") == 0) {

560 
ªÃ®šg_sched
->
ex™_t
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

562 ià(
ªÃ®šg_sched
->
ex™_t
 <= 0.) {

563 
	`´štf
("Error: -exit_t value must be greaterhan 0.\n");

564 
	`ex™
(1);

567 
ªÃ®šg_sched
->
ty³
 = 
USER_SCHED
;

568 
i
 += 2;

573 ià(
	`¡rcmp
(
¬gv
[
i
], "-inner_num") == 0) {

575 
ªÃ®šg_sched
->
šÃr_num
 = 
	`©of
(
¬gv
[
i
 + 1]);

576 ià(
ªÃ®šg_sched
->
šÃr_num
 <= 0.0) {

577 
	`´štf
("Error: -inner_num value must be greaterhan 0.\n");

578 
	`ex™
(1);

581 
i
 += 2;

585 ià(
	`¡rcmp
(
¬gv
[
i
], "-seed") == 0) {

586 
£ed
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

587 
i
 += 2;

591 ià(
	`¡rcmp
(
¬gv
[
i
], "-place_cost_exp") == 0) {

592 
¶aûr_İts
->
¶aû_co¡_exp
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

594 ià(
¶aûr_İts
->
¶aû_co¡_exp
 < 0.) {

595 
	`´štf
("Error: -place_cost_exp value must be‚onnegative.\n");

596 
	`ex™
(1);

599 
i
 += 2;

603 ià(
	`¡rcmp
(
¬gv
[
i
], "-td_place_exp_first") == 0) {

604 
¶aûr_İts
->
td_¶aû_exp_fœ¡
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

606 ià(
¶aûr_İts
->
td_¶aû_exp_fœ¡
 < 0.) {

607 
	`´štf
("Error: -td_place_exp_first value must be‚onnegative.\n");

608 
	`ex™
(1);

611 
i
 += 2;

615 ià(
	`¡rcmp
(
¬gv
[
i
], "-td_place_exp_last") == 0) {

616 
¶aûr_İts
->
td_¶aû_exp_Ï¡
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

618 ià(
¶aûr_İts
->
td_¶aû_exp_Ï¡
 < 0.) {

619 
	`´štf
("Error: -td_place_exp_last value must be‚onnegative.\n");

620 
	`ex™
(1);

623 
i
 += 2;

627 ià(
	`¡rcmp
(
¬gv
[
i
], "-place_algorithm") == 0) {

628 ià(
¬gc
 <ğ
i
 + 1) {

629 
	`´štf
("Error: -place_algorithm option„equires‡ "

631 
	`ex™
(1);

634 ià(
	`¡rcmp
(
¬gv
[
i
+1], "bounding_box") == 0) {

635 
¶aûr_İts
->
¶aû_®gÜ™hm
 = 
BOUNDING_BOX_PLACE
;

636 } ià(
	`¡rcmp
(
¬gv
[
i
+1], "net_timing_driven") == 0) {

637 
¶aûr_İts
->
¶aû_®gÜ™hm
 = 
NET_TIMING_DRIVEN_PLACE
;

638 } ià(
	`¡rcmp
(
¬gv
[
i
+1], "path_timing_driven") == 0) {

639 
¶aûr_İts
->
¶aû_®gÜ™hm
 = 
PATH_TIMING_DRIVEN_PLACE
;

640 } ià(
	`¡rcmp
(
¬gv
[
i
+1], "new_timing_driven") == 0) {

641 
¶aûr_İts
->
¶aû_®gÜ™hm
 = 
NEW_TIMING_DRIVEN_PLACE
;

643 
	`´štf
("Error: -place_algorithm must be bounding_box, "

645 
	`ex™
(1);

648 
i
 += 2;

652 ià(
	`¡rcmp
(
¬gv
[
i
], "-ground_num") == 0) {

653 ià(
¬gc
 <ğ
i
 + 1) {

654 
	`´štf
("Error: NEW_TIMING_DRIVEN_PLACE‚eed‡ ground‚um.\n");

655 
	`ex™
(1);

658 
ground_num
 = 
	`©of
(
¬gv
[
i
+1]);

659 ià(
ground_num
 < 0.0) {

660 
	`´štf
("Error: ground_num must biggerhan 0!\n");

662 
i
 += 2;

666 ià(
	`¡rcmp
(
¬gv
[
i
], "-place_parallel") == 0) {

667 ià(
¬gc
 <ğ
i
 + 1) {

668 
	`´štf
("Error: should set whether use…arallel…lacementƒxplicity.\n");

669 
	`ex™
(1);

672 ià(
	`¡rcmp
(
¬gv
[
i
+1], "on") == 0) {

673 
¶aûr_İts
->
¶aû_·¿Î–
 = 
TRUE
;

676 
ªÃ®šg_sched
->
šÃr_num
 = 90.0;

677 } ià(
	`¡rcmp
(
¬gv
[
i
+1], "off") == 0) {

678 
¶aûr_İts
->
¶aû_·¿Î–
 = 
FALSE
;

680 
	`´štf
("Error: only can use on or off options.\n");

681 
	`ex™
(1);

683 
i
 += 2;

688 ià(
	`¡rcmp
(
¬gv
[
i
], "-prob") == 0) {

689 
¶aûr_İts
->
m_´ob
 = 
	`©oi
(
¬gv
[
i
 + 1]);

690 ià(
¶aûr_İts
->
m_´ob
 < 0) {

691 
	`´štf
("Error: -prob value must be‚onnegative.\n");

692 
	`ex™
(1);

695 
i
 += 2;

699 ià(
	`¡rcmp
(
¬gv
[
i
], "-timing_tradeoff") == 0) {

700 
¶aûr_İts
->
timšg_Œadeoff
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

701 ià(
¶aûr_İts
->
timšg_Œadeoff
 < 0.) {

702 
	`´štf
("Error: -timing_tradeoff value must be‚onnegative.\n");

703 
	`ex™
(1);

706 
i
 += 2;

710 ià(
	`¡rcmp
(
¬gv
[
i
], "-enable_timing_computations") == 0) {

711 ià(
¬gc
 <ğ
i
 + 1) {

712 
	`´štf
("Error: -enable_timing_computations option„equires‡ string "

714 
	`ex™
(1);

717 ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "on") == 0) {

718 
¶aûr_İts
->
’abË_timšg_computiÚs
 = 
TRUE
;

719 } ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "off") == 0) {

720 
¶aûr_İts
->
’abË_timšg_computiÚs
 = 
FALSE
;

722 
	`´štf
("Error: -enable_timing_computations must be on or off.\n");

723 
	`ex™
(1);

726 
i
 += 2;

730 ià(
	`¡rcmp
(
¬gv
[
i
], "-block_dist") == 0) {

731 
¶aûr_İts
->
block_di¡
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

732 ià(
¶aûr_İts
->
block_di¡
 < 0.) {

733 
	`´štf
("Error: -block_dist value must be‚onnegative.\n");

734 
	`ex™
(1);

737 
i
 += 2;

741 ià(
	`¡rcmp
(
¬gv
[
i
], "-place_cost_type") == 0) {

742 ià(
¬gc
 <ğ
i
 + 1) {

743 
	`´štf
("Error: -place_cost_type option„equires‡ "

745 
	`ex™
(1);

748 ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "linear") == 0) {

749 
¶aûr_İts
->
¶aû_co¡_ty³
 = 
LINEAR_CONG
;

750 } ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "nonlinear") == 0) {

751 
¶aûr_İts
->
¶aû_co¡_ty³
 = 
NONLINEAR_CONG
;

753 
	`´štf
("Error: -place_cost_type must be†inear or‚onlinear.\n");

754 
	`ex™
(1);

757 
i
 += 2;

761 ià(
	`¡rcmp
(
¬gv
[
i
], "-num_regions") == 0) {

762 
¶aûr_İts
->
num_»giÚs
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

764 ià(
¶aûr_İts
->
num_»giÚs
 <= 0.) {

765 
	`´štf
("Error: -num_regions value must be greaterhan 0.\n");

766 
	`ex™
(1);

769 
i
 += 2;

773 ià(
	`¡rcmp
(
¬gv
[
i
], "-place_chan_width") == 0) {

774 
¶aûr_İts
->
¶aû_chª_width
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

776 ià(
¶aûr_İts
->
¶aû_chª_width
 <= 0.) {

777 
	`´štf
("Error: -place_chan_width value must be greaterhan 0.\n");

778 
	`ex™
(1);

781 
i
 += 2;

782 
do_Úe_nÚlš—r_¶aû
 = 
TRUE
;

786 ià(
	`¡rcmp
(
¬gv
[
i
], "-max_router_iterations") == 0) {

787 
rou‹r_İts
->
max_rou‹r_™”©iÚs
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

789 ià(
rou‹r_İts
->
max_rou‹r_™”©iÚs
 < 0) {

790 
	`´štf
("Error: -max_router_iterations value is†esshan 0.\n");

791 
	`ex™
(1);

794 
i
 += 2;

798 ià(
	`¡rcmp
(
¬gv
[
i
], "-bb_factor") == 0) {

799 
rou‹r_İts
->
bb_çùÜ
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

801 ià(
rou‹r_İts
->
bb_çùÜ
 < 0) {

802 
	`´štf
("Error: -bb_factor is†esshan 0.\n");

803 
	`ex™
(1);

806 
i
 += 2;

810 ià(
	`¡rcmp
(
¬gv
[
i
], "-router_algorithm") == 0) {

811 ià(
¬gc
 <ğ
i
 + 1) {

812 
	`´štf
("Error: -router_algorithm option„equires‡ string "

814 
	`ex™
(1);

817 ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "breadth_first") == 0) {

818 
rou‹r_İts
->
rou‹r_®gÜ™hm
 = 
BREADTH_FIRST
;

819 } ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "timing_driven") == 0) {

820 
rou‹r_İts
->
rou‹r_®gÜ™hm
 = 
TIMING_DRIVEN
;

822 
	`´štf
("Error: -router_algorithm must be breadth_first or "

824 
	`ex™
(1);

827 
i
 += 2;

831 ià(
	`¡rcmp
(
¬gv
[
i
], "-first_iter_pres_fac") == 0) {

832 
rou‹r_İts
->
fœ¡_™”_´es_çc
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

834 ià(
rou‹r_İts
->
fœ¡_™”_´es_çc
 < 0.) {

835 
	`´štf
("Error: -first_iter_pres_fac must be‚onnegative.\n");

836 
	`ex™
(1);

839 
i
 += 2;

843 ià(
	`¡rcmp
(
¬gv
[
i
], "-initial_pres_fac") == 0) {

844 
rou‹r_İts
->
š™Ÿl_´es_çc
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

846 ià(
rou‹r_İts
->
š™Ÿl_´es_çc
 <= 0.) {

847 
	`´štf
("Error: -initial_pres_fac must be greaterhan 0.\n");

848 
	`ex™
(1);

851 
i
 += 2;

855 ià(
	`¡rcmp
(
¬gv
[
i
], "-pres_fac_mult") == 0) {

856 
rou‹r_İts
->
´es_çc_muÉ
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

858 ià(
rou‹r_İts
->
´es_çc_muÉ
 <= 0.) {

859 
	`´štf
("Error: -pres_fac_mult must be greaterhan "

861 
	`ex™
(1);

864 
i
 += 2;

868 ià(
	`¡rcmp
(
¬gv
[
i
], "-acc_fac") == 0) {

869 
rou‹r_İts
->
acc_çc
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

871 ià(
rou‹r_İts
->
acc_çc
 < 0.) {

872 
	`´štf
("Error: -acc_fac must be‚onnegative.\n");

873 
	`ex™
(1);

876 
i
 += 2;

880 ià(
	`¡rcmp
(
¬gv
[
i
], "-astar_fac") == 0) {

881 
rou‹r_İts
->
a¡¬_çc
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

883 ià(
rou‹r_İts
->
a¡¬_çc
 < 0.) {

884 
	`´štf
("Error: -astar_fac must be‚onnegative.\n");

885 
	`ex™
(1);

888 
i
 += 2;

892 ià(
	`¡rcmp
(
¬gv
[
i
], "-max_criticality") == 0) {

893 
rou‹r_İts
->
max_ü™iÿl™y
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

895 ià(
rou‹r_İts
->
max_ü™iÿl™y
 < 0. ||„outer_opts->max_criticality

897 
	`´štf
("Error: -max_criticality must be greaterhan orƒqual\n"

899 
	`ex™
(1);

902 
i
 += 2;

906 ià(
	`¡rcmp
(
¬gv
[
i
], "-criticality_exp") == 0) {

907 
rou‹r_İts
->
ü™iÿl™y_exp
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

909 ià(
rou‹r_İts
->
ü™iÿl™y_exp
 < 0.) {

910 
	`´štf
("Error: -criticality_exp must be‚on-negative.\n");

911 
	`ex™
(1);

914 
i
 += 2;

918 ià(
	`¡rcmp
(
¬gv
[
i
], "-router_base_cost_type") == 0) {

919 ià(
¬gc
 <ğ
i
 + 1) {

920 
	`´štf
("Error: -router_base_cost_type option„equires‡ string "

922 
	`ex™
(1);

925 ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "intrinsic_delay") == 0) {

926 
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 = 
INTRINSIC_DELAY
;

927 } ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "delay_normalized") == 0) {

928 
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 = 
DELAY_NORMALIZED
;

929 } ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "demand_only") == 0) {

930 
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 = 
DEMAND_ONLY
;

932 
	`´štf
("Error: -router_base_cost_type must be intrinsic_delay, "

934 
	`ex™
(1);

937 
rou‹r_ba£_co¡_ty³_£t
 = 
TRUE
;

938 
i
 += 2;

942 ià(
	`¡rcmp
(
¬gv
[
i
], "-bend_cost") == 0) {

943 
rou‹r_İts
->
b’d_co¡
 = 
	`»ad_doubË_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

945 ià(
rou‹r_İts
->
b’d_co¡
 < 0.) {

946 
	`´štf
("Error: -bend_cost cannot be†esshan 0.\n");

947 
	`ex™
(1);

950 
b’d_co¡_£t
 = 
TRUE
;

951 
i
 += 2;

955 ià(
	`¡rcmp
(
¬gv
[
i
], "-route_type") == 0) {

956 ià(
¬gc
 <ğ
i
 + 1) {

957 
	`´štf
("Error: -route_type option„equires‡ "

959 
	`ex™
(1);

962 ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "global") == 0) {

963 
rou‹r_İts
->
rou‹_ty³
 = 
GLOBAL
;

964 } ià(
	`¡rcmp
(
¬gv
[
i
 + 1], "detailed") == 0) {

965 
rou‹r_İts
->
rou‹_ty³
 = 
DETAILED
;

967 
	`´štf
("Error: -route_type must be global or detailed.\n");

968 
	`ex™
(1);

971 
i
 += 2;

975 ià(
	`¡rcmp
(
¬gv
[
i
], "-route_chan_width") == 0) {

976 
rou‹r_İts
->
fixed_chªÃl_width
 = 
	`»ad_št_İtiÚ
(
¬gc
, 
¬gv
, 
i
);

978 ià(
rou‹r_İts
->
fixed_chªÃl_width
 <= 0) {

979 
	`´štf
("Error: -route_chan_width value must be greaterhan 0.\n");

980 
	`ex™
(1);

983 ià(
rou‹r_İts
->
fixed_chªÃl_width
 >ğ
MAX_CHANNEL_WIDTH
) {

984 
	`´štf
("Error: -router_chan_width value must be†esshan %d."

985 "\n", 
MAX_CHANNEL_WIDTH
);

986 
	`ex™
(1);

989 
i
 += 2;

993 ià(
	`¡rcmp
(
¬gv
[
i
], "-route_only") == 0) {

994 ià(*
İ”©iÚ
 =ğ
PLACE_ONLY
) {

995 
	`´štf
("Error: Both -route_only‡nd -place_only specified.\n");

996 
	`ex™
(1);

999 *
İ”©iÚ
 = 
ROUTE_ONLY
;

1000 
¶aûr_İts
->
¶aû_äeq
 = 
PLACE_NEVER
;

1001 
i
++;

1005 ià(
	`¡rcmp
(
¬gv
[
i
], "-place_only") == 0) {

1006 ià(*
İ”©iÚ
 =ğ
ROUTE_ONLY
) {

1007 
	`´štf
("Error: Both -route_only‡nd -place_only specified.\n");

1008 
	`ex™
(1);

1011 *
İ”©iÚ
 = 
PLACE_ONLY
;

1012 
i
++;

1016 ià(
	`¡rcmp
(
¬gv
[
i
], "-verify_binary_search") == 0) {

1017 *
v”ify_bš¬y_£¬ch
 = 
TRUE
;

1018 
i
++;

1022 
	`´štf
("E¼Ü: UÄecognized fÏg: %s. AbÜtšg.\n", 
¬gv
[
i
]);

1023 
	`ex™
(1);

1027 ià(
¶aûr_İts
->
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
 && *
İ”©iÚ
 !=

1028 
PLACE_AND_ROUTE
 && 
do_Úe_nÚlš—r_¶aû
 =ğ
FALSE
) {

1029 
	`´štf
("Error: Replacing usinghe‚onlinear congestion option\n");

1030 
	`´štf
(" forƒach channel width makes sense only for full "

1032 
	`ex™
(1);

1035 ià(
¶aûr_İts
->
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
 &&

1036 (
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


1037 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE


1038 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
)) {

1040 
	`´štf
("Error: Cannot use‚onlinear…lacement with \n"

1042 
	`ex™
(1);

1045 ià(
rou‹r_İts
->
rou‹_ty³
 =ğ
GLOBAL
 &&

1046 (
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


1047 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE


1048 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
)) {

1051 
	`´štf
("Warning: Using global„outing withiming-driven…lacement.\n");

1052 
	`´štf
("\tThis is‡llowed, but strange,‡nd circuit speed will suffer.\n");

1055 ià(*
timšg_ª®ysis_’abËd
 =ğ
FALSE
 &&

1056 (
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


1057 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE


1058 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
)) {

1060 
	`´štf
("Error:iming‡nalysis must beƒnabled foriming-driven…lacement\n");

1061 
	`ex™
(1);

1064 ià(*
İ”©iÚ
 =ğ
ROUTE_ONLY
 && 
¶aûr_İts
->
·d_loc_ty³
 =ğ
USER
) {

1065 
	`´štf
("Error: You cannot specify both‡ full…lacement file‡nd \n");

1066 
	`´štf
("‡…ad†ocation file.\n");

1067 
	`ex™
(1);

1070 ià(
rou‹r_İts
->
fixed_chªÃl_width
 !ğ
NO_FIXED_CHANNEL_WIDTH
 &&

1071 *
v”ify_bš¬y_£¬ch
) {

1072 
	`´štf
("Error: Routing on‡ fixed channel width (%dracks) "

1073 "¥ecif›d.\n", 
rou‹r_İts
->
fixed_chªÃl_width
);

1074 
	`´štf
(" There is‚o binary searcho verify, so you \n"

1076 
	`ex™
(1);

1079 ià(*
İ”©iÚ
 =ğ
ROUTE_ONLY
 || *İ”©iÚ =ğ
PLACE_AND_ROUTE
) {

1080 ià(
rou‹r_İts
->
rou‹r_®gÜ™hm
 =ğ
TIMING_DRIVEN
 &&

1081 *
timšg_ª®ysis_’abËd
 =ğ
FALSE
) {

1082 
	`´štf
("Error: Cannot…erformiming-driven„outing wheniming "

1084 
	`ex™
(1);

1087 ià(*
timšg_ª®ysis_’abËd
 =ğ
FALSE
 && 
rou‹r_İts
->
rou‹r_ba£_co¡_ty³


1088 !ğ
DEMAND_ONLY
) {

1089 
	`´štf
("Error:„outer_base_cost_type must be demand_only wheniming "

1091 
	`ex™
(1);

1095 ià(*
İ”©iÚ
 =ğ
TIMING_ANALYSIS_ONLY
 && *
timšg_ª®ysis_’abËd
 ==

1096 
FALSE
) {

1097 
	`´štf
("Error: -timing_analyze_only_with_net_delay option„equires\n"

1099 
	`ex™
(1);

1103 
	`´štf
("\nGeneral Options:\n");

1104 ià(*
a¥eù_¿tio
 != 1.0) {

1105 
	`´štf
("\tFPGA will have‡ width/length„atio of %g.\n",

1106 *
a¥eù_¿tio
);

1109 ià(*
u£r_sized
 =ğ
TRUE
) {

1110 
	`´štf
("\tThe FPGA size has been specified byhe user.\n");

1115 ià(
num_grid_rows
 == 0) {

1116 
num_grid_rows
 = ()
num_grid_cŞumns
 / ()(*
a¥eù_¿tio
);

1117 } ià(
num_grid_cŞumns
 == 0) {

1118 
num_grid_cŞumns
 = 
num_grid_rows
 * *
a¥eù_¿tio
;

1119 } ià(*
a¥eù_¿tio
 != 1 && *aspect_ratio !=

1120 
num_grid_cŞumns
 / 
num_grid_rows
) {

1121 
	`´štf
("\nError: User-specified size‡nd‡spect„atio do\n");

1122 
	`´štf
("not match. Notehat‡spect„atio does‚ot haveo\n");

1123 
	`´štf
("be specified if both‚um_grid_columns‡nd‚um_grid_rows‡re specified.\n");

1124 
	`ex™
(1);

1128 ià(*
fuÎ_¡©s
 =ğ
TRUE
) {

1129 
	`´štf
("\tA full statistical„eport will be…rinted.\n");

1132 ià(*
İ”©iÚ
 =ğ
ROUTE_ONLY
) {

1133 
	`´štf
("\tRouting will be…erformed on‡nƒxisting…lacement.\n");

1134 } ià(*
İ”©iÚ
 =ğ
PLACE_ONLY
) {

1135 
	`´štf
("\tThe circuit will be…laced but‚ot„outed.\n");

1136 } ià(*
İ”©iÚ
 =ğ
PLACE_AND_ROUTE
) {

1137 
	`´štf
("\tThe circuit will be…laced‡nd„outed.\n");

1138 } ià(*
İ”©iÚ
 =ğ
TIMING_ANALYSIS_ONLY
) {

1139 
	`´štf
("\tOnlyiming‡nalysis (assuming‡ constant‚et Tdel) will "

1143 ià(*
İ”©iÚ
 =ğ
PLACE_ONLY
 || *İ”©iÚ =ğ
PLACE_AND_ROUTE
) {

1144 
	`´štf
("\nPlacer Options:\n");

1145 ià(
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
) {

1146 
	`´štf
("\tPlacement‡lgorithm is‚et_timing_driven\n");

1147 } ià(
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

1148 
	`´štf
("\tPlacement‡lgorithm is…ath_timing_driven\n");

1149 } ià(
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
){

1150 
	`´štf
("\tPlacement‡lgorithm is‚ew_timing_driven, it depend on \"A Novel Net Weighting Algorithm for Timing-Driven Placement.\"\n");

1152 
	`´štf
("\tPlacement‡lgorithm is wirelength-driven\n");

1155 ià(
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


1156 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE


1157 || 
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

1158 
	`´štf
("\tTradeoff between bounding box‡nd critical…ath: %g\n",

1159 
¶aûr_İts
->
timšg_Œadeoff
);

1160 
	`´štf
("\tLower bound‡ssumes blocks distance: %d\n",

1161 
¶aûr_İts
->
block_di¡
);

1162 
	`´štf
("\tRecomputing criticalitiesƒvery %demperature changes\n",

1163 
¶aûr_İts
->
»compu‹_ü™_™”
);

1164 
	`´štf
("\tInner†oop computes criticalitiesƒvery move_lim/%d moves\n",

1165 
¶aûr_İts
->
šÃr_loİ_»compu‹_divid”
);

1166 
	`´štf
("\tExponent starting value used iniming-driven cost function is %g\n",

1167 
¶aûr_İts
->
td_¶aû_exp_fœ¡
);

1168 
	`´štf
("\tExponent final value used iniming-driven cost function is %g\n",

1169 
¶aûr_İts
->
td_¶aû_exp_Ï¡
);

1170 } ià(
¶aûr_İts
->
¶aû_®gÜ™hm
 =ğ
BOUNDING_BOX_PLACE
) {

1171 
	`´štf
("\tPlacement‡lgorithm is bounding_box\n");

1172 ià(
¶aûr_İts
->
’abË_timšg_computiÚs
) {

1173 
	`´štf
("\tPlacement‡lgorithm will generateimingƒstimates\n"

1178 ià(
ªÃ®šg_sched
->
ty³
 =ğ
AUTO_SCHED
) {

1179 
	`´štf
("\tAutomatic‡nnealing schedule selected.\n");

1180 
	`´štf
("\tNumber of moves inhe inner†oop is (num_blocks)^4/3 "

1181 "* %g\n", 
ªÃ®šg_sched
->
šÃr_num
);

1183 
	`´štf
("\tUser‡nnealing schedule selected with:\n");

1184 
	`´štf
("\tIn™ŸÈTem³¿tu»: %g\n", 
ªÃ®šg_sched
->
š™_t
);

1185 
	`´štf
("\tEx™ (Fš®èTem³¿tu»: %g\n", 
ªÃ®šg_sched
->
ex™_t
);

1186 
	`´štf
("\tTemperature Reduction factor (alpha_t): %g\n",

1187 
ªÃ®šg_sched
->
®pha_t
);

1188 
	`´štf
("\tNumber of moves inhe inner†oop is (num_blocks)^4/3 * "

1189 "%g\n", 
ªÃ®šg_sched
->
šÃr_num
);

1192 ià(
¶aûr_İts
->
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

1193 
	`´štf
("\tPlacement costype is‚onlinear congestion.\n");

1194 
	`´štf
("\tCongestion will be determined on‡ %d x %d‡rray.\n",

1195 
¶aûr_İts
->
num_»giÚs
,…lacer_opts->num_regions);

1197 ià(
do_Úe_nÚlš—r_¶aû
 =ğ
TRUE
) {

1198 
¶aûr_İts
->
¶aû_äeq
 = 
PLACE_ONCE
;

1199 
	`´štf
("\tPlacement will be…erformed once.\n");

1200 
	`´štf
("\tPlacement channel width factor = %d.\n",

1201 
¶aûr_İts
->
¶aû_chª_width
);

1203 
¶aûr_İts
->
¶aû_äeq
 = 
PLACE_ALWAYS
;

1204 
	`´štf
("\tCircuit will be„eplaced forƒach channel width "

1207 } ià(
¶aûr_İts
->
¶aû_co¡_ty³
 =ğ
LINEAR_CONG
) {

1208 
¶aûr_İts
->
¶aû_äeq
 = 
PLACE_ONCE
;

1209 
	`´štf
("\tPlacement costype is†inear congestion.\n");

1210 
	`´štf
("\tPlacement will be…erformed once.\n");

1211 
	`´štf
("\tPlacement channel width factor = %d.\n",

1212 
¶aûr_İts
->
¶aû_chª_width
);

1213 
	`´štf
("\tExponent used in…lacement cost: %g\n",

1214 
¶aûr_İts
->
¶aû_co¡_exp
);

1217 ià(
¶aûr_İts
->
·d_loc_ty³
 =ğ
RANDOM
) {

1218 
	`´štf
("\tPlacer will fixhe IO_TYPE…ins in‡„andom configuration.\n");

1219 } ià(
¶aûr_İts
->
·d_loc_ty³
 =ğ
USER
) {

1220 
	`´štf
("\tPlacer will fixhe IO_TYPE…ins‡s specified by file %s.\n",

1221 
¶aûr_İts
->
·d_loc_fe
);

1226 ià(
b’d_co¡_£t
 =ğ
FALSE
 && 
rou‹r_İts
->
rou‹_ty³
 =ğ
DETAILED
) {

1227 
rou‹r_İts
->
b’d_co¡
 = 0.;

1231 ià(!
rou‹r_ba£_co¡_ty³_£t
 && 
rou‹r_İts
->
rou‹r_®gÜ™hm
 =ğ
TIMING_DRIVEN
) {

1232 
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 = 
DELAY_NORMALIZED
;

1236 ià(
¶aûr_İts
->
¶aû_·¿Î–
 =ğ
FALSE
) {

1237 
	`´štf
("\tPlacer will use single-thread.\n");

1239 
	`´štf
("\tPlacer will use multi-threadso…lace…arallel.\n");

1242 
	`´štf
("\tIn™ŸÈ¿ndom s“d: %d\n", 
£ed
);

1243 
	`my_¤ªdom
(
£ed
);

1246 ià(*
İ”©iÚ
 =ğ
ROUTE_ONLY
 || *İ”©iÚ =ğ
PLACE_AND_ROUTE
) {

1247 
	`´štf
("\nRouting Options:\n");

1249 ià(
rou‹r_İts
->
rou‹_ty³
 =ğ
GLOBAL
) {

1250 
	`´štf
("\tOnly GLOBAL„outing will be…erformed.\n");

1252 
	`´štf
("\tCombined GLOBAL + DETAILED„outing will be…erformed.\n");

1255 ià(
rou‹r_İts
->
rou‹r_®gÜ™hm
 =ğ
BREADTH_FIRST
) {

1256 
	`´štf
("\tRouter‡lgorithm: breadth first.\n");

1258 
	`´štf
("\tRouter‡lgorithm:iming driven.\n");

1261 
	`´štf
("\tThe„outer willry‡t most %d iterations.\n",

1262 
rou‹r_İts
->
max_rou‹r_™”©iÚs
);

1263 
	`´štf
("\tRoutings can go‡t most %d channels outsideheir "

1264 "boundšg box.\n", 
rou‹r_İts
->
bb_çùÜ
);

1269 ià(
b’d_co¡_£t
 =ğ
FALSE
 && 
rou‹r_İts
->
rou‹_ty³
 =ğ
DETAILED
) {

1270 
rou‹r_İts
->
b’d_co¡
 = 0.;

1273 
	`´štf
("\tCo¡ oà¨b’d (b’d_co¡èi %g.\n", 
rou‹r_İts
->
b’d_co¡
);

1274 
	`´štf
("\tFirst iteration sharing…enalty factor (first_iter_pres_fac):"

1275 " %g\n", 
rou‹r_İts
->
fœ¡_™”_´es_çc
);

1276 
	`´štf
("\tInitial (2nd iter.) sharing…enalty factor (initial_pres_fac):"

1277 " %g\n", 
rou‹r_İts
->
š™Ÿl_´es_çc
);

1278 
	`´štf
("\tSharing…enalty growth factor (pres_fac_mult): %g\n",

1279 
rou‹r_İts
->
´es_çc_muÉ
);

1280 
	`´štf
("\tAccumulated sharing…enalty factor (acc_fac): %g\n",

1281 
rou‹r_İts
->
acc_çc
);

1285 ià(!
rou‹r_ba£_co¡_ty³_£t
 && 
rou‹r_İts
->
rou‹r_®gÜ™hm
 =ğ
TIMING_DRIVEN
) {

1286 
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 = 
DELAY_NORMALIZED
;

1289 
	`´štf
("\tBase_cost_type: ");

1291 ià(
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 =ğ
INTRINSIC_DELAY
) {

1292 
	`´štf
("intrinsic Tdel.\n");

1293 } ià(
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 =ğ
DELAY_NORMALIZED
) {

1294 
	`´štf
("Tdel‚ormalized.\n");

1295 } ià(
rou‹r_İts
->
rou‹r_ba£_co¡_ty³
 =ğ
DEMAND_ONLY
) {

1296 
	`´štf
("demand only.\n");

1299 ià(
rou‹r_İts
->
rou‹r_®gÜ™hm
 =ğ
TIMING_DRIVEN
) {

1300 
	`´štf
("\tSearch‡ggressiveness factor (astar_fac): %g\n",

1301 
rou‹r_İts
->
a¡¬_çc
);

1302 
	`´štf
("\tMaximum sink criticality (max_criticality): %g\n",

1303 
rou‹r_İts
->
max_ü™iÿl™y
);

1304 
	`´štf
("\tExponent for criticality computation (criticality_exp): "

1305 "%g\n", 
rou‹r_İts
->
ü™iÿl™y_exp
);

1308 ià(
rou‹r_İts
->
fixed_chªÃl_width
 =ğ
NO_FIXED_CHANNEL_WIDTH
) {

1309 
	`´štf
("\tRouter will findhe minimum‚umber ofracks "

1312 
	`´štf
("\tRouter will‡ttempt„outing only with‡ channel width"

1313 " faùÜ oà%d.\n", 
rou‹r_İts
->
fixed_chªÃl_width
);

1316 ià(*
v”ify_bš¬y_£¬ch
) {

1320 
	`´štf
("\tRouter will verifyhat binary search yields min. "

1325 ià(*
İ”©iÚ
 =ğ
TIMING_ANALYSIS_ONLY
) {

1326 
	`´štf
("\tNet Tdel value foriming‡nalysis: %g (s)\n",

1327 *
cÚ¡ªt_Ãt_d–ay
);

1330 
	`´štf
("\n");

1331 
	}
}

1334 
	$g‘_šput
(* 
Ãi¡_fe
,

1335 * 
¬ch_fe
,

1336 
¶aû_co¡_ty³
,

1337 
num_»giÚs
,

1338 
a¥eù_¿tio
,

1339 
boŞ—n
 
u£r_sized
,

1340 
rou‹r_ty³s_t
 
rou‹_ty³
,

1341 
d‘a_routšg_¬ch_t
 *
d‘_routšg_¬ch
,

1342 
£gm’t_šfo_t
** 
£gm’t_šf_±r
,

1343 
timšg_šfo_t
* 
timšg_šf_±r
,

1344 
subblock_d©a_t
* 
subblock_d©a_±r
,

1345 
chª_width_di¡r_t
* 
chª_width_di¡_±r
)

1350 
	`´štf
("Readinghe FPGA‡rchitectural description from %s.\n",

1351 
¬ch_fe
);

1353 
	`»ad_¬ch
(
¬ch_fe
,

1354 
rou‹_ty³
,

1355 
d‘_routšg_¬ch
,

1356 
£gm’t_šf_±r
,

1357 
timšg_šf_±r
,

1358 
subblock_d©a_±r
,

1359 
chª_width_di¡_±r
);

1361 
	`´štf
("SucûssfuÎy„—d %s.\n", 
¬ch_fe
);

1362 
	`´štf
("Pins…er clb: %d. Pads…er„ow/column: %d.\n",

1363 
max_pšs_³r_şb
, 
io_¿tio
);

1364 
	`´štf
("Subblocks…er clb: %d. Subblock LUT size: %d.\n",

1365 
subblock_d©a_±r
->
max_subblocks_³r_block
,

1366 
subblock_d©a_±r
->
subblock_lut_size
);

1368 ià(
rou‹_ty³
 =ğ
DETAILED
) {

1369 ià(
d‘_routšg_¬ch
->
Fc_ty³
 =ğ
ABSOLUTE
) {

1370 
	`´štf
("Fc value is‡bsolute‚umber ofracks.\n");

1372 
	`´štf
("Fc value is fraction ofracks in‡ channel.\n");

1375 
	`´štf
("Fc_output: %g. Fc_input: %g. Fc_pad: %g.\n",

1376 
d‘_routšg_¬ch
->
Fc_ouut
,

1377 
d‘_routšg_¬ch
->
Fc_šput
,

1378 
d‘_routšg_¬ch
->
Fc_·d
);

1380 ià(
d‘_routšg_¬ch
->
sw™ch_block_ty³
 =ğ
SUBSET
) {

1381 
	`´štf
("Switch blocksype: Subset.\n");

1382 } ià(
d‘_routšg_¬ch
->
sw™ch_block_ty³
 =ğ
WILTON
) {

1383 
	`´štf
("Switch_block_type: WILTON.\n");

1385 
	`´štf
("Switch_block_type: UNIVERSAL.\n");

1388 
	`´štf
("Distinctypes of segments: %d.\n",

1389 
d‘_routšg_¬ch
->
num_£gm’t
);

1390 
	`´štf
("Distinctypes of user-specified switches: %d.\n",

1391 
d‘_routšg_¬ch
->
num_sw™ch
 - 2);

1394 
	`´štf
("\n");

1395 
	`´štf
("R—dšghcœcu™‚‘li¡ from %s.\n", 
Ãi¡_fe
);

1397 
	`»ad_Ãi¡
(
Ãi¡_fe
, 
subblock_d©a_±r
);

1399 
	`´štf
("SucûssfuÎy„—d %s.\n", 
Ãi¡_fe
);

1400 
	`´štf
("%d blocks, %d‚‘s, %d glob®‚‘s.\n", 
num_blocks
, 
num_Ãts
,

1401 
num_glob®s
);

1402 
	`´štf
("%d clbs, %d iÅuts, %d ouuts.\n", 
num_şbs
, 
num_´im¬y_šputs
,

1403 
num_´im¬y_ouuts
);

1407 
	`š™_¬ch
(
a¥eù_¿tio
,

1408 
u£r_sized
);

1409 
	`´štf
("The circuit will be mapped into‡ %d x %d‡rray of clbs.\n\n",

1410 
num_grid_cŞumns
, 
num_grid_rows
);

1412 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
 && (
num_»giÚs
 > 
num_grid_cŞumns
 ||

1413 
num_»giÚs
 > 
num_grid_rows
)) {

1414 
	`´štf
("Error: Cannot use more„egionshan clbs in…lacement cost "

1416 
	`ex™
(1);

1418 
	}
}

1420 
	$»ad_št_İtiÚ
(
¬gc
, * 
¬gv
[], 
Ÿrg
)

1425 
v®ue
, 
num_»ad
;

1426 
num_»ad
 = 0;

1429 ià(
¬gc
 > 
Ÿrg
 + 1) {

1430 
num_»ad
 = 
	`ssÿnf
(
¬gv
[
Ÿrg
 + 1], "%d", &
v®ue
);

1434 ià(
num_»ad
 != 1) {

1435 
	`´štf
("E¼Ü: % İtiÚ„equœe ª iÁeg”…¬am‘”.\n\n", 
¬gv
[
Ÿrg
]);

1436 
	`ex™
(1);

1439  (
v®ue
);

1440 
	}
}

1443 
	$»ad_doubË_İtiÚ
(
¬gc
, * 
¬gv
[], 
Ÿrg
)

1447 
num_»ad
 = 0;

1448 
v®ue
 = 0.0;

1450 ià(
¬gc
 > 
Ÿrg
 + 1) {

1451 
num_»ad
 = 
	`ssÿnf
(
¬gv
[
Ÿrg
 + 1], "%f", &
v®ue
);

1455 ià(
num_»ad
 != 1) {

1456 
	`´štf
("E¼Ü: % İtiÚ„equœe ¨doubË…¬am‘”.\n\n", 
¬gv
[
Ÿrg
]);

1457 
	`ex™
(1);

1460  (
v®ue
);

1461 
	}
}

	@net_delay.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"Ãt_d–ay.h
"

10 
	ss_lšked_rc_edge
 {

11 
s_rc_node
* 
	mchd
;

12 
	misw™ch
;

14 
s_lšked_rc_edge
* 
	mÃxt
;

17 
s_lšked_rc_edge
 
	tt_lšked_rc_edge
;

27 
	ss_rc_node
 {

29 
t_lšked_rc_edge
* 
	mchd_li¡
;

30 
s_rc_node


31 *
	mÃxt
;

32 } 
	mu
;

33 
	mivex
;

34 
	mC_down¡»am
;

35 
	mTd–
;

38 
s_rc_node
 
	tt_rc_node
;

53 
	ss_lšked_rc_±r
 {

54 
s_rc_node
* 
	mrc_node
;

55 
s_lšked_rc_±r


56 *
	mÃxt
;

59 
s_lšked_rc_±r
 
	tt_lšked_rc_±r
;

69 
t_rc_node
* 
®loc_ªd_lßd_rc_Œ“
(
š‘
,

70 
t_rc_node
** 
rc_node_ä“_li¡_±r
,

71 
t_lšked_rc_edge
** 
rc_edge_ä“_li¡_±r
,

72 
t_lšked_rc_±r
* 
¼_node_to_rc_node
);

74 
add_to_rc_Œ“
(
t_rc_node
* 
·»Á_rc
,

75 
t_rc_node
* 
chd_rc
,

76 
isw™ch
,

77 
ivex
,

78 
t_lšked_rc_edge
** 
rc_edge_ä“_li¡_±r
);

80 
t_rc_node
* 
®loc_rc_node
Ñ_rc_node** 
rc_node_ä“_li¡_±r
);

82 
ä“_rc_node
(
t_rc_node
* 
rc_node
,

83 
t_rc_node
** 
rc_node_ä“_li¡_±r
);

85 
t_lšked_rc_edge
* 
®loc_lšked_rc_edge
Ñ_lšked_rc_edge** 
rc_edge_ä“_li¡_±r
);

87 
ä“_lšked_rc_edge
(
t_lšked_rc_edge
* 
rc_edge
,

88 
t_lšked_rc_edge
** 
rc_edge_ä“_li¡_±r
);

90 
lßd_rc_Œ“_C
(
t_rc_node
* 
rc_node
);

92 
lßd_rc_Œ“_T
(
t_rc_node
* 
rc_node
,

93 
T_¬riv®
);

95 
lßd_Úe_Ãt_d–ay
(** 
Ãt_d–ay
,

96 
š‘
,

97 
t_lšked_rc_±r
* 
¼_node_to_rc_node
);

99 
lßd_Úe_cÚ¡ªt_Ãt_d–ay
(** 
Ãt_d–ay
,

100 
š‘
,

101 
d–ay_v®ue
);

103 
ä“_rc_Œ“
(
t_rc_node
* 
rc_roÙ
,

104 
t_rc_node
** 
rc_node_ä“_li¡_±r
,

105 
t_lšked_rc_edge
** 
rc_edge_ä“_li¡_±r
);

107 
»£¼_node_t_to_rc_node
(
t_lšked_rc_±r
* 
¼_node_to_rc_node
,

108 
š‘
);

110 
ä“_rc_node_ä“_li¡
(
t_rc_node
* 
rc_node_ä“_li¡
);

112 
ä“_rc_edge_ä“_li¡
(
t_lšked_rc_edge
* 
rc_edge_ä“_li¡
);

118 ** 
	$®loc_Ãt_d–ay
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
)

123 
chunk_by‹s_ava
 = 0;

124 * 
chunk_Ãxt_ava_mem
 = 
NULL
;

125 *
chunk_li¡_h—d_±r
 = 
NULL
;

127 ** 
Ãt_d–ay
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

129 
š‘
 = -1;

130 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

131 * 
tmp_±r
 = (*)
	`my_chunk_m®loc
((
Ãt
[
š‘
].
num_Ãt_pšs
-1)

133 
chunk_li¡_h—d_±r
,

134 &
chunk_by‹s_ava
,

135 &
chunk_Ãxt_ava_mem
);

136 
Ãt_d–ay
[
š‘
] = 
tmp_±r
 - 1;

139  
Ãt_d–ay
;

140 
	}
}

142 
	$ä“_Ãt_d–ay
(** 
Ãt_d–ay
,

143 
lšked_v±r_t
** 
chunk_li¡_h—d_±r
)

146 
	`ä“
(
Ãt_d–ay
);

147 
	`ä“_chunk_memÜy
(*
chunk_li¡_h—d_±r
);

148 *
chunk_li¡_h—d_±r
 = 
NULL
;

149 
	}
}

151 
	$lßd_Ãt_d–ay_äom_routšg
(** 
Ãt_d–ay
)

158 
t_rc_node
* 
rc_node_ä“_li¡
, *
rc_roÙ
;

159 
t_lšked_rc_edge
* 
rc_edge_ä“_li¡
;

160 
š‘
;

161 
t_lšked_rc_±r
* 
¼_node_to_rc_node
;

162 
¼_node_to_rc_node
 = (
t_lšked_rc_±r
*è
	`my_ÿÎoc
(
num_¼_nodes
,

163 (
t_lšked_rc_±r
));

164 
rc_node_ä“_li¡
 = 
NULL
;

165 
rc_edge_ä“_li¡
 = 
NULL
;

167 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

168 ià(
is_glob®
[
š‘
]) {

169 
	`lßd_Úe_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
, 
š‘
, 0.);

171 
rc_roÙ
 = 
	`®loc_ªd_lßd_rc_Œ“
(
š‘
, &
rc_node_ä“_li¡
,

172 &
rc_edge_ä“_li¡
, 
¼_node_to_rc_node
);

173 
	`lßd_rc_Œ“_C
(
rc_roÙ
);

174 
	`lßd_rc_Œ“_T
(
rc_roÙ
, 0.);

175 
	`lßd_Úe_Ãt_d–ay
(
Ãt_d–ay
, 
š‘
, 
¼_node_to_rc_node
);

176 
	`ä“_rc_Œ“
(
rc_roÙ
, &
rc_node_ä“_li¡
, &
rc_edge_ä“_li¡
);

177 
	`»£¼_node_t_to_rc_node
(
¼_node_to_rc_node
, 
š‘
);

181 
	`ä“_rc_node_ä“_li¡
(
rc_node_ä“_li¡
);

182 
	`ä“_rc_edge_ä“_li¡
(
rc_edge_ä“_li¡
);

183 
	`ä“
(
¼_node_to_rc_node
);

184 
	}
}

191 
	$lßd_cÚ¡ªt_Ãt_d–ay
(** 
Ãt_d–ay
,

192 
d–ay_v®ue
)

196 
š‘
;

197 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

198 ià(
is_glob®
[
š‘
]) {

199 
	`lßd_Úe_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
,

200 
š‘
,

203 
	`lßd_Úe_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
,

204 
š‘
,

205 
d–ay_v®ue
);

208 
	}
}

211 
t_rc_node
* 
	$®loc_ªd_lßd_rc_Œ“
(
š‘
, 
t_rc_node
** 
rc_node_ä“_li¡_±r
,

212 
t_lšked_rc_edge
** 
rc_edge_ä“_li¡_±r
,

213 
t_lšked_rc_±r
* 
¼_node_to_rc_node
)

217 
t_rc_node
* 
cu¼_rc
, *
´ev_rc
;

218 
t_lšked_rc_±r
* 
lšked_rc_±r
;

219 
t_rc_node
* 
roÙ_rc
 = 
	`®loc_rc_node
(
rc_node_ä“_li¡_±r
);

221 
s_Œaû
* 
Œ
 = 
Œaû_h—d
[
š‘
];

222 ià(
Œ
 =ğ
NULL
) {

223 
	`´štf
("Error in‡lloc_and_load_rc_tree: Traceback for‚et %d doesn't "

224 "exi¡.\n", 
š‘
);

225 
	`ex™
(1);

228 
ivex
 = 
Œ
->
šdex
;

229 
isw™ch
 = 
Œ
->iswitch;

230 
roÙ_rc
->
ivex
 = ivex;

231 
roÙ_rc
->
u
.
chd_li¡
 = 
NULL
;

232 
¼_node_to_rc_node
[
ivex
].
rc_node
 = 
roÙ_rc
;

233 
´ev_rc
 = 
roÙ_rc
;

234 
Œ
 =±r->
Ãxt
;

236 
Œ
 !ğ
NULL
) {

237 
ivex
 = 
Œ
->
šdex
;

242 ià(
¼_node_to_rc_node
[
ivex
].
rc_node
 =ğ
NULL
) {

243 
cu¼_rc
 = 
	`®loc_rc_node
(
rc_node_ä“_li¡_±r
);

244 
	`add_to_rc_Œ“
(
´ev_rc
, 
cu¼_rc
, 
isw™ch
, 
ivex
,

245 
rc_edge_ä“_li¡_±r
);

246 
¼_node_to_rc_node
[
ivex
].
rc_node
 = 
cu¼_rc
;

247 
´ev_rc
 = 
cu¼_rc
;

248 } ià(
¼_node
[
ivex
].
ty³
 !ğ
SINK
) {

249 #ifdeà
DEBUG


250 
´ev_node
 = 
´ev_rc
->
ivex
;

251 ià(
¼_node
[
´ev_node
].
ty³
 !ğ
SINK
) {

252 
	`´štf
("Error in‡lloc_and_load_rc_tree: Routing of‚et %d is "

253 "nÙ‡»e.\n", 
š‘
);

254 
	`ex™
(1);

258 
´ev_rc
 = 
¼_node_to_rc_node
[
ivex
].
rc_node
;

266 
cu¼_rc
 = 
	`®loc_rc_node
(
rc_node_ä“_li¡_±r
);

267 
	`add_to_rc_Œ“
(
´ev_rc
, 
cu¼_rc
, 
isw™ch
, 
ivex
,

268 
rc_edge_ä“_li¡_±r
);

269 
lšked_rc_±r
 = (
t_lšked_rc_±r
*è
	`my_m®loc
((t_linked_rc_ptr));

270 
lšked_rc_±r
->
Ãxt
 = 
¼_node_to_rc_node
[
ivex
].next;

271 
¼_node_to_rc_node
[
ivex
].
Ãxt
 = 
lšked_rc_±r
;

272 
lšked_rc_±r
->
rc_node
 = 
cu¼_rc
;

273 
´ev_rc
 = 
cu¼_rc
;

276 
isw™ch
 = 
Œ
->iswitch;

277 
Œ
 =±r->
Ãxt
;

280  (
roÙ_rc
);

281 
	}
}

284 
	$add_to_rc_Œ“
(
t_rc_node
* 
·»Á_rc
,_rc_node* 
chd_rc
, 

285 
isw™ch
, 
ivex
, 
t_lšked_rc_edge
** 
rc_edge_ä“_li¡_±r
)

290 
t_lšked_rc_edge
* 
lšked_rc_edge
;

291 
lšked_rc_edge
 = 
	`®loc_lšked_rc_edge
(
rc_edge_ä“_li¡_±r
);

292 
lšked_rc_edge
->
Ãxt
 = 
·»Á_rc
->
u
.
chd_li¡
;

293 
·»Á_rc
->
u
.
chd_li¡
 = 
lšked_rc_edge
;

294 
lšked_rc_edge
->
chd
 = 
chd_rc
;

295 
lšked_rc_edge
->
isw™ch
 = iswitch;

296 
chd_rc
->
u
.
chd_li¡
 = 
NULL
;

297 
chd_rc
->
ivex
 = ivex;

298 
	}
}

301 
t_rc_node
* 
	$®loc_rc_node
(
t_rc_node
** 
rc_node_ä“_li¡_±r
)

305 
t_rc_node
* 
rc_node
;

306 
rc_node
 = *
rc_node_ä“_li¡_±r
;

308 ià(
rc_node
 !ğ
NULL
) {

309 *
rc_node_ä“_li¡_±r
 = 
rc_node
->
u
.
Ãxt
;

311 
rc_node
 = (
t_rc_node
*è
	`my_m®loc
((t_rc_node));

314  (
rc_node
);

315 
	}
}

318 
	$ä“_rc_node
(
t_rc_node
* 
rc_node
,_rc_node

319 ** 
rc_node_ä“_li¡_±r
)

322 
rc_node
->
u
.
Ãxt
 = *
rc_node_ä“_li¡_±r
;

323 *
rc_node_ä“_li¡_±r
 = 
rc_node
;

324 
	}
}

327 
t_lšked_rc_edge
* 
	$®loc_lšked_rc_edge
(
t_lšked_rc_edge


328 ** 
rc_edge_ä“_li¡_±r
)

332 
t_lšked_rc_edge
* 
lšked_rc_edge
;

333 
lšked_rc_edge
 = *
rc_edge_ä“_li¡_±r
;

335 ià(
lšked_rc_edge
 !ğ
NULL
) {

336 *
rc_edge_ä“_li¡_±r
 = 
lšked_rc_edge
->
Ãxt
;

338 
lšked_rc_edge
 = (
t_lšked_rc_edge
*è
	`my_m®loc
(

339 (
t_lšked_rc_edge
));

342  (
lšked_rc_edge
);

343 
	}
}

346 
	$ä“_lšked_rc_edge
(
t_lšked_rc_edge
* 
rc_edge
,_linked_rc_edge

347 ** 
rc_edge_ä“_li¡_±r
)

350 
rc_edge
->
Ãxt
 = *
rc_edge_ä“_li¡_±r
;

351 *
rc_edge_ä“_li¡_±r
 = 
rc_edge
;

352 
	}
}

355 
	$lßd_rc_Œ“_C
(
t_rc_node
* 
rc_node
)

360 
t_lšked_rc_edge
* 
lšked_rc_edge
;

361 
t_rc_node
* 
chd_node
;

362 
ivex
;

363 
isw™ch
;

364 
C
, 
C_down¡»am
;

365 
lšked_rc_edge
 = 
rc_node
->
u
.
chd_li¡
;

366 
ivex
 = 
rc_node
->ivex;

367 
C
 = 
¼_node
[
ivex
].C;

369 
lšked_rc_edge
 !ğ
NULL
) {

370 
isw™ch
 = 
lšked_rc_edge
->iswitch;

371 
chd_node
 = 
lšked_rc_edge
->
chd
;

372 
C_down¡»am
 = 
	`lßd_rc_Œ“_C
(
chd_node
);

374 ià(
sw™ch_šf
[
isw™ch
].
bufã»d
 =ğ
FALSE
) {

375 
C
 +ğ
C_down¡»am
;

378 
lšked_rc_edge
 =†šked_rc_edge->
Ãxt
;

381 
rc_node
->
C_down¡»am
 = 
C
;

382  (
C
);

383 
	}
}

386 
	$lßd_rc_Œ“_T
(
t_rc_node
* 
rc_node
, 
T_¬riv®
)

392 
Td–
, 
Rm‘®
, 
Tchd
;

393 
t_lšked_rc_edge
* 
lšked_rc_edge
;

394 
t_rc_node
* 
chd_node
;

395 
isw™ch
;

396 
ivex
;

397 
Td–
 = 
T_¬riv®
;

398 
ivex
 = 
rc_node
->ivex;

399 
Rm‘®
 = 
¼_node
[
ivex
].
R
;

411 
Td–
 +ğ0.5 * 
rc_node
->
C_down¡»am
 * 
Rm‘®
;

412 
rc_node
->
Td–
 = Tdel;

414 
lšked_rc_edge
 = 
rc_node
->
u
.
chd_li¡
;

416 
lšked_rc_edge
 !ğ
NULL
) {

417 
isw™ch
 = 
lšked_rc_edge
->iswitch;

418 
chd_node
 = 
lšked_rc_edge
->
chd
;

419 
Tchd
 = 
Td–
 + 
sw™ch_šf
[
isw™ch
].
R
 * 
chd_node
->
C_down¡»am
;

420 
Tchd
 +ğ
sw™ch_šf
[
isw™ch
].
Td–
;

421 
	`lßd_rc_Œ“_T
(
chd_node
, 
Tchd
);

422 
lšked_rc_edge
 =†šked_rc_edge->
Ãxt
;

424 
	}
}

427 
	$lßd_Úe_Ãt_d–ay
(** 
Ãt_d–ay
, 
š‘
, 
t_lšked_rc_±r


428 *
¼_node_to_rc_node
)

432 
š
, 
ivex
;

433 
Tmax
;

434 
t_rc_node
* 
rc_node
;

435 
t_lšked_rc_±r
* 
lšked_rc_±r
, *
Ãxt_±r
;

437 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

438 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

439 
ivex
 = 
Ãt_¼_‹rmš®s
[
š‘
][
š
];

440 
lšked_rc_±r
 = 
¼_node_to_rc_node
[
ivex
].
Ãxt
;

441 
rc_node
 = 
¼_node_to_rc_node
[
ivex
].rc_node;

442 
Tmax
 = 
rc_node
->
Td–
;

453 ià(
lšked_rc_±r
 !ğ
NULL
) {

458 
rc_node
 = 
lšked_rc_±r
->rc_node;

460 ià(
rc_node
->
Td–
 > 
Tmax
) {

461 
Tmax
 = 
rc_node
->
Td–
;

462 
¼_node_to_rc_node
[
ivex
].
rc_node
 =„c_node;

465 
Ãxt_±r
 = 
lšked_rc_±r
->
Ãxt
;

466 
	`ä“
(
lšked_rc_±r
);

467 
lšked_rc_±r
 = 
Ãxt_±r
;

468 } 
lšked_rc_±r
 !ğ
NULL
);

470 
¼_node_to_rc_node
[
ivex
].
Ãxt
 = 
NULL
;

473 
Ãt_d–ay
[
š‘
][
š
] = 
Tmax
;

475 
	}
}

478 
	$lßd_Úe_cÚ¡ªt_Ãt_d–ay
(** 
Ãt_d–ay
, 
š‘
, 

479 
d–ay_v®ue
)

484 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

485 
š
;

486 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

487 
Ãt_d–ay
[
š‘
][
š
] = 
d–ay_v®ue
;

489 
	}
}

492 
	$ä“_rc_Œ“
(
t_rc_node
* 
rc_roÙ
,_rc_node** 
rc_node_ä“_li¡_±r
,

493 
t_lšked_rc_edge
** 
rc_edge_ä“_li¡_±r
)

497 
t_rc_node
* 
rc_node
, *
chd_node
;

498 
t_lšked_rc_edge
* 
rc_edge
, *
Ãxt_edge
;

499 
rc_node
 = 
rc_roÙ
;

500 
rc_edge
 = 
rc_node
->
u
.
chd_li¡
;

502 
rc_edge
 !ğ
NULL
) {

503 
chd_node
 = 
rc_edge
->
chd
;

504 
	`ä“_rc_Œ“
(
chd_node
, 
rc_node_ä“_li¡_±r
, 
rc_edge_ä“_li¡_±r
);

505 
Ãxt_edge
 = 
rc_edge
->
Ãxt
;

506 
	`ä“_lšked_rc_edge
(
rc_edge
, 
rc_edge_ä“_li¡_±r
);

507 
rc_edge
 = 
Ãxt_edge
;

510 
	`ä“_rc_node
(
rc_node
, 
rc_node_ä“_li¡_±r
);

511 
	}
}

514 
	$»£¼_node_t_to_rc_node
(
t_lšked_rc_±r
* 
¼_node_to_rc_node
, 

515 
š‘
)

521 
s_Œaû
* 
Œ
;

522 
ivex
;

523 
Œ
 = 
Œaû_h—d
[
š‘
];

525 
Œ
 !ğ
NULL
) {

526 
ivex
 = 
Œ
->
šdex
;

527 
¼_node_to_rc_node
[
ivex
].
rc_node
 = 
NULL
;

528 
Œ
 =±r->
Ãxt
;

530 
	}
}

533 
	$ä“_rc_node_ä“_li¡
(
t_rc_node
* 
rc_node_ä“_li¡
)

536 
t_rc_node
* 
rc_node
, *
Ãxt_node
;

537 
rc_node
 = 
rc_node_ä“_li¡
;

539 
rc_node
 !ğ
NULL
) {

540 
Ãxt_node
 = 
rc_node
->
u
.
Ãxt
;

541 
	`ä“
(
rc_node
);

542 
rc_node
 = 
Ãxt_node
;

544 
	}
}

546 
	$ä“_rc_edge_ä“_li¡
(
t_lšked_rc_edge
* 
rc_edge_ä“_li¡
)

549 
t_lšked_rc_edge
* 
rc_edge
, *
Ãxt_edge
;

550 
rc_edge
 = 
rc_edge_ä“_li¡
;

552 
rc_edge
 !ğ
NULL
) {

553 
Ãxt_edge
 = 
rc_edge
->
Ãxt
;

554 
	`ä“
(
rc_edge
);

555 
rc_edge
 = 
Ãxt_edge
;

557 
	}
}

560 
	$´št_Ãt_d–ay
(** 
Ãt_d–ay
, * 
âame
)

563 
FILE
* 
å
 = 
	`my_fİ’
(
âame
, "w");

565 
š‘
, 
š
;

566 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

567 
	`årštf
(
å
, "N‘: %d.\n", 
š‘
);

568 
	`årštf
(
å
, "Delays:");

570 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

571 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

572 
	`årštf
(
å
, " %g", 
Ãt_d–ay
[
š‘
][
š
]);

575 
	`årštf
(
å
, "\n\n");

578 
	`fşo£
(
å
);

579 
	}
}

	@net_delay.h

1 #iâdeà
NET_DELAY_H


2 
	#NET_DELAY_H


	)

4 
	~"ut.h
"

6 ** 
®loc_Ãt_d–ay
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
);

8 
ä“_Ãt_d–ay
(** 
Ãt_d–ay
, 
lšked_v±r_t


9 ** 
chunk_li¡_h—d_±r
);

11 
lßd_Ãt_d–ay_äom_routšg
(** 
Ãt_d–ay
);

13 
lßd_cÚ¡ªt_Ãt_d–ay
(** 
Ãt_d–ay
, 
d–ay_v®ue
);

15 
´št_Ãt_d–ay
(** 
Ãt_d–ay
, * 
âame
);

	@path_delay.c

1 
	~<¡dio.h
>

2 
	~<as£¹.h
>

4 
	~"ut.h
"

5 
	~"v´_ty³s.h
"

6 
	~"v´_uts.h
"

7 
	~"glob®s.h
"

8 
	~"·th_d–ay.h
"

9 
	~"·th_d–ay2.h
"

10 
	~"Ãt_d–ay.h
"

11 
	~"¶aû.h
"

12 
	~"¡ršg.h
"

14 
	#T_CONSTANT_GENERATOR
 -1000

	)

80 
ground_num
;

81 
lšked_v±r_t
* 
	g‹dge_ch_li¡_h—d
 = 
NULL
;

82 
	g‹dge_ch_by‹s_ava
 = 0;

83 * 
	g‹dge_ch_Ãxt_ava
 = 
NULL
;

86 
®loc_ªd_lßd_pš_m­pšgs
(** *
block_pš_to_Šode_±r
,

87 **** 
sblk_pš_to_Šode_±r
,

88 
subblock_d©a_t
 
subblock_d©a
,

89 ** 
num_u£s_of_sblk_İš
);

91 
ä“_pš_m­pšgs
(** 
block_pš_to_Šode
,

92 *** 
sblk_pš_to_Šode
,

93 * 
num_subblocks_³r_block
);

95 
®loc_ªd_lßd_çnout_couÁs
(** *
num_u£s_of_şb_š_±r
,

96 ** *
num_u£s_of_sblk_İš_±r
,

97 
subblock_d©a_t
 
subblock_d©a
);

99 
ä“_çnout_couÁs
(** 
num_u£s_of_şb_š
,

100 ** 
num_u£s_of_sblk_İš
);

103 
»£t_®l_Šodes_äÚt_behšd_ü™_·th
();

106 
assign_äÚt_ü™_·th_through_pš_to_´im¬y_šputs
();

109 
ÿlc_®l_Šodes_äÚt_ü™_·th_through_pš
(cÚ¡ 
ü™_d–ay
);

112 
assign_behšd_ü™_·th_through_pš_to_´im¬y_ouuts
();

115 
ÿlc_®l_Šodes_behšd_ü™_·th_through_pš
(cÚ¡ 
ü™_d–ay
);

118 
ÿlc_subÃt_loÿl_ü™_weight
(** 
Ãt_¦ack
,

119 cÚ¡ 
ü™_d–ay
,

120 ** 
block_pš_to_Šode
);

122 
compu‹_discouÁ_v®ue
(cÚ¡ 
ground_num
,

123 cÚ¡ 
x
,

124 cÚ¡ 
y
);

127 
®loc_ªd_lßd_Šodes_ªd_Ãt_m­pšg
(** 
num_u£s_of_şb_š
,

128 ** 
num_u£s_of_sblk_İš
,

129 ** 
block_pš_to_Šode
,

130 *** 
sblk_pš_to_Šode
,

131 
subblock_d©a_t
 
subblock_d©a
,

132 
timšg_šfo_t
 
timšg_šf
);

134 
bud_şb_Šodes
(
iblk
,

135 * 
n_u£s_of_şb_š
,

136 ** 
block_pš_to_Šode
,

137 ** 
sub_pš_to_Šode
,

138 
subblock_lut_size
,

139 
subblks_š_block
,

140 
subblock_t
* 
sub_šf
,

141 
T_şb_š_to_sblk_š
,

142 * 
Ãxt_şb_š_edge
);

144 
bud_subblock_Šodes
(* 
n_u£s_of_sblk_İš
,

145 * 
blk_pš_to_Šode
,

146 ** 
sub_pš_to_Šode
,

147 
subblock_lut_size
,

148 
subblks_š_block
,

149 
subblock_t
* 
sub_šf
,

150 
T_sblk_İš_to_sblk_š
,

151 
T_sblk_İš_to_şb_İš
,

152 
T_subblock_t
* 
T_subblock
,

153 * 
Ãxt_sblk_İš_edge
,

154 
iblk
);

156 
bud_ad_Šodes
(
iblk
,

157 ** 
block_pš_to_Šode
,

158 
T_ad
,

159 * 
num_subblocks_³r_block
,

160 
subblock_t
** 
subblock_šf
);

162 
boŞ—n
 
is_glob®_şock
(
iblk
,

163 * 
num_subblocks_³r_block
,

164 
subblock_t
** 
subblock_šf
);

166 
bud_İad_Šodes
(* 
blk_pš_to_Šode
,

167 
T_İad
, 
iblk
);

169 
bud_block_ouut_Šode
(
ivex
,

170 
iblk
,

171 
š
,

172 ** 
block_pš_to_Šode
);

176 
	$ä“_subblock_d©a
(
subblock_d©a_t
* 
subblock_d©a_±r
)

179 
	`ä“_chunk_memÜy
(
subblock_d©a_±r
->
chunk_h—d_±r
);

180 
	`ä“
(
subblock_d©a_±r
->
num_subblocks_³r_block
);

181 
	`ä“
(
subblock_d©a_±r
->
subblock_šf
);

183 
subblock_d©a_±r
->
num_subblocks_³r_block
 = 
NULL
;

184 
subblock_d©a_±r
->
subblock_šf
 = 
NULL
;

185 
subblock_d©a_±r
->
chunk_h—d_±r
 = 
NULL
;

186 
	}
}

194 
	$®loc_ªd_lßd_timšg_g¿ph
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

195 
timšg_šfo_t
 
timšg_šf
,

196 
subblock_d©a_t
 
subblock_d©a
)

198 ià(
‹dge_ch_li¡_h—d
 !ğ
NULL
) {

199 
	`´štf
("Error in‡lloc_and_load_timing_graph:\n"

201 
	`ex™
(1);

206 ià(
subblock_d©a
.
max_subblocks_³r_block
 > 
MAX_SHORT
) {

207 
	`´štf
("Error in‡lloc_and_load_timing_graph: max_subblocks_per_block"

209 
subblock_d©a
.
max_subblocks_³r_block
);

210 
	`ex™
(1);

212 ià(
max_pšs_³r_şb
 > 
MAX_SHORT
) {

213 
	`´štf
("Error in‡lloc_and_load_timing_graph: max_pins_per_clb is %d."

214 "\tWÈÿu£ shÜˆov”æow iÀŠode_desüt.\n", 
max_pšs_³r_şb
);

215 
	`ex™
(1);

220 ** 
num_u£s_of_şb_š
 = 
NULL
;

222 ** 
num_u£s_of_sblk_İš
 = 
NULL
;

226 
	`®loc_ªd_lßd_çnout_couÁs
(&
num_u£s_of_şb_š
,

227 &
num_u£s_of_sblk_İš
,

228 
subblock_d©a
);

233 
num_of_v”‹xs
 = 
	`®loc_ªd_lßd_pš_m­pšgs
(&
block_pš_to_Šode
,

234 &
sblk_pš_to_Šode
,

235 
subblock_d©a
,

236 
num_u£s_of_sblk_İš
);

237 
	`´štf
("Now check block_pin_to_tnode[%d][%d]...\n",

238 
num_blocks
,

239 
max_pšs_³r_şb
);

240 
	`check_block_pš_to_Šode
(
block_pš_to_Šode
);

243 ià(
¶aûr_İts_±r
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

244 
äÚt_ü™_·th_through_pš
 = (*)
	`my_m®loc
(
num_of_v”‹xs


246 
behšd_ü™_·th_through_pš
 = (*)
	`my_m®loc
(
num_of_v”‹xs


251 
	`®loc_ªd_lßd_Šodes_ªd_Ãt_m­pšg
(
num_u£s_of_şb_š
,

252 
num_u£s_of_sblk_İš
,

253 
block_pš_to_Šode
,

254 
sblk_pš_to_Šode
,

255 
subblock_d©a
,

256 
timšg_šf
);

259 
num_sšks
 = 
	`®loc_ªd_lßd_timšg_g¿ph_edge_Ëv–s
();

261 
	`check_timšg_g¿ph
(
subblock_d©a
.
num_cÚ¡_g’
,

262 
subblock_d©a
.
num_ff
,

263 
num_sšks
);

267 
	`ä“_çnout_couÁs
(
num_u£s_of_şb_š
,

268 
num_u£s_of_sblk_İš
);

270 
	`ä“_pš_m­pšgs
(
block_pš_to_Šode
,

271 
sblk_pš_to_Šode
,

272 
subblock_d©a
.
num_subblocks_³r_block
);

273 
	}
}

277 
	$»£t_®l_Šodes_äÚt_behšd_ü™_·th
()

279 
v
 = -1;

280 
v
 = 0; v < 
num_of_v”‹xs
; ++v) {

281 
äÚt_ü™_·th_through_pš
[
v
] = 
behšd_ü™_·th_through_pš
[v] = 0.0;

283 
	}
}

286 
	$assign_äÚt_ü™_·th_through_pš_to_´im¬y_šputs
()

288 cÚ¡ 
num_©_Ëv–_0
 = 
Šodes_©_Ëv–
[0].
ÃËm
;

289 
i
 = -1;

290 
i
 = 0; i < 
num_©_Ëv–_0
; ++i) {

291 cÚ¡ 
ivex
 = 
Šodes_©_Ëv–
[0].
li¡
[
i
];

292 
äÚt_ü™_·th_through_pš
[
ivex
] = 1.0;

294 
	}
}

300 
	$ÿlc_®l_Šodes_äÚt_ü™_·th_through_pš
(cÚ¡ 
ü™_d–ay
)

302 
ev–
 = -1;

303 
v
 = -1;

304 
›dge
 = -1;

305 
ev–
 = 0; iËv– < 
num_Šode_Ëv–s
; ++ilevel) {

306 cÚ¡ 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

307 
v
 = 0; v < 
num_©_Ëv–
; ++v) {

308 cÚ¡ 
äom_node
 = 
Šodes_©_Ëv–
[
ev–
].
li¡
[
v
];

309 cÚ¡ 
sourû_¬r_time
 = 
v”‹xes
[
äom_node
].
¬r_time
;

311 
edge_t
* 
cÚn_edges
 = 
v”‹xes
[
äom_node
].
out_edges
;

312 cÚ¡ 
num_cÚn_edges
 = 
v”‹xes
[
äom_node
].
num_out_edges
;

313 
›dge
 = 0; iedg< 
num_cÚn_edges
; ++iedge) {

314 cÚ¡ 
to_node
 = 
cÚn_edges
[
›dge
].to_node;

315 cÚ¡ 
sšk_¬r_time
 = 
v”‹xes
[
to_node
].
¬r_time
;

316 cÚ¡ 
d–ay
 = 
cÚn_edges
[
›dge
].
Td–
;

318 cÚ¡ 
fÜw¬d_loÿl_¦ack
 =

319 
sšk_¬r_time
 - 
sourû_¬r_time
 - 
d–ay
;

321 cÚ¡ 
discouÁ_v®ue
 =

322 
	`compu‹_discouÁ_v®ue
(
ground_num
,

323 
fÜw¬d_loÿl_¦ack
,

324 
ü™_d–ay
);

325 
äÚt_ü™_·th_through_pš
[
to_node
] +=

326 
discouÁ_v®ue
 * 
äÚt_ü™_·th_through_pš
[
äom_node
];

330 
	}
}

333 
	$assign_behšd_ü™_·th_through_pš_to_´im¬y_ouuts
()

335 cÚ¡ 
num_©_Ï¡_Ëv–
 = 
Šodes_©_Ëv–
[
num_Šode_Ëv–s
 - 1].
ÃËm
;

336 
i
 = -1;

337 
i
 = 0; i < 
num_©_Ï¡_Ëv–
; ++i) {

338 cÚ¡ 
ivex
 = 
Šodes_©_Ëv–
[
num_Šode_Ëv–s
-1].
li¡
[
i
];

339 
behšd_ü™_·th_through_pš
[
ivex
] = 1.0;

341 
	}
}

345 
	$ÿlc_®l_Šodes_behšd_ü™_·th_through_pš
(cÚ¡ 
ü™_d–ay
)

347 
ev–
 = -1;

348 
v
 = -1;

349 
›dge
 = -1;

350 
ev–
 = 
num_Šode_Ëv–s
 - 1; ilevel >= 0; --ilevel) {

351 cÚ¡ 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

352 
v
 = 0; v < 
num_©_Ëv–
; ++v) {

353 cÚ¡ 
äom_node
 = 
Šodes_©_Ëv–
[
ev–
].
li¡
[
v
];

354 cÚ¡ 
sourû_»q_time
 = 
v”‹xes
[
äom_node
].
»q_time
;

356 
edge_t
* 
cÚn_edges
 = 
v”‹xes
[
äom_node
].
out_edges
;

357 cÚ¡ 
num_cÚn_edges
 = 
v”‹xes
[
äom_node
].
num_out_edges
;

358 
›dge
 = 0; iedg< 
num_cÚn_edges
; ++iedge) {

359 cÚ¡ 
d–ay
 = 
cÚn_edges
[
›dge
].
Td–
;

360 cÚ¡ 
to_node
 = 
cÚn_edges
[
›dge
].to_node;

361 cÚ¡ 
sšk_»q_time
 = 
v”‹xes
[
to_node
].
»q_time
;

363 cÚ¡ 
backw¬d_loÿl_¦ack
 =

364 
sšk_»q_time
 - 
sourû_»q_time
 - 
d–ay
;

366 cÚ¡ 
discouÁ_v®ue
 =

367 
	`compu‹_discouÁ_v®ue
(
ground_num
,

368 
backw¬d_loÿl_¦ack
,

369 
ü™_d–ay
);

370 
behšd_ü™_·th_through_pš
[
äom_node
] +=

371 
discouÁ_v®ue
 * 
behšd_ü™_·th_through_pš
[
to_node
];

375 
	}
}

380 
	$ÿlc_subÃt_loÿl_ü™_weight
(** 
Ãt_¦ack
,

381 cÚ¡ 
ü™_d–ay
,

382 ** 
block_pš_to_Šode
)

384 
š‘
 = -1;

385 
sourû_v”‹x_idx
 = -1;

386 
sšk_v”‹x_idx
 = -1;

387 
discouÁ_v®ue
 = 0.0;

388 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

389 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

390 
sourû_v”‹x_idx
 = 
	`loÿ‹_sourû_v”‹x_šdex_by_Ãt_šdex
(
š‘
);

392 
š
 = 0;

393 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

394 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

395 
discouÁ_v®ue
 = 
	`compu‹_discouÁ_v®ue
(
ground_num
,

396 
Ãt_¦ack
[
š‘
][
š
],

397 
ü™_d–ay
);

398 
sšk_v”‹x_idx
 = 
	`fšd_sšk_v”‹x_šdex_by_Ãt_ªd_pš_šdex
(

399 
š‘
,

400 
š
,

401 
block_pš_to_Šode
);

402 
subÃt_loÿl_ü™_weight
[
š‘
][
š
] =

403 
äÚt_ü™_·th_through_pš
[
sourû_v”‹x_idx
]

404 * 
behšd_ü™_·th_through_pš
[
sšk_v”‹x_idx
]

405 * 
discouÁ_v®ue
;

409 
	}
}

411 
	$compu‹_discouÁ_v®ue
(cÚ¡ 
ground_num
,

412 cÚ¡ 
x
,

413 cÚ¡ 
y
)

415 
	`as£¹
(
ground_num
 > 0.0 && 
y
 != 0);

416  
	`pow
(
ground_num
, -
x
 / 
y
);

417 
	}
}

420 
	$compu‹_®l_Ãts_loÿl_ü™_weight
(** 
Ãt_¦ack
,

421 ** 
block_pš_to_Šode
,

422 cÚ¡ 
ü™iÿl_d–ay
)

424 
	`»£t_®l_Šodes_äÚt_behšd_ü™_·th
();

426 
	`assign_äÚt_ü™_·th_through_pš_to_´im¬y_šputs
();

427 
	`ÿlc_®l_Šodes_äÚt_ü™_·th_through_pš
(
ü™iÿl_d–ay
);

429 
	`assign_behšd_ü™_·th_through_pš_to_´im¬y_ouuts
();

430 
	`ÿlc_®l_Šodes_behšd_ü™_·th_through_pš
(
ü™iÿl_d–ay
);

432 
	`ÿlc_subÃt_loÿl_ü™_weight
(
Ãt_¦ack
,

433 
ü™iÿl_d–ay
,

434 
block_pš_to_Šode
);

435 
	}
}

437 
	$loÿ‹_sourû_v”‹x_šdex_by_Ãt_šdex
(cÚ¡ 
Ãt_šdex
)

439 
	`as£¹
(
driv”_node_šdex_of_Ãt
 !ğ
NULL
);

441  
driv”_node_šdex_of_Ãt
[
Ãt_šdex
];

442 
	}
}

444 
	$fšd_sšk_v”‹x_šdex_by_Ãt_ªd_pš_šdex
(cÚ¡ 
Ãt_šdex
,

445 cÚ¡ 
sšk_pš_šdex
,

446 ** 
block_pš_to_Šode
)

448 
	`as£¹
(
Ãt
 !ğ
NULL
 && 
block_pš_to_Šode
 !ğNULL && (
Ãt_šdex
 >= 0

449 && 
Ãt_šdex
 <ğ
num_Ãts
 - 1));

451 cÚ¡ 
block_šdex
 = 
Ãt
[
Ãt_šdex
].
node_blocks
[
sšk_pš_šdex
];

454 cÚ¡ 
block_pš_šdex
 = 
Ãt
[
Ãt_šdex
].
node_block_pšs
[
sšk_pš_šdex
];

457 
sšk_v”‹x_idx
 = 
block_pš_to_Šode
[
block_šdex
][
block_pš_šdex
];

459  
sšk_v”‹x_idx
;

460 
	}
}

462 
	$check_block_pš_to_Šode
(** 
block_pš_to_Šode
)

464 
FILE
* 
ouut_fe
 = 
	`fİ’
("check_block_pin_to_tnode.txt",

466 
mes§ge
[
BUFSIZE
] = "";

467 
iblock
 = -1;

468 
š
 = -1;

469 
iblock
 = 0; iblock < 
num_blocks
; ++iblock) {

470 
š
 = 0; ipš < 
max_pšs_³r_şb
; ++ipin) {

471 
	`¥rštf
(
mes§ge
, "block_pin_to_tnode[%d][%d] = %d\n",

472 
iblock
, 
š
, 
block_pš_to_Šode
[iblock][ipin]);

473 
	`åuts
(
mes§ge
, 
ouut_fe
);

476 
	`fşo£
(
ouut_fe
);

477 
	}
}

479 
	$check_v”‹xs_Ëv–s
()

481 
v”‹xs_­³¬_couÁ
[
num_of_v”‹xs
];

482 
v
 = -1;

483 
v
 = 0; v < 
num_of_v”‹xs
; ++v) {

484 
v”‹xs_­³¬_couÁ
[
v
] = 0;

487 
FILE
* 
fe
 = 
	`fİ’
("check_all_vertexs_levels.txt", "w");

488 
mes§ge
[
BUFSIZE
 * 3000];

489 
tmp
[80];

491 
	`¥rštf
(
mes§ge
, "Iˆhad %d†evËs", 
num_Šode_Ëv–s
);

492 
	`åuts
(
mes§ge
, 
fe
);

493 
l
 = -1;

494 
l
 = 0;† < 
num_Šode_Ëv–s
; ++l) {

495 cÚ¡ 
v”‹xs_©_Ëv–
 = 
Šodes_©_Ëv–
[
l
].
ÃËm
;

496 
	`¥rštf
(
mes§ge
, "\nLevel %d, it had %d vertexes\n",

497 
l
, 
v”‹xs_©_Ëv–
);

498 
	`åuts
(
mes§ge
, 
fe
);

500 
	`¡rıy
(
mes§ge
, "");

501 
v
 = 0; v < 
v”‹xs_©_Ëv–
; ++v) {

502 cÚ¡ 
v”‹x_šdex
 = 
Šodes_©_Ëv–
[
l
].
li¡
[
v
];

503 ++
v”‹xs_­³¬_couÁ
[
v”‹x_šdex
];

505 
	`¡rÿt
(
mes§ge
, "V");

506 
	`¥rštf
(
tmp
, "%d", 
v”‹x_šdex
);

507 
	`¡rÿt
(
mes§ge
, 
tmp
);

508 ià(
v
 !ğ
v”‹xs_©_Ëv–
 - 1) {

509 
	`¡rÿt
(
mes§ge
, ", ");

512 
	`åuts
(
mes§ge
, 
fe
);

515 
	`åuts
("\ÇÎ v”‹xe ­³¬ed couÁ: ", 
fe
);

516 
v
 = 0; v < 
num_of_v”‹xs
; ++v) {

517 
	`¥rštf
(
mes§ge
, "\nV%d‡µ—»d couÁ: %d", 
v
, 
v”‹xs_­³¬_couÁ
[v]);

518 
	`åuts
(
mes§ge
, 
fe
);

520 
	`fşo£
(
fe
);

521 
	}
}

525 
	$®loc_ªd_lßd_pš_m­pšgs
(*** 
block_pš_to_Šode_±r
,

526 **** 
sblk_pš_to_Šode_±r
,

527 
subblock_d©a_t
 
subblock_d©a
,

528 ** 
num_u£s_of_sblk_İš
)

530 cÚ¡ 
subblock_lut_size
 = 
subblock_d©a
.subblock_lut_size;

532 cÚ¡ 
out_pš
 = 
subblock_lut_size
;

533 cÚ¡ 
şk_pš
 = 
subblock_lut_size
 + 1;

535 * 
num_subblocks_³r_block
 = 
subblock_d©a
.num_subblocks_per_block;

537 
subblock_t
** 
subblock_šf
 = 
subblock_d©a
.subblock_inf;

540 ** 
block_pš_to_Šode
 = (**)
	`®loc_m©rix
(0,

541 
num_blocks
-1,

543 
max_pšs_³r_şb
-1,

545 *** 
sblk_pš_to_Šode
 = (***)
	`my_m®loc
(
num_blocks
 * (**));

548 
iblk
 = -1;

549 
š
 = -1;

550 
cu¼_Šode
 = 0;

551 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

552 ià(
blocks
[
iblk
].
block_ty³
 =ğ
B_CLB_TYPE
) {

554 
š
 = 0; ipš < 
max_pšs_³r_şb
; ++ipin) {

555 ià(
blocks
[
iblk
].
Ãts
[
š
] =ğ
OPEN
) {

556 
block_pš_to_Šode
[
iblk
][
š
] = 
OPEN
;

558 
block_pš_to_Šode
[
iblk
][
š
] = 
cu¼_Šode
++;

562 cÚ¡ 
num_subblocks
 = 
num_subblocks_³r_block
[
iblk
];

564 
sblk_pš_to_Šode
[
iblk
] = (**)
	`®loc_m©rix
(0,

565 
num_subblocks
 - 1,

567 
subblock_lut_size
 + 1,

569 
isub
 = -1;

570 
isub
 = 0; isub < 
num_subblocks
; ++isub) {

571 
boŞ—n
 
has_šputs
 = 
FALSE
;

573 
š
 = 0; ipš < 
subblock_lut_size
; ++ipin) {

574 ià(
subblock_šf
[
iblk
][
isub
].
šputs
[
š
] !ğ
OPEN
) {

575 
has_šputs
 = 
TRUE
;

576 
sblk_pš_to_Šode
[
iblk
][
isub
][
š
] = 
cu¼_Šode
++;

578 
sblk_pš_to_Šode
[
iblk
][
isub
][
š
] = 
OPEN
;

584 ià(
num_u£s_of_sblk_İš
[
iblk
][
isub
] != 0) {

585 
sblk_pš_to_Šode
[
iblk
][
isub
][
out_pš
] = 
cu¼_Šode
;

586 ià(
has_šputs
) {

587 ++
cu¼_Šode
;

589 
cu¼_Šode
 += 2;

592 
sblk_pš_to_Šode
[
iblk
][
isub
][
out_pš
] = 
OPEN
;

596 ià(
subblock_šf
[
iblk
][
isub
].
şock
 !ğ
OPEN
) {

601 
sblk_pš_to_Šode
[
iblk
][
isub
][
şk_pš
] = 
cu¼_Šode
;

602 
cu¼_Šode
 += 2;

604 
sblk_pš_to_Šode
[
iblk
][
isub
][
şk_pš
] = 
OPEN
;

608 
block_pš_to_Šode
[
iblk
][0] = 
cu¼_Šode
;

609 
block_pš_to_Šode
[
iblk
][1] = 
cu¼_Šode
 + 1;

610 
cu¼_Šode
 += 2;

612 
š
 = 2; ipš < 
max_pšs_³r_şb
; ++ipin) {

613 
block_pš_to_Šode
[
iblk
][
š
] = 
OPEN
;

616 
sblk_pš_to_Šode
[
iblk
] = 
NULL
;

620 *
sblk_pš_to_Šode_±r
 = 
sblk_pš_to_Šode
;

621 *
block_pš_to_Šode_±r
 = 
block_pš_to_Šode
;

623  
cu¼_Šode
;

624 
	}
}

627 
	$ä“_pš_m­pšgs
(** 
block_pš_to_Šode
,

628 *** 
sblk_pš_to_Šode
,

629 * 
num_subblocks_³r_block
)

632 
	`ä“_m©rix
(
block_pš_to_Šode
, 0,

633 
num_blocks
 - 1, 0,

636 
iblk
 = -1;

637 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

638 ià(
blocks
[
iblk
].
block_ty³
 =ğ
B_CLB_TYPE
) {

639 
	`ä“_m©rix
(
sblk_pš_to_Šode
[
iblk
], 0,

640 
num_subblocks_³r_block
[
iblk
] - 1, 0,

645 
	`ä“
(
sblk_pš_to_Šode
);

646 
	}
}

651 
	$®loc_ªd_lßd_çnout_couÁs
(*** 
num_u£s_of_şb_š_±r
,

652 *** 
num_u£s_of_sblk_İš_±r
,

653 
subblock_d©a_t
 
subblock_d©a
)

658 * 
num_subblocks_³r_block
 = 
subblock_d©a
.num_subblocks_per_block;

660 
subblock_t
** 
subblock_šf
 = 
subblock_d©a
.subblock_inf;

661 
subblock_lut_size
 = 
subblock_d©a
.subblock_lut_size;

665 ** 
num_u£s_of_şb_š
 = (**)
	`my_m®loc
(
num_blocks
 * (*));

666 ** 
num_u£s_of_sblk_İš
 = (**)
	`my_m®loc
(
num_blocks
 * (*));

668 
iblk
 = -1;

669 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

670 ià(
blocks
[
iblk
].
block_ty³
 !ğ
B_CLB_TYPE
) {

671 
num_u£s_of_şb_š
[
iblk
] = 
NULL
;

672 
num_u£s_of_sblk_İš
[
iblk
] = 
NULL
;

674 
num_u£s_of_şb_š
[
iblk
] = (*)
	`my_ÿÎoc
(
max_pšs_³r_şb
,

676 
num_u£s_of_sblk_İš
[
iblk
] = (*)
	`my_ÿÎoc
(
num_subblocks_³r_block
[iblk],

679 
	`lßd_Úe_şb_çnout_couÁ
(
subblock_lut_size
,

680 
subblock_šf
[
iblk
],

681 
num_subblocks_³r_block
[
iblk
],

682 
num_u£s_of_şb_š
[
iblk
],

683 
num_u£s_of_sblk_İš
[
iblk
],

684 
iblk
);

688 *
num_u£s_of_şb_š_±r
 = 
num_u£s_of_şb_š
;

689 *
num_u£s_of_sblk_İš_±r
 = 
num_u£s_of_sblk_İš
;

690 
	}
}

692 
	$ä“_çnout_couÁs
(** 
num_u£s_of_şb_š
,

693 ** 
num_u£s_of_sblk_İš
)

696 
iblk
 = -1;

697 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

698 ià(
blocks
[
iblk
].
block_ty³
 =ğ
B_CLB_TYPE
) {

699 
	`ä“
(
num_u£s_of_şb_š
[
iblk
]);

700 
	`ä“
(
num_u£s_of_sblk_İš
[
iblk
]);

704 
	`ä“
(
num_u£s_of_şb_š
);

705 
	`ä“
(
num_u£s_of_sblk_İš
);

706 
	}
}

709 
	$®loc_ªd_lßd_Šodes_ªd_Ãt_m­pšg
(** 
num_u£s_of_şb_š
,

710 ** 
num_u£s_of_sblk_İš
,

711 ** 
block_pš_to_Šode
,

712 *** 
sblk_pš_to_Šode
,

713 
subblock_d©a_t
 
subblock_d©a
,

714 
timšg_šfo_t
 
timšg_šf
)

717 
v”‹xes
 = (
v”‹x_t
*)
	`my_m®loc
(
num_of_v”‹xs
 * (vertex_t));

718 
Šode_desüt
 = (
v”‹x_desüt
*)
	`my_m®loc
(
num_of_v”‹xs
 *

719 (
v”‹x_desüt
));

722 
driv”_node_šdex_of_Ãt
 = (*)
	`my_m®loc
(
num_Ãts
 * ());

725 * 
Ãxt_şb_š_edge
 = (*)
	`my_m®loc
(
max_pšs_³r_şb
 * ());

726 * 
Ãxt_sblk_İš_edge
 = (*)
	`my_m®loc
(
subblock_d©a
.
max_subblocks_³r_block


730 
subblock_t
** 
subblock_šf
 = 
subblock_d©a
.subblock_inf;

731 cÚ¡ 
subblock_lut_size
 = 
subblock_d©a
.subblock_lut_size;

732 * 
num_subblocks_³r_block
 = 
subblock_d©a
.num_subblocks_per_block;

735 
i
 = -1;

736 
i
 = 0; i < 
num_of_v”‹xs
; ++i) {

737 
v”‹xes
[
i
].
num_·»Ás
 = 0;

739 
v”‹xes
[
i
].
š_edges
 = (
edge_t
*)
	`my_m®loc
(6 * (edge_t));

742 
iblk
 = -1;

743 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

744 
blocks
[
iblk
].
block_ty³
) {

745 
B_CLB_TYPE
:

746 
	`bud_şb_Šodes
(
iblk
,

747 
num_u£s_of_şb_š
[
iblk
],

748 
block_pš_to_Šode
,

749 
sblk_pš_to_Šode
[
iblk
],

750 
subblock_lut_size
,

751 
num_subblocks_³r_block
[
iblk
],

752 
subblock_šf
[
iblk
],

753 
timšg_šf
.
T_şb_š_to_sblk_š
,

754 
Ãxt_şb_š_edge
);

756 
	`bud_subblock_Šodes
(
num_u£s_of_sblk_İš
[
iblk
],

757 
block_pš_to_Šode
[
iblk
],

758 
sblk_pš_to_Šode
[
iblk
],

759 
subblock_lut_size
,

760 
num_subblocks_³r_block
[
iblk
],

761 
subblock_šf
[
iblk
],

762 
timšg_šf
.
T_sblk_İš_to_sblk_š
,

763 
timšg_šf
.
T_sblk_İš_to_şb_İš
,

764 
timšg_šf
.
T_subblock
,

765 
Ãxt_sblk_İš_edge
,

766 
iblk
);

769 
INPAD_TYPE
:

770 
	`bud_ad_Šodes
(
iblk
,

771 
block_pš_to_Šode
,

772 
timšg_šf
.
T_ad
,

773 
num_subblocks_³r_block
,

774 
subblock_šf
);

777 
OUTPAD_TYPE
:

778 
	`bud_İad_Šodes
(
block_pš_to_Šode
[
iblk
],

779 
timšg_šf
.
T_İad
,

780 
iblk
);

784 
	`´štf
("Error in‡lloc_and_load_tnodes_and_net_mapping:\n"

786 
blocks
[
iblk
].
block_ty³
,

787 
iblk
,

788 
blocks
[
iblk
].
Çme
);

789 
	`ex™
(1);

793 
	`ä“
(
Ãxt_şb_š_edge
);

794 
	`ä“
(
Ãxt_sblk_İš_edge
);

795 
	}
}

802 
	$bud_şb_Šodes
(
iblk
,

803 * 
num_u£s_of_şb_š
,

804 ** 
block_pš_to_Šode
,

805 ** 
sub_pš_to_Šode
,

806 
subblock_lut_size
,

807 
subblks_š_block
,

808 
subblock_t
* 
sub_šf
,

809 
T_şb_š_to_sblk_š
,

810 * 
Ãxt_şb_š_edge
)

812 
num_out_edges
 = 0;

813 cÚ¡ 
şk_pš
 = 
subblock_lut_size
 + 1;

815 
š
 = -1;

816 
äom_node
 = -1;

817 
š
 = 0; ipš < 
max_pšs_³r_şb
; ++ipin) {

818 
äom_node
 = 
block_pš_to_Šode
[
iblk
][
š
];

819 ià(
äom_node
 !ğ
OPEN
) {

820 ià(
	`is_İš
(
š
)) {

821 
	`bud_block_ouut_Šode
(
äom_node
,

822 
iblk
,

823 
š
,

824 
block_pš_to_Šode
);

825 
Šode_desüt
[
äom_node
].
ty³
 = 
CLB_OPIN
;

827 
Ãxt_şb_š_edge
[
š
] = 0;

830 
num_out_edges
 = 
num_u£s_of_şb_š
[
š
];

831 
v”‹xes
[
äom_node
].
num_out_edges
 =‚um_out_edges;

832 
v”‹xes
[
äom_node
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
(
num_out_edges
 * (edge_t),

833 &
‹dge_ch_li¡_h—d
,

834 &
‹dge_ch_by‹s_ava
,

835 &
‹dge_ch_Ãxt_ava
);

836 
Šode_desüt
[
äom_node
].
ty³
 = 
CLB_IPIN
;

839 
Šode_desüt
[
äom_node
].
š
 = ipin;

840 
Šode_desüt
[
äom_node
].
isubblk
 = 
OPEN
;

841 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

848 
äom_pš
 = -1;

849 
to_node
 = -1;

850 
edge_t
* 
‹dge
 = 
NULL
;

851 
isub
 = -1;

852 
›dge
 = 0;

853 
isub
 = 0; isub < 
subblks_š_block
; ++isub) {

855 
š
 = 0; ipš < 
subblock_lut_size
; ++ipin) {

856 
äom_pš
 = 
sub_šf
[
isub
].
šputs
[
š
];

858 ià(
äom_pš
 !ğ
OPEN
 && from_pš < 
max_pšs_³r_şb
) {

859 
äom_node
 = 
block_pš_to_Šode
[
iblk
][
äom_pš
];

860 
to_node
 = 
sub_pš_to_Šode
[
isub
][
š
];

864 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

865 
›dge
 = 
Ãxt_şb_š_edge
[
äom_pš
]++;

866 
‹dge
[
›dge
].
to_node
 =o_node;

868 
‹dge
[
›dge
].
Td–
 = 
T_şb_š_to_sblk_š
;

873 
äom_pš
 = 
sub_šf
[
isub
].
şock
;

874 ià(
äom_pš
 !ğ
OPEN
 && from_pš < 
max_pšs_³r_şb
) {

875 
äom_node
 = 
block_pš_to_Šode
[
iblk
][
äom_pš
];

876 
to_node
 = 
sub_pš_to_Šode
[
isub
][
şk_pš
];

878 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

879 
›dge
 = 
Ãxt_şb_š_edge
[
äom_pš
]++;

880 
‹dge
[
›dge
].
to_node
 =o_node;

886 
‹dge
[
›dge
].
Td–
 = 0.0;

889 
	}
}

891 
	$bud_block_ouut_Šode
(
ivex
,

892 
iblk
,

893 
š
,

894 ** 
block_pš_to_Šode
)

898 
š‘
 = 
blocks
[
iblk
].
Ãts
[
š
];

899 
	`as£¹
(
š‘
 !ğ
OPEN
);

901 
driv”_node_šdex_of_Ãt
[
š‘
] = 
ivex
;

902 
num_out_edges
 = 
Ãt
[
š‘
].
num_Ãt_pšs
 - 1;

903 
v”‹xes
[
ivex
].
num_out_edges
 =‚um_out_edges;

904 
v”‹xes
[
ivex
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
(
num_out_edges
 * (edge_t),

905 &
‹dge_ch_li¡_h—d
,

906 &
‹dge_ch_by‹s_ava
,

907 &
‹dge_ch_Ãxt_ava
);

908 
edge_t
* 
‹dge
 = 
v”‹xes
[
ivex
].
out_edges
;

909 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

911 
›dge
 = -1;

912 
›dge
 = 0; iedg< 
knum_Ãt_pšs
 - 1; ++iedge) {

913 
to_blk
 = 
Ãt
[
š‘
].
node_blocks
[
›dge
 + 1];

915 
to_pš
 = -1;

916 ià(
blocks
[
to_blk
].
block_ty³
 =ğ
B_CLB_TYPE
) {

917 
to_pš
 = 
Ãt
[
š‘
].
node_block_pšs
[
›dge
 + 1];

919 
to_pš
 = 0;

922 
to_node
 = 
block_pš_to_Šode
[
to_blk
][
to_pš
];

923 
‹dge
[
›dge
].
to_node
 =o_node;

926 
	}
}

931 
	$bud_subblock_Šodes
(* 
num_u£s_of_sblk_İš
,

932 * 
blk_pš_to_Šode
,

933 ** 
sub_pš_to_Šode
,

934 
subblock_lut_size
,

935 
subblks_š_block
,

936 
subblock_t
* 
sub_šf
,

937 
T_sblk_İš_to_sblk_š
,

938 
T_sblk_İš_to_şb_İš
,

939 
T_subblock_t
* 
T_subblock
,

940 * 
Ãxt_sblk_İš_edge
,

941 
iblk
)

943 
›dge
, 
num_out_edges
;

944 cÚ¡ 
out_pš
 = 
subblock_lut_size
;

945 cÚ¡ 
şk_pš
 = 
subblock_lut_size
 + 1;

948 
isub
 = -1;

949 
äom_node
 = -1;

950 
š
 = -1;

951 
isub
 = 0; isub < 
subblks_š_block
; ++isub) {

952 
äom_node
 = 
sub_pš_to_Šode
[
isub
][
out_pš
];

953 ià(
äom_node
 !ğ
OPEN
) {

954 
Ãxt_sblk_İš_edge
[
isub
] = 0;

955 
num_out_edges
 = 
num_u£s_of_sblk_İš
[
isub
];

956 
v”‹xes
[
äom_node
].
num_out_edges
 =‚um_out_edges;

957 
v”‹xes
[
äom_node
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
(
num_out_edges
 * (edge_t),

958 &
‹dge_ch_li¡_h—d
,

959 &
‹dge_ch_by‹s_ava
,

960 &
‹dge_ch_Ãxt_ava
);

961 
Šode_desüt
[
äom_node
].
ty³
 = 
SUBBLK_OPIN
;

963 
Šode_desüt
[
äom_node
].
š
 = 
out_pš
;

964 
Šode_desüt
[
äom_node
].
isubblk
 = 
isub
;

965 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

969 
äom_pš
 = -1;

970 
to_pš
 = -1;

971 
to_node
 = -1;

972 
edge_t
* 
‹dge
 = 
NULL
;

974 
isub
 = 0; isub < 
subblks_š_block
; ++isub) {

975 
š
 = 0; ipš < 
subblock_lut_size
; ++ipin) {

976 
äom_pš
 = 
sub_šf
[
isub
].
šputs
[
š
];

979 ià(
äom_pš
 >ğ
max_pšs_³r_şb
) {

981 
äom_node
 = 
sub_pš_to_Šode
[
äom_pš
 - 
max_pšs_³r_şb
][
out_pš
];

983 
to_node
 = 
sub_pš_to_Šode
[
isub
][
š
];

985 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

986 
›dge
 = 
Ãxt_sblk_İš_edge
[
äom_pš
 - 
max_pšs_³r_şb
]++;

987 
‹dge
[
›dge
].
to_node
 =o_node;

988 
‹dge
[
›dge
].
Td–
 = 
T_sblk_İš_to_sblk_š
;

992 
äom_pš
 = 
sub_šf
[
isub
].
şock
;

993 ià(
äom_pš
 >ğ
max_pšs_³r_şb
) {

996 
äom_node
 = 
sub_pš_to_Šode
[
äom_pš
 - 
max_pšs_³r_şb
][
out_pš
];

999 
to_node
 = 
sub_pš_to_Šode
[
isub
][
şk_pš
];

1001 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1002 
›dge
 = 
Ãxt_sblk_İš_edge
[
äom_pš
 - 
max_pšs_³r_şb
]++;

1003 
‹dge
[
›dge
].
to_node
 =o_node;

1005 
‹dge
[
›dge
].
Td–
 = 
T_sblk_İš_to_sblk_š
;

1008 
to_pš
 = 
sub_šf
[
isub
].
ouut
;

1009 ià(
to_pš
 !ğ
OPEN
) {

1012 ià(
blocks
[
iblk
].
Ãts
[
to_pš
] !ğ
OPEN
) {

1013 
to_node
 = 
blk_pš_to_Šode
[
to_pš
];

1014 
äom_node
 = 
sub_pš_to_Šode
[
isub
][
out_pš
];

1015 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1017 
›dge
 = 
Ãxt_sblk_İš_edge
[
isub
]++;

1019 
‹dge
[
›dge
].
to_node
 =o_node;

1020 
‹dge
[
›dge
].
Td–
 = 
T_sblk_İš_to_şb_İš
;

1028 
š_to_sšk_d–ay
 = 0.0;

1029 
boŞ—n
 
has_šputs
 = 
FALSE
;

1030 
isub
 = 0; isub < 
subblks_š_block
; ++isub) {

1031 ià(
sub_pš_to_Šode
[
isub
][
out_pš
] =ğ
OPEN
) {

1035 ià(
sub_šf
[
isub
].
şock
 =ğ
OPEN
) {

1036 
to_node
 = 
sub_pš_to_Šode
[
isub
][
out_pš
];

1037 
š_to_sšk_d–ay
 = 
T_subblock
[
isub
].
T_comb
;

1040 
äom_node
 = 
sub_pš_to_Šode
[
isub
][
şk_pš
];

1041 
v”‹xes
[
äom_node
].
num_out_edges
 = 1;

1042 
v”‹xes
[
äom_node
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
((edge_t),

1043 &
‹dge_ch_li¡_h—d
,

1044 &
‹dge_ch_by‹s_ava
,

1045 &
‹dge_ch_Ãxt_ava
);

1046 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1047 
‹dge
[0].
to_node
 = 
sub_pš_to_Šode
[
isub
][
out_pš
];

1048 
‹dge
[0].
Td–
 = 
T_subblock
[
isub
].
T_£q_out
;

1050 
Šode_desüt
[
äom_node
].
ty³
 = 
FF_SOURCE
;

1051 
Šode_desüt
[
äom_node
].
š
 = 
OPEN
;

1052 
Šode_desüt
[
äom_node
].
isubblk
 = 
isub
;

1053 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

1056 
äom_node
++;

1057 
v”‹xes
[
äom_node
].
num_out_edges
 = 0;

1058 
v”‹xes
[
äom_node
].
out_edges
 = 
NULL
;

1059 
Šode_desüt
[
äom_node
].
ty³
 = 
FF_SINK
;

1060 
Šode_desüt
[
äom_node
].
š
 = 
OPEN
;

1061 
Šode_desüt
[
äom_node
].
isubblk
 = 
isub
;

1062 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

1065 
to_node
 = 
äom_node
;

1066 
š_to_sšk_d–ay
 = 
T_subblock
[
isub
].
T_£q_š
;

1070 
has_šputs
 = 
FALSE
;

1071 
š
 = 0; ipš < 
subblock_lut_size
; ++ipin) {

1072 
äom_node
 = 
sub_pš_to_Šode
[
isub
][
š
];

1073 ià(
äom_node
 !ğ
OPEN
) {

1074 
has_šputs
 = 
TRUE
;

1075 
v”‹xes
[
äom_node
].
num_out_edges
 = 1;

1076 
v”‹xes
[
äom_node
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
((edge_t),

1077 &
‹dge_ch_li¡_h—d
,

1078 &
‹dge_ch_by‹s_ava
,

1079 &
‹dge_ch_Ãxt_ava
);

1080 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1081 
‹dge
[0].
to_node
 =o_node;

1082 
‹dge
[0].
Td–
 = 
š_to_sšk_d–ay
;

1083 
Šode_desüt
[
äom_node
].
ty³
 = 
SUBBLK_IPIN
;

1084 
Šode_desüt
[
äom_node
].
š
 = ipin;

1085 
Šode_desüt
[
äom_node
].
isubblk
 = 
isub
;

1086 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

1091 ià(
FALSE
 =ğ
has_šputs
) {

1092 
äom_node
 = 
sub_pš_to_Šode
[
isub
][
out_pš
] + 1;

1093 
v”‹xes
[
äom_node
].
num_out_edges
 = 1;

1094 
v”‹xes
[
äom_node
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
((edge_t),

1095 &
‹dge_ch_li¡_h—d
,

1096 &
‹dge_ch_by‹s_ava
,

1097 &
‹dge_ch_Ãxt_ava
);

1098 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1099 
‹dge
[0].
to_node
 =o_node;

1101 
‹dge
[0].
Td–
 = 
T_CONSTANT_GENERATOR
;

1102 
Šode_desüt
[
äom_node
].
ty³
 = 
CONSTANT_GEN_SOURCE
;

1103 
Šode_desüt
[
äom_node
].
š
 = 
OPEN
;

1104 
Šode_desüt
[
äom_node
].
isubblk
 = 
isub
;

1105 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

1108 
	}
}

1112 
	$bud_ad_Šodes
(
iblk
,

1113 ** 
block_pš_to_Šode
,

1114 
T_ad
,

1115 * 
num_subblocks_³r_block
,

1116 
subblock_t
** 
subblock_šf
)

1120 
äom_node
 = 
block_pš_to_Šode
[
iblk
][0];

1121 
to_node
 = 
block_pš_to_Šode
[
iblk
][1];

1122 
v”‹xes
[
äom_node
].
num_out_edges
 = 1;

1123 
v”‹xes
[
äom_node
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
((edge_t),

1124 &
‹dge_ch_li¡_h—d
,

1125 &
‹dge_ch_by‹s_ava
,

1126 &
‹dge_ch_Ãxt_ava
);

1127 
edge_t
* 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1128 
‹dge
[0].
to_node
 =o_node;

1134 ià(
	`is_glob®_şock
(
iblk
,

1135 
num_subblocks_³r_block
,

1136 
subblock_šf
)) {

1137 
‹dge
[0].
Td–
 = 0.0;

1139 
‹dge
[0].
Td–
 = 
T_ad
;

1142 
Šode_desüt
[
äom_node
].
ty³
 = 
INPAD_SOURCE
;

1143 
Šode_desüt
[
äom_node
].
š
 = 
OPEN
;

1144 
Šode_desüt
[
äom_node
].
isubblk
 = 
OPEN
;

1145 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

1148 
	`bud_block_ouut_Šode
(
to_node
,

1149 
iblk
,

1151 
block_pš_to_Šode
);

1152 
Šode_desüt
[
to_node
].
ty³
 = 
INPAD_OPIN
;

1153 
Šode_desüt
[
to_node
].
š
 = 0;

1154 
Šode_desüt
[
to_node
].
isubblk
 = 
OPEN
;

1155 
Šode_desüt
[
to_node
].
iblk
 = iblk;

1156 
	}
}

1159 
boŞ—n
 
	$is_glob®_şock
(
iblk
,

1160 * 
num_subblocks_³r_block
,

1161 
subblock_t
** 
subblock_šf
)

1165 
š‘
 = 
blocks
[
iblk
].
Ãts
[0];

1166 ià(!
is_glob®
[
š‘
]) {

1167  
FALSE
;

1170 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1171 
š
 = -1;

1172 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

1173 
to_blk
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

1174 
to_pš
 = 
Ãt
[
š‘
].
node_block_pšs
[
š
];

1176 
isub
 = -1;

1177 
isub
 = 0; isub < 
num_subblocks_³r_block
[
to_blk
]; ++isub) {

1178 ià(
subblock_šf
[
to_blk
][
isub
].
şock
 =ğ
to_pš
) {

1179  
TRUE
;

1184  
FALSE
;

1185 
	}
}

1191 
	$bud_İad_Šodes
(* 
blk_pš_to_Šode
,

1192 
T_İad
,

1193 
iblk
)

1195 
äom_node
 = 
blk_pš_to_Šode
[0];

1196 
to_node
 = 
blk_pš_to_Šode
[1];

1197 
v”‹xes
[
äom_node
].
num_out_edges
 = 1;

1198 
v”‹xes
[
äom_node
].
out_edges
 = (
edge_t
*)
	`my_chunk_m®loc
((edge_t),

1199 &
‹dge_ch_li¡_h—d
,

1200 &
‹dge_ch_by‹s_ava
,

1201 &
‹dge_ch_Ãxt_ava
);

1202 
edge_t
* 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1203 
‹dge
[0].
to_node
 =o_node;

1204 
‹dge
[0].
Td–
 = 
T_İad
;

1206 
Šode_desüt
[
äom_node
].
ty³
 = 
OUTPAD_IPIN
;

1207 
Šode_desüt
[
äom_node
].
š
 = 0;

1208 
Šode_desüt
[
äom_node
].
isubblk
 = 
OPEN
;

1209 
Šode_desüt
[
äom_node
].
iblk
 = iblk;

1211 
v”‹xes
[
to_node
].
num_out_edges
 = 0;

1212 
v”‹xes
[
to_node
].
out_edges
 = 
NULL
;

1213 
Šode_desüt
[
to_node
].
ty³
 = 
OUTPAD_SINK
;

1214 
Šode_desüt
[
to_node
].
š
 = 
OPEN
;

1215 
Šode_desüt
[
to_node
].
isubblk
 = 
OPEN
;

1216 
Šode_desüt
[
to_node
].
iblk
 = iblk;

1217 
	}
}

1224 
	$lßd_timšg_g¿ph_Ãt_d–ays
(** 
Ãt_d–ay
)

1226 
š‘
 = -1;

1227 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1229 cÚ¡ 
äom_node
 = 
driv”_node_šdex_of_Ãt
[
š‘
];

1230 
edge_t
* 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1234 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1235 
š
 = 0;

1236 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

1237 
‹dge
[
š
 - 1].
Td–
 = 
Ãt_d–ay
[
š‘
][ipin];

1240 
	}
}

1246 ** 
	$®loc_Ãt_¦ack
()

1248 ** 
Ãt_¦ack
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

1250 
š‘
 = -1;

1251 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1252 * 
tmp_±r
 = (*)
	`my_chunk_m®loc
((
Ãt
[
š‘
].
num_Ãt_pšs
 - 1)

1254 &
‹dge_ch_li¡_h—d
,

1255 &
‹dge_ch_by‹s_ava
,

1256 &
‹dge_ch_Ãxt_ava
);

1257 
Ãt_¦ack
[
š‘
] = 
tmp_±r
 - 1;

1260  
Ãt_¦ack
;

1261 
	}
}

1264 
	$ä“_timšg_g¿ph
(** 
Ãt_¦ack
)

1267 ià(
‹dge_ch_li¡_h—d
 =ğ
NULL
) {

1268 
	`´štf
("Error in free_timing_graph: Noiming grapho free.\n");

1269 
	`ex™
(1);

1272 
	`ä“_chunk_memÜy
(
‹dge_ch_li¡_h—d
);

1273 
	`ä“
(
v”‹xes
);

1274 
	`ä“
(
Šode_desüt
);

1275 
	`ä“
(
driv”_node_šdex_of_Ãt
);

1276 
	`ä“_ivec_veùÜ
(
Šodes_©_Ëv–
, 0, 
num_Šode_Ëv–s
 - 1);

1277 
	`ä“
(
Ãt_¦ack
);

1278 
‹dge_ch_li¡_h—d
 = 
NULL
;

1279 
‹dge_ch_by‹s_ava
 = 0;

1280 
‹dge_ch_Ãxt_ava
 = 
NULL
;

1281 
v”‹xes
 = 
NULL
;

1282 
Šode_desüt
 = 
NULL
;

1283 
num_of_v”‹xs
 = 0;

1284 
driv”_node_šdex_of_Ãt
 = 
NULL
;

1285 
Šodes_©_Ëv–
 = 
NULL
;

1286 
num_Šode_Ëv–s
 = 0;

1287 
	}
}

1289 
	$´št_Ãt_¦ack
(* 
âame
, ** 
Ãt_¦ack
)

1292 
FILE
* 
å
 = 
	`my_fİ’
(
âame
, "w");

1293 
	`årštf
(
å
, "Net #\tSlacks\n\n");

1295 
š‘
, 
š
;

1296 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1297 
	`årštf
(
å
, "%5d", 
š‘
);

1299 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1300 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

1301 
	`årštf
(
å
, "\t%g", 
Ãt_¦ack
[
š‘
][
š
]);

1304 
	`årštf
(
å
, "\n");

1306 
	}
}

1308 
	$´št_timšg_g¿ph
(* 
âame
)

1311 
edge_t
* 
‹dge
;

1312 
v”‹x_ty³_t
 
™y³
;

1313 * 
Šode_ty³_Çmes
[] = {"INPAD_SOURCE",

1324 
FILE
* 
å
 = 
	`my_fİ’
(
âame
, "w");

1325 
	`årštf
(
å
, "num_of_v”‹xs: %d\n", 
num_of_v”‹xs
);

1326 
	`årštf
(
å
, "Node #\tType\t\tipin\tisubblk\tiblk\t#ƒdges\t"

1329 
ivex
, 
›dge
;

1330 
ivex
 = 0; ivex < 
num_of_v”‹xs
; ++ivex) {

1331 
	`årštf
(
å
, "%d\t", 
ivex
);

1332 
™y³
 = 
Šode_desüt
[
ivex
].
ty³
;

1333 
	`årštf
(
å
, "%-15.15s\t", 
Šode_ty³_Çmes
[
™y³
]);

1334 
	`årštf
(
å
, "%d\t%d\t%d\t", 
Šode_desüt
[
ivex
].
š
,

1335 
Šode_desüt
[
ivex
].
isubblk
,node_desüt[ivex].
iblk
);

1336 
	`årštf
(
å
, "%d\t", 
v”‹xes
[
ivex
].
num_out_edges
);

1337 
‹dge
 = 
v”‹xes
[
ivex
].
out_edges
;

1339 
›dge
 = 0; iedg< 
v”‹xes
[
ivex
].
num_out_edges
; ++iedge) {

1340 
	`årštf
(
å
, "\t(%4d,%7.3g)", 
‹dge
[
›dge
].
to_node
,edge[›dge].
Td–
);

1343 
	`årštf
(
å
, "\n");

1345 
	`årštf
(
å
, "\n\Âum_Šode_Ëv–s: %d\n", 
num_Šode_Ëv–s
);

1347 
ev–
, 
i
;

1348 
ev–
 = 0; iËv– < 
num_Šode_Ëv–s
; ilevel++) {

1349 
	`årštf
(
å
, "\n\nLev–: %d Num_nodes: %d\nNodes:", 
ev–
,

1350 
Šodes_©_Ëv–
[
ev–
].
ÃËm
);

1352 
i
 = 0; i < 
Šodes_©_Ëv–
[
ev–
].
ÃËm
; i++) {

1353 
	`årštf
(
å
, "\t%d", 
Šodes_©_Ëv–
[
ev–
].
li¡
[
i
]);

1357 
	`årštf
(
å
, "\n");

1358 
	`årštf
(
å
, "\n\nNet #\tNet_to_driver_tnode\n");

1360 
i
 = 0; i < 
num_Ãts
; i++) {

1361 
	`årštf
(
å
, "%4d\t%6d\n", 
i
, 
driv”_node_šdex_of_Ãt
[i]);

1364 
	`årštf
(
å
, "\n\nNode #\t\tT_arr\t\tT_req\n\n");

1366 
ivex
 = 0; ivex < 
num_of_v”‹xs
; ivex++)

1367 
	`årštf
(
å
, "%d\t%12g\t%12g\n", 
ivex
, 
v”‹xes
[ivex].
¬r_time
,

1368 
v”‹xes
[
ivex
].
»q_time
);

1370 
	`fşo£
(
å
);

1371 
	}
}

1381 
	$ÿlc_®l_v”‹xs_¬r_»q_time
(
rg‘_cyşe_time
)

1385 
äom_node
 = -1;

1386 
äom_node
 = 0; from_nod< 
num_of_v”‹xs
; ++from_node) {

1387 
v”‹xes
[
äom_node
].
¬r_time
 = 
T_CONSTANT_GENERATOR
;

1391 
i
 = -1;

1392 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[0].
ÃËm
;

1393 
i
 = 0; i < 
num_©_Ëv–
; ++i) {

1394 
äom_node
 = 
Šodes_©_Ëv–
[0].
li¡
[
i
];

1395 
v”‹xes
[
äom_node
].
¬r_time
 = 0.0;

1400 
¬r_time
 = 0.0;

1401 
»q_time
 = 0.0;

1402 
Td–
 = 0.0;

1404 
ev–
 = -1;

1405 
num_out_edges
 = -1;

1406 
›dge
 = -1;

1407 
to_node
 = -1;

1408 
edge_t
* 
cÚn_edges
 = 
NULL
;

1411 
T_ü™
 = 0.0;

1413 
ev–
 = 0; iËv– < 
num_Šode_Ëv–s
; ++ilevel) {

1414 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

1415 
i
 = 0; i < 
num_©_Ëv–
; ++i) {

1416 
äom_node
 = 
Šodes_©_Ëv–
[
ev–
].
li¡
[
i
];

1417 
¬r_time
 = 
v”‹xes
[
äom_node
].arr_time;

1419 
T_ü™
 = 
	`max
(T_ü™, 
¬r_time
);

1421 
cÚn_edges
 = 
v”‹xes
[
äom_node
].
out_edges
;

1422 
num_out_edges
 = 
v”‹xes
[
äom_node
].num_out_edges;

1423 
›dge
 = 0; iedg< 
num_out_edges
; ++iedge) {

1424 
to_node
 = 
cÚn_edges
[
›dge
].to_node;

1425 
Td–
 = 
cÚn_edges
[
›dge
].Tdel;

1427 
v”‹xes
[
to_node
].
¬r_time
 = 
	`max
(vertexes[to_node].arr_time,

1428 
¬r_time
 + 
Td–
);

1433 
T_cyşe
 = 0.0;

1434 ià(
rg‘_cyşe_time
 > 0.0) {

1437 
T_cyşe
 = 
rg‘_cyşe_time
;

1440 
T_cyşe
 = 
T_ü™
;

1447 
ev–
 = 
num_Šode_Ëv–s
 - 1; ilevel >= 0; --ilevel) {

1448 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

1449 
i
 = 0; i < 
num_©_Ëv–
; ++i) {

1450 
äom_node
 = 
Šodes_©_Ëv–
[
ev–
].
li¡
[
i
];

1451 
num_out_edges
 = 
v”‹xes
[
äom_node
].num_out_edges;

1453 ià(
num_out_edges
 == 0) {

1454 
v”‹xes
[
äom_node
].
»q_time
 = 
T_cyşe
;

1456 
cÚn_edges
 = 
v”‹xes
[
äom_node
].
out_edges
;

1457 
Td–
 = 
cÚn_edges
[0].Tdel;

1459 
to_node
 = 
cÚn_edges
[0].to_node;

1460 
»q_time
 = 
v”‹xes
[
to_node
].»q_tim- 
Td–
;

1461 
›dge
 = 1; iedg< 
num_out_edges
; ++iedge) {

1462 
to_node
 = 
cÚn_edges
[
›dge
].to_node;

1463 
Td–
 = 
cÚn_edges
[
›dge
].Tdel;

1465 
»q_time
 = 
	`mš
(req_time,

1466 
v”‹xes
[
to_node
].
»q_time
 - 
Td–
);

1468 
v”‹xes
[
äom_node
].
»q_time
 =„eq_time;

1473  
T_ü™
;

1474 
	}
}

1479 
	$compu‹_Ãt_¦acks
(** 
Ãt_¦ack
)

1481 
š‘
 = -1;

1482 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1484 
äom_node
 = 
driv”_node_šdex_of_Ãt
[
š‘
];

1485 
¬r_time
 = 
v”‹xes
[
äom_node
].arr_time;

1487 
num_out_edges
 = 
v”‹xes
[
äom_node
].num_out_edges;

1488 
edge_t
* 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

1489 
›dge
 = -1;

1490 
›dge
 = 0; iedg< 
num_out_edges
; ++iedge) {

1491 
to_node
 = 
‹dge
[
›dge
].to_node;

1492 
Td–
 = 
‹dge
[
›dge
].Tdel;

1493 
»q_time
 = 
v”‹xes
[
to_node
].req_time;

1495 
Ãt_¦ack
[
š‘
][
›dge
 + 1] = 
»q_time
 - 
¬r_time
 - 
Td–
;

1498 
	}
}

1500 
	$´št_ü™iÿl_·th
(* 
âame
)

1503 
FILE
* 
å
 = 
	`my_fİ’
(
âame
, "w");

1505 
iblk
 = -1;

1506 
š‘
 = -1;

1508 
t_lšked_št
* 
ü™iÿl_·th_h—d
 = 
	`®loÿ‹_ªd_lßd_ü™iÿl_·th
();

1510 
Šodes_Ú_ü™_·th
 = 0;

1511 
nÚ_glob®_Ãts_Ú_ü™_·th
 = 0;

1512 
glob®_Ãts_Ú_ü™_·th
 = 0;

1513 
tÙ®_Ãt_d–ay
 = 0.0;

1514 
tÙ®_logic_d–ay
 = 0.0;

1515 
t_lšked_št
* 
ü™iÿl_·th_node
 = 
ü™iÿl_·th_h—d
;

1516 
ü™iÿl_·th_node
 !ğ
NULL
) {

1517 
d–ay
 = 
	`´št_ü™iÿl_·th_node
(
å
, 
ü™iÿl_·th_node
);

1518 
ivex
 = 
ü™iÿl_·th_node
->
d©a
;

1519 
v”‹x_ty³_t
 
ty³
 = 
Šode_desüt
[
ivex
].type;

1520 ++
Šodes_Ú_ü™_·th
;

1522 ià(
ty³
 =ğ
INPAD_OPIN
 ||y³ =ğ
CLB_OPIN
) {

1523 
	`g‘_Šode_block_ªd_ouut_Ãt
(
ivex
, &
iblk
, &
š‘
);

1525 ià(!
is_glob®
[
š‘
]) {

1526 ++
nÚ_glob®_Ãts_Ú_ü™_·th
;

1528 ++
glob®_Ãts_Ú_ü™_·th
;

1531 
tÙ®_Ãt_d–ay
 +ğ
d–ay
;

1533 
tÙ®_logic_d–ay
 +ğ
d–ay
;

1536 
ü™iÿl_·th_node
 = cr™iÿl_·th_node->
Ãxt
;

1539 
	`årštf
(
å
, "\nTnodes on crit.…ath: %d Non-global‚ets on crit.…ath: %d.\n",

1540 
Šodes_Ú_ü™_·th
,

1541 
nÚ_glob®_Ãts_Ú_ü™_·th
);

1543 
	`årštf
(
å
, "Global‚ets on crit.…ath: %d.\n",

1544 
glob®_Ãts_Ú_ü™_·th
);

1546 
	`årštf
(
å
, "Total†ogic delay: %g (s) Total‚et delay: %g (s)\n",

1547 
tÙ®_logic_d–ay
,

1548 
tÙ®_Ãt_d–ay
);

1550 
	`´štf
("Nets on crit.…ath: %d‚ormal, %d global.\n",

1551 
nÚ_glob®_Ãts_Ú_ü™_·th
,

1552 
glob®_Ãts_Ú_ü™_·th
);

1554 
	`´štf
("Total†ogic delay: %g (s) Total‚et delay: %g (s)\n",

1555 
tÙ®_logic_d–ay
,

1556 
tÙ®_Ãt_d–ay
);

1557 
	`fşo£
(
å
);

1559 
	`ä“_št_li¡
(&
ü™iÿl_·th_h—d
);

1560 
	}
}

1562 
t_lšked_št
* 
	$®loÿ‹_ªd_lßd_ü™iÿl_·th
()

1566 
ivex
, 
›dge
, 
to_node
;

1569 
i
 = -1;

1570 
¦ack
 = 0.0;

1571 
ü™_node
 = 
OPEN
;

1573 
mš_¦ack
 = 
HUGE_FLOAT
;

1574 cÚ¡ 
num_v”‹xs_©_Ëv–_0
 = 
Šodes_©_Ëv–
[0].
ÃËm
;

1575 
i
 = 0; i < 
num_v”‹xs_©_Ëv–_0
; ++i) {

1576 
ivex
 = 
Šodes_©_Ëv–
[0].
li¡
[
i
];

1577 
¦ack
 = 
v”‹xes
[
ivex
].
»q_time
 - v”‹xes[ivex].
¬r_time
;

1578 ià(
¦ack
 < 
mš_¦ack
) {

1579 
ü™_node
 = 
ivex
;

1580 
mš_¦ack
 = 
¦ack
;

1583 
num_ü™_v”‹xs_š_Ëv–_0
 = 0;

1584 
i
 = 0; i < 
num_v”‹xs_©_Ëv–_0
; ++i) {

1585 
ivex
 = 
Šodes_©_Ëv–
[0].
li¡
[
i
];

1586 
¦ack
 = 
v”‹xes
[
ivex
].
»q_time
 - v”‹xes[ivex].
¬r_time
;

1587 ià(
¦ack
 =ğ
mš_¦ack
) {

1588 ++
num_ü™_v”‹xs_š_Ëv–_0
;

1591 ià(
num_ü™_v”‹xs_š_Ëv–_0
 > 1) {

1592 
	`´štf
("Attention! There‡re %d critical vertexs in Level 0.\n",

1593 
num_ü™_v”‹xs_š_Ëv–_0
);

1596 
t_lšked_št
* 
ü™iÿl_·th_h—d
 =

1597 (
t_lšked_št
*)
	`my_m®loc
((t_linked_int));

1598 
ü™iÿl_·th_h—d
->
d©a
 = 
ü™_node
;

1599 
num_out_edges
 = 
v”‹xes
[
ü™_node
].num_out_edges;

1601 
t_lšked_št
* 
cu¼_ü™_node
 = 
NULL
;

1602 
edge_t
* 
‹dge
 = 
NULL
;

1603 
t_lšked_št
* 
´ev_ü™_node
 = 
ü™iÿl_·th_h—d
;

1604 
num_out_edges
 != 0) {

1605 
cu¼_ü™_node
 = (
t_lšked_št
*)
	`my_m®loc
((t_linked_int));

1606 
´ev_ü™_node
->
Ãxt
 = 
cu¼_ü™_node
;

1607 
‹dge
 = 
v”‹xes
[
ü™_node
].
out_edges
;

1608 
mš_¦ack
 = 
HUGE_FLOAT
;

1610 
›dge
 = 0; iedg< 
num_out_edges
; ++iedge) {

1611 
to_node
 = 
‹dge
[
›dge
].to_node;

1612 
¦ack
 = 
v”‹xes
[
to_node
].
»q_time
 - v”‹xes[to_node].
¬r_time
;

1614 ià(
¦ack
 < 
mš_¦ack
) {

1615 
ü™_node
 = 
to_node
;

1616 
mš_¦ack
 = 
¦ack
;

1620 
cu¼_ü™_node
->
d©a
 = 
ü™_node
;

1621 
´ev_ü™_node
 = 
cu¼_ü™_node
;

1622 
num_out_edges
 = 
v”‹xes
[
ü™_node
].num_out_edges;

1625 
´ev_ü™_node
->
Ãxt
 = 
NULL
;

1626  (
ü™iÿl_·th_h—d
);

1627 
	}
}

1632 
	$g‘_Šode_block_ªd_ouut_Ãt
(
ivex
,

1633 * 
iblk_±r
,

1634 * 
š‘_±r
)

1636 
š‘
, 
š
;

1637 
iblk
 = 
Šode_desüt
[
ivex
].iblk;

1639 
v”‹x_ty³_t
 
Šode_ty³
 = 
Šode_desüt
[
ivex
].
ty³
;

1640 ià(
Šode_ty³
 =ğ
CLB_OPIN
 ||node_ty³ =ğ
INPAD_OPIN
) {

1641 
š
 = 
Šode_desüt
[
ivex
].ipin;

1642 
š‘
 = 
blocks
[
iblk
].
Ãts
[
š
];

1644 
š‘
 = 
OPEN
;

1647 *
iblk_±r
 = 
iblk
;

1648 *
š‘_±r
 = 
š‘
;

1649 
	}
}

1653 
	$do_cÚ¡ªt_Ãt_d–ay_timšg_ª®ysis
(
¶aûr_İts_t
 
¶aûr_İts
,

1654 
timšg_šfo_t
 
timšg_šf
,

1655 
subblock_d©a_t
 
subblock_d©a
,

1656 
cÚ¡ªt_Ãt_d–ay_v®ue
)

1658 
	`®loc_ªd_lßd_timšg_g¿ph
(&
¶aûr_İts
,

1659 
timšg_šf
,

1660 
subblock_d©a
);

1661 ** 
Ãt_¦ack
 = 
	`®loc_Ãt_¦ack
();

1662 
lšked_v±r_t
* 
Ãt_d–ay_chunk_li¡_h—d
 = 
NULL
;

1663 ** 
Ãt_d–ay
 = 
	`®loc_Ãt_d–ay
(&
Ãt_d–ay_chunk_li¡_h—d
);

1665 
	`lßd_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
,

1666 
cÚ¡ªt_Ãt_d–ay_v®ue
);

1668 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

1670 
T_ü™
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

1671 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

1673 
	`´štf
("\n");

1674 
	`´št_ü™iÿl_·th
("critical_path.echo");

1675 
	`´štf
("\nCr™iÿÈP©h: %g (s)\n", 
T_ü™
);

1679 
	`ä“_timšg_g¿ph
(
Ãt_¦ack
);

1680 
	`ä“_Ãt_d–ay
(
Ãt_d–ay
,

1681 &
Ãt_d–ay_chunk_li¡_h—d
);

1682 
	}
}

	@path_delay.h

1 #iâdeà
PATH_DELAY_H


2 
	#PATH_DELAY_H


	)

4 
	~"v´_ty³s.h
"

10 ** 
	gblock_pš_to_Šode
;

15 *** 
	gsblk_pš_to_Šode
;

21 
®loc_ªd_lßd_timšg_g¿ph
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

22 
timšg_šfo_t
 
timšg_šf
,

23 
subblock_d©a_t
 
subblock_d©a
);

25 
t_lšked_št
* 
®loÿ‹_ªd_lßd_ü™iÿl_·th
();

27 
lßd_timšg_g¿ph_Ãt_d–ays
(** 
Ãt_d–ay
);

32 ** 
®loc_Ãt_¦ack
();

34 
ÿlc_®l_v”‹xs_¬r_»q_time
(
rg‘_cyşe_time
);

36 
compu‹_Ãt_¦acks
(** 
Ãt_¦ack
);

38 
ä“_timšg_g¿ph
(** 
Ãt_¦ack
);

40 
ä“_subblock_d©a
(
subblock_d©a_t
* 
subblock_d©a_±r
);

42 
´št_timšg_g¿ph
(* 
âame
);

44 
´št_Ãt_¦ack
(* 
âame
, ** 
Ãt_¦ack
);

46 
´št_ü™iÿl_·th
(* 
âame
);

48 
g‘_Šode_block_ªd_ouut_Ãt
(
ivex
,

49 * 
iblk_±r
,

50 * 
š‘_±r
);

52 
do_cÚ¡ªt_Ãt_d–ay_timšg_ª®ysis
(
¶aûr_İts_t
 
¶aûr_İts
,

53 
timšg_šfo_t
 
timšg_šf
,

54 
subblock_d©a_t
 
subblock_d©a
,

55 
cÚ¡ªt_Ãt_d–ay_v®ue
);

58 ** 
subÃt_loÿl_ü™_weight
;

60 * 
äÚt_ü™_·th_through_pš
;

61 * 
behšd_ü™_·th_through_pš
;

66 
compu‹_®l_Ãts_loÿl_ü™_weight
(** 
Ãt_¦ack
,

67 ** 
block_pš_to_Šode
,

68 cÚ¡ 
ü™_d–ay
);

71 
loÿ‹_sourû_v”‹x_šdex_by_Ãt_šdex
(cÚ¡ 
š‘
);

73 
fšd_sšk_v”‹x_šdex_by_Ãt_ªd_pš_šdex
(cÚ¡ 
š‘
,

74 cÚ¡ 
š
,

75 ** 
block_pš_to_Šode
);

77 
check_block_pš_to_Šode
(** 
block_pš_to_Šode
);

79 
check_v”‹xs_Ëv–s
();

	@path_delay2.c

1 
	~"ut.h
"

2 
	~"v´_ty³s.h
"

3 
	~"glob®s.h
"

4 
	~"·th_d–ay2.h
"

8 
v”‹x_t
* 
	gv”‹xes
;

9 
	gnum_of_v”‹xs
;

11 
v”‹x_desüt
* 
	gŠode_desüt
;

15 * 
	gdriv”_node_šdex_of_Ãt
;

20 
veùÜ_t
* 
	gŠodes_©_Ëv–
;

21 
	gnum_Šode_Ëv–s
;

25 * 
®loc_ªd_lßd_Šode_çnš_ªd_check_edges
(* 
num_sšks_±r
);

29 * 
	$®loc_ªd_lßd_Šode_çnš_ªd_check_edges
(* 
num_sšks_±r
)

34 * 
®l_v”‹xs_çnš_v®ue
 = (*)
	`my_ÿÎoc
(
num_of_v”‹xs
,

36 
”rÜ
 = 0;

37 
num_sšks
 = 0;

39 
ivex
 = -1;

40 
ivex
 = 0; ivex < 
num_of_v”‹xs
; ++ivex) {

41 
num_out_edges
 = 
v”‹xes
[
ivex
].num_out_edges;

42 ià(
num_out_edges
 > 0) {

43 
edge_t
* 
‹dge
 = 
v”‹xes
[
ivex
].
out_edges
;

45 
›dge
 = 0;

46 
›dge
 = 0; iedg< 
num_out_edges
; ++iedge) {

47 
to_node
 = 
‹dge
[
›dge
].to_node;

48 ià(
to_node
 < 0 ||o_nod>ğ
num_of_v”‹xs
) {

49 
	`´štf
("Error in‡lloc_and_load_tnode_fanin_and_check_edges:\n"

50 "v”‹xe #%dƒdg#%d gÛ tØËg®‚od#%d.\n", 
ivex
,

51 
›dge
, 
to_node
);

52 ++
”rÜ
;

55 ++
®l_v”‹xs_çnš_v®ue
[
to_node
];

57 } ià(
num_out_edges
 == 0) {

58 ++
num_sšks
;

60 
	`´štf
("Error in‡lloc_and_load_tnode_fanin_and_check_edges: \n"

61 "v”‹xe #%d ha %dƒdges.\n", 
ivex
, 
num_out_edges
);

62 ++
”rÜ
;

66 ià(
”rÜ
 != 0) {

67 
	`´štf
("Found %d E¼Ü šhtimšg g¿ph. AbÜtšg.\n", 
”rÜ
);

68 
	`ex™
(1);

70 *
num_sšks_±r
 = 
num_sšks
;

72  
®l_v”‹xs_çnš_v®ue
;

73 
	}
}

80 
	$®loc_ªd_lßd_timšg_g¿ph_edge_Ëv–s
()

82 
num_sšks
 = -1;

86 * 
Šode_çnš_Ëá
 = 
	`®loc_ªd_lßd_Šode_çnš_ªd_check_edges
(&
num_sšks
);

90 
Šodes_©_Ëv–
 = (
veùÜ_t
*)
	`my_m®loc
((
num_of_v”‹xs
 + 1) *

91 (
veùÜ_t
));

94 
t_lšked_št
* 
ä“_li¡_h—d
 = 
NULL
;

95 
t_lšked_št
* 
nodes_©_Ëv–_h—d
 = 
NULL
;

96 
z”o_çnš_©_Ëv–
 = 0;

97 
äom_node
 = 0;

99 
äom_node
 = 0; from_nod< 
num_of_v”‹xs
; ++from_node) {

100 ià(
Šode_çnš_Ëá
[
äom_node
] == 0) {

101 ++
z”o_çnš_©_Ëv–
;

102 
nodes_©_Ëv–_h—d
 = 
	`š£¹_š_št_li¡
(nodes_at_level_head,

103 
äom_node
,

104 &
ä“_li¡_h—d
);

109 
	`®loc_iveùÜ_ªd_cİy_št_li¡
(&
nodes_©_Ëv–_h—d
,

110 
z”o_çnš_©_Ëv–
,

111 &
Šodes_©_Ëv–
[0],

112 &
ä“_li¡_h—d
);

113 
num_Ëv–s
 = 0;

114 
z”o_çnš_©_Ëv–
 != 0) {

115 ++
num_Ëv–s
;

116 
z”o_çnš_©_Ëv–
 = 0;

118 
i
 = 0;

119 
i
 = 0; i < 
Šodes_©_Ëv–
[
num_Ëv–s
 - 1].
ÃËm
; ++i) {

120 
äom_node
 = 
Šodes_©_Ëv–
[
num_Ëv–s
 - 1].
li¡
[
i
];

121 
edge_t
* 
‹dge
 = 
v”‹xes
[
äom_node
].
out_edges
;

122 
num_out_edges
 = 
v”‹xes
[
äom_node
].num_out_edges;

124 
›dge
 = 0;

125 
›dge
 = 0; iedg< 
num_out_edges
; ++iedge) {

126 
to_node
 = 
‹dge
[
›dge
].to_node;

127 --(
Šode_çnš_Ëá
[
to_node
]);

129 ià(
Šode_çnš_Ëá
[
to_node
] == 0) {

130 ++
z”o_çnš_©_Ëv–
;

131 
nodes_©_Ëv–_h—d
 = 
	`š£¹_š_št_li¡
(nodes_at_level_head,

132 
to_node
,

133 &
ä“_li¡_h—d
);

138 
	`®loc_iveùÜ_ªd_cİy_št_li¡
(&
nodes_©_Ëv–_h—d
,

139 
z”o_çnš_©_Ëv–
,

140 &
Šodes_©_Ëv–
[
num_Ëv–s
],

141 &
ä“_li¡_h—d
);

144 
Šodes_©_Ëv–
 = (
veùÜ_t
*)
	`my_»®loc
(tnodes_at_level,

145 
num_Ëv–s
 * (
veùÜ_t
));

146 
num_Šode_Ëv–s
 = 
num_Ëv–s
;

148 
	`ä“
(
Šode_çnš_Ëá
);

149 
	`ä“_št_li¡
(&
ä“_li¡_h—d
);

151  
num_sšks
;

152 
	}
}

159 
	$check_timšg_g¿ph
(
num_cÚ¡_g’
,

160 
num_ff
,

161 
num_sšks
)

163 
”rÜ
 = 0;

164 
num_Šodes_check
 = 0;

165 
	`´štf
("In check_timing_graph:otal_vertexs = %d,‚um_const_gen: %d,‚um_ff: %d,‚um_sinks: %d.\n",

166 
num_of_v”‹xs
,

167 
num_cÚ¡_g’
,

168 
num_ff
,

169 
num_sšks
);

171 
ev–
 = -1;

172 
ev–
 = 0; iËv– < 
num_Šode_Ëv–s
; ++ilevel) {

173 
num_Šodes_check
 +ğ
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

176 ià(
num_Šodes_check
 !ğ
num_of_v”‹xs
) {

177 
	`´štf
("Error in check_timing_graph: %dnodes‡ppear inhe vertexes†evel "

178 "¡ruùu». Ex³ùed %d.\n", 
num_Šodes_check
, 
num_of_v”‹xs
);

179 
	`´štf
("Checkhe‚etlist for combinational cycles.\n");

180 ++
”rÜ
;

183 ià(
num_cÚ¡_g’
 + 
num_´im¬y_šputs
 !ğ
Šodes_©_Ëv–
[0].
ÃËm
) {

184 
	`´štf
("Error in check_timing_graph: %dnodes‡re sources (have‚o "

186 
Šodes_©_Ëv–
[0].
ÃËm
,

187 
num_cÚ¡_g’
 + 
num_´im¬y_šputs
);

188 ++
”rÜ
;

191 ià(
num_sšks
 !ğ
num_´im¬y_ouuts
 + 
num_ff
) {

192 
	`´štf
("Error in check_timing_graph: %dnodes‡re sinks (have‚o "

194 
num_sšks
,

195 
num_ff
 + 
num_´im¬y_ouuts
);

196 ++
”rÜ
;

199 
š‘
 = -1;

200 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

201 
ivex
 = 
driv”_node_šdex_of_Ãt
[
š‘
];

202 ià(
ivex
 < 0 || ivex >ğ
num_of_v”‹xs
) {

203 
	`´štf
("Error in check_timing_graph:\n"

205 
š‘
,

206 
ivex
);

207 ++
”rÜ
;

211 ià(
”rÜ
 != 0) {

212 
	`´štf
("Found %d E¼Ü šhtimšg g¿ph. AbÜtšg.\n", 
”rÜ
);

213 
	`ex™
(1);

215 
	}
}

217 
	$´št_ü™iÿl_·th_node
(
FILE
* 
å
,

218 
t_lšked_št
* 
ü™iÿl_·th_node
)

222 * 
Šode_ty³_Çmes
[] = {"INPAD_SOURCE", "INPAD_OPIN",

229 
ivex
 = 
ü™iÿl_·th_node
->
d©a
;

230 
iblk
 = 
Šode_desüt
[
ivex
].iblk;

231 
š
 = 
Šode_desüt
[
ivex
].ipin;

232 
v”‹x_ty³_t
 
ty³
 = 
Šode_desüt
[
ivex
].type;

233 
	`årštf
(
å
, "Node: %d % Block #%d (%s)\n", 
ivex
, 
Šode_ty³_Çmes
[
ty³
],

234 
iblk
, 
blocks
[iblk].
Çme
);

236 ià(
ty³
 !ğ
INPAD_SOURCE
 &&y³ !ğ
OUTPAD_SINK
 &&y³ !ğ
FF_SINK
 &&

237 
ty³
 !ğ
FF_SOURCE
 &&y³ !ğ
CONSTANT_GEN_SOURCE
) {

238 
	`årštf
(
å
, "Pš: %d ", 
š
);

241 ià(
ty³
 =ğ
SUBBLK_IPIN
 ||y³ =ğ
SUBBLK_OPIN
 ||y³ =ğ
FF_SINK


242 || 
ty³
 =ğ
FF_SOURCE
 ||y³ =ğ
CONSTANT_GEN_SOURCE
) {

243 
	`årštf
(
å
, "Subblock #%d ", 
Šode_desüt
[
ivex
].
isubblk
);

246 ià(
ty³
 !ğ
INPAD_SOURCE
 &&y³ !ğ
OUTPAD_SINK
) {

247 
	`årštf
(
å
, "\n");

250 
	`årštf
(
å
, "arr_time: %g„eq_time: %g ",

251 
v”‹xes
[
ivex
].
¬r_time
,

252 
v”‹xes
[
ivex
].
»q_time
);

253 
t_lšked_št
* 
Ãxt_ü™_node
 = 
ü™iÿl_·th_node
->
Ãxt
;

255 
Td–
 = 0.0;

256 
down¡»am_node
 = 0;

257 ià(
Ãxt_ü™_node
 !ğ
NULL
) {

258 
down¡»am_node
 = 
Ãxt_ü™_node
->
d©a
;

259 
Td–
 = 
v”‹xes
[
down¡»am_node
].
¬r_time
 - v”‹xes[
ivex
].arr_time;

260 
	`årštf
(
å
, "Td–: %g\n", 
Td–
);

262 
Td–
 = 0.0;

263 
	`årštf
(
å
, "\n");

266 
š‘
 = 0;

267 ià(
ty³
 =ğ
INPAD_OPIN
 ||y³ =ğ
CLB_OPIN
) {

268 
š‘
 = 
blocks
[
iblk
].
Ãts
[
š
];

269 
	`årštf
(
å
, "N‘ØÃxˆnode: #%d (%s). Pš Ú‚‘: %d.\n", 
š‘
,

270 
Ãt
[
š‘
].
Çme
,‚‘[š‘].
num_Ãt_pšs
);

273 
	`årštf
(
å
, "\n");

274  (
Td–
);

275 
	}
}

	@path_delay2.h

1 #iâdeà
PATH_DELAY2_H


2 
	#PATH_DELAY2_H


	)

4 
	~<¡dio.h
>

5 
	~"ut.h
"

10 
	ss_edge_t
 {

12 
	mto_node
;

13 
	mTd–
;

14 } 
	tedge_t
;

21 
	ss_v”‹x_t
 {

22 
edge_t
* 
	mout_edges
;

23 
	mnum_out_edges
;

25 
edge_t
* 
	mš_edges
;

26 
	mnum_·»Ás
;

31 
	m¬r_time
;

32 
	m»q_time
;

33 } 
	tv”‹x_t
;

39 
	es_v”‹x_ty³_t
 {

40 
	mINPAD_SOURCE
,

41 
	mINPAD_OPIN
,

43 
	mOUTPAD_IPIN
,

44 
	mOUTPAD_SINK
,

46 
	mCLB_IPIN
,

47 
	mCLB_OPIN
,

49 
	mSUBBLK_IPIN
,

50 
	mSUBBLK_OPIN
,

52 
	mFF_SINK
,

53 
	mFF_SOURCE
,

55 
	mCONSTANT_GEN_SOURCE


56 } 
	tv”‹x_ty³_t
;

64 
v”‹x_ty³_t
 
	mty³
;

65 
	mš
;

66 
	misubblk
;

67 
	miblk
;

68 } 
	tv”‹x_desüt
;

71 
v”‹x_t
* 
v”‹xes
;

72 
v”‹x_desüt
* 
Šode_desüt
;

74 
num_of_v”‹xs
;

77 * 
driv”_node_šdex_of_Ãt
;

81 
veùÜ_t
* 
Šodes_©_Ëv–
;

82 
num_Šode_Ëv–s
;

90 * 
	gäÚt_ü™_·th_through_pš
;

91 * 
	gbehšd_ü™_·th_through_pš
;

94 
®loc_ªd_lßd_timšg_g¿ph_edge_Ëv–s
();

96 
check_timšg_g¿ph
(
num_cÚ¡_g’
,

97 
num_ff
,

98 
num_sšks
);

100 
´št_ü™iÿl_·th_node
(
FILE
* 
å
,

101 
t_lšked_št
* 
ü™iÿl_·th_node
);

	@path_delay_parallel.c

1 
	~<¡dio.h
>

2 
	~<as£¹.h
>

4 
	~"ut.h
"

5 
	~"glob®s.h
"

6 
	~"·th_d–ay_·¿Î–.h
"

7 
	~"·th_d–ay2.h
"

8 
	~"Ãt_d–ay.h
"

9 
	~"v´_uts.h
"

76 
	#T_CONSTANT_GENERATOR
 -1000

	)

79 
	ee_subblock_pš_ty³
 {

80 
	mSUB_INPUT
 = 0,

81 
	mSUB_OUTPUT
,

82 
	mSUB_CLOCK
,

83 
	mNUM_SUB_PIN_TYPES


92 
	$lßd_timšg_g¿ph_Ãt_d–ays_·¿Î–
(** 
Ãt_d–ay
,

93 
¡¬t_Ãt
,

94 
fšish_Ãt
)

96 
sšks
 = 0;

97 
š‘
 = 0;

98 
š‘
 = 
¡¬t_Ãt
; iÃˆ< 
fšish_Ãt
; ++inet) {

99 
šode
 = 
driv”_node_šdex_of_Ãt
[
š‘
];

100 
edge_t
* 
‹dge
 = 
v”‹xes
[
šode
].
out_edges
;

101 
sšks
 +ğ()
Ãt
[
š‘
].
num_Ãt_pšs
;

105 
š
 = 0;

106 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

108 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

109 
‹dge
[
š
 - 1].
Td–
 = 
Ãt_d–ay
[
š‘
][ipin];

110 
to_node
 = 
‹dge
[
š
 - 1].to_node;

112 
couÁ”
 = -1;

113 
couÁ”
 = 0; couÁ” < 
v”‹xes
[
to_node
].
num_·»Ás
; ++counter) {

114 ià(
v”‹xes
[
to_node
].
š_edges
[
couÁ”
].to_nod!ğ
šode
) {

118 
v”‹xes
[
to_node
].
š_edges
[
couÁ”
].
Td–
 = 
Ãt_d–ay
[
š‘
][
š
];

122 ià(
couÁ”
 =ğ
v”‹xes
[
to_node
].
num_·»Ás
) {

123 
	`´štf
("disrepency between fanout‡nd fanin‚odes\n");

124 
	`ex™
(-1);

129  
sšks
;

130 
	}
}

158 
	$ÿlc_Šodes_¬r_time_·¿Î–
(
¡¬t_node
,

159 
fšish_node
,

160 
ev–
)

165 
T_ü™
 = 0.0;

167 
i
 = 0;

168 
i
 = 
¡¬t_node
; i < 
fšish_node
; ++i) {

169 
šode
 = 
Šodes_©_Ëv–
[
ev–
].
li¡
[
i
];

170 
num_·»Á_edges
 = 
v”‹xes
[
šode
].
num_·»Ás
;

171 
edge_t
* 
‹dge
 = 
v”‹xes
[
šode
].
š_edges
;

173 
›dge
 = -1;

174 
›dge
 = 0; iedg< 
num_·»Á_edges
; ++iedge) {

175 
äom_node
 = 
‹dge
[
›dge
].
to_node
;

176 
¬r_time
 = 
v”‹xes
[
äom_node
].arr_time;

177 
Td–
 = 
‹dge
[
›dge
].Tdel;

178 
v”‹xes
[
šode
].
¬r_time
 = 
	`max
(vertexes[inode].arr_time,

179 
¬r_time
 + 
Td–
);

182 
T_ü™
 = 
	`max
(T_ü™, 
v”‹xes
[
šode
].
¬r_time
);

185  
T_ü™
;

186 
	}
}

193 
	$ÿlc_Šodes_»q_time_·¿Î–
(
T_cyşe
,

194 
¡¬t_node
,

195 
fšish_node
,

196 
ev–
)

200 
i
 = 0;

201 
i
 = 
¡¬t_node
; i < 
fšish_node
; ++i) {

202 
šode
 = 
Šodes_©_Ëv–
[
ev–
].
li¡
[
i
];

204 
num_out_edges
 = 
v”‹xes
[
šode
].num_out_edges;

205 ià(
num_out_edges
 == 0) {

207 
v”‹xes
[
šode
].
»q_time
 = 
T_cyşe
;

209 
edge_t
* 
‹dge
 = 
v”‹xes
[
šode
].
out_edges
;

210 
to_node
 = 
‹dge
[0].to_node;

211 
Td–
 = 
‹dge
[0].Tdel;

212 
»q_time
 = 
v”‹xes
[
to_node
].»q_tim- 
Td–
;

214 
›dge
 = 0;

215 
›dge
 = 1; iedg< 
num_out_edges
; ++iedge) {

216 
to_node
 = 
‹dge
[
›dge
].to_node;

217 
Td–
 = 
‹dge
[
›dge
].Tdel;

218 
»q_time
 = 
	`mš
Ôeq_time, 
v”‹xes
[
to_node
].»q_tim- 
Td–
);

220 
v”‹xes
[
šode
].
»q_time
 =„eq_time;

223 
	}
}

230 
	$compu‹_Ãt_¦acks_·¿Î–
(** 
Ãt_¦ack
,

231 
¡¬t_Ãt
,

232 
fšish_Ãt
)

234 
couÁ_wÜk
 = 0;

235 
š‘
 = 0;

236 
š‘
 = 
¡¬t_Ãt
; iÃˆ< 
fšish_Ãt
; ++inet) {

237 cÚ¡ 
driv”_node
 = 
driv”_node_šdex_of_Ãt
[
š‘
];

238 cÚ¡ 
¬r_time
 = 
v”‹xes
[
driv”_node
].arr_time;

239 
edge_t
* 
‹dge
 = 
v”‹xes
[
driv”_node
].
out_edges
;

241 cÚ¡ 
num_out_edges
 = 
v”‹xes
[
driv”_node
].num_out_edges;

242 
couÁ_wÜk
 +ğ()
num_out_edges
;

244 
›dge
 = -1;

245 
›dge
 = 0; iedg< 
num_out_edges
; ++iedge) {

246 cÚ¡ 
to_node
 = 
‹dge
[
›dge
].to_node;

247 cÚ¡ 
Td–
 = 
‹dge
[
›dge
].Tdel;

248 cÚ¡ 
»q_time
 = 
v”‹xes
[
to_node
].req_time;

249 
Ãt_¦ack
[
š‘
][
›dge
 + 1] = 
»q_time
 - 
¬r_time
 - 
Td–
;

253  
couÁ_wÜk
;

254 
	}
}

	@path_delay_parallel.h

1 #iâdeà
PATH_DELAY_PARALLEL_H


2 
	#PATH_DELAY_PARALLEL_H


	)

4 
	~"v´_ty³s.h
"

6 
lßd_timšg_g¿ph_Ãt_d–ays_·¿Î–
(** 
Ãt_d–ay
,

7 
¡¬t
,

8 
fšish
);

10 
ÿlc_Šodes_¬r_time_·¿Î–
(
¡¬t_node
,

11 
fšish_node
,

12 
ev–
);

14 
ÿlc_Šodes_»q_time_·¿Î–
(
T_cyşe
,

15 
¡¬t_node
,

16 
fšish_node
,

17 
ev–
);

19 
compu‹_Ãt_¦acks_·¿Î–
(** 
Ãt_¦ack
,

20 
¡¬t_Ãt
,

21 
fšish_Ãt
);

	@place.c

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

3 
	~<as£¹.h
>

4 
	~<¡ršg.h
>

5 
	~<time.h
>

7 
	~"ut.h
"

8 
	~"glob®s.h
"

9 
	~"¶aû.h
"

10 
	~"»ad_¶aû.h
"

11 
	~"d¿w.h
"

12 
	~"¶aû_ªd_rou‹.h
"

13 
	~"Ãt_d–ay.h
"

14 
	~"·th_d–ay.h
"

15 
	~"timšg_¶aû_lookup.h
"

16 
	~"timšg_¶aû.h
"

17 
	~"·th_d–ay2.h
"

18 
	~"v´_uts.h
"

20 
	#SMALL_NET
 4

	)

23 
	#FROM
 0

	)

24 
	#TO
 1

	)

25 
	#FROM_AND_TO
 2

	)

27 
	#ERROR_TOL
 0.001

	)

28 
	#MAX_MOVES_BEFORE_RECOMPUTE
 1000000

	)

38 * 
	gdu¶iÿ‹_pšs
;

42 ** 
	gunique_pš_li¡
;

45 * 
	gÃt_co¡
 = 
NULL
;

46 * 
	g‹mp_Ãt_co¡
 = 
NULL
;

51 ** 
	gpošt_to_pošt_timšg_co¡
 = 
NULL
;

52 ** 
	g‹mp_pošt_to_pošt_timšg_co¡
 = 
NULL
;

57 ** 
	gpošt_to_pošt_d–ay_co¡
 = 
NULL
;

58 ** 
	g‹mp_pošt_to_pošt_d–ay_co¡
 = 
NULL
;

65 ** 
	gÃt_pš_šdex
 = 
NULL
;

68 
bbox_t
* 
	gbb_coÜds
 = 
NULL
;

72 
bbox_t
* 
	gbb_num_Ú_edges
 = 
NULL
;

78 
¶aû_»giÚ_t
** 
	g¶aû_»giÚ_x
 = 
NULL
;

79 
¶aû_»giÚ_t
** 
	g¶aû_»giÚ_y
 = 
NULL
;

82 * 
	g¶aû_»giÚ_bounds_x
;

83 * 
	g¶aû_»giÚ_bounds_y
;

87 
	güoss_couÁ
[50] = {

102 ** 
	gchªx_¶aû_co¡_çc
 = 
NULL
;

103 ** 
	gchªy_¶aû_co¡_çc
 = 
NULL
;

106 
š™Ÿl_¶aûm’t
(
·d_loc_t
 
·d_loc_ty³
,

107 * 
·d_loc_fe
);

109 
run_maš_¶aûm’t
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

110 cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

111 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

112 ** 
Şd_»giÚ_occ_x
,

113 ** 
Şd_»giÚ_occ_y
,

114 ** 
Ãt_¦ack
,

115 ** 
Ãt_d–ay
,

116 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

118 
run_low_‹m³¿tu»_¶aû
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

119 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

120 ** 
Şd_»giÚ_occ_x
,

121 ** 
Şd_»giÚ_occ_y
,

122 ** 
Ãt_¦ack
,

123 ** 
Ãt_d–ay
,

124 
¶aûr_co¡s_t
* 
¶aûr_co¡_±r
);

126 
³rfÜm_timšg_ª®yze
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

127 ** 
Ãt_d–ay
,

128 ** 
Ãt_¦ack
,

129 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

130 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

132 
»compu‹_td_co¡_aá”_sw­_û¹aš_times
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

133 cÚ¡ 
šÃr_™”
,

134 ** 
Ãt_d–ay
,

135 ** 
Ãt_¦ack
,

136 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

137 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

139 
compu‹_timšg_driv’_co¡
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

140 cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

141 ** 
Ãt_¦ack
,

142 ** 
block_pš_to_Šode
,

143 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

145 
upd©e_¶aû_co¡_aá”_max_move_times
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

146 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

148 
compu‹_timšg_driv’_co¡_š_ou‹r_loİ
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

149 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

151 
upd©e_¶aû_co¡s_by_sucûss_sum
(cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s
,

152 
¶aûr_co¡s_t
* 
¶aûr_İts_±r
);

155 
couÁ_cÚÃùiÚs
();

157 
compu‹_Ãt_pš_šdex_v®ues
();

159 
g‘_¡d_dev
(
n
,

160 
sum_x_squ¬ed
,

161 
av_x
);

163 
¡¬tšg_‹m³¿tu»
(cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

164 cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

165 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

166 ** 
Şd_»giÚ_occ_x
,

167 ** 
Şd_»giÚ_occ_y
,

168 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

170 
upd©e_‹m³¿tu»
(* 
t
,

171 
¾im
,

172 
sucûss_¿tio
,

173 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
);

175 
upd©e_¿nge_lim™
(* 
¾im
,

176 
sucûss_¿tio
);

178 
upd©e_ü™_expÚ’t
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

179 cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
);

181 
ex™_ü™
(
t
,

182 
tÙ®_co¡
,

183 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
);

192 
Œy_sw­
(cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

193 cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

194 ** 
Şd_»giÚ_occ_x
,

195 ** 
Şd_»giÚ_occ_y
,

196 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

200 
®loc_ªd_lßd_¶aûm’t_¡ruùs
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

201 *** 
Şd_»giÚ_occ_x
,

202 *** 
Şd_»giÚ_occ_y
);

204 
ä“_¶aûm’t_¡ruùs
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

205 ** 
Şd_»giÚ_occ_x
,

206 ** 
Şd_»giÚ_occ_y
);

209 
®loc_¶aû_»giÚs
(
num_»giÚs
);

211 
lßd_¶aû_»giÚs
(
num_»giÚs
);

213 
upd©e_»giÚ_occ
(
š‘
, 
bbox_t
* 
coÜds
,

214 
add_Ü_sub
, 
num_»giÚs
);

216 
§ve_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

217 ** 
Şd_»giÚ_occ_y
, 
num_»giÚs
);

219 
»¡Üe_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

220 ** 
Şd_»giÚ_occ_y
, 
num_»giÚs
);

222 
ä“_¶aû_»giÚs
(
num_»giÚs
);

225 
®loc_ªd_lßd_unique_pš_li¡
();

227 
ä“_unique_pš_li¡
();

230 
fšd_afãùed_Ãts
(* 
Ãts_to_upd©e
,

231 * 
Ãt_block_moved
,

232 
äom_block
,

233 
to_block
,

234 
num_of_pšs
);

236 
fšd_to
(
x_äom
,

237 
y_äom
,

238 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

239 
¾im
,

240 * 
x_to
,

241 * 
y_to
);

243 
as£ss_sw­
(
d–_co¡
, 
t
);

245 
»compu‹_bb_co¡
(
¶aû_co¡_ty³
,

246 
num_»giÚs
);

249 
compu‹_pošt_to_pošt_d–ay
(
š‘
,

250 
š
);

252 
upd©e_timšg_driv’_co¡
(
äom_block
,

253 
to_block
,

254 
num_of_pšs
);

256 
compu‹_d–_timšg_driv’_co¡
(
¶aû_®gÜ™hm_t
 
¶aû_®go
,

257 
äom_block
,

258 
to_block
,

259 
num_of_pšs
,

260 * 
d–_timšg
,

261 * 
d–_d–ay
);

268 
compu‹_timšg_driv’_co¡_by_Üig_®go
(* 
timšg_co¡
,

269 * 
cÚÃùiÚ_d–ay_sum
);

272 
num_of_v”‹xs
;

273 
v”‹x_t
* 
v”‹xes
;

274 * 
driv”_node_šdex_of_Ãt
;

279 
compu‹_timšg_driv’_co¡s_by_·th_®go
(* 
tÙ®_timšg_co¡
,

280 * 
cÚÃùiÚ_d–ay_sum
);

282 
compu‹_bb_co¡
(
m‘hod
,

283 
¶aû_co¡_ty³
,

284 
num_»giÚs
);

286 
nÚlš—r_cÚg_co¡
(
num_»giÚs
);

288 
g‘_Ãt_co¡
(
š‘
,

289 
bbox_t
* 
bb_±r
);

291 
g‘_bb_äom_sü©ch
(
š‘
, 
bbox_t
* 
coÜds
,

292 
bbox_t
* 
num_Ú_edges
);

294 
g‘_nÚ_upd©—bË_bb
(
š‘
,

295 
bbox_t
* 
bb_coÜd_Ãw
);

297 
upd©e_bb
(
š‘
,

298 
bbox_t
* 
bb_coÜd_Ãw
,

299 
bbox_t
* 
bb_edge_Ãw
,

300 
xŞd
,

301 
yŞd
,

302 
xÃw
,

303 
yÃw
);

305 
®loc_ªd_lßd_fÜ_ç¡_co¡_upd©e
(
¶aû_co¡_exp
);

307 
ä“_ç¡_co¡_upd©e_¡ruùs
();

309 
check_¶aû
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

310 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
);

318 
	$Œy_¶aû
(cÚ¡ * 
Ãi¡_fe
,

319 cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

320 cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

321 
chª_width_di¡r_t
 
chª_width_di¡
,

322 
rou‹r_İts_t
 
rou‹r_İts
,

323 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

324 
£gm’t_šfo_t
* 
£gm’t_šf
,

325 
timšg_šfo_t
 
timšg_šf
,

326 
subblock_d©a_t
* 
subblock_d©a_±r
)

330 ** 
Ãt_¦ack
 = 
NULL
;

331 ** 
Ãt_d–ay
 = 
NULL
;

332 ** 
»memb”_Ãt_d–ay_Üigš®_±r
 = 
NULL
;

333 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

335 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


336 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


338 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE


339 || 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

341 
	`®loc_ªd_lßd_timšg_g¿ph
(
¶aûr_İts_±r
,

342 
timšg_šf
,

343 *
subblock_d©a_±r
);

344 
Ãt_¦ack
 = 
	`®loc_Ãt_¦ack
();

345 
	`as£¹
(
Ãt_¦ack
 !ğ
NULL
);

347 
	`®loc_d–ay_lookup_m©rixes_ªd_ü™iÿl™›s
(
¶aûr_İts_±r
,

348 *
subblock_d©a_±r
,

349 
chª_width_di¡
,

350 
timšg_šf
,

351 
rou‹r_İts
,

352 
d‘_routšg_¬ch
,

353 
£gm’t_šf
,

354 &
Ãt_d–ay
);

355 
»memb”_Ãt_d–ay_Üigš®_±r
 = 
Ãt_d–ay
;

364 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
 = 
	`š™_¶aûr_·¿s
();

365 
¶aûr_·¿s_±r
->
m_width_çùÜ
 = 
¶aûr_İts_±r
->
¶aû_chª_width
;

367 ià(
¶aûr_İts_±r
->
·d_loc_ty³
 =ğ
FREE
) {

368 
¶aûr_·¿s_±r
->
m_fixed_pšs
 = 
FALSE
;

370 
¶aûr_·¿s_±r
->
m_fixed_pšs
 = 
TRUE
;

373 
	`š™_chªÃl_t
(
¶aûr_·¿s_±r
->
m_width_çùÜ
,

374 
chª_width_di¡
);

376 ** 
Şd_»giÚ_occ_x
 = 
NULL
;

377 ** 
Şd_»giÚ_occ_y
 = 
NULL
;

378 
	`®loc_ªd_lßd_¶aûm’t_¡ruùs
(
¶aûr_İts_±r
,

379 &
Şd_»giÚ_occ_x
,

380 &
Şd_»giÚ_occ_y
);

383 
	`š™Ÿl_¶aûm’t
(
¶aûr_İts_±r
->
·d_loc_ty³
,

384 
¶aûr_İts_±r
->
·d_loc_fe
);

386 
	`š™_d¿w_coÜds
(()
¶aûr_·¿s_±r
->
m_width_çùÜ
);

391 
g_pšs_Ú_block
 = (*)
	`my_m®loc
(5 * ());

392 
g_pšs_Ú_block
[
B_CLB_TYPE
] = 
max_pšs_³r_şb
;

393 
g_pšs_Ú_block
[
IO_TYPE
] = 1;

394 
g_pšs_Ú_block
[
EMPTY_TYPE
] = 0;

395 
g_pšs_Ú_block
[
OUTPAD_TYPE
] = 1;

396 
g_pšs_Ú_block
[
INPAD_TYPE
] = 1;

398 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
 = 
	`š™_¶aûr_co¡s
();

399 
š‘
 = -1;

400 
š
 = -1;

402 
¶aûr_co¡s_±r
->
m_bb_co¡
 = 
	`compu‹_bb_co¡
(
NORMAL
,

403 
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

404 
¶aûr_İts_±r
->
num_»giÚs
);

406 
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
 = 0;

407 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


408 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


409 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

410 
¶aûr_·¿s_±r
->
m_ü™_expÚ’t
 = 
¶aûr_İts_±r
->
td_¶aû_exp_fœ¡
;

412 
	`compu‹_Ãt_pš_šdex_v®ues
();

414 
¶aûr_·¿s_±r
->
m_num_cÚÃùiÚs
 = 
	`couÁ_cÚÃùiÚs
();

416 
	`´štf
("\nThere‡re %d…ointo…oint connections inhis circuit\n\n",

417 
¶aûr_·¿s_±r
->
m_num_cÚÃùiÚs
);

419 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
) {

420 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

421 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

422 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

423 
timšg_¶aû_ü™
[
š‘
][
š
] = 0.0;

428 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


429 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE
){

430 
	`compu‹_timšg_driv’_co¡_by_Üig_®go
(&
¶aûr_co¡s_±r
->
m_timšg_co¡
,

431 &
¶aûr_co¡s_±r
->
m_d–ay_co¡
);

433 
	`compu‹_timšg_driv’_co¡s_by_·th_®go
(&
¶aûr_co¡s_±r
->
m_timšg_co¡
,

434 &
¶aûr_co¡s_±r
->
m_d–ay_co¡
);

439 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
 =

440 
¶aûr_co¡s_±r
->
m_d–ay_co¡
 / 
¶aûr_·¿s_±r
->
m_num_cÚÃùiÚs
;

444 
	`lßd_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
,

445 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
);

447 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
 = 0;

455 ià(
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


456 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

457 
Ãt_d–ay
 = 
pošt_to_pošt_d–ay_co¡
;

461 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

464 
¶aûr_·¿s_±r
->
m_max_d–ay
 =

465 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
);

467 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

469 
	`compu‹_timšg_driv’_co¡
(
¶aûr_İts_±r
,

470 
¶aûr_·¿s_±r
,

471 
Ãt_¦ack
,

472 
block_pš_to_Šode
,

473 
¶aûr_co¡s_±r
);

475 
¶aûr_co¡s_±r
->
m_šv”£_´ev_bb_co¡
 = 1 /…Ïûr_co¡s_±r->
m_bb_co¡
;

476 
¶aûr_co¡s_±r
->
m_šv”£_´ev_timšg_co¡
 =

477 1 / 
¶aûr_co¡s_±r
->
m_timšg_co¡
;

479 
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
 = 1;

483 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
 = 1.0;

485 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
 =…Ïûr_co¡s_±r->
m_bb_co¡
;

486 
¶aûr_co¡s_±r
->
m_timšg_co¡
 =…Ïûr_co¡s_±r->
m_d–ay_co¡
 = 0.0;

487 
¶aûr_co¡s_±r
->
m_šv”£_´ev_bb_co¡
 = 0.0;

488 
¶aûr_co¡s_±r
->
m_šv”£_´ev_timšg_co¡
 = 0.0;

490 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
 =…Ïûr_·¿s_±r->
m_max_d–ay
 = 0.0;

491 
¶aûr_·¿s_±r
->
m_ü™_expÚ’t
 = 0.0;

492 
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
 = 0;

493 
¶aûr_·¿s_±r
->
m_num_cÚÃùiÚs
 = 0;

501 
¶aûr_·¿s_±r
->
m_move_lim™
 = ()(
ªÃ®šg_sched
.
šÃr_num
 *

502 
	`pow
(
num_blocks
, 1.3333));

503 ià(
¶aûr_·¿s_±r
->
m_move_lim™
 <= 0) {

504 
¶aûr_·¿s_±r
->
m_move_lim™
 = 1;

507 ià(
¶aûr_İts_±r
->
šÃr_loİ_»compu‹_divid”
 != 0) {

508 
¶aûr_·¿s_±r
->
m_šÃr_»compu‹_lim™
 =

509 ()(0.5 + ()
¶aûr_·¿s_±r
->
m_move_lim™
 /

510 ()
¶aûr_İts_±r
->
šÃr_loİ_»compu‹_divid”
);

512 
¶aûr_·¿s_±r
->
m_šÃr_»compu‹_lim™
 =…Ïûr_·¿s_±r->
m_move_lim™
 + 1;

517 
¶aûr_·¿s_±r
->
m_¿nge_lim™
 = ()
	`max
(
num_grid_cŞumns
,

518 
num_grid_rows
);

519 cÚ¡ 
fœ¡_¾im
 = 
¶aûr_·¿s_±r
->
m_¿nge_lim™
;

520 
¶aûr_·¿s_±r
->
m_fš®_¾im
 = 1.0;

521 
¶aûr_·¿s_±r
->
m_šv”£_d–_¾im
 =

522 1 / (
fœ¡_¾im
 - 
¶aûr_·¿s_±r
->
m_fš®_¾im
);

525 
¶aûr_·¿s_±r
->
m_‹m³r
 = 
	`¡¬tšg_‹m³¿tu»
(
ªÃ®šg_sched
,

526 
¶aûr_İts_±r
,

527 
¶aûr_·¿s_±r
,

528 
Şd_»giÚ_occ_x
,

529 
Şd_»giÚ_occ_y
,

530 
¶aûr_co¡s_±r
);

532 
	`´štf
("Initial Placement Cost: %g bb_cost: %gd_cost: %g delay_cost: %g\n\n",

533 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
,

534 
¶aûr_co¡s_±r
->
m_bb_co¡
,

535 
¶aûr_co¡s_±r
->
m_timšg_co¡
,

536 
¶aûr_co¡s_±r
->
m_d–ay_co¡
);

538 #iâdeà
SPEC


539 
	`´štf
("%11s %10s %11s %11s %11s %11s %11s %9s %8s %7s %7s %10s %7s\n",

543 
	`´štf
("%11s %10s %11s %11s %11s %11s %11s %9s %8s %7s %7s %10s %7s\n",

548 
msg
[
BUFSIZE
] = "";

549 
	`¥rštf
(
msg
, "Initial Placement. Cost: %g BB Cost: %g TD Cost %g Delay Cost: %g "

551 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
,

552 
¶aûr_co¡s_±r
->
m_bb_co¡
,

553 
¶aûr_co¡s_±r
->
m_timšg_co¡
,

554 
¶aûr_co¡s_±r
->
m_d–ay_co¡
,

555 
¶aûr_·¿s_±r
->
m_max_d–ay
,

556 
¶aûr_·¿s_±r
->
m_width_çùÜ
);

557 
	`upd©e_sü“n
(
MAJOR
, 
msg
, 
PLACEMENT
, 
FALSE
);

560 
şock_t
 
¡¬t_time
 = 
	`şock
();

561 
	`run_maš_¶aûm’t
(
¶aûr_İts_±r
,

562 
ªÃ®šg_sched
,

563 
¶aûr_·¿s_±r
,

564 
Şd_»giÚ_occ_x
,

565 
Şd_»giÚ_occ_y
,

566 
Ãt_¦ack
,

567 
Ãt_d–ay
,

568 
¶aûr_co¡s_±r
);

569 
şock_t
 
’d_time
 = 
	`şock
();

570 
maš_¶aûm’t_ruÁime
 = ()(
’d_time
 - 
¡¬t_time
è/ 
CLOCKS_PER_SEC
;

575 
	`´štf
("Attention,hen will„un†ow-temperature SA-Based Placement.......\n");

576 
	`run_low_‹m³¿tu»_¶aû
(
¶aûr_İts_±r
,

577 
¶aûr_·¿s_±r
,

578 
Şd_»giÚ_occ_x
,

579 
Şd_»giÚ_occ_y
,

580 
Ãt_¦ack
,

581 
Ãt_d–ay
,

582 
¶aûr_co¡s_±r
);

585 #iâdeà
SPEC


586 
	`´štf
("After†ow-temperature SA-Based Placement,…rinthe„esult......\n");

587 
	`´štf
("%11.5g %10.6g %11.6g %11.6g %11.6g %11.6g %11.4g %9.4g %8.3g %7.4g %7.4g %10d \n\n",

588 
¶aûr_·¿s_±r
->
m_‹m³r
, 
¶aûr_co¡s_±r
->
m_av_co¡
,

589 
¶aûr_co¡s_±r
->
m_av_bb_co¡
,…Ïûr_co¡s_±r->
m_av_timšg_co¡
,

590 
¶aûr_co¡s_±r
->
m_av_d–ay_co¡
, 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
,

591 
¶aûr_·¿s_±r
->
m_max_d–ay
,…Ïûr_·¿s_±r->
m_sucûss_¿tio
,

592 
¶aûr_·¿s_±r
->
m_¡d_dev
,…Ïûr_·¿s_±r->
m_¿nge_lim™
,

593 
¶aûr_·¿s_±r
->
m_ü™_expÚ’t
,…Ïûr_·¿s_±r->
m_tÙ®_™”
);

595 
	`´štf
("For†ow-temperature SA-Based Placment, success_sum = %d,\
_iter = %10d, success_ratio = %9.4g\n",

597 
¶aûr_·¿s_±r
->
m_sucûss_sum
,…Ïûr_·¿s_±r->
m_tÙ®_™”
,

598 
¶aûr_·¿s_±r
->
m_sucûss_¿tio
);

601 #ifdeà
VERBOSE


602 
	`dump_şbs
();

605 
	`check_¶aû
(
¶aûr_İts_±r
,

606 
¶aûr_co¡s_±r
);

608 ià(
¶aûr_İts_±r
->
’abË_timšg_computiÚs
 &&

609 
k¶aû_®go
 =ğ
BOUNDING_BOX_PLACE
) {

612 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

613 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

614 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

615 
timšg_¶aû_ü™
[
š‘
][
š
] = 0;

619 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


620 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

621 
	`compu‹_timšg_driv’_co¡_by_Üig_®go
(&
¶aûr_co¡s_±r
->
m_timšg_co¡
,

622 &
¶aûr_co¡s_±r
->
m_d–ay_co¡
);

624 
	`compu‹_timšg_driv’_co¡s_by_·th_®go
(&
¶aûr_co¡s_±r
->
m_timšg_co¡
,

625 &
¶aûr_co¡s_±r
->
m_d–ay_co¡
);

629 
¶aû_e¡_ü™
 = 0.0;

630 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


631 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


633 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE


634 || 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

637 
Ãt_d–ay
 = 
pošt_to_pošt_d–ay_co¡
;

638 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

640 
¶aû_e¡_ü™
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

642 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

644 #ifdeà
PRINT_SINK_DELAYS


645 
	`´št_sšk_d–ays
("Placement_Sink_Delays.echo");

648 #ifdeà
PRINT_NET_SLACKS


649 
	`´št_Ãt_¦ack
("PÏûm’t_N‘_SÏcks.echo", 
Ãt_¦ack
);

652 
ü™_·th_fe_Çme
[48] = "";

653 
	`¡rıy
(
ü™_·th_fe_Çme
, 
Ãi¡_fe
);

654 
	`¡rÿt
(
ü™_·th_fe_Çme
, "-Place_Crit_Path.echo");

655 
	`´št_ü™iÿl_·th
(
ü™_·th_fe_Çme
);

656 
	`´štf
("PÏûm’ˆE¡im©ed Cr™ P©h D–ay: %g\n\n", 
¶aû_e¡_ü™
);

659 
	`¥rštf
(
msg
, "Placement. Cost: %g, bb_cost: %g,d_cost: %g, Channel Factor: %d, critical_delay: %g",

660 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
,

661 
¶aûr_co¡s_±r
->
m_bb_co¡
,

662 
¶aûr_co¡s_±r
->
m_timšg_co¡
,

663 
¶aûr_·¿s_±r
->
m_width_çùÜ
,

664 
¶aûr_·¿s_±r
->
m_max_d–ay
);

665 
	`´štf
("Placement. Cost: %g, bb_cost: %g,iming_cost: %g, delay_cost: %g\n",

666 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
,

667 
¶aûr_co¡s_±r
->
m_bb_co¡
,

668 
¶aûr_co¡s_±r
->
m_timšg_co¡
,

669 
¶aûr_co¡s_±r
->
m_d–ay_co¡
);

670 
	`upd©e_sü“n
(
MAJOR
,

671 
msg
,

672 
PLACEMENT
,

673 
FALSE
);

675 
	`´štf
("TÙ® move ©‹m±ed: %d.\n", 
¶aûr_·¿s_±r
->
m_tÙ®_™”
);

676 
	`´štf
("Maš PÏûm’ˆco¡ %à£cÚds.\n", 
maš_¶aûm’t_ruÁime
);

677 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


678 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


680 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE


681 || 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

682 
Ãt_d–ay
 = 
»memb”_Ãt_d–ay_Üigš®_±r
;

683 
	`ä“_¶aûm’t_¡ruùs
(
¶aûr_İts_±r
,

684 
Şd_»giÚ_occ_x
,

685 
Şd_»giÚ_occ_y
);

687 
	`ä“_lookups_ªd_ü™iÿl™›s
(
¶aûr_İts_±r
,

688 &
Ãt_d–ay
,

689 &
Ãt_¦ack
);

693 
	`ä“_¶aûr_·¿s
(
¶aûr_·¿s_±r
);

694 
	`ä“_¶aûr_co¡s
(
¶aûr_co¡s_±r
);

696 
	`ä“
(
g_grid_ÿ·c™y
);

697 
g_grid_ÿ·c™y
 = 
NULL
;

699 
	`ä“
(
g_pšs_Ú_block
);

700 
g_pšs_Ú_block
 = 
NULL
;

701 
	}
}

703 
	$š™Ÿl_¶aûm’t
(
·d_loc_t
 
·d_loc_ty³
,

704 * 
·d_loc_fe
)

707 
pos
 = (
s_pos
**)
	`my_m®loc
(
g_num_grid_ty³s
 * (s_pos*));

709 * 
ava_diff_ty³_grids
 = (*)
	`my_ÿÎoc
(
g_num_grid_ty³s
, ());

711 
i
, 
j
, 
k
, 
iblk
;

712 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

713 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

714 
bš_grids
[
i
][
j
].
m_u§ge
 = 0;

716 
k
 = 0; k < 
bš_grids
[
i
][
j
].
m_ÿ·c™y
; ++k) {

717 
bš_grids
[
i
][
j
].
š_blocks
[
k
] = 
EMPTY
;

718 ià(
bš_grids
[
i
][
j
].
m_off£t
 == 0) {

719 ++
ava_diff_ty³_grids
[
bš_grids
[
i
][
j
].
grid_ty³
];

725 
i
 = 0; i < 
g_num_grid_ty³s
; ++i) {

726 
pos
[
i
] = (
s_pos
*)
	`my_m®loc
(
ava_diff_ty³_grids
[i]

727 * (
s_pos
));

730 * 
šdex
 = (*)
	`my_ÿÎoc
(
g_num_grid_ty³s
, ());

731 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

732 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

733 
k
 = 0; k < 
bš_grids
[
i
][
j
].
m_ÿ·c™y
; ++k) {

734 ià(
bš_grids
[
i
][
j
].
m_off£t
 == 0) {

735 
ty³_šdex
 = 
bš_grids
[
i
][
j
].
grid_ty³
;

736 
pos
[
ty³_šdex
][
šdex
[ty³_šdex]].
x
 = 
i
;

737 
pos
[
ty³_šdex
][
šdex
[ty³_šdex]].
y
 = 
j
;

738 
pos
[
ty³_šdex
][
šdex
[ty³_šdex]].
z
 = 
k
;

739 ++
šdex
[
ty³_šdex
];

746 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

748 ià(!((
blocks
[
iblk
].
block_ty³
 =ğ
INPAD_TYPE


749 || 
blocks
[
iblk
].
block_ty³
 =ğ
OUTPAD_TYPE
)

750 && 
·d_loc_ty³
 =ğ
USER
)) {

751 
ty³_šdex
 = 
blocks
[
iblk
].
block_ty³
;

756 ià(
blocks
[
iblk
].
block_ty³
 =ğ
INPAD_TYPE


757 || 
blocks
[
iblk
].
block_ty³
 =ğ
OUTPAD_TYPE
) {

758 
ty³_šdex
 = 
IO_TYPE
;

760 
	`as£¹
(
ava_diff_ty³_grids
[
ty³_šdex
] > 0);

763 
choiû
 = 
	`my_œªd
(
ava_diff_ty³_grids
[
ty³_šdex
] - 1);

764 
x
 = 
pos
[
ty³_šdex
][
choiû
].x;

765 
y
 = 
pos
[
ty³_šdex
][
choiû
].y;

766 
z
 = 
pos
[
ty³_šdex
][
choiû
].z;

767 
bš_grids
[
x
][
y
].
š_blocks
[
z
] = 
iblk
;

768 ++
bš_grids
[
x
][
y
].
m_u§ge
;

772 
pos
[
ty³_šdex
][
choiû
] =

773 
pos
[
ty³_šdex
][
ava_diff_ty³_grids
[type_index] - 1];

774 --
ava_diff_ty³_grids
[
ty³_šdex
];

778 ià(
·d_loc_ty³
 =ğ
USER
) {

779 
	`»ad_u£r_·d_loc
(
·d_loc_fe
);

784 
i
 = 0; i <ğ(
num_grid_cŞumns
 + 1); ++i) {

785 
j
 = 0; j <ğ(
num_grid_rows
 + 1); ++j) {

786 
k
 = 0; k < 
bš_grids
[
i
][
j
].
m_ÿ·c™y
; ++k) {

787 
	`as£¹
(
bš_grids
[
i
][
j
].
š_blocks
 !ğ
NULL
);

789 
iblk
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

790 ià(
iblk
 !ğ
EMPTY
) {

791 
blocks
[
iblk
].
x
 = 
i
;

792 
blocks
[
iblk
].
y
 = 
j
;

793 
blocks
[
iblk
].
z
 = 
k
;

799 #ifdeà
VERBOSE


800 
	`´štf
("Atƒnd of initial_placement.\n");

801 
	`dump_şbs
();

804 
i
 = 0; i < 
g_num_grid_ty³s
; ++i) {

805 
	`ä“
(
pos
[
i
]);

808 
	`ä“
(
pos
);

809 
	`ä“
(
šdex
);

810 
	`ä“
(
ava_diff_ty³_grids
);

811 
	}
}

813 
	$run_maš_¶aûm’t
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

814 cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

815 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

816 ** 
Şd_»giÚ_occ_x
,

817 ** 
Şd_»giÚ_occ_y
,

818 ** 
Ãt_¦ack
,

819 ** 
Ãt_d–ay
,

820 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

822 
šÃr_™”
 = 0;

823 
moves_sšû_co¡_»compu‹
 = 0;

824 
¶aûr_·¿s_±r
->
m_tÙ®_™”
 = 0;

825 
msg
[
BUFSIZE
] = "";

826 cÚ¡ 
k¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

828 
	`ex™_ü™
(
¶aûr_·¿s_±r
->
m_‹m³r
,

829 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
,

830 
ªÃ®šg_sched
) == 0) {

831 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


832 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


834 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

835 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
 = 1.0;

838 
¶aûr_co¡s_±r
->
m_av_co¡
 =…Ïûr_co¡s_±r->
m_av_bb_co¡
 = 0.0;

839 
¶aûr_co¡s_±r
->
m_av_timšg_co¡
 =…Ïûr_co¡s_±r->
m_av_d–ay_co¡
 = 0.0;

840 
¶aûr_·¿s_±r
->
m_sum_of_squ¬es
 =…Ïûr_·¿s_±r->
m_sucûss_sum
 = 0;

844 cÚ¡ 
kou‹r_ü™_™”_couÁ
 = 
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
;

845 cÚ¡ 
k»compu‹_ü™_™”
 = 
¶aûr_İts_±r
->
»compu‹_ü™_™”
;

846 ià((
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


847 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


849 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
)

850 && (
kou‹r_ü™_™”_couÁ
 >ğ
k»compu‹_ü™_™”


851 || 
¶aûr_İts_±r
->
šÃr_loİ_»compu‹_divid”
 != 0)) {

852 
	`³rfÜm_timšg_ª®yze
(
¶aûr_İts_±r
,

853 
Ãt_¦ack
,

854 
Ãt_d–ay
,

855 
¶aûr_·¿s_±r
,

856 
¶aûr_co¡s_±r
);

860 ++(
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
);

863 
¶aûr_co¡s_±r
->
m_šv”£_´ev_bb_co¡
 = 1 /…Ïûr_co¡s_±r->
m_bb_co¡
;

864 
¶aûr_co¡s_±r
->
m_šv”£_´ev_timšg_co¡
 = 1 /…Ïûr_co¡s_±r->
m_timšg_co¡
;

866 
¶aûr_·¿s_±r
->
m_šÃr_ü™_™”_couÁ
 = 1;

867 cÚ¡ 
move_lim™
 = 
¶aûr_·¿s_±r
->
m_move_lim™
;

868 
šÃr_™”
 = 0; iÂ”_™” < 
move_lim™
; ++inner_iter) {

870 ià(
	`Œy_sw­
(
¶aûr_·¿s_±r
,

871 
¶aûr_İts_±r
,

872 
Şd_»giÚ_occ_x
,

873 
Şd_»giÚ_occ_y
,

874 
¶aûr_co¡s_±r
) == 1) {

875 ++(
¶aûr_·¿s_±r
->
m_sucûss_sum
);

876 
¶aûr_co¡s_±r
->
m_av_co¡
 +ğ¶aûr_co¡s_±r->
m_tÙ®_co¡
;

877 
¶aûr_co¡s_±r
->
m_av_bb_co¡
 +ğ¶aûr_co¡s_±r->
m_bb_co¡
;

878 
¶aûr_co¡s_±r
->
m_av_d–ay_co¡
 +ğ¶aûr_co¡s_±r->
m_d–ay_co¡
;

879 
¶aûr_co¡s_±r
->
m_av_timšg_co¡
 +ğ¶aûr_co¡s_±r->
m_timšg_co¡
;

880 
¶aûr_·¿s_±r
->
m_sum_of_squ¬es
 +=

881 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
 *…lacer_costs_ptr->m_total_cost;

885 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


886 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


888 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

889 
	`»compu‹_td_co¡_aá”_sw­_û¹aš_times
(
¶aûr_İts_±r
,

890 
šÃr_™”
,

891 
Ãt_d–ay
,

892 
Ãt_¦ack
,

893 
¶aûr_·¿s_±r
,

894 
¶aûr_co¡s_±r
);

897 #ifdeà
VERBOSE


902 ià(
	`çbs
(
¶aûr_co¡s_±r
->
m_bb_co¡


903 - 
	`compu‹_bb_co¡
(
CHECK
, 
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

904 
¶aûr_İts_±r
->
num_»giÚs
))

905 > 
¶aûr_co¡s_±r
->
m_bb_co¡
 * 
ERROR_TOL
) {

906 
	`ex™
(1);

916 
moves_sšû_co¡_»compu‹
 +ğ
move_lim™
;

917 ià(
moves_sšû_co¡_»compu‹
 > 
MAX_MOVES_BEFORE_RECOMPUTE
) {

918 
	`upd©e_¶aû_co¡_aá”_max_move_times
(
¶aûr_İts_±r
,

919 
¶aûr_co¡s_±r
);

920 
moves_sšû_co¡_»compu‹
 = 0;

923 
¶aûr_·¿s_±r
->
m_tÙ®_™”
 +ğ
move_lim™
;

924 
¶aûr_·¿s_±r
->
m_sucûss_¿tio
 =

925 (()
¶aûr_·¿s_±r
->
m_sucûss_sum
è/ 
move_lim™
;

927 
	`upd©e_¶aû_co¡s_by_sucûss_sum
(
¶aûr_·¿s_±r
,

928 
¶aûr_co¡s_±r
);

930 
¶aûr_·¿s_±r
->
m_¡d_dev
 = 
	`g‘_¡d_dev
ÕÏûr_·¿s_±r->
m_sucûss_sum
,

931 
¶aûr_·¿s_±r
->
m_sum_of_squ¬es
,

932 
¶aûr_co¡s_±r
->
m_av_co¡
);

935 
	`upd©e_‹m³¿tu»
(&
¶aûr_·¿s_±r
->
m_‹m³r
,

936 
¶aûr_·¿s_±r
->
m_¿nge_lim™
,

937 
¶aûr_·¿s_±r
->
m_sucûss_¿tio
,

938 
ªÃ®šg_sched
);

940 
	`¥rštf
(
msg
, "Cost: %g BB Cost %g TD Cost %g Temperature: %g Max_Delay: %g",

941 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
,

942 
¶aûr_co¡s_±r
->
m_bb_co¡
,

943 
¶aûr_co¡s_±r
->
m_timšg_co¡
,

944 
¶aûr_·¿s_±r
->
m_‹m³r
,

945 
¶aûr_·¿s_±r
->
m_max_d–ay
);

946 
	`upd©e_sü“n
(
MINOR
,

947 
msg
,

948 
PLACEMENT
,

949 
FALSE
);

952 
	`upd©e_¿nge_lim™
(&
¶aûr_·¿s_±r
->
m_¿nge_lim™
,

953 
¶aûr_·¿s_±r
->
m_sucûss_¿tio
);

955 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


956 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


958 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

960 
¶aûr_·¿s_±r
->
m_ü™_expÚ’t
 = 
	`upd©e_ü™_expÚ’t
(
¶aûr_İts_±r
,

961 
¶aûr_·¿s_±r
);

964 #ifdeà
VERBOSE


965 
	`dump_şbs
();

968 
	}
}

970 
	$run_low_‹m³¿tu»_¶aû
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

971 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

972 ** 
Şd_»giÚ_occ_x
,

973 ** 
Şd_»giÚ_occ_y
,

974 ** 
Ãt_¦ack
,

975 ** 
Ãt_d–ay
,

976 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

978 
¶aûr_·¿s_±r
->
m_‹m³r
 = 0.0;

979 
¶aûr_co¡s_±r
->
m_av_co¡
 =…Ïûr_co¡s_±r->
m_av_bb_co¡
 = 0.0;

980 
¶aûr_co¡s_±r
->
m_av_timšg_co¡
 =…Ïûr_co¡s_±r->
m_av_d–ay_co¡
 = 0.0;

981 
¶aûr_·¿s_±r
->
m_sucûss_sum
 =…Ïûr_·¿s_±r->
m_sum_of_squ¬es
 = 0.0;

984 cÚ¡ 
kou‹r_ü™_™”_couÁ
 = 
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
;

985 cÚ¡ 
k»compu‹_ü™_™”
 = 
¶aûr_İts_±r
->
»compu‹_ü™_™”
;

986 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

988 ià((
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


989 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


990 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
)

991 && (
kou‹r_ü™_™”_couÁ
 >ğ
k»compu‹_ü™_™”


992 || 
¶aûr_İts_±r
->
šÃr_loİ_»compu‹_divid”
 != 0)) {

995 
	`³rfÜm_timšg_ª®yze
(
¶aûr_İts_±r
,

996 
Ãt_¦ack
,

997 
Ãt_d–ay
,

998 
¶aûr_·¿s_±r
,

999 
¶aûr_co¡s_±r
);

1002 ++(
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
);

1004 
¶aûr_co¡s_±r
->
m_šv”£_´ev_bb_co¡
 = 1 /…Ïûr_co¡s_±r->
m_bb_co¡
;

1005 
¶aûr_co¡s_±r
->
m_šv”£_´ev_timšg_co¡
 = 1 /…Ïûr_co¡s_±r->
m_timšg_co¡
;

1007 
	`´štf
("Now†ow-temperature SA-Based Placement......\n");

1008 
¶aûr_·¿s_±r
->
m_šÃr_ü™_™”_couÁ
 = 1;

1010 cÚ¡ 
move_lim™
 = 
¶aûr_·¿s_±r
->
m_move_lim™
;

1011 
šÃr_™”
 = -1;

1012 
šÃr_™”
 = 0; iÂ”_™” < 
move_lim™
; ++inner_iter) {

1014 ià(
	`Œy_sw­
(
¶aûr_·¿s_±r
,

1015 
¶aûr_İts_±r
,

1016 
Şd_»giÚ_occ_x
,

1017 
Şd_»giÚ_occ_y
,

1018 
¶aûr_co¡s_±r
) == 1) {

1019 ++(
¶aûr_·¿s_±r
->
m_sucûss_sum
);

1020 
¶aûr_co¡s_±r
->
m_av_co¡
 +ğ¶aûr_co¡s_±r->
m_tÙ®_co¡
;

1021 
¶aûr_co¡s_±r
->
m_av_bb_co¡
 +ğ¶aûr_co¡s_±r->
m_bb_co¡
;

1022 
¶aûr_co¡s_±r
->
m_av_d–ay_co¡
 +ğ¶aûr_co¡s_±r->
m_d–ay_co¡
;

1023 
¶aûr_co¡s_±r
->
m_av_timšg_co¡
 +ğ¶aûr_co¡s_±r->
m_timšg_co¡
;

1024 
¶aûr_·¿s_±r
->
m_sum_of_squ¬es
 +=

1025 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
 *…lacer_costs_ptr->m_total_cost;

1027 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


1028 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


1030 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

1031 
	`»compu‹_td_co¡_aá”_sw­_û¹aš_times
(
¶aûr_İts_±r
,

1032 
šÃr_™”
,

1033 
Ãt_d–ay
,

1034 
Ãt_¦ack
,

1035 
¶aûr_·¿s_±r
,

1036 
¶aûr_co¡s_±r
);

1041 
¶aûr_·¿s_±r
->
m_tÙ®_™”
 +ğ
move_lim™
;

1042 
¶aûr_·¿s_±r
->
m_sucûss_¿tio
 =

1043 (()
¶aûr_·¿s_±r
->
m_sucûss_sum
è/ 
move_lim™
;

1045 
	`upd©e_¶aû_co¡s_by_sucûss_sum
(
¶aûr_·¿s_±r
,

1046 
¶aûr_co¡s_±r
);

1048 
¶aûr_·¿s_±r
->
m_¡d_dev
 = 
	`g‘_¡d_dev
ÕÏûr_·¿s_±r->
m_sucûss_sum
,

1049 
¶aûr_·¿s_±r
->
m_sum_of_squ¬es
,

1050 
¶aûr_co¡s_±r
->
m_av_co¡
);

1051 
	}
}

1054 
	$³rfÜm_timšg_ª®yze
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1055 ** 
Ãt_¦ack
,

1056 ** 
Ãt_d–ay
,

1057 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

1058 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1060 #ifdeà
VERBOSE


1061 
	`´štf
("Outer Loop Recompute Criticalities\n");

1063 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
 =

1064 
¶aûr_co¡s_±r
->
m_d–ay_co¡
 / 
¶aûr_·¿s_±r
->
m_num_cÚÃùiÚs
;

1067 ià(
¶aûr_İts_±r
->
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
) {

1070 
	`lßd_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
,

1071 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
);

1076 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

1079 
¶aûr_·¿s_±r
->
m_max_d–ay
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

1080 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

1082 
	`compu‹_timšg_driv’_co¡
(
¶aûr_İts_±r
,

1083 
¶aûr_·¿s_±r
,

1084 
Ãt_¦ack
,

1085 
block_pš_to_Šode
,

1086 
¶aûr_co¡s_±r
);

1087 
¶aûr_·¿s_±r
->
m_ou‹r_ü™_™”_couÁ
 = 0;

1088 
	}
}

1090 
	$»compu‹_td_co¡_aá”_sw­_û¹aš_times
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1091 cÚ¡ 
šÃr_™”
,

1092 ** 
Ãt_d–ay
,

1093 ** 
Ãt_¦ack
,

1094 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

1095 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1097 cÚ¡ 
kšÃr_»compu‹_lim™
 = 
¶aûr_·¿s_±r
->
m_šÃr_»compu‹_lim™
;

1098 cÚ¡ 
kšÃr_ü™_™”_couÁ
 = 
¶aûr_·¿s_±r
->
m_šÃr_ü™_™”_couÁ
;

1099 cÚ¡ 
kmove_lim™
 = 
¶aûr_·¿s_±r
->
m_move_lim™
;

1100 ià(
kšÃr_ü™_™”_couÁ
 >ğ
kšÃr_»compu‹_lim™


1101 && 
šÃr_™”
 !ğ
kmove_lim™
 - 1) {

1102 
¶aûr_·¿s_±r
->
m_šÃr_ü™_™”_couÁ
 = 0;

1103 #ifdeà
VERBOSE


1104 
	`´štf
("Inner Loop Recompute Criticalities\n");

1106 ià(
¶aûr_İts_±r
->
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
) {

1107 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
 =

1108 
¶aûr_co¡s_±r
->
m_d–ay_co¡
 / 
¶aûr_·¿s_±r
->
m_num_cÚÃùiÚs
;

1109 
	`lßd_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
,

1110 
¶aûr_·¿s_±r
->
m_¶aû_d–ay_v®ue
);

1114 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

1115 
¶aûr_·¿s_±r
->
m_max_d–ay
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

1116 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

1118 
	`compu‹_timšg_driv’_co¡
(
¶aûr_İts_±r
,

1119 
¶aûr_·¿s_±r
,

1120 
Ãt_¦ack
,

1121 
block_pš_to_Šode
,

1122 
¶aûr_co¡s_±r
);

1125 ++(
¶aûr_·¿s_±r
->
m_šÃr_ü™_™”_couÁ
);

1126 
	}
}

1128 
	$compu‹_timšg_driv’_co¡
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1129 cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

1130 ** 
Ãt_¦ack
,

1131 ** 
block_pš_to_Šode
,

1132 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1134 cÚ¡ 
kmax_d–ay
 = 
¶aûr_·¿s_±r
->
m_max_d–ay
;

1135 cÚ¡ 
kü™_expÚ’t
 = 
¶aûr_·¿s_±r
->
m_ü™_expÚ’t
;

1136 * 
timšg_co¡_±r
 = &(
¶aûr_co¡s_±r
->
m_timšg_co¡
);

1137 * 
d–ay_co¡_±r
 = &(
¶aûr_co¡s_±r
->
m_d–ay_co¡
);

1138 ià(
¶aûr_İts_±r
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

1139 
	`compu‹_®l_Ãts_loÿl_ü™_weight
(
Ãt_¦ack
,

1140 
block_pš_to_Šode
,

1141 
kmax_d–ay
);

1142 
	`compu‹_timšg_driv’_co¡s_by_·th_®go
(
timšg_co¡_±r
,

1143 
d–ay_co¡_±r
);

1145 
	`lßd_ü™iÿl™›s
(
Ãt_¦ack
,

1146 
kmax_d–ay
,

1147 
kü™_expÚ’t
);

1148 
	`compu‹_timšg_driv’_co¡_by_Üig_®go
(
timšg_co¡_±r
,

1149 
d–ay_co¡_±r
);

1151 
	}
}

1153 
	$upd©e_¶aû_co¡_aá”_max_move_times
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1154 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1157 
¶aû_cÚg_ty³s_t
 
¶aû_co¡_ty³
 = 
¶aûr_İts_±r
->place_cost_type;

1158 cÚ¡ 
knum_»giÚs
 = 
¶aûr_İts_±r
->
num_»giÚs
;

1159 
¶aûr_co¡s_±r
->
m_Ãw_bb_co¡
 = 
	`»compu‹_bb_co¡
(
¶aû_co¡_ty³
,

1160 
knum_»giÚs
);

1162 cÚ¡ 
Ãw_bb_co¡
 = 
¶aûr_co¡s_±r
->
m_Ãw_bb_co¡
;

1163 cÚ¡ 
bb_co¡
 = 
¶aûr_co¡s_±r
->
m_bb_co¡
;

1164 ià(
	`çbs
(
Ãw_bb_co¡
 - 
bb_co¡
è> bb_co¡ * 
ERROR_TOL
) {

1165 
	`´štf
("Error inry_place:‚ew_bb_cost = %g, old bb_cost = %g.\n",

1166 
Ãw_bb_co¡
, 
bb_co¡
);

1167 
	`ex™
(1);

1169 
¶aûr_co¡s_±r
->
m_bb_co¡
 =…Ïûr_co¡s_±r->
m_Ãw_bb_co¡
;

1172 cÚ¡ 
¶aû_®gÜ™hm_t
 
¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

1173 ià(
¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||…Ïû_®gØ=ğ
PATH_TIMING_DRIVEN_PLACE


1175 || 
¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

1179 
	`compu‹_timšg_driv’_co¡_š_ou‹r_loİ
(
¶aûr_İts_±r
,

1180 
¶aûr_co¡s_±r
);

1182 
¶aûr_co¡s_±r
->
m_timšg_co¡
 =…Ïûr_co¡s_±r->
m_Ãw_timšg_co¡
;

1184 
¶aûr_co¡s_±r
->
m_d–ay_co¡
 =…Ïûr_co¡s_±r->
m_Ãw_d–ay_co¡
;

1186 
	}
}

1188 
	$compu‹_timšg_driv’_co¡_š_ou‹r_loİ
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1189 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1191 cÚ¡ 
¶aû_®gÜ™hm_t
 
¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

1192 * 
Ãw_timšg_co¡_±r
 = &(
¶aûr_co¡s_±r
->
m_Ãw_timšg_co¡
);

1193 * 
Ãw_d–ay_co¡_±r
 = &(
¶aûr_co¡s_±r
->
m_Ãw_d–ay_co¡
);

1194 ià(
¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||…Ïû_®gØ=ğ
PATH_TIMING_DRIVEN_PLACE
) {

1195 
	`compu‹_timšg_driv’_co¡_by_Üig_®go
(
Ãw_timšg_co¡_±r
,

1196 
Ãw_d–ay_co¡_±r
);

1198 
	`compu‹_timšg_driv’_co¡s_by_·th_®go
(
Ãw_timšg_co¡_±r
,

1199 
Ãw_d–ay_co¡_±r
);

1202 cÚ¡ 
ktimšg_co¡
 = 
¶aûr_co¡s_±r
->
m_timšg_co¡
;

1203 ià(
	`çbs
(*
Ãw_timšg_co¡_±r
 - 
ktimšg_co¡
è> ktimšg_co¡ * 
ERROR_TOL
) {

1204 
	`´štf
("Error inry_place:‚ew_timing_cost = %g, oldiming_cost = %g.\n",

1205 *
Ãw_timšg_co¡_±r
,

1206 
ktimšg_co¡
);

1207 
	`ex™
(1);

1210 cÚ¡ 
kd–ay_co¡
 = 
¶aûr_co¡s_±r
->
m_d–ay_co¡
;

1211 ià(
	`çbs
(*
Ãw_d–ay_co¡_±r
 - 
kd–ay_co¡
è> kd–ay_co¡ * 
ERROR_TOL
) {

1212 
	`´štf
("Error inry_place:‚ew_delay_cost = %g, old delay_cost = %g.\n",

1213 *
Ãw_d–ay_co¡_±r
,

1214 
kd–ay_co¡
);

1215 
	`ex™
(1);

1217 
	}
}

1219 
	$upd©e_¶aû_co¡s_by_sucûss_sum
(cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

1220 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1222 cÚ¡ 
sucûss_sum
 = 
¶aûr_·¿s_±r
->
m_sucûss_sum
;

1223 ià(0 =ğ
sucûss_sum
) {

1224 
¶aûr_co¡s_±r
->
m_av_bb_co¡
 =…Ïûr_co¡s_±r->
m_bb_co¡
;

1225 
¶aûr_co¡s_±r
->
m_av_timšg_co¡
 =…Ïûr_co¡s_±r->
m_timšg_co¡
;

1226 
¶aûr_co¡s_±r
->
m_av_d–ay_co¡
 =…Ïûr_co¡s_±r->
m_d–ay_co¡
;

1227 
¶aûr_co¡s_±r
->
m_av_co¡
 =…Ïûr_co¡s_±r->
m_tÙ®_co¡
;

1229 
¶aûr_co¡s_±r
->
m_av_bb_co¡
 /ğ
sucûss_sum
;

1230 
¶aûr_co¡s_±r
->
m_av_timšg_co¡
 /ğ
sucûss_sum
;

1231 
¶aûr_co¡s_±r
->
m_av_d–ay_co¡
 /ğ
sucûss_sum
;

1232 
¶aûr_co¡s_±r
->
m_av_co¡
 /ğ
sucûss_sum
;

1234 
	}
}

1238 
	$couÁ_cÚÃùiÚs
()

1241 
couÁ
 = 0;

1242 
š‘
 = -1;

1243 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1244 ià(
is_glob®
[
š‘
] =ğ
TRUE
) {

1248 
couÁ
 +ğ(
Ãt
[
š‘
].
num_Ãt_pšs
 - 1);

1251  
couÁ
;

1252 
	}
}

1256 
	$compu‹_Ãt_pš_šdex_v®ues
()

1259 
iblk
 = -1;

1260 
š
 = -1;

1261 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

1262 
š
 = 0; ipš < 
max_pšs_³r_şb
; ++ipin) {

1263 
Ãt_pš_šdex
[
iblk
][
š
] = 
OPEN
;

1267 
š‘
 = -1;

1268 
Ãš
 = -1;

1269 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1270 ià(
is_glob®
[
š‘
] =ğ
TRUE
) {

1274 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1275 
Ãš
 = 0;‚‘pš < 
knum_Ãt_pšs
; ++netpin) {

1276 cÚ¡ 
blk_šdex
 = 
Ãt
[
š‘
].
node_blocks
[
Ãš
];

1279 ià(
blocks
[
blk_šdex
].
block_ty³
 =ğ
INPAD_TYPE
) {

1280 
Ãt_pš_šdex
[
blk_šdex
][0] = 0;

1281 } ià(
blocks
[
blk_šdex
].
block_ty³
 =ğ
OUTPAD_TYPE
) {

1283 
Ãt_pš_šdex
[
blk_šdex
][0] = 
Ãš
;

1285 
Ãt_pš_šdex
[
blk_šdex
][
Ãt
[
š‘
].
node_block_pšs
[
Ãš
]] =‚etpin;

1289 
	}
}

1295 
	$g‘_¡d_dev
(
sucûss_sum
,

1296 
sum_of_squ¬e
,

1297 
av_co¡
)

1299 
¡d_dev
 = 0.0;

1300 ià(
sucûss_sum
 <= 1) {

1301 
¡d_dev
 = 0.0;

1303 
¡d_dev
 = (
sum_of_squ¬e
 - 
sucûss_sum
 * 
av_co¡
 *‡v_cost) /

1304 ()(
sucûss_sum
 - 1);

1308 ià(
¡d_dev
 > 0.0) {

1309 
¡d_dev
 = 
	`sq¹
(std_dev);

1311 
¡d_dev
 = 0.0;

1314  
¡d_dev
;

1315 
	}
}

1317 
	$¡¬tšg_‹m³¿tu»
(cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

1318 cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1319 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

1320 ** 
Şd_»giÚ_occ_x
,

1321 ** 
Şd_»giÚ_occ_y
,

1322 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1325 ià(
ªÃ®šg_sched
.
ty³
 =ğ
USER_SCHED
) {

1326  (
ªÃ®šg_sched
.
š™_t
);

1329 
num_acû±ed
 = 0;

1330 
av_co¡
 = 0.0;

1331 
sum_of_squ¬es
 = 0.0;

1333 cÚ¡ 
move_lim™
 = 
	`mš
(
¶aûr_·¿s_±r
->
m_move_lim™
, 
num_blocks
);

1334 
¶aûr_·¿s_±r
->
m_‹m³r
 = 1.e30;

1335 
i
 = -1;

1336 
i
 = 0; i < 
move_lim™
; ++i) {

1337 ià(
	`Œy_sw­
(
¶aûr_·¿s_±r
,

1338 
¶aûr_İts_±r
,

1339 
Şd_»giÚ_occ_x
,

1340 
Şd_»giÚ_occ_y
,

1341 
¶aûr_co¡s_±r
) == 1) {

1342 ++
num_acû±ed
;

1343 
av_co¡
 +ğ
¶aûr_co¡s_±r
->
m_tÙ®_co¡
;

1344 
sum_of_squ¬es
 +=

1345 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
 *…lacer_costs_ptr->m_total_cost;

1350 ià(
num_acû±ed
 != 0) {

1351 
av_co¡
 /ğ
num_acû±ed
;

1353 
av_co¡
 = 0.0;

1357 
¡d_dev
 = 
	`g‘_¡d_dev
(
num_acû±ed
,

1358 
sum_of_squ¬es
,

1359 
av_co¡
);

1360 #ifdeà
DEBUG


1361 ià(
num_acû±ed
 !ğ
move_lim™
) {

1362 
	`´štf
("Warning: Starting: %d of %d configurations‡ccepted.\n",

1363 
num_acû±ed
, 
move_lim™
);

1367  (20.0 * 
¡d_dev
);

1368 
	}
}

1372 
	$upd©e_‹m³¿tu»
(* 
t
,

1373 
¾im
,

1374 
sucûss_¿tio
,

1375 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
)

1378 ià(
ªÃ®šg_sched
.
ty³
 =ğ
USER_SCHED
) {

1379 *
t
 = 
ªÃ®šg_sched
.
®pha_t
 * (*t);

1381 ià(
sucûss_¿tio
 > 0.96) {

1382 *
t
 = (*t) * 0.5;

1383 } ià(
sucûss_¿tio
 > 0.8) {

1384 *
t
 = (*t) * 0.9;

1385 } ià(
sucûss_¿tio
 > 0.15 || 
¾im
 > 1.) {

1386 *
t
 = (*t) * 0.95;

1388 *
t
 = (*t) * 0.8;

1391 
	}
}

1394 
	$upd©e_¿nge_lim™
(* 
¾im
,

1395 
sucûss_¿tio
)

1399 *
¾im
 = (*¾imè* (1.0 - 0.44 + 
sucûss_¿tio
);

1400 
uµ”_lim
 = 
	`max
(
num_grid_cŞumns
,

1401 
num_grid_rows
);

1402 *
¾im
 = 
	`mš
(*¾im, 
uµ”_lim
);

1403 *
¾im
 = 
	`max
(*rlim, 1.0);

1405 
	}
}

1407 
	$upd©e_ü™_expÚ’t
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1408 cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
)

1410 cÚ¡ 
k¿nge_lim™
 = 
¶aûr_·¿s_±r
->
m_¿nge_lim™
;

1411 cÚ¡ 
kfš®_¾im
 = 
¶aûr_·¿s_±r
->
m_fš®_¾im
;

1412 cÚ¡ 
kšv”£_d–_¾im
 = 
¶aûr_·¿s_±r
->
m_šv”£_d–_¾im
;

1413 cÚ¡ 
¾im_¿tio
 = (
k¿nge_lim™
 - 
kfš®_¾im
è* 
kšv”£_d–_¾im
;

1415 cÚ¡ 
¶aû_exp_¿nge
 =

1416 
¶aûr_İts_±r
->
td_¶aû_exp_Ï¡
 -…Ïûr_İts_±r->
td_¶aû_exp_fœ¡
;

1417 
Ãw_ü™_expÚ’t
 = (1 - 
¾im_¿tio
è* 
¶aû_exp_¿nge
 +

1418 
¶aûr_İts_±r
->
td_¶aû_exp_fœ¡
;

1420  
Ãw_ü™_expÚ’t
;

1421 
	}
}

1423 
	$ex™_ü™
(
t
,

1424 
tÙ®_co¡
,

1425 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
)

1428 ià(
ªÃ®šg_sched
.
ty³
 =ğ
USER_SCHED
) {

1429 ià(
t
 < 
ªÃ®šg_sched
.
ex™_t
) {

1437 ià(
t
 < 0.005 * 
tÙ®_co¡
 / 
num_Ãts
) {

1442 
	}
}

1452 
	$Œy_sw­
(cÚ¡ 
¶aûr_·¿s_t
* 
¶aûr_·¿s_±r
,

1453 cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1454 ** 
Şd_»giÚ_occ_x
,

1455 ** 
Şd_»giÚ_occ_y
,

1456 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

1465 
äom_block
 = 
	`my_œªd
(
num_blocks
 - 1);

1466 cÚ¡ 
block_ty³s_t
 
käom_block_ty³
 = 
blocks
[
äom_block
].
block_ty³
;

1467 ià(
¶aûr_·¿s_±r
->
m_fixed_pšs
 =ğ
TRUE
) {

1468 
käom_block_ty³
 !ğ
B_CLB_TYPE
) {

1469 
äom_block
 = 
	`my_œªd
(
num_blocks
 - 1);

1473 
x_äom
 = 
blocks
[
äom_block
].
x
;

1474 
y_äom
 = 
blocks
[
äom_block
].
y
;

1475 
z_äom
 = 
blocks
[
äom_block
].
z
;

1477 
x_to
 = 0;

1478 
y_to
 = 0;

1480 
	`fšd_to
(
x_äom
,

1481 
y_äom
,

1482 
käom_block_ty³
,

1483 
¶aûr_·¿s_±r
->
m_¿nge_lim™
,

1484 &
x_to
,

1485 &
y_to
);

1487 
z_to
 = 0;

1488 ià(
bš_grids
[
x_to
][
y_to
].
m_ÿ·c™y
 > 1) {

1489 
z_to
 = 
	`my_œªd
(
bš_grids
[
x_to
][
y_to
].
m_ÿ·c™y
 - 1);

1495 
to_block
 = 
EMPTY
;

1496 ià(
bš_grids
[
x_to
][
y_to
].
š_blocks
[
z_to
] =ğ
EMPTY
) {

1498 
to_block
 = 
EMPTY
;

1499 
blocks
[
äom_block
].
x
 = 
x_to
;

1500 
blocks
[
äom_block
].
y
 = 
y_to
;

1501 
blocks
[
äom_block
].
z
 = 
z_to
;

1503 
to_block
 = 
bš_grids
[
x_to
][
y_to
].
š_blocks
[
z_to
];

1504 
blocks
[
to_block
].
x
 = 
x_äom
;

1505 
blocks
[
to_block
].
y
 = 
y_äom
;

1506 
blocks
[
to_block
].
z
 = 
z_äom
;

1508 
blocks
[
äom_block
].
x
 = 
x_to
;

1509 
blocks
[
äom_block
].
y
 = 
y_to
;

1510 
blocks
[
äom_block
].
z
 = 
z_to
;

1513 
bbox_t
* 
bb_coÜd_Ãw
 = 
NULL
;

1514 
bbox_t
* 
bb_edge_Ãw
 = 
NULL
;

1515 * 
Ãts_to_upd©e
 = 
NULL
;

1516 * 
Ãt_block_moved
 = 
NULL
;

1519 ià(
bb_coÜd_Ãw
 =ğ
NULL
) {

1520 
bb_coÜd_Ãw
 = (
bbox_t
*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 *

1521 (
bbox_t
));

1522 
bb_edge_Ãw
 = (
bbox_t
*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 *

1523 (
bbox_t
));

1524 
Ãts_to_upd©e
 = (*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * ());

1525 
Ãt_block_moved
 = (*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * ());

1531 cÚ¡ 
num_of_pšs
 = 
g_pšs_Ú_block
[
käom_block_ty³
];

1533 cÚ¡ 
num_Ãts_afãùed
 = 
	`fšd_afãùed_Ãts
(
Ãts_to_upd©e
,

1534 
Ãt_block_moved
,

1535 
äom_block
,

1536 
to_block
,

1537 
num_of_pšs
);

1538 
¶aû_cÚg_ty³s_t
 
¶aû_co¡_ty³
 = 
¶aûr_İts_±r
->place_cost_type;

1539 cÚ¡ 
knum_»giÚs
 = 
¶aûr_İts_±r
->
num_»giÚs
;

1540 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

1541 
	`§ve_»giÚ_occ
(
Şd_»giÚ_occ_x
,

1542 
Şd_»giÚ_occ_y
,

1543 
knum_»giÚs
);

1547 
bb_d–_c
 = 0.0;

1548 
bb_šdex
 = 0;

1549 
k
 = -1;

1550 
š‘
 = -1;

1552 
k
 = 0; k < 
num_Ãts_afãùed
; ++k) {

1553 
š‘
 = 
Ãts_to_upd©e
[
k
];

1557 ià(
Ãt_block_moved
[
k
] =ğ
FROM_AND_TO
) {

1561 ià(
Ãt
[
š‘
].
num_Ãt_pšs
 <ğ
SMALL_NET
) {

1562 
	`g‘_nÚ_upd©—bË_bb
(
š‘
,

1563 &
bb_coÜd_Ãw
[
bb_šdex
]);

1565 ià(
Ãt_block_moved
[
k
] =ğ
FROM
) {

1566 
	`upd©e_bb
(
š‘
,

1567 &
bb_coÜd_Ãw
[
bb_šdex
],

1568 &
bb_edge_Ãw
[
bb_šdex
],

1569 
x_äom
,

1570 
y_äom
,

1571 
x_to
,

1572 
y_to
);

1574 
	`upd©e_bb
(
š‘
,

1575 &
bb_coÜd_Ãw
[
bb_šdex
],

1576 &
bb_edge_Ãw
[
bb_šdex
],

1577 
x_to
,

1578 
y_to
,

1579 
x_äom
,

1580 
y_äom
);

1585 ià(
¶aû_co¡_ty³
 !ğ
NONLINEAR_CONG
) {

1586 
‹mp_Ãt_co¡
[
š‘
] = 
	`g‘_Ãt_co¡
(inet,

1587 &
bb_coÜd_Ãw
[
bb_šdex
]);

1588 
bb_d–_c
 +ğ
‹mp_Ãt_co¡
[
š‘
] - 
Ãt_co¡
[inet];

1591 
	`upd©e_»giÚ_occ
(
š‘
,

1592 &
bb_coÜds
[
š‘
],

1594 
knum_»giÚs
);

1595 
	`upd©e_»giÚ_occ
(
š‘
,

1596 &
bb_coÜd_Ãw
[
bb_šdex
],

1598 
knum_»giÚs
);

1601 ++
bb_šdex
;

1604 
Ãwco¡
 = 0.0;

1605 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

1606 
Ãwco¡
 = 
	`nÚlš—r_cÚg_co¡
(
¶aûr_İts_±r
->
num_»giÚs
);

1608 
bb_d–_c
 = 
Ãwco¡
 - 
¶aûr_co¡s_±r
->
m_bb_co¡
;

1612 
d–_co¡
 = 0.0;

1613 
timšg_d–_c
 = 0.0;

1614 
d–ay_d–_c
 = 0.0;

1615 cÚ¡ 
¶aû_®gÜ™hm_t
 
¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

1616 ià(
¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


1617 || 
¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


1619 || 
¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

1623 
	`compu‹_d–_timšg_driv’_co¡
(
¶aû_®go
,

1624 
äom_block
,

1625 
to_block
,

1626 
num_of_pšs
,

1627 &
timšg_d–_c
,

1628 &
d–ay_d–_c
);

1630 cÚ¡ 
ktimšg_Œadeoff
 = 
¶aûr_İts_±r
->
timšg_Œadeoff
;

1631 cÚ¡ 
nÜm®_bb_co¡
 =

1632 
bb_d–_c
 * 
¶aûr_co¡s_±r
->
m_šv”£_´ev_bb_co¡
;

1633 cÚ¡ 
nÜm®_timšg_co¡
 =

1634 
timšg_d–_c
 * 
¶aûr_co¡s_±r
->
m_šv”£_´ev_timšg_co¡
;

1635 
d–_co¡
 = (1 - 
ktimšg_Œadeoff
è* 
nÜm®_bb_co¡


1636 + 
ktimšg_Œadeoff
 * 
nÜm®_timšg_co¡
;

1638 
d–_co¡
 = 
bb_d–_c
;

1642 
k“p_sw™ch
 = 
	`as£ss_sw­
(
d–_co¡
,

1643 
¶aûr_·¿s_±r
->
m_‹m³r
);

1644 ià(
k“p_sw™ch
 == 1) {

1645 
¶aûr_co¡s_±r
->
m_tÙ®_co¡
 +ğ
d–_co¡
;

1646 
¶aûr_co¡s_±r
->
m_bb_co¡
 +ğ
bb_d–_c
;

1648 ià(
¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


1649 || 
¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


1650 || 
¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

1651 
¶aûr_co¡s_±r
->
m_timšg_co¡
 +ğ
timšg_d–_c
;

1652 
¶aûr_co¡s_±r
->
m_d–ay_co¡
 +ğ
d–ay_d–_c
;

1656 
	`upd©e_timšg_driv’_co¡
(
äom_block
,

1657 
to_block
,

1658 
num_of_pšs
);

1662 
bb_šdex
 = 0;

1663 
k
 = 0; k < 
num_Ãts_afãùed
; ++k) {

1664 
š‘
 = 
Ãts_to_upd©e
[
k
];

1668 ià(
Ãt_block_moved
[
k
] =ğ
FROM_AND_TO
) {

1669 
‹mp_Ãt_co¡
[
š‘
] = -1;

1673 
bb_coÜds
[
š‘
] = 
bb_coÜd_Ãw
[
bb_šdex
];

1674 ià(
Ãt
[
š‘
].
num_Ãt_pšs
 > 
SMALL_NET
) {

1675 
bb_num_Ú_edges
[
š‘
] = 
bb_edge_Ãw
[
bb_šdex
];

1678 ++
bb_šdex
;

1679 
Ãt_co¡
[
š‘
] = 
‹mp_Ãt_co¡
[inet];

1680 
‹mp_Ãt_co¡
[
š‘
] = -1;

1685 
bš_grids
[
x_to
][
y_to
].
š_blocks
[
z_to
] = 
äom_block
;

1686 
bš_grids
[
x_äom
][
y_äom
].
š_blocks
[
z_äom
] = 
to_block
;

1687 ià(
EMPTY
 =ğ
to_block
) {

1689 ++(
bš_grids
[
x_to
][
y_to
].
m_u§ge
);

1690 --(
bš_grids
[
x_äom
][
y_äom
].
m_u§ge
);

1694 
k
 = 0; k < 
num_Ãts_afãùed
; k++) {

1695 
š‘
 = 
Ãts_to_upd©e
[
k
];

1696 
‹mp_Ãt_co¡
[
š‘
] = -1;

1700 
blocks
[
äom_block
].
x
 = 
x_äom
;

1701 
blocks
[
äom_block
].
y
 = 
y_äom
;

1702 
blocks
[
äom_block
].
z
 = 
z_äom
;

1703 ià(
to_block
 !ğ
EMPTY
) {

1704 
blocks
[
to_block
].
x
 = 
x_to
;

1705 
blocks
[
to_block
].
y
 = 
y_to
;

1706 
blocks
[
to_block
].
z
 = 
z_to
;

1710 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

1711 
	`»¡Üe_»giÚ_occ
(
Şd_»giÚ_occ_x
,

1712 
Şd_»giÚ_occ_y
,

1713 
knum_»giÚs
);

1717  
k“p_sw™ch
;

1718 
	}
}

1721 
	$®loc_ªd_lßd_¶aûm’t_¡ruùs
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1722 *** 
Şd_»giÚ_occ_x
,

1723 *** 
Şd_»giÚ_occ_y
)

1728 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

1729 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


1730 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


1731 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE


1732 || 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

1733 
pošt_to_pošt_d–ay_co¡
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

1734 
‹mp_pošt_to_pošt_d–ay_co¡
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

1736 
pošt_to_pošt_timšg_co¡
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

1737 
‹mp_pošt_to_pošt_timšg_co¡
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

1739 
Ãt_pš_šdex
 = (**)
	`®loc_m©rix
(0, 
num_blocks
 - 1,

1740 0, 
max_pšs_³r_şb
 - 1,

1747 
š‘
 = -1;

1748 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1750 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1751 
pošt_to_pošt_d–ay_co¡
[
š‘
] =

1752 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

1753 --(
pošt_to_pošt_d–ay_co¡
[
š‘
]);

1755 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
] =

1756 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

1757 --(
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
]);

1759 
pošt_to_pošt_timšg_co¡
[
š‘
] =

1760 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

1761 --(
pošt_to_pošt_timšg_co¡
[
š‘
]);

1763 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
] =

1764 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

1765 --(
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
]);

1768 
š
 = 0;

1769 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1770 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1772 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

1773 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 0;

1774 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 0;

1780 
Ãt_co¡
 = (*)
	`my_m®loc
(
num_Ãts
 * ());

1781 
‹mp_Ãt_co¡
 = (*)
	`my_m®loc
(
num_Ãts
 * ());

1786 
š‘
 = -1;

1787 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1788 
‹mp_Ãt_co¡
[
š‘
] = -1.0;

1791 
bb_coÜds
 = (
bbox_t
*)
	`my_m®loc
(
num_Ãts
 * (bbox_t));

1792 
bb_num_Ú_edges
 = (
bbox_t
*)
	`my_m®loc
(
num_Ãts
 * (bbox_t));

1795 
	`®loc_ªd_lßd_unique_pš_li¡
();

1798 
¶aû_cÚg_ty³s_t
 
¶aû_co¡_ty³
 = 
¶aûr_İts_±r
->place_cost_type;

1799 cÚ¡ 
knum_»giÚs
 = 
¶aûr_İts_±r
->
num_»giÚs
;

1800 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

1801 
	`®loc_¶aû_»giÚs
(
knum_»giÚs
);

1802 
	`lßd_¶aû_»giÚs
(
knum_»giÚs
);

1803 *
Şd_»giÚ_occ_x
 = (**)
	`®loc_m©rix
(0, 
knum_»giÚs
 - 1,

1804 0, 
knum_»giÚs
 - 1,

1806 *
Şd_»giÚ_occ_y
 = (**)
	`®loc_m©rix
(0, 
knum_»giÚs
 - 1,

1807 0, 
knum_»giÚs
 - 1,

1810 *
Şd_»giÚ_occ_x
 = 
NULL
;

1811 *
Şd_»giÚ_occ_y
 = 
NULL
;

1813 
	`®loc_ªd_lßd_fÜ_ç¡_co¡_upd©e
(
¶aûr_İts_±r
->
¶aû_co¡_exp
);

1815 
	}
}

1822 
	$ä“_¶aûm’t_¡ruùs
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

1823 ** 
Şd_»giÚ_occ_x
,

1824 ** 
Şd_»giÚ_occ_y
)

1826 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

1827 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


1828 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


1829 || 
k¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE


1830 || 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

1831 
š‘
 = -1;

1832 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1834 ++
pošt_to_pošt_d–ay_co¡
[
š‘
];

1835 
	`ä“
(
pošt_to_pošt_d–ay_co¡
[
š‘
]);

1837 ++
pošt_to_pošt_timšg_co¡
[
š‘
];

1838 
	`ä“
(
pošt_to_pošt_timšg_co¡
[
š‘
]);

1840 ++
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
];

1841 
	`ä“
(
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
]);

1843 ++
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
];

1844 
	`ä“
(
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
]);

1847 
	`ä“
(
pošt_to_pošt_d–ay_co¡
);

1848 
	`ä“
(
‹mp_pošt_to_pošt_d–ay_co¡
);

1849 
	`ä“
(
pošt_to_pošt_timšg_co¡
);

1850 
	`ä“
(
‹mp_pošt_to_pošt_timšg_co¡
);

1851 
	`ä“_m©rix
(
Ãt_pš_šdex
,

1853 
num_blocks
 - 1,

1858 
	`ä“
(
Ãt_co¡
);

1859 
	`ä“
(
‹mp_Ãt_co¡
);

1860 
	`ä“
(
bb_num_Ú_edges
);

1861 
	`ä“
(
bb_coÜds
);

1862 
Ãt_co¡
 = 
NULL
;

1863 
‹mp_Ãt_co¡
 = 
NULL
;

1864 
bb_num_Ú_edges
 = 
NULL
;

1865 
bb_coÜds
 = 
NULL
;

1866 
	`ä“_unique_pš_li¡
();

1868 cÚ¡ 
¶aû_cÚg_ty³s_t
 
k¶aû_co¡_ty³
 = 
¶aûr_İts_±r
->
¶aû_co¡_ty³
;

1869 cÚ¡ 
knum_»giÚs
 = 
¶aûr_İts_±r
->
num_»giÚs
;

1870 ià(
k¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

1871 
	`ä“_¶aû_»giÚs
(
knum_»giÚs
);

1872 
	`ä“_m©rix
(
Şd_»giÚ_occ_x
, 0, 
knum_»giÚs
 - 1, 0, ());

1873 
	`ä“_m©rix
(
Şd_»giÚ_occ_y
, 0, 
knum_»giÚs
 - 1, 0, ());

1874 } ià(
k¶aû_co¡_ty³
 =ğ
LINEAR_CONG
) {

1875 
	`ä“_ç¡_co¡_upd©e_¡ruùs
();

1877 
	}
}

1882 
	$®loc_¶aû_»giÚs
(
num_»giÚs
)

1884 
¶aû_»giÚ_x
 = (
¶aû_»giÚ_t
**)
	`®loc_m©rix
(0,

1885 
num_»giÚs
 - 1,

1887 
num_»giÚs
 - 1,

1888 (
¶aû_»giÚ_t
));

1889 
¶aû_»giÚ_y
 = (
¶aû_»giÚ_t
**)
	`®loc_m©rix
(0,

1890 
num_»giÚs
 - 1,

1892 
num_»giÚs
 - 1,

1893 (
¶aû_»giÚ_t
));

1894 
¶aû_»giÚ_bounds_x
 = (*)
	`my_m®loc
((
num_»giÚs
 + 1) *

1896 
¶aû_»giÚ_bounds_y
 = (*)
	`my_m®loc
((
num_»giÚs
 + 1) *

1898 
	}
}

1900 
	$lßd_¶aû_»giÚs
(
num_»giÚs
)

1904 
i
, 
j
, 
low_block
, 
high_block
, 
ºum
;

1905 
low_lim
, 
high_lim
, 
ÿ·c™y
, 
çc
, 
block_ÿ·c™y
;

1906 
Ën_çc
, 
height_çc
;

1909 
j
 = 0; j < 
num_»giÚs
; j++) {

1910 
ÿ·c™y
 = 0.;

1911 
low_lim
 = (è
j
 / (è
num_»giÚs
 * 
num_grid_rows
 + 1.;

1912 
high_lim
 = ()(
j
 + 1è/ (è
num_»giÚs
 * 
num_grid_rows
;

1913 
low_block
 = 
	`æoÜ
(
low_lim
);

1914 
low_block
 = 
	`max
(1,†ow_block);

1915 
high_block
 = 
	`û
(
high_lim
);

1916 
high_block
 = 
	`mš
(high_block, 
num_grid_rows
);

1917 
block_ÿ·c™y
 = (
chª_width_x
[
low_block
 - 1] +

1918 
chª_width_x
[
low_block
]) / 2.;

1920 ià(
low_block
 == 1) {

1921 
block_ÿ·c™y
 +ğ
chª_width_x
[0] / 2.;

1924 
çc
 = 1. - (
low_lim
 - 
low_block
);

1925 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

1927 
ºum
 = 
low_block
 + 1;„num < 
high_block
;„num++) {

1928 
block_ÿ·c™y
 = (
chª_width_x
[
ºum
 - 1] + chan_width_x[rnum]) / 2.;

1929 
ÿ·c™y
 +ğ
block_ÿ·c™y
;

1932 
block_ÿ·c™y
 = (
chª_width_x
[
high_block
 - 1] +

1933 
chª_width_x
[
high_block
]) / 2.;

1935 ià(
high_block
 =ğ
num_grid_rows
) {

1936 
block_ÿ·c™y
 +ğ
chª_width_x
[
num_grid_rows
] / 2.;

1939 
çc
 = 1. - (
high_block
 - 
high_lim
);

1940 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

1942 
i
 = 0; i < 
num_»giÚs
; i++) {

1943 
¶aû_»giÚ_x
[
i
][
j
].
ÿ·c™y
 = capacity;

1944 
¶aû_»giÚ_x
[
i
][
j
].
šv_ÿ·c™y
 = 1. / 
ÿ·c™y
;

1945 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 = 0.;

1946 
¶aû_»giÚ_x
[
i
][
j
].
co¡
 = 0.;

1951 
i
 = 0; i < 
num_»giÚs
; i++) {

1952 
ÿ·c™y
 = 0.;

1953 
low_lim
 = (è
i
 / (è
num_»giÚs
 * 
num_grid_cŞumns
 + 1.;

1954 
high_lim
 = ()(
i
 + 1è/ (è
num_»giÚs
 * 
num_grid_cŞumns
;

1955 
low_block
 = 
	`æoÜ
(
low_lim
);

1956 
low_block
 = 
	`max
(1,†ow_block);

1957 
high_block
 = 
	`û
(
high_lim
);

1958 
high_block
 = 
	`mš
(high_block, 
num_grid_cŞumns
);

1959 
block_ÿ·c™y
 = (
chª_width_y
[
low_block
 - 1] +

1960 
chª_width_y
[
low_block
]) / 2.;

1962 ià(
low_block
 == 1) {

1963 
block_ÿ·c™y
 +ğ
chª_width_y
[0] / 2.;

1966 
çc
 = 1. - (
low_lim
 - 
low_block
);

1967 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

1969 
ºum
 = 
low_block
 + 1;„num < 
high_block
;„num++) {

1970 
block_ÿ·c™y
 = (
chª_width_y
[
ºum
 - 1] + chan_width_y[rnum]) / 2.;

1971 
ÿ·c™y
 +ğ
block_ÿ·c™y
;

1974 
block_ÿ·c™y
 = (
chª_width_y
[
high_block
 - 1] +

1975 
chª_width_y
[
high_block
]) / 2.;

1977 ià(
high_block
 =ğ
num_grid_cŞumns
) {

1978 
block_ÿ·c™y
 +ğ
chª_width_y
[
num_grid_cŞumns
] / 2.;

1981 
çc
 = 1. - (
high_block
 - 
high_lim
);

1982 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

1984 
j
 = 0; j < 
num_»giÚs
; j++) {

1985 
¶aû_»giÚ_y
[
i
][
j
].
ÿ·c™y
 = capacity;

1986 
¶aû_»giÚ_y
[
i
][
j
].
šv_ÿ·c™y
 = 1. / 
ÿ·c™y
;

1987 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 = 0.;

1988 
¶aû_»giÚ_y
[
i
][
j
].
co¡
 = 0.;

1994 
Ën_çc
 = (è
num_grid_cŞumns
 / (è
num_»giÚs
;

1995 
height_çc
 = (è
num_grid_rows
 / (è
num_»giÚs
;

1996 
¶aû_»giÚ_bounds_x
[0] = 0.5;

1997 
¶aû_»giÚ_bounds_y
[0] = 0.5;

1999 
i
 = 1; i <ğ
num_»giÚs
; i++) {

2000 
¶aû_»giÚ_bounds_x
[
i
] =…Ïû_»giÚ_bounds_x[˜- 1] + 
Ën_çc
;

2001 
¶aû_»giÚ_bounds_y
[
i
] =…Ïû_»giÚ_bounds_y[˜- 1] + 
height_çc
;

2003 
	}
}

2009 
	$upd©e_»giÚ_occ
(
š‘
, 
bbox_t
* 
coÜds
,

2010 
add_Ü_sub
, 
num_»giÚs
)

2012 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2013 
üossšg
 = 0.0;

2014 ià(
Ãt
[
š‘
].
num_Ãt_pšs
 > 50) {

2015 
üossšg
 = 2.7933 + 0.02616 * (
knum_Ãt_pšs
 - 50);

2017 
üossšg
 = 
üoss_couÁ
[
knum_Ãt_pšs
 - 1];

2020 
Ãt_xmš
 = 
coÜds
->
xmš
 - 0.5;

2021 
Ãt_xmax
 = 
coÜds
->
xmax
 + 0.5;

2022 
Ãt_ymš
 = 
coÜds
->
ymš
 - 0.5;

2023 
Ãt_ymax
 = 
coÜds
->
ymax
 + 0.5;

2025 
šv_»giÚ_Ën
 = ()
num_»giÚs
 / (è
num_grid_cŞumns
;

2026 
šv_»giÚ_height
 = ()
num_»giÚs
 / (è
num_grid_rows
;

2033 
imš
 = ()(
Ãt_xmš
 - 0.5è* 
šv_»giÚ_Ën
;

2034 
imax
 = ()(
Ãt_xmax
 - 0.5è* 
šv_»giÚ_Ën
;

2035 
imax
 = 
	`mš
(imax, 
num_»giÚs
 - 1);

2037 
jmš
 = ()(
Ãt_ymš
 - 0.5è* 
šv_»giÚ_height
;

2038 
jmax
 = ()(
Ãt_ymax
 - 0.5è* 
šv_»giÚ_height
;

2039 
jmax
 = 
	`mš
(jmax, 
num_»giÚs
 - 1);

2041 
šv_bb_Ën
 = 1.0 / (
Ãt_xmax
 - 
Ãt_xmš
);

2042 
šv_bb_height
 = 1.0 / (
Ãt_ymax
 - 
Ãt_ymš
);

2046 
ov”Ïp_xlow
, 
ov”Ïp_xhigh
, 
ov”Ïp_ylow
, 
ov”Ïp_yhigh
;

2047 
y_ov”Ïp
, 
x_ov”Ïp
, 
x_occu·ncy
, 
y_occu·ncy
;

2049 
i
, 
j
;

2050 
i
 = 
imš
; i <ğ
imax
; i++) {

2051 
j
 = 
jmš
; j <ğ
jmax
; j++) {

2052 
ov”Ïp_xlow
 = 
	`max
(
¶aû_»giÚ_bounds_x
[
i
], 
Ãt_xmš
);

2053 
ov”Ïp_xhigh
 = 
	`mš
(
¶aû_»giÚ_bounds_x
[
i
 + 1], 
Ãt_xmax
);

2054 
ov”Ïp_ylow
 = 
	`max
(
¶aû_»giÚ_bounds_y
[
j
], 
Ãt_ymš
);

2055 
ov”Ïp_yhigh
 = 
	`mš
(
¶aû_»giÚ_bounds_y
[
j
 + 1], 
Ãt_ymax
);

2056 
x_ov”Ïp
 = 
ov”Ïp_xhigh
 - 
ov”Ïp_xlow
;

2057 
y_ov”Ïp
 = 
ov”Ïp_yhigh
 - 
ov”Ïp_ylow
;

2059 #ifdeà
DEBUG


2060 ià(
x_ov”Ïp
 < -0.001) {

2061 
	`´štf
("Error in update_region_occ: x_overlap < 0"

2062 "\Àš‘ = %d, ov”Ï°ğ%g\n", 
š‘
, 
x_ov”Ïp
);

2065 ià(
y_ov”Ïp
 < -0.001) {

2066 
	`´štf
("Error in update_region_occ: y_overlap < 0"

2067 "\Àš‘ = %d, ov”Ï°ğ%g\n", 
š‘
, 
y_ov”Ïp
);

2071 
x_occu·ncy
 = 
üossšg
 * 
y_ov”Ïp
 * 
x_ov”Ïp
 * 
šv_bb_height
 *

2072 
šv_»giÚ_Ën
;

2073 
y_occu·ncy
 = 
üossšg
 * 
x_ov”Ïp
 * 
y_ov”Ïp
 * 
šv_bb_Ën
 *

2074 
šv_»giÚ_height
;

2075 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 +ğ
add_Ü_sub
 * 
x_occu·ncy
;

2076 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 +ğ
add_Ü_sub
 * 
y_occu·ncy
;

2079 
	}
}

2082 
	$§ve_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

2083 ** 
Şd_»giÚ_occ_y
,

2084 
num_»giÚs
)

2088 
i
, 
j
;

2089 
i
 = 0; i < 
num_»giÚs
; i++) {

2090 
j
 = 0; j < 
num_»giÚs
; j++) {

2091 
Şd_»giÚ_occ_x
[
i
][
j
] = 
¶aû_»giÚ_x
[i][j].
occu·ncy
;

2092 
Şd_»giÚ_occ_y
[
i
][
j
] = 
¶aû_»giÚ_y
[i][j].
occu·ncy
;

2095 
	}
}

2097 
	$»¡Üe_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

2098 ** 
Şd_»giÚ_occ_y
,

2099 
num_»giÚs
)

2103 
i
, 
j
;

2104 
i
 = 0; i < 
num_»giÚs
; i++) {

2105 
j
 = 0; j < 
num_»giÚs
; j++) {

2106 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 = 
Şd_»giÚ_occ_x
[i][j];

2107 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 = 
Şd_»giÚ_occ_y
[i][j];

2110 
	}
}

2112 
	$ä“_¶aû_»giÚs
(
num_»giÚs
)

2116 
	`ä“_m©rix
(
¶aû_»giÚ_x
,

2118 
num_»giÚs
 - 1,

2120 (
¶aû_»giÚ_t
));

2121 
	`ä“_m©rix
(
¶aû_»giÚ_y
,

2123 
num_»giÚs
 - 1,

2125 (
¶aû_»giÚ_t
));

2126 
	`ä“
(
¶aû_»giÚ_bounds_x
);

2127 
	`ä“
(
¶aû_»giÚ_bounds_y
);

2128 
	}
}

2136 
	$®loc_ªd_lßd_unique_pš_li¡
()

2138 
du¶iÿ‹_pšs
 = (*)
	`my_ÿÎoc
(
num_Ãts
, ());

2142 * 
times_li¡ed
 = (*)
	`my_ÿÎoc
(
num_blocks
, ());

2143 
ªy_dups
 = 0;

2144 
š‘
 = -1;

2145 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

2146 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2147 
num_dup
 = 0;

2149 
š
 = -1;

2150 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

2151 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

2152 ++
times_li¡ed
[
block_num
];

2153 ià(
times_li¡ed
[
block_num
] > 1) {

2154 ++
num_dup
;

2158 ià(
num_dup
 > 0) {

2159 
du¶iÿ‹_pšs
[
š‘
] = 
num_dup
;

2160 ià(
ªy_dups
 == 0) {

2162 
unique_pš_li¡
 = (**)
	`my_ÿÎoc
(
num_Ãts
, (*));

2163 
ªy_dups
 = 1;

2167 
unique_pš_li¡
[
š‘
] =

2168 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 
num_dup
) * ());

2170 
off£t
 = 0;

2171 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

2172 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

2173 ià(
times_li¡ed
[
block_num
] != 0) {

2174 
times_li¡ed
[
block_num
] = 0;

2175 
unique_pš_li¡
[
š‘
][
off£t
] = 
block_num
;

2176 ++
off£t
;

2180 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

2181 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

2182 
times_li¡ed
[
block_num
] = 0;

2187 
	`ä“
(
times_li¡ed
);

2188 
times_li¡ed
 = 
NULL
;

2189 
	}
}

2192 
	$ä“_unique_pš_li¡
()

2194 
ªy_dup
, 
š‘
;

2195 
ªy_dup
 = 0;

2197 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

2198 ià(
du¶iÿ‹_pšs
[
š‘
] != 0) {

2199 
	`ä“
(
unique_pš_li¡
[
š‘
]);

2200 
ªy_dup
 = 1;

2204 ià(
ªy_dup
 != 0) {

2205 
	`ä“
(
unique_pš_li¡
);

2208 
	`ä“
(
du¶iÿ‹_pšs
);

2209 
	}
}

2213 
	$fšd_afãùed_Ãts
(* 
Ãts_to_upd©e
,

2214 * 
Ãt_block_moved
,

2215 
äom_block
,

2216 
to_block
,

2217 
num_of_pšs
)

2222 
couÁ
 = 0;

2223 
afãùed_šdex
 = 0;

2224 
š‘
 = 0;

2225 
k
 = -1;

2226 
k
 = 0; k < 
num_of_pšs
; ++k) {

2227 
š‘
 = 
blocks
[
äom_block
].
Ãts
[
k
];

2229 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
 || 
‹mp_Ãt_co¡
[inet] > 0.0) {

2233 
Ãts_to_upd©e
[
afãùed_šdex
] = 
š‘
;

2234 
Ãt_block_moved
[
afãùed_šdex
] = 
FROM
;

2235 ++
afãùed_šdex
;

2236 
‹mp_Ãt_co¡
[
š‘
] = 1.0;

2239 ià(
to_block
 !ğ
EMPTY
) {

2240 
k
 = 0; k < 
num_of_pšs
; ++k) {

2241 
š‘
 = 
blocks
[
to_block
].
Ãts
[
k
];

2242 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

2246 ià(
‹mp_Ãt_co¡
[
š‘
] > 0.0) {

2247 
couÁ
 = 0; couÁ < 
afãùed_šdex
; ++count) {

2249 ià(
Ãts_to_upd©e
[
couÁ
] =ğ
š‘
) {

2250 ià(
Ãt_block_moved
[
couÁ
] =ğ
FROM
) {

2251 
Ãt_block_moved
[
couÁ
] = 
FROM_AND_TO
;

2258 #ifdeà
DEBUG


2259 ià(
couÁ
 > 
afãùed_šdex
) {

2260 
	`´štf
("Error in find_affected_nets -- count = %d,"

2261 "‡fãùed index = %d.\n", 
couÁ
, 
afãùed_šdex
);

2262 
	`ex™
(1);

2267 
Ãts_to_upd©e
[
afãùed_šdex
] = 
š‘
;

2268 
Ãt_block_moved
[
afãùed_šdex
] = 
TO
;

2269 ++
afãùed_šdex
;

2270 
‹mp_Ãt_co¡
[
š‘
] = 1.;

2275  
afãùed_šdex
;

2276 
	}
}

2281 
	$fšd_to
(
x_äom
,

2282 
y_äom
,

2283 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

2284 
¾im
,

2285 * 
x_to
,

2286 * 
y_to
)

2288 cÚ¡ 
¾x
 = 
	`mš
(
num_grid_cŞumns
, 
¾im
);

2289 cÚ¡ 
¾y
 = 
	`mš
(
num_grid_rows
, 
¾im
);

2291 #ifdeà
DEBUG


2292 ià(
¾x
 < 1 ||„lx > 
num_grid_cŞumns
) {

2293 
	`´štf
("E¼Ü iÀfšd_to:„lx = %d\n", 
¾x
);

2294 
	`ex™
(1);

2299 
x_»l
 = 0;

2300 
y_»l
 = 0;

2301 ià(
kblock_ty³
 =ğ
B_CLB_TYPE
) {

2302 
x_»l
 = 
	`my_œªd
(2 * 
¾x
);

2303 
y_»l
 = 
	`my_œªd
(2 * 
¾y
);

2307 *
x_to
 = 
x_äom
 + (
x_»l
 - 
¾x
);

2308 *
y_to
 = 
y_äom
 + (
y_»l
 - 
¾y
);

2310 ià(*
x_to
 > 
num_grid_cŞumns
) {

2311 *
x_to
 = *x_tØ- 
num_grid_cŞumns
;

2313 ià(*
x_to
 < 1) {

2314 *
x_to
 = *x_tØ+ 
num_grid_cŞumns
;

2317 ià(*
y_to
 > 
num_grid_rows
) {

2318 *
y_to
 = *y_tØ- 
num_grid_rows
;

2320 ià(*
y_to
 < 1) {

2321 *
y_to
 = *y_tØ+ 
num_grid_rows
;

2324 
iside
 = 0;

2325 
Ïû
 = 0;

2326 ià(
¾x
 >ğ
num_grid_cŞumns
) {

2327 
iside
 = 
	`my_œªd
(3);

2337 
iside
) {

2339 
Ïû
 = 
	`my_œªd
(
num_grid_rows
 - 1) + 1;

2340 *
x_to
 = 0;

2341 *
y_to
 = 
Ïû
;

2345 
Ïû
 = 
	`my_œªd
(
num_grid_cŞumns
 - 1) + 1;

2346 *
x_to
 = 
Ïû
;

2347 *
y_to
 = 
num_grid_rows
 + 1;

2351 
Ïû
 = 
	`my_œªd
(
num_grid_rows
 - 1) + 1;

2352 *
x_to
 = 
num_grid_cŞumns
 + 1;

2353 *
y_to
 = 
Ïû
;

2357 
Ïû
 = 
	`my_œªd
(
num_grid_cŞumns
 - 1) + 1;

2358 *
x_to
 = 
Ïû
;

2359 *
y_to
 = 0;

2363 
	`´štf
("Error in find_to. Unexpected io swap†ocation.\n");

2364 
	`ex™
(1);

2367 ià(
x_äom
 == 0) {

2368 
Ïû
 = 
	`my_œªd
(2 * 
¾y
);

2369 *
y_to
 = 
y_äom
 + (
Ïû
 - 
¾y
);

2370 *
x_to
 = 
x_äom
;

2372 ià(*
y_to
 > 
num_grid_rows
) {

2373 *
y_to
 = 
num_grid_rows
 + 1;

2374 *
x_to
 = 
	`my_œªd
(
¾x
 - 1) + 1;

2375 } ià(*
y_to
 < 1) {

2376 *
y_to
 = 0;

2377 *
x_to
 = 
	`my_œªd
(
¾x
 - 1) + 1;

2379 } ià(
x_äom
 =ğ
num_grid_cŞumns
 + 1) {

2380 
Ïû
 = 
	`my_œªd
(2 * 
¾y
);

2381 *
y_to
 = 
y_äom
 + (
Ïû
 - 
¾y
);

2382 *
x_to
 = 
x_äom
;

2384 ià(*
y_to
 > 
num_grid_rows
) {

2385 *
y_to
 = 
num_grid_rows
 + 1;

2386 *
x_to
 = 
num_grid_cŞumns
 - 
	`my_œªd
(
¾x
 - 1);

2387 } ià(*
y_to
 < 1) {

2388 *
y_to
 = 0;

2389 *
x_to
 = 
num_grid_cŞumns
 - 
	`my_œªd
(
¾x
 - 1);

2391 } ià(
y_äom
 == 0) {

2392 
Ïû
 = 
	`my_œªd
(2 * 
¾x
);

2393 *
x_to
 = 
x_äom
 + (
Ïû
 - 
¾x
);

2394 *
y_to
 = 
y_äom
;

2396 ià(*
x_to
 > 
num_grid_cŞumns
) {

2397 *
x_to
 = 
num_grid_cŞumns
 + 1;

2398 *
y_to
 = 
	`my_œªd
(
¾y
 - 1) + 1;

2399 } ià(*
x_to
 < 1) {

2400 *
x_to
 = 0;

2401 *
y_to
 = 
	`my_œªd
(
¾y
 - 1) + 1;

2404 
Ïû
 = 
	`my_œªd
(2 * 
¾x
);

2405 *
x_to
 = 
x_äom
 + (
Ïû
 - 
¾x
);

2406 *
y_to
 = 
y_äom
;

2408 ià(*
x_to
 > 
num_grid_cŞumns
) {

2409 *
x_to
 = 
num_grid_cŞumns
 + 1;

2410 *
y_to
 = 
num_grid_rows
 - 
	`my_œªd
(
¾y
 - 1);

2411 } ià(*
x_to
 < 1) {

2412 *
x_to
 = 0;

2413 *
y_to
 = 
num_grid_rows
 - 
	`my_œªd
(
¾y
 - 1);

2418 } (
x_äom
 =ğ*
x_to
è&& (
y_äom
 =ğ*
y_to
));

2420 ià(*
x_to
 < 0 || *x_tØ> 
num_grid_cŞumns
 + 1 || *
y_to
 < 0

2421 || *
y_to
 > 
num_grid_rows
 + 1) {

2422 
	`´štf
("Error in„outine find_to: (x_to,y_to) = (%d,%d)\n",

2423 *
x_to
, *
y_to
);

2424 
	`ex™
(1);

2427 ià(
kblock_ty³
 =ğ
B_CLB_TYPE
) {

2428 ià(
bš_grids
[*
x_to
][*
y_to
].
grid_ty³
 !ğ
B_CLB_TYPE
) {

2429 
	`´štf
("Error: Moving CLB_TYPEo illegalype blocks‡t (%d,%d)\n",

2430 *
x_to
, *
y_to
);

2431 
	`ex™
(1);

2434 ià(
bš_grids
[*
x_to
][*
y_to
].
grid_ty³
 !ğ
IO_TYPE
) {

2435 
	`´štf
("Error: Moving IO_TYPE blockso illegalype†ocation‡t "

2436 "(%d,%d)\n", *
x_to
, *
y_to
);

2437 
	`ex™
(1);

2440 
	}
}

2442 
	$as£ss_sw­
(
d–_co¡
,

2443 
t
)

2446 
acû±
 = -1;

2447 
âum
;

2449 ià(
d–_co¡
 <= 0) {

2450 #ifdeà
SPEC


2451 
âum
 = 
	`my_äªd
();

2453 
acû±
 = 1;

2454 (
acû±
);

2457 ià(
t
 == 0.) {

2461 
âum
 = 
	`my_äªd
();

2462 
´ob_çc
 = 
	`exp
(-
d–_co¡
 / 
t
);

2463 ià(
´ob_çc
 > 
âum
) {

2464 
acû±
 = 1;

2466 
acû±
 = 0;

2469  
acû±
;

2470 
	}
}

2476 
	$»compu‹_bb_co¡
(
¶aû_co¡_ty³
,

2477 
num_»giÚs
)

2479 
co¡
 = 0;

2481 
i
, 
j
, 
š‘
;

2482 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

2483 
i
 = 0; i < 
num_»giÚs
; ++i) {

2484 
j
 = 0; j < 
num_»giÚs
; ++j) {

2485 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 = 0.;

2486 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 = 0.;

2491 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

2492 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

2494 ià(
¶aû_co¡_ty³
 !ğ
NONLINEAR_CONG
) {

2495 
co¡
 +ğ
Ãt_co¡
[
š‘
];

2497 
	`upd©e_»giÚ_occ
(
š‘
,

2498 &
bb_coÜds
[
š‘
],

2500 
num_»giÚs
);

2505 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

2506 
co¡
 = 
	`nÚlš—r_cÚg_co¡
(
num_»giÚs
);

2509  
co¡
;

2510 
	}
}

2516 
	$compu‹_pošt_to_pošt_d–ay
(
š‘
,

2517 
sšk_pš
)

2519 
sourû_block_šdex
 = 
Ãt
[
š‘
].
node_blocks
[0];

2520 
sšk_block_šdex
 = 
Ãt
[
š‘
].
node_blocks
[
sšk_pš
];

2521 
	`as£¹
(
sourû_block_šdex
 !ğ
sšk_block_šdex
);

2523 
block_ty³s_t
 
sourû_ty³
 = 
blocks
[
sourû_block_šdex
].
block_ty³
;

2524 
block_ty³s_t
 
sšk_ty³
 = 
blocks
[
sšk_block_šdex
].
block_ty³
;

2526 
d–_x
 = 
	`abs
(
blocks
[
sšk_block_šdex
].
x
 - blocks[
sourû_block_šdex
].x);

2527 
d–_y
 = 
	`abs
(
blocks
[
sšk_block_šdex
].
y
 - blocks[
sourû_block_šdex
].y);

2529 
d–ay_sourû_to_sšk
 = 0.0;

2530 ià(
sourû_ty³
 =ğ
B_CLB_TYPE
) {

2531 ià(
sšk_ty³
 =ğ
B_CLB_TYPE
) {

2532 
d–ay_sourû_to_sšk
 = 
d–_şb_to_şb
[
d–_x
][
d–_y
];

2533 } ià(
sšk_ty³
 =ğ
OUTPAD_TYPE
) {

2535 
d–ay_sourû_to_sšk
 = 
d–_şb_to_ouad
[
d–_x
][
d–_y
];

2537 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, \
 from clb output…ino input…ad\n");

2539 
	`ex™
(1);

2541 } ià(
sourû_ty³
 =ğ
INPAD_TYPE
) {

2542 ià(
sšk_ty³
 =ğ
B_CLB_TYPE
) {

2543 
d–ay_sourû_to_sšk
 = 
d–_š·d_to_şb
[
d–_x
][
d–_y
];

2544 } ià(
sšk_ty³
 =ğ
OUTPAD_TYPE
) {

2545 
d–ay_sourû_to_sšk
 = 
d–_š·d_to_ouad
[
d–_x
][
d–_y
];

2547 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, \
 from input…ado input…ad\n");

2549 
	`ex™
(1);

2552 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, bad source_type\n");

2553 
	`ex™
(1);

2556 ià(
d–ay_sourû_to_sšk
 < 0.0) {

2557 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, Tdel is†esshan 0\n");

2558 
	`ex™
(1);

2561  
d–ay_sourû_to_sšk
;

2562 
	}
}

2566 
	$upd©e_timšg_driv’_co¡
(
äom_block
,

2567 
to_block
,

2568 
num_of_pšs
)

2572 
blkpš
, 
Ãt_pš
, 
š‘
, 
š
;

2573 
blkpš
 = 0; blkpš < 
num_of_pšs
; ++blkpin) {

2574 
š‘
 = 
blocks
[
äom_block
].
Ãts
[
blkpš
];

2575 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

2579 
Ãt_pš
 = 
Ãt_pš_šdex
[
äom_block
][
blkpš
];

2580 ià(
Ãt_pš
 != 0) {

2582 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


2583 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

2584 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] =

2585 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
];

2586 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = -1;

2588 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2589 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
];

2590 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] = -1;

2594 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2595 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2596 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] =

2597 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
];

2598 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

2600 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2601 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
];

2602 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

2607 ià(
to_block
 !ğ
EMPTY
) {

2608 
blkpš
 = 0; blkpš < 
num_of_pšs
; ++blkpin) {

2609 
š‘
 = 
blocks
[
to_block
].
Ãts
[
blkpš
];

2610 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

2614 
Ãt_pš
 = 
Ãt_pš_šdex
[
to_block
][
blkpš
];

2615 ià(
Ãt_pš
 != 0) {

2617 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


2618 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

2619 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] =

2620 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
];

2621 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = -1;

2623 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2624 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
];

2625 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] = -1;

2629 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2630 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2631 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] =

2632 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
];

2633 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

2635 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2636 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
];

2637 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

2642 
	}
}

2648 
	$compu‹_d–_timšg_driv’_co¡
(
¶aû_®gÜ™hm_t
 
¶aû_®gÜ™hm
,

2649 
äom_block
,

2650 
to_block
,

2651 
num_of_pšs
,

2652 * 
d–_timšg
,

2653 * 
d–_d–ay
)

2655 
š‘
, 
Ãt_pš
, 
š
;

2656 
‹mp_d–ay
 = 0.0;

2657 
d–_timšg_co¡
 = 0.0;

2658 
d–_d–ay_co¡
 = 0.0;

2659 
k
 = -1;

2660 
k
 = 0; k < 
num_of_pšs
; ++k) {

2661 
š‘
 = 
blocks
[
äom_block
].
Ãts
[
k
];

2662 ià(
š‘
 =ğ
OPEN
 || 
TRUE
 =ğ
is_glob®
[inet]) {

2666 
Ãt_pš
 = 
Ãt_pš_šdex
[
äom_block
][
k
];

2667 ià(
Ãt_pš
 != 0) {

2673 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


2674 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

2675 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2676 
Ãt_pš
);

2677 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = 
‹mp_d–ay
;

2679 ià(
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

2680 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2681 
subÃt_loÿl_ü™_weight
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

2683 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2684 
timšg_¶aû_ü™
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

2687 
d–_d–ay_co¡
 +ğ
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]

2688 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
];

2689 
d–_timšg_co¡
 +ğ
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]

2690 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
];

2694 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2695 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2696 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2697 
š
);

2698 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay
;

2700 ià(
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

2701 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2702 
subÃt_loÿl_ü™_weight
[
š‘
][
š
] * 
‹mp_d–ay
;

2704 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2705 
timšg_¶aû_ü™
[
š‘
][
š
] * 
‹mp_d–ay
;

2708 
d–_d–ay_co¡
 +ğ
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]

2709 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
];

2710 
d–_timšg_co¡
 +ğ
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
]

2711 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
];

2716 ià(
to_block
 !ğ
EMPTY
) {

2717 
k
 = 0; k < 
num_of_pšs
; ++k) {

2718 
š‘
 = 
blocks
[
to_block
].
Ãts
[
k
];

2719 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[inet]) {

2723 
Ãt_pš
 = 
Ãt_pš_šdex
[
to_block
][
k
];

2724 ià(
Ãt_pš
 != 0) {

2730 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


2731 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

2732 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2733 
Ãt_pš
);

2734 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = 
‹mp_d–ay
;

2736 ià(
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

2737 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2738 
subÃt_loÿl_ü™_weight
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

2740 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2741 
timšg_¶aû_ü™
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

2744 
d–_d–ay_co¡
 +ğ
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]

2745 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
];

2746 
d–_timšg_co¡
 +ğ
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]

2747 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
];

2751 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2752 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2753 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2754 
š
);

2755 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay
;

2757 ià(
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

2758 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2759 
subÃt_loÿl_ü™_weight
[
š‘
][
š
] * 
‹mp_d–ay
;

2761 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2762 
timšg_¶aû_ü™
[
š‘
][
š
] * 
‹mp_d–ay
;

2765 
d–_d–ay_co¡
 +ğ
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]

2766 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
];

2768 
d–_timšg_co¡
 +ğ
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
]

2769 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
];

2775 *
d–_timšg
 = 
d–_timšg_co¡
;

2776 *
d–_d–ay
 = 
d–_d–ay_co¡
;

2777 
	}
}

2784 
	$compu‹_timšg_driv’_co¡_by_Üig_®go
(* 
timšg_co¡
,

2785 * 
cÚÃùiÚ_d–ay_sum
)

2787 
loÿl_timšg_co¡
 = 0.0;

2788 
loÿl_cÚÃù_d–ay_sum
 = 0.0;

2790 
š‘
 = -1;

2791 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

2792 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

2793 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2795 
š
 = 0;

2796 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2798 
subÃt_d–ay_co¡
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2799 
š
);

2800 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
subÃt_d–ay_co¡
;

2801 
loÿl_cÚÃù_d–ay_sum
 +ğ
subÃt_d–ay_co¡
;

2803 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

2806 
subÃt_timšg_co¡
 =

2807 
subÃt_d–ay_co¡
 * 
timšg_¶aû_ü™
[
š‘
][
š
];

2808 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = 
subÃt_timšg_co¡
;

2809 
loÿl_timšg_co¡
 +ğ
subÃt_timšg_co¡
;

2812 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

2817 *
timšg_co¡
 = 
loÿl_timšg_co¡
;

2818 *
cÚÃùiÚ_d–ay_sum
 = 
loÿl_cÚÃù_d–ay_sum
;

2819 
	}
}

2825 
	$compu‹_timšg_driv’_co¡s_by_·th_®go
(* 
timšg_co¡
,

2826 * 
cÚÃùiÚ_d–ay_sum
)

2828 
loÿl_timšg_co¡
 = 0.0;

2829 
loÿl_cÚÃù_d–ay_sum
 = 0.0;

2831 
š‘
 = -1;

2832 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

2833 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

2834 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2836 
š
 = 0;

2837 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2838 
subÃt_d–ay_co¡
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2839 
š
);

2840 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
subÃt_d–ay_co¡
;

2841 
loÿl_cÚÃù_d–ay_sum
 +ğ
subÃt_d–ay_co¡
;

2843 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

2845 
subÃt_timšg_co¡
 =

2846 
subÃt_d–ay_co¡
 * 
subÃt_loÿl_ü™_weight
[
š‘
][
š
];

2848 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = 
subÃt_timšg_co¡
;

2849 
loÿl_timšg_co¡
 +ğ
subÃt_timšg_co¡
;

2851 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

2856 *
timšg_co¡
 = 
loÿl_timšg_co¡
;

2857 *
cÚÃùiÚ_d–ay_sum
 = 
loÿl_cÚÃù_d–ay_sum
;

2858 
	}
}

2867 
	$compu‹_bb_co¡
(
m‘hod
,

2868 
¶aû_co¡_ty³
,

2869 
num_»giÚs
)

2872 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

2873 
i
 = -1;

2874 
j
 = -1;

2875 
i
 = 0; i < 
num_»giÚs
; ++i) {

2876 
j
 = 0; j < 
num_»giÚs
; ++j) {

2877 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 = 0.;

2878 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 = 0.;

2883 
n
 = -1;

2884 
co¡
 = 0.0;

2885 
n
 = 0;‚ < 
num_Ãts
; ++n) {

2886 ià(
is_glob®
[
n
] =ğ
FALSE
) {

2889 ià(
Ãt
[
n
].
num_Ãt_pšs
 > 
SMALL_NET
 && 
m‘hod
 =ğ
NORMAL
) {

2890 
	`g‘_bb_äom_sü©ch
(
n
,

2891 &
bb_coÜds
[
n
],

2892 &
bb_num_Ú_edges
[
n
]);

2894 
	`g‘_nÚ_upd©—bË_bb
(
n
,

2895 &
bb_coÜds
[
n
]);

2898 ià(
¶aû_co¡_ty³
 !ğ
NONLINEAR_CONG
) {

2899 
Ãt_co¡
[
n
] = 
	`g‘_Ãt_co¡
(n,

2900 &
bb_coÜds
[
n
]);

2901 
co¡
 +ğ
Ãt_co¡
[
n
];

2903 
	`upd©e_»giÚ_occ
(
n
,

2904 &
bb_coÜds
[
n
],

2906 
num_»giÚs
);

2911 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

2912 
co¡
 = 
	`nÚlš—r_cÚg_co¡
(
num_»giÚs
);

2915  
co¡
;

2916 
	}
}

2927 
	$nÚlš—r_cÚg_co¡
(
num_»giÚs
)

2929 
i
, 
j
;

2930 
co¡
 = 0.;

2932 
i
 = 0; i < 
num_»giÚs
; i++) {

2933 
j
 = 0; j < 
num_»giÚs
; j++) {

2935 ià(
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 <…Ïû_»giÚ_x[i][j].
ÿ·c™y
) {

2936 
co¡
 +ğ
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 *

2937 
¶aû_»giÚ_x
[
i
][
j
].
šv_ÿ·c™y
;

2939 
tmp
 = 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 *

2940 
¶aû_»giÚ_x
[
i
][
j
].
šv_ÿ·c™y
;

2941 
co¡
 +ğ
tmp
 *mp;

2944 ià(
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 <…Ïû_»giÚ_y[i][j].
ÿ·c™y
) {

2945 
co¡
 +ğ
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 *

2946 
¶aû_»giÚ_y
[
i
][
j
].
šv_ÿ·c™y
;

2948 
tmp
 = 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 *

2949 
¶aû_»giÚ_y
[
i
][
j
].
šv_ÿ·c™y
;

2950 
co¡
 +ğ
tmp
 *mp;

2955  
co¡
;

2956 
	}
}

2963 
	$g‘_bb_äom_sü©ch
(
š‘
, 
bbox_t
* 
coÜds
,

2964 
bbox_t
* 
num_Ú_edges
)

2969 
n_pšs
;

2970 * 
¶i¡
;

2971 ià(
du¶iÿ‹_pšs
[
š‘
] == 0) {

2972 
¶i¡
 = 
Ãt
[
š‘
].
node_blocks
;

2973 
n_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2975 
¶i¡
 = 
unique_pš_li¡
[
š‘
];

2976 
n_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
 - 
du¶iÿ‹_pšs
[inet];

2979 
x
 = 
blocks
[
¶i¡
[0]].x;

2980 
y
 = 
blocks
[
¶i¡
[0]].y;

2981 
x
 = 
	`max
(
	`mš
(x, 
num_grid_cŞumns
), 1);

2982 
y
 = 
	`max
(
	`mš
(y, 
num_grid_rows
), 1);

2984 
xmš
 = 
x
;

2985 
ymš
 = 
y
;

2986 
xmax
 = 
x
;

2987 
ymax
 = 
y
;

2989 
xmš_edge
 = 1;

2990 
ymš_edge
 = 1;

2991 
xmax_edge
 = 1;

2992 
ymax_edge
 = 1;

2994 
š
 = 0;

2995 
š
 = 1; ipš < 
n_pšs
; ++ipin) {

2996 
block_num
 = 
¶i¡
[
š
];

2997 
x
 = 
blocks
[
block_num
].x;

2998 
y
 = 
blocks
[
block_num
].y;

3005 
x
 = 
	`max
(
	`mš
(x, 
num_grid_cŞumns
), 1);

3006 
y
 = 
	`max
(
	`mš
(y, 
num_grid_rows
), 1);

3008 ià(
x
 =ğ
xmš
) {

3009 ++
xmš_edge
;

3010 } ià(
x
 =ğ
xmax
) {

3011 ++
xmax_edge
;

3012 } ià(
x
 < 
xmš
) {

3013 
xmš
 = 
x
;

3014 
xmš_edge
 = 1;

3015 } ià(
x
 > 
xmax
) {

3016 
xmax
 = 
x
;

3017 
xmax_edge
 = 1;

3020 ià(
y
 =ğ
ymš
) {

3021 ++
ymš_edge
;

3022 } ià(
y
 =ğ
ymax
) {

3023 ++
ymax_edge
;

3024 } ià(
y
 < 
ymš
) {

3025 
ymš
 = 
y
;

3026 
ymš_edge
 = 1;

3027 } ià(
y
 > 
ymax
) {

3028 
ymax
 = 
y
;

3029 
ymax_edge
 = 1;

3035 
coÜds
->
xmš
 = xmin;

3036 
coÜds
->
xmax
 = xmax;

3037 
coÜds
->
ymš
 = ymin;

3038 
coÜds
->
ymax
 = ymax;

3039 
num_Ú_edges
->
xmš
 = 
xmš_edge
;

3040 
num_Ú_edges
->
xmax
 = 
xmax_edge
;

3041 
num_Ú_edges
->
ymš
 = 
ymš_edge
;

3042 
num_Ú_edges
->
ymax
 = 
ymax_edge
;

3043 
	}
}

3047 
	$g‘_Ãt_co¡
(
š‘
, 
bbox_t
* 
bb±r
)

3051 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

3052 
üossšg
 = 0.0;

3053 ià(
knum_Ãt_pšs
 > 50) {

3054 
üossšg
 = 2.7933 + 0.02616 * (
knum_Ãt_pšs
 - 50);

3057 
üossšg
 = 
üoss_couÁ
[
knum_Ãt_pšs
 - 1];

3065 
nco¡
 = (
bb±r
->
xmax
 - bb±r->
xmš
 + 1è* 
üossšg
 *

3066 
chªx_¶aû_co¡_çc
[
bb±r
->
ymax
][bb±r->
ymš
 - 1];

3067 
nco¡
 +ğ(
bb±r
->
ymax
 - bb±r->
ymš
 + 1è* 
üossšg
 *

3068 
chªy_¶aû_co¡_çc
[
bb±r
->
xmax
][bb±r->
xmš
 - 1];

3069 (
nco¡
);

3070 
	}
}

3080 
	$g‘_nÚ_upd©—bË_bb
(
š‘
, 
bbox_t
* 
bb_coÜd_Ãw
)

3082 
x
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[0]].x;

3083 
y
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[0]].y;

3084 
xmš
 = 
x
;

3085 
ymš
 = 
y
;

3086 
xmax
 = 
x
;

3087 
ymax
 = 
y
;

3089 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

3090 
k
 = 0;

3091 
k
 = 1; k < 
knum_Ãt_pšs
; ++k) {

3092 
x
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[
k
]].x;

3093 
y
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[
k
]].y;

3095 ià(
x
 < 
xmš
) {

3096 
xmš
 = 
x
;

3097 } ià(
x
 > 
xmax
) {

3098 
xmax
 = 
x
;

3101 ià(
y
 < 
ymš
) {

3102 
ymš
 = 
y
;

3103 } ià(
y
 > 
ymax
) {

3104 
ymax
 = 
y
;

3114 
bb_coÜd_Ãw
->
xmš
 = 
	`max
(
	`mš
(xmš, 
num_grid_cŞumns
), 1);

3115 
bb_coÜd_Ãw
->
ymš
 = 
	`max
(
	`mš
(ymš, 
num_grid_rows
), 1);

3116 
bb_coÜd_Ãw
->
xmax
 = 
	`max
(
	`mš
(xmax, 
num_grid_cŞumns
), 1);

3117 
bb_coÜd_Ãw
->
ymax
 = 
	`max
(
	`mš
(ymax, 
num_grid_rows
), 1);

3118 
	}
}

3131 
	$upd©e_bb
(
š‘
,

3132 
bbox_t
* 
bb_coÜd_Ãw
,

3133 
bbox_t
* 
bb_edge_Ãw
,

3134 
xŞd
, 
yŞd
, 
xÃw
, 
yÃw
)

3136 
xÃw
 = 
	`max
(
	`mš
(xÃw, 
num_grid_cŞumns
), 1);

3137 
yÃw
 = 
	`max
(
	`mš
(yÃw, 
num_grid_rows
), 1);

3138 
xŞd
 = 
	`max
(
	`mš
(xŞd, 
num_grid_cŞumns
), 1);

3139 
yŞd
 = 
	`max
(
	`mš
(yŞd, 
num_grid_rows
), 1);

3142 ià(
xÃw
 < 
xŞd
) {

3144 ià(
xŞd
 =ğ
bb_coÜds
[
š‘
].
xmax
) {

3145 ià(
bb_num_Ú_edges
[
š‘
].
xmax
 == 1) {

3146 
	`g‘_bb_äom_sü©ch
(
š‘
, 
bb_coÜd_Ãw
, 
bb_edge_Ãw
);

3149 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax - 1;

3150 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

3154 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

3155 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax;

3159 ià(
xÃw
 < 
bb_coÜds
[
š‘
].
xmš
) {

3160 
bb_coÜd_Ãw
->
xmš
 = 
xÃw
;

3161 
bb_edge_Ãw
->
xmš
 = 1;

3162 } ià(
xÃw
 =ğ
bb_coÜds
[
š‘
].
xmš
) {

3163 
bb_coÜd_Ãw
->
xmš
 = 
xÃw
;

3164 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin + 1;

3166 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

3167 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin;

3169 } ià(
xÃw
 > 
xŞd
) {

3171 ià(
xŞd
 =ğ
bb_coÜds
[
š‘
].
xmš
) {

3172 ià(
bb_num_Ú_edges
[
š‘
].
xmš
 == 1) {

3173 
	`g‘_bb_äom_sü©ch
(
š‘
, 
bb_coÜd_Ãw
, 
bb_edge_Ãw
);

3176 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin - 1;

3177 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

3180 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

3181 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin;

3185 ià(
xÃw
 > 
bb_coÜds
[
š‘
].
xmax
) {

3186 
bb_coÜd_Ãw
->
xmax
 = 
xÃw
;

3187 
bb_edge_Ãw
->
xmax
 = 1;

3188 } ià(
xÃw
 =ğ
bb_coÜds
[
š‘
].
xmax
) {

3189 
bb_coÜd_Ãw
->
xmax
 = 
xÃw
;

3190 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax + 1;

3192 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

3193 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax;

3197 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

3198 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

3199 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin;

3200 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax;

3204 ià(
yÃw
 < 
yŞd
) {

3206 ià(
yŞd
 =ğ
bb_coÜds
[
š‘
].
ymax
) {

3207 ià(
bb_num_Ú_edges
[
š‘
].
ymax
 == 1) {

3208 
	`g‘_bb_äom_sü©ch
(
š‘
, 
bb_coÜd_Ãw
, 
bb_edge_Ãw
);

3211 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax - 1;

3212 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

3215 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

3216 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax;

3220 ià(
yÃw
 < 
bb_coÜds
[
š‘
].
ymš
) {

3221 
bb_coÜd_Ãw
->
ymš
 = 
yÃw
;

3222 
bb_edge_Ãw
->
ymš
 = 1;

3223 } ià(
yÃw
 =ğ
bb_coÜds
[
š‘
].
ymš
) {

3224 
bb_coÜd_Ãw
->
ymš
 = 
yÃw
;

3225 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin + 1;

3227 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

3228 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin;

3231 } ià(
yÃw
 > 
yŞd
) {

3233 ià(
yŞd
 =ğ
bb_coÜds
[
š‘
].
ymš
) {

3234 ià(
bb_num_Ú_edges
[
š‘
].
ymš
 == 1) {

3235 
	`g‘_bb_äom_sü©ch
(
š‘
, 
bb_coÜd_Ãw
, 
bb_edge_Ãw
);

3238 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin - 1;

3239 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

3242 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

3243 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin;

3247 ià(
yÃw
 > 
bb_coÜds
[
š‘
].
ymax
) {

3248 
bb_coÜd_Ãw
->
ymax
 = 
yÃw
;

3249 
bb_edge_Ãw
->
ymax
 = 1;

3250 } ià(
yÃw
 =ğ
bb_coÜds
[
š‘
].
ymax
) {

3251 
bb_coÜd_Ãw
->
ymax
 = 
yÃw
;

3252 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax + 1;

3254 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

3255 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax;

3259 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

3260 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

3261 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin;

3262 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax;

3264 
	}
}

3278 
	$®loc_ªd_lßd_fÜ_ç¡_co¡_upd©e
(
¶aû_co¡_exp
)

3280 
low
, 
high
, 
i
;

3285 
chªx_¶aû_co¡_çc
 = (**)
	`my_m®loc
((
num_grid_rows
 + 1) * (*));

3286 
i
 = 0; i <ğ
num_grid_rows
; ++i) {

3287 
chªx_¶aû_co¡_çc
[
i
] = (*)
	`my_m®loc
((i + 1) * ());

3291 
chªy_¶aû_co¡_çc
 = (**)
	`my_m®loc
((
num_grid_cŞumns
 + 1) * (*));

3292 
i
 = 0; i <ğ
num_grid_cŞumns
; ++i) {

3293 
chªy_¶aû_co¡_çc
[
i
] = (*)
	`my_m®loc
((i + 1) * ());

3298 
chªx_¶aû_co¡_çc
[0][0] = 
chª_width_x
[0];

3300 
high
 = 1; high <ğ
num_grid_rows
; ++high) {

3301 
chªx_¶aû_co¡_çc
[
high
][high] = 
chª_width_x
[high];

3303 
low
 = 0;†ow < 
high
; ++low) {

3304 
chªx_¶aû_co¡_çc
[
high
][
low
] =

3305 
chªx_¶aû_co¡_çc
[
high
-1][
low
] + 
chª_width_x
[high];

3316 
high
 = 0; high <ğ
num_grid_rows
; ++high)

3317 
low
 = 0;†ow <ğ
high
; ++low) {

3318 
chªx_¶aû_co¡_çc
[
high
][
low
] =

3319 (
high
 - 
low
 + 1.0è/ 
chªx_¶aû_co¡_çc
[high][low];

3320 
chªx_¶aû_co¡_çc
[
high
][
low
] =

3321 
	`pow
(()
chªx_¶aû_co¡_çc
[
high
][
low
],

3322 ()
¶aû_co¡_exp
);

3327 
chªy_¶aû_co¡_çc
[0][0] = 
chª_width_y
[0];

3328 
high
 = 1; high <ğ
num_grid_cŞumns
; ++high) {

3329 
chªy_¶aû_co¡_çc
[
high
][high] = 
chª_width_y
[high];

3330 
low
 = 0;†ow < 
high
; ++low) {

3331 
chªy_¶aû_co¡_çc
[
high
][
low
] =

3332 
chªy_¶aû_co¡_çc
[
high
 - 1][
low
] + 
chª_width_y
[high];

3338 
high
 = 0; high <ğ
num_grid_cŞumns
; ++high) {

3339 
low
 = 0;†ow <ğ
high
; ++low) {

3340 
chªy_¶aû_co¡_çc
[
high
][
low
] =

3341 (
high
 - 
low
 + 1.è/ 
chªy_¶aû_co¡_çc
[high][low];

3342 
chªy_¶aû_co¡_çc
[
high
][
low
] =

3343 
	`pow
(()
chªy_¶aû_co¡_çc
[
high
][
low
],

3344 ()
¶aû_co¡_exp
);

3347 
	}
}

3349 
	$ä“_ç¡_co¡_upd©e_¡ruùs
()

3353 
i
;

3354 
i
 = 0; i <ğ
num_grid_rows
; i++) {

3355 
	`ä“
(
chªx_¶aû_co¡_çc
[
i
]);

3357 
	`ä“
(
chªx_¶aû_co¡_çc
);

3359 
i
 = 0; i <ğ
num_grid_cŞumns
; i++) {

3360 
	`ä“
(
chªy_¶aû_co¡_çc
[
i
]);

3362 
	`ä“
(
chªy_¶aû_co¡_çc
);

3363 
	}
}

3371 
	$check_¶aû
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

3372 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
)

3374 
bb_co¡_check
 = 
	`compu‹_bb_co¡
(
CHECK
,

3375 
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

3376 
¶aûr_İts_±r
->
num_»giÚs
);

3377 
	`´štf
("bb_cost„ecomputed from scratch is %g.\n",

3378 
bb_co¡_check
);

3380 cÚ¡ 
kbb_co¡
 = 
¶aûr_co¡s_±r
->
m_bb_co¡
;

3381 
”rÜ
 = 0;

3382 ià(
	`çbs
(
bb_co¡_check
 - 
kbb_co¡
è> kbb_co¡ * 
ERROR_TOL
) {

3383 
	`´štf
("Error: bb_cost_check: %g‡nd bb_cost: %g differ in check_place.\n",

3384 
bb_co¡_check
, 
kbb_co¡
);

3385 ++
”rÜ
;

3388 
timšg_co¡_check
 = 0.0;

3389 
d–ay_co¡_check
 = 0.0;

3390 cÚ¡ 
¶aû_®gÜ™hm_t
 
¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

3391 ià(
¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||…Ïû_®gØ=ğ
PATH_TIMING_DRIVEN_PLACE


3392 || 
¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

3393 ià(
¶aû_®go
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

3394 
	`compu‹_timšg_driv’_co¡s_by_·th_®go
(&
timšg_co¡_check
,

3395 &
d–ay_co¡_check
);

3397 
	`compu‹_timšg_driv’_co¡_by_Üig_®go
(&
timšg_co¡_check
,

3398 &
d–ay_co¡_check
);

3400 
	`´štf
("timing_cost„ecomputed from scratch is %g. \n",

3401 
timšg_co¡_check
);

3403 cÚ¡ 
ktimšg_co¡
 = 
¶aûr_co¡s_±r
->
m_timšg_co¡
;

3404 ià(
	`çbs
(
timšg_co¡_check
 - 
ktimšg_co¡
è> ktimšg_co¡ * 
ERROR_TOL
) {

3405 
	`´štf
("Error:iming_cost_check: %g‡ndiming_cost: "

3407 
timšg_co¡_check
,

3408 
ktimšg_co¡
);

3409 ++
”rÜ
;

3412 
	`´štf
("d–ay_co¡„ecompu‹d from sü©ch i %g. \n", 
d–ay_co¡_check
);

3413 cÚ¡ 
kd–ay_co¡
 = 
¶aûr_co¡s_±r
->
m_d–ay_co¡
;

3414 ià(
	`çbs
(
d–ay_co¡_check
 - 
kd–ay_co¡
è> kd–ay_co¡ * 
ERROR_TOL
) {

3415 
	`´štf
("Error: delay_cost_check: %g‡nd delay_cost: "

3417 
d–ay_co¡_check
,

3418 
kd–ay_co¡
);

3419 ++
”rÜ
;

3423 * 
block_dÚe
 = (*)
	`my_m®loc
(
num_blocks
 * ());

3425 
i
, 
j
, 
k
;

3426 
i
 = 0; i < 
num_blocks
; ++i) {

3427 
block_dÚe
[
i
] = 0;

3430 
block_num
 = 
EMPTY
;

3432 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

3433 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

3434 ià(
bš_grids
[
i
][
j
].
m_u§ge
 == 0) {

3438 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

3440 cÚ¡ 
kşb_grid_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

3441 
k
 = 0; k < 
kşb_grid_ÿ·c™y
; ++k) {

3442 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

3443 ià(
blocks
[
block_num
].
block_ty³
 !ğ
B_CLB_TYPE
) {

3444 
	`´štf
("Error: blocks %dype does‚ot match clb(%d,%d,%d)ype.\n",

3445 
block_num
, 
i
, 
j
, 
k
);

3446 ++
”rÜ
;

3449 ià((
blocks
[
block_num
].
x
 !ğ
i
è|| (blocks[block_num].
y
 !ğ
j
)

3450 || (
blocks
[
block_num
].
z
 !ğ
k
)) {

3451 
	`´štf
("Error: blocks %d†ocation conflicts with clb(%d,%d,%d)"

3452 "d©a.\n", 
block_num
, 
i
, 
j
, 
k
);

3453 ++
”rÜ
;

3456 ià(
bš_grids
[
i
][
j
].
m_u§ge
 > 1) {

3457 
	`´štf
("Error: clb(%d,%d) has occupancy of %d\n",

3458 
i
, 
j
, 
bš_grids
[i][j].
m_u§ge
);

3459 ++
”rÜ
;

3461 
block_dÚe
[
block_num
]++;

3464 ià(
bš_grids
[
i
][
j
].
m_u§ge
 > bš_grids[i][j].
m_ÿ·c™y
) {

3465 
	`´štf
("E¼Ü: clb(%d,%dèha occu·ncy oà%d\n", 
i
, 
j
,

3466 
bš_grids
[
i
][
j
].
m_u§ge
);

3467 ++
”rÜ
;

3470 cÚ¡ 
kio_bš_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

3471 
k
 = 0; k < 
kio_bš_ÿ·c™y
; ++k) {

3472 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

3473 ià(
block_num
 =ğ
EMPTY
) {

3477 ià((
blocks
[
block_num
].
block_ty³
 !ğ
INPAD_TYPE
)

3478 && 
blocks
[
block_num
].
block_ty³
 !ğ
OUTPAD_TYPE
) {

3479 
	`´štf
("Error: blocks %dype does‚ot match clb(%d,%d)ype.\n",

3480 
block_num
, 
i
, 
j
);

3481 ++
”rÜ
;

3484 ià((
blocks
[
block_num
].
x
 !ğ
i
è|| (blocks[block_num].
y
 !ğ
j
)

3485 || (
blocks
[
block_num
].
z
 !ğ
k
)) {

3486 
	`´štf
("Error: blocks %d†ocation conflicts with clb(%d,%d,%d)"

3487 "d©a.\n", 
block_num
, 
i
, 
j
, 
k
);

3488 ++
”rÜ
;

3490 
block_dÚe
[
block_num
]++;

3497 
i
 = 0; i < 
num_blocks
; ++i) {

3498 ià(
block_dÚe
[
i
] != 1) {

3499 
	`´štf
("Error: blocks %d†isted %dimes in data structures.\n",

3500 
i
, 
block_dÚe
[i]);

3501 ++
”rÜ
;

3505 
	`ä“
(
block_dÚe
);

3507 ià(
”rÜ
 == 0) {

3508 
	`´štf
("\nCompleted…lacement consistency check successfully.\n\n");

3510 
	`´štf
("\nCompleted…lacement consistency check, %d Errors found.\n\n",

3511 
”rÜ
);

3512 
	`´štf
("Aborting…rogram.\n");

3513 
	`ex™
(1);

3515 
	}
}

3517 
	$»ad_¶aû
(* 
¶aû_fe
,

3518 * 
Ãt_fe
,

3519 * 
¬ch_fe
,

3520 
¶aûr_İts_t
 
¶aûr_İts
,

3521 
rou‹r_İts_t
 
rou‹r_İts
,

3522 
chª_width_di¡r_t
 
chª_width_di¡
,

3523 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

3524 
£gm’t_šfo_t
* 
£gm’t_šf
,

3525 
timšg_šfo_t
 
timšg_šf
,

3526 
subblock_d©a_t
* 
subblock_d©a_±r
)

3531 
š‘
, 
š
;

3532 ** 
dummy_x
, **
dummy_y
;

3534 ** 
Ãt_¦ack
 = 
NULL
;

3535 ** 
Ãt_d–ay
 = 
NULL
;

3537 ** 
»memb”_Ãt_d–ay_Üigš®_±r
 = 
NULL
;

3538 ià(
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


3539 || 
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE


3540 || 
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE


3541 || 
¶aûr_İts
.
’abË_timšg_computiÚs
) {

3544 
	`®loc_ªd_lßd_timšg_g¿ph
(&
¶aûr_İts
,

3545 
timšg_šf
,

3546 *
subblock_d©a_±r
);

3547 
Ãt_¦ack
 = 
	`®loc_Ãt_¦ack
();

3549 
	`®loc_d–ay_lookup_m©rixes_ªd_ü™iÿl™›s
(&
¶aûr_İts
,

3550 *
subblock_d©a_±r
,

3551 
chª_width_di¡
,

3552 
timšg_šf
,

3553 
rou‹r_İts
,

3554 
d‘_routšg_¬ch
,

3555 
£gm’t_šf
,

3556 &
Ãt_d–ay
);

3557 
»memb”_Ãt_d–ay_Üigš®_±r
 = 
Ãt_d–ay
;

3561 
	`·r£_¶aûm’t_fe
(
¶aû_fe
,

3562 
Ãt_fe
,

3563 
¬ch_fe
);

3567 
chª_width_çùÜ
 = 
¶aûr_İts
.
¶aû_chª_width
;

3568 
	`š™_chªÃl_t
(
chª_width_çùÜ
, 
chª_width_di¡
);

3572 
	`®loc_ªd_lßd_¶aûm’t_¡ruùs
(&
¶aûr_İts
,

3573 &
dummy_x
,

3574 &
dummy_y
);

3576 
bb_co¡
 = 
	`compu‹_bb_co¡
(
NORMAL
,

3577 
¶aûr_İts
.
¶aû_co¡_ty³
,

3578 
¶aûr_İts
.
num_»giÚs
);

3580 
d–ay_co¡
, 
timšg_co¡
, 
e¡_ü™
;

3581 ià(
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


3582 || 
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE


3583 || 
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE


3584 || 
¶aûr_İts
.
’abË_timšg_computiÚs
) {

3585 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

3586 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

3587 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

3588 
timšg_¶aû_ü™
[
š‘
][
š
] = 0;

3592 
Ãt_d–ay
 = 
pošt_to_pošt_d–ay_co¡
;

3594 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

3595 
e¡_ü™
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

3596 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

3598 
	`compu‹_timšg_driv’_co¡_by_Üig_®go
(&
timšg_co¡
,

3599 &
d–ay_co¡
);

3601 
	`´štf
("Placement. bb_cost: %g delay_cost: %g.\n\n",

3602 
bb_co¡
, 
d–ay_co¡
);

3603 #ifdeà
PRINT_SINK_DELAYS


3604 
	`´št_sšk_d–ays
("Placement_Sink_Delays.echo");

3606 #ifdeà
PRINT_NET_SLACKS


3607 
	`´št_Ãt_¦ack
("PÏûm’t_N‘_SÏcks.echo", 
Ãt_¦ack
);

3609 #ifdeà
PRINT_PLACE_CRIT_PATH


3610 
	`´št_ü™iÿl_·th
("Placement_Crit_Path.echo");

3612 
	`´štf
("PÏûm’ˆE¡im©ed Cr™ P©h D–ay: %g\n\n", 
e¡_ü™
);

3614 
timšg_co¡
 = 0;

3615 
d–ay_co¡
 = 0;

3616 
	`´štf
("PÏûm’ˆbb_co¡ i %g.\n", 
bb_co¡
);

3625 
	`ä“_¶aûm’t_¡ruùs
(&
¶aûr_İts
,

3626 
dummy_x
,

3627 
dummy_y
);

3629 ià(
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

3630 
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
 ||

3631 
¶aûr_İts
.
’abË_timšg_computiÚs
) {

3632 
Ãt_d–ay
 = 
»memb”_Ãt_d–ay_Üigš®_±r
;

3633 
	`ä“_lookups_ªd_ü™iÿl™›s
(&
¶aûr_İts
,

3634 &
Ãt_d–ay
,

3635 &
Ãt_¦ack
);

3638 
	`š™_d¿w_coÜds
((è
chª_width_çùÜ
);

3639 
msg
[
BUFSIZE
] = "";

3640 
	`¥rštf
(
msg
, "PÏûm’ˆäom f%s. bb_co¡ %g.", 
¶aû_fe
,

3641 
bb_co¡
);

3642 
	`upd©e_sü“n
(
MAJOR
, 
msg
, 
PLACEMENT
, 
FALSE
);

3643 
	}
}

	@place.h

1 #iâdeà
PLACE_H


2 
	#PLACE_H


	)

4 
	~"v´_ty³s.h
"

10 
	eco¡_m‘hods
 {

11 
	mNORMAL
,

12 
	mCHECK


15 
	ss_pos
 {

16 
	mx
;

17 
	my
;

18 
	mz
;

19 }** 
	gpos
;

22 
Œy_¶aû
(cÚ¡ * 
Ãi¡_fe
,

23 cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

24 cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

25 
chª_width_di¡r_t
 
chª_width_di¡
,

26 
rou‹r_İts_t
 
rou‹r_İts
,

27 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

28 
£gm’t_šfo_t
* 
£gm’t_šf
,

29 
timšg_šfo_t
 
timšg_šf
,

30 
subblock_d©a_t
* 
subblock_d©a_±r
);

32 
»ad_¶aû
(* 
¶aû_fe
,

33 * 
Ãt_fe
,

34 * 
¬ch_fe
,

35 
¶aûr_İts_t
 
¶aûr_İts_±r
,

36 
rou‹r_İts_t
 
rou‹r_İts
,

37 
chª_width_di¡r_t
 
chª_width_di¡
,

38 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

39 
£gm’t_šfo_t
* 
£gm’t_šf
,

40 
timšg_šfo_t
 
timšg_šf
,

41 
subblock_d©a_t
* 
subblock_d©a_±r
);

	@place_and_route.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"glob®s.h
"

4 
	~"¶aû_ªd_rou‹.h
"

5 
	~"¶aû.h
"

6 
	~"¶aû_·¿Î–.h
"

7 
	~"»ad_¶aû.h
"

8 
	~"rou‹_expÜt.h
"

9 
	~"d¿w.h
"

10 
	~"¡©s.h
"

11 
	~"check_rou‹.h
"

12 
	~"¼_g¿ph.h
"

13 
	~"·th_d–ay.h
"

14 
	~"Ãt_d–ay.h
"

15 
	~"timšg_¶aû.h
"

19 
bš¬y_£¬ch_¶aû_ªd_rou‹
(
¶aûr_İts_t
 
¶aûr_İts
,

20 * 
¶aû_fe
,

21 * 
Ãi¡_fe
,

22 * 
¬ch_fe
,

23 * 
rou‹_fe
,

24 
boŞ—n
 
fuÎ_¡©s
,

25 
boŞ—n
 
v”ify_bš¬y_£¬ch
,

26 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

27 
rou‹r_İts_t
 
rou‹r_İts
,

28 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

29 
£gm’t_šfo_t
* 
£gm’t_šf
,

30 
timšg_šfo_t
 
timšg_šf
,

31 
subblock_d©a_t
 *
subblock_d©a_±r
,

32 
chª_width_di¡r_t
 
chª_width_di¡
);

34 
comp_width
(
chªÃl_t
* 
chª
, 
x
, 
£·¿tiÚ
);

40 
	$¶aû_ªd_rou‹
(
İ”©iÚ_ty³s_t
 
İ”©iÚ
,

41 
¶aûr_İts_t
 
¶aûr_İts
,

42 * 
¶aû_fe
,

43 * 
Ãi¡_fe
,

44 * 
¬ch_fe
,

45 * 
rou‹_fe
,

46 
boŞ—n
 
fuÎ_¡©s
,

47 
boŞ—n
 
v”ify_bš¬y_£¬ch
,

48 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

49 
rou‹r_İts_t
 
rou‹r_İts
,

50 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

51 
£gm’t_šfo_t
* 
£gm’t_šf
,

52 
timšg_šfo_t
 
timšg_šf
,

53 
subblock_d©a_t
* 
subblock_d©a_±r
,

54 
chª_width_di¡r_t
 
chª_width_di¡
)

57 
msg
[
BUFSIZE
] = "";

58 
width_çc
 = 0;

59 
boŞ—n
 
sucûss
 = 
FALSE
;

60 ** 
Ãt_d–ay
 = 
NULL
;

61 ** 
Ãt_¦ack
 = 
NULL
;

62 
lšked_v±r_t
* 
Ãt_d–ay_chunk_li¡_h—d
 = 
NULL
;

63 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
;

65 ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_NEVER
) {

66 
	`»ad_¶aû
(
¶aû_fe
,

67 
Ãi¡_fe
,

68 
¬ch_fe
,

69 
¶aûr_İts
,

70 
rou‹r_İts
,

71 
chª_width_di¡
,

72 
d‘_routšg_¬ch
,

73 
£gm’t_šf
,

74 
timšg_šf
,

75 
subblock_d©a_±r
);

76 } ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_ONCE
) {

77 ià(
¶aûr_İts
.
¶aû_·¿Î–
 =ğ
FALSE
) {

78 
	`Œy_¶aû
(
Ãi¡_fe
,

79 &
¶aûr_İts
,

80 
ªÃ®šg_sched
,

81 
chª_width_di¡
,

82 
rou‹r_İts
,

83 
d‘_routšg_¬ch
,

84 
£gm’t_šf
,

85 
timšg_šf
,

86 
subblock_d©a_±r
);

88 
	`Œy_¶aû_u£_muÉi_th»ads
(&
¶aûr_İts
,

89 
ªÃ®šg_sched
,

90 
chª_width_di¡
,

91 
rou‹r_İts
,

92 
d‘_routšg_¬ch
,

93 
£gm’t_šf
,

94 
timšg_šf
,

95 
subblock_d©a_±r
);

98 
	`´št_¶aû
(
¶aû_fe
,

99 
Ãi¡_fe
,

100 
¬ch_fe
);

101 } ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_ALWAYS


102 && 
rou‹r_İts
.
fixed_chªÃl_width
 !ğ
NO_FIXED_CHANNEL_WIDTH
) {

103 
¶aûr_İts
.
¶aû_chª_width
 = 
rou‹r_İts
.
fixed_chªÃl_width
;

105 ià(
¶aûr_İts
.
¶aû_·¿Î–
 =ğ
FALSE
) {

106 
	`Œy_¶aû
(
Ãi¡_fe
,

107 &
¶aûr_İts
,

108 
ªÃ®šg_sched
,

109 
chª_width_di¡
,

110 
rou‹r_İts
,

111 
d‘_routšg_¬ch
,

112 
£gm’t_šf
,

113 
timšg_šf
,

114 
subblock_d©a_±r
);

116 
	`Œy_¶aû_u£_muÉi_th»ads
(&
¶aûr_İts
,

117 
ªÃ®šg_sched
,

118 
chª_width_di¡
,

119 
rou‹r_İts
,

120 
d‘_routšg_¬ch
,

121 
£gm’t_šf
,

122 
timšg_šf
,

123 
subblock_d©a_±r
);

125 
	`´št_¶aû
(
¶aû_fe
,

126 
Ãi¡_fe
,

127 
¬ch_fe
);

130 
	`fæush
(
¡dout
);

132 ià(
İ”©iÚ
 =ğ
PLACE_ONLY
) {

137 ià(
rou‹r_İts
.
fixed_chªÃl_width
 =ğ
NO_FIXED_CHANNEL_WIDTH
) {

138 
width_çc
 = 
	`bš¬y_£¬ch_¶aû_ªd_rou‹
(
¶aûr_İts
,

139 
¶aû_fe
,

140 
Ãi¡_fe
,

141 
¬ch_fe
,

142 
rou‹_fe
,

143 
fuÎ_¡©s
,

144 
v”ify_bš¬y_£¬ch
,

145 
ªÃ®šg_sched
,

146 
rou‹r_İts
,

147 
d‘_routšg_¬ch
,

148 
£gm’t_šf
,

149 
timšg_šf
,

150 
subblock_d©a_±r
,

151 
chª_width_di¡
);

154 
width_çc
 = 
rou‹r_İts
.
fixed_chªÃl_width
;

156 
şb_İšs_u£d_loÿÎy
 = 
	`®loc_rou‹_¡ruùs
(*
subblock_d©a_±r
);

158 ià(
timšg_šf
.
timšg_ª®ysis_’abËd
) {

159 
	`®loc_ªd_lßd_timšg_g¿ph
(&
¶aûr_İts
,

160 
timšg_šf
,

161 *
subblock_d©a_±r
);

162 
Ãt_¦ack
 = 
	`®loc_Ãt_¦ack
();

163 
Ãt_d–ay
 = 
	`®loc_Ãt_d–ay
(&
Ãt_d–ay_chunk_li¡_h—d
);

165 
Ãt_d–ay
 = 
NULL
;

166 
Ãt_¦ack
 = 
NULL
;

170 
	`ä“_subblock_d©a
(
subblock_d©a_±r
);

171 
sucûss
 = 
	`Œy_rou‹
(
width_çc
,

172 
rou‹r_İts
,

173 
d‘_routšg_¬ch
,

174 
£gm’t_šf
,

175 
timšg_šf
,

176 
Ãt_¦ack
,

177 
Ãt_d–ay
,

178 
chª_width_di¡
,

179 
şb_İšs_u£d_loÿÎy
);

182 ià(
sucûss
 =ğ
FALSE
) {

183 
	`´štf
("Circuit is unrouteable with‡ channel width factor of %d.\n\n",

184 
width_çc
);

185 
	`¥rštf
(
msg
, "Routing failed with‡ channel width factor of %d. ILLEGAL "

186 "routšg shown.", 
width_çc
);

188 
	`check_rou‹
(
rou‹r_İts
.
rou‹_ty³
,

189 
d‘_routšg_¬ch
.
num_sw™ch
,

190 
şb_İšs_u£d_loÿÎy
);

191 
	`g‘_£rŸl_num
();

192 
	`´štf
("Circuit successfully„outed with‡ channel width factor of %d."

193 "\n\n", 
width_çc
);

194 
	`routšg_¡©s
(
fuÎ_¡©s
, 
rou‹r_İts
.
rou‹_ty³
,

195 
d‘_routšg_¬ch
.
num_sw™ch
, 
£gm’t_šf
,

196 
d‘_routšg_¬ch
.
num_£gm’t
, d‘_routšg_¬ch.
R_mšW_nmos
,

197 
d‘_routšg_¬ch
.
R_mšW_pmos
, 
timšg_šf
.
timšg_ª®ysis_’abËd
,

198 
Ãt_¦ack
, 
Ãt_d–ay
);

199 
	`´št_rou‹
(
rou‹_fe
);

200 #ifdeà
PRINT_SINK_DELAYS


201 
	`´št_sšk_d–ays
("Routing_Sink_Delays.echo");

203 
	`¥rštf
(
msg
, "Routing succeeded with‡ channel width factor of %d.",

204 
width_çc
);

207 
	`š™_d¿w_coÜds
(
max_pšs_³r_şb
);

208 
	`upd©e_sü“n
(
MAJOR
, 
msg
, 
ROUTING
, 
timšg_šf
.
timšg_ª®ysis_’abËd
);

211 ià(
timšg_šf
.
timšg_ª®ysis_’abËd
) {

212 
	`ä“_timšg_g¿ph
(
Ãt_¦ack
);

213 
	`ä“_Ãt_d–ay
(
Ãt_d–ay
, &
Ãt_d–ay_chunk_li¡_h—d
);

215 
	`ä“_rou‹_¡ruùs
(
şb_İšs_u£d_loÿÎy
);

216 
	`fæush
(
¡dout
);

217 
	}
}

220 
	$bš¬y_£¬ch_¶aû_ªd_rou‹
(
¶aûr_İts_t
 
¶aûr_İts
,

221 * 
¶aû_fe
, * 
Ãi¡_fe
,

222 * 
¬ch_fe
, * 
rou‹_fe
,

223 
boŞ—n
 
fuÎ_¡©s
,

224 
boŞ—n
 
v”ify_bš¬y_£¬ch
,

225 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

226 
rou‹r_İts_t
 
rou‹r_İts
,

227 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

228 
£gm’t_šfo_t
* 
£gm’t_šf
,

229 
timšg_šfo_t
 
timšg_šf
,

230 
subblock_d©a_t
 *
subblock_d©a_±r
,

231 
chª_width_di¡r_t
 
chª_width_di¡
)

236 
msg
[
BUFSIZE
];

237 
lšked_v±r_t
* 
Ãt_d–ay_chunk_li¡_h—d
;

241 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
 = 
	`®loc_rou‹_¡ruùs
(*
subblock_d©a_±r
);

242 
veùÜ_t
** 
§ved_şb_İšs_u£d_loÿÎy
;

244 
s_Œaû
** 
be¡_routšg
 = 
	`®loc_§ved_routšg
(
şb_İšs_u£d_loÿÎy
,

245 &
§ved_şb_İšs_u£d_loÿÎy
);

247 ** 
Ãt_d–ay
 = 
NULL
;

248 ** 
Ãt_¦ack
 = 
NULL
;

249 ià(
timšg_šf
.
timšg_ª®ysis_’abËd
) {

250 
	`®loc_ªd_lßd_timšg_g¿ph
(&
¶aûr_İts
,

251 
timšg_šf
,

252 *
subblock_d©a_±r
);

253 
Ãt_¦ack
 = 
	`®loc_Ãt_¦ack
();

254 
Ãt_d–ay
 = 
	`®loc_Ãt_d–ay
(&
Ãt_d–ay_chunk_li¡_h—d
);

256 
Ãt_d–ay
 = 
NULL
;

257 
Ãt_¦ack
 = 
NULL
;

261 
	`ä“_subblock_d©a
(
subblock_d©a_±r
);

262 
cu¼’t
 = 2 * 
max_pšs_³r_şb
;

263 
low
 = -1;

264 
high
 = -1;

265 
fš®
 = -1;

267 
boŞ—n
 
sucûss
, 
´ev_sucûss
, 
´ev2_sucûss
;

268 
fš®
 == -1) {

269 
	`fæush
(
¡dout
);

270 #ifdeà
VERBOSE


271 
	`´štf
("low = %d, high = %d, cu¼’ˆğ%d\n", 
low
, 
high
, 
cu¼’t
);

277 ià(
cu¼’t
 > 
MAX_CHANNEL_WIDTH
) {

278 
	`´štf
("This circuit‡ppearso be unroutable withhe current "

280 
	`´štf
("Aborting„outing…rocedure.\n");

281 
	`ex™
(1);

284 ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_ALWAYS
) {

286 
¶aûr_İts
.
¶aû_chª_width
 = 
cu¼’t
;

287 ià(
¶aûr_İts
.
¶aû_·¿Î–
 =ğ
FALSE
) {

288 
	`Œy_¶aû
(
Ãi¡_fe
,

289 &
¶aûr_İts
,

290 
ªÃ®šg_sched
,

291 
chª_width_di¡
,

292 
rou‹r_İts
,

293 
d‘_routšg_¬ch
,

294 
£gm’t_šf
,

295 
timšg_šf
,

296 
subblock_d©a_±r
);

310 
sucûss
 = 
	`Œy_rou‹
(
cu¼’t
,

311 
rou‹r_İts
,

312 
d‘_routšg_¬ch
,

313 
£gm’t_šf
,

314 
timšg_šf
,

315 
Ãt_¦ack
,

316 
Ãt_d–ay
,

317 
chª_width_di¡
,

318 
şb_İšs_u£d_loÿÎy
);

319 ià(
sucûss
) {

320 
high
 = 
cu¼’t
;

322 ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_ALWAYS
) {

323 
	`´št_¶aû
(
¶aû_fe
, 
Ãi¡_fe
, 
¬ch_fe
);

327 
	`§ve_routšg
(
be¡_routšg
, 
şb_İšs_u£d_loÿÎy
,

328 
§ved_şb_İšs_u£d_loÿÎy
);

330 ià((
high
 - 
low
) <= 1) {

331 
fš®
 = 
high
;

334 ià(
low
 != -1) {

335 
cu¼’t
 = (
high
 + 
low
) / 2;

337 
cu¼’t
 = 
high
 / 2;

340 
low
 = 
cu¼’t
;

342 ià(
high
 != -1) {

343 ià((
high
 - 
low
) <= 1) {

344 
fš®
 = 
high
;

347 
cu¼’t
 = (
high
 + 
low
) / 2;

349 
cu¼’t
 = 
low
 * 2;

362 ià(
v”ify_bš¬y_£¬ch
) {

363 
	`´štf
("\nVerifyinghat binary search found min. channel width ...\n");

364 
´ev_sucûss
 = 
TRUE
;

366 
´ev2_sucûss
 = 
TRUE
;

367 
cu¼’t
 = 
fš®
 - 2;

369 
´ev2_sucûss
 || 
´ev_sucûss
) {

370 
	`fæush
(
¡dout
);

372 ià(
cu¼’t
 < 1) {

376 ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_ALWAYS
) {

377 
¶aûr_İts
.
¶aû_chª_width
 = 
cu¼’t
;

378 
	`Œy_¶aû
(
Ãi¡_fe
,

379 &
¶aûr_İts
,

380 
ªÃ®šg_sched
,

381 
chª_width_di¡
,

382 
rou‹r_İts
,

383 
d‘_routšg_¬ch
,

384 
£gm’t_šf
,

385 
timšg_šf
,

386 
subblock_d©a_±r
);

389 
sucûss
 = 
	`Œy_rou‹
(
cu¼’t
, 
rou‹r_İts
, 
d‘_routšg_¬ch
,

390 
£gm’t_šf
, 
timšg_šf
, 
Ãt_¦ack
, 
Ãt_d–ay
, 
chª_width_di¡
,

391 
şb_İšs_u£d_loÿÎy
);

393 ià(
sucûss
) {

394 
fš®
 = 
cu¼’t
;

395 
	`§ve_routšg
(
be¡_routšg
, 
şb_İšs_u£d_loÿÎy
,

396 
§ved_şb_İšs_u£d_loÿÎy
);

398 ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_ALWAYS
) {

399 
	`´št_¶aû
(
¶aû_fe
, 
Ãi¡_fe
, 
¬ch_fe
);

403 
´ev2_sucûss
 = 
´ev_sucûss
;

404 
´ev_sucûss
 = 
sucûss
;

405 
cu¼’t
--;

411 
	`š™_chªÃl_t
(
fš®
,

412 
chª_width_di¡
);

414 ià(
¶aûr_İts
.
¶aû_äeq
 =ğ
PLACE_ALWAYS
) {

415 
	`´štf
("Reading best…lacement back in.\n");

416 
¶aûr_İts
.
¶aû_chª_width
 = 
fš®
;

418 
	`»ad_¶aû
(
¶aû_fe
, 
Ãi¡_fe
, 
¬ch_fe
, 
¶aûr_İts
, 
rou‹r_İts
,

419 
chª_width_di¡
, 
d‘_routšg_¬ch
, 
£gm’t_šf
, 
timšg_šf
,

420 
subblock_d©a_±r
);

423 
	`ä“_¼_g¿ph
();

425 
	`bud_¼_g¿ph
(
rou‹r_İts
.
rou‹_ty³
, 
d‘_routšg_¬ch
, 
£gm’t_šf
,

426 
timšg_šf
, 
rou‹r_İts
.
rou‹r_ba£_co¡_ty³
);

428 
	`ä“_¼_g¿ph_š‹º®s
(
rou‹r_İts
.
rou‹_ty³
, 
d‘_routšg_¬ch
, 
£gm’t_šf
,

429 
timšg_šf
, 
rou‹r_İts
.
rou‹r_ba£_co¡_ty³
);

431 
	`»¡Üe_routšg
(
be¡_routšg
, 
şb_İšs_u£d_loÿÎy
,

432 
§ved_şb_İšs_u£d_loÿÎy
);

434 
	`check_rou‹
(
rou‹r_İts
.
rou‹_ty³
, 
d‘_routšg_¬ch
.
num_sw™ch
,

435 
şb_İšs_u£d_loÿÎy
);

436 
	`g‘_£rŸl_num
();

437 
	`´štf
("Be¡„outšg u£d‡ chªÃÈwidth faùÜ oà%d.\n\n", 
fš®
);

438 
	`routšg_¡©s
(
fuÎ_¡©s
, 
rou‹r_İts
.
rou‹_ty³
,

439 
d‘_routšg_¬ch
.
num_sw™ch
, 
£gm’t_šf
,

440 
d‘_routšg_¬ch
.
num_£gm’t
, d‘_routšg_¬ch.
R_mšW_nmos
,

441 
d‘_routšg_¬ch
.
R_mšW_pmos
, 
timšg_šf
.
timšg_ª®ysis_’abËd
,

442 
Ãt_¦ack
, 
Ãt_d–ay
);

443 
	`´št_rou‹
(
rou‹_fe
);

444 #ifdeà
PRINT_SINK_DELAYS


445 
	`´št_sšk_d–ays
("Routing_Sink_Delays.echo");

447 
	`š™_d¿w_coÜds
(
max_pšs_³r_şb
);

448 
	`¥rštf
(
msg
, "Routing succeeded with‡ channel width factor of %d.",

449 
fš®
);

450 
	`upd©e_sü“n
(
MAJOR
, 
msg
, 
ROUTING
, 
timšg_šf
.
timšg_ª®ysis_’abËd
);

452 ià(
timšg_šf
.
timšg_ª®ysis_’abËd
) {

453 
	`ä“_timšg_g¿ph
(
Ãt_¦ack
);

454 
	`ä“_Ãt_d–ay
(
Ãt_d–ay
, &
Ãt_d–ay_chunk_li¡_h—d
);

457 
	`ä“_rou‹_¡ruùs
(
şb_İšs_u£d_loÿÎy
);

458 
	`ä“_§ved_routšg
(
be¡_routšg
, 
§ved_şb_İšs_u£d_loÿÎy
);

459 
	`fæush
(
¡dout
);

460  (
fš®
);

461 
	}
}

469 
	$š™_chªÃl_t
(
cçùÜ
,

470 
chª_width_di¡r_t
 
chª_width_di¡
)

472 
chª_width_io
 = 
chª_width_di¡
.chan_width_io;

473 
chªÃl_t
 
chª_x_di¡
 = 
chª_width_di¡
.chan_x_dist;

474 
chªÃl_t
 
chª_y_di¡
 = 
chª_width_di¡
.chan_y_dist;

477 
nio
 = ()
	`æoÜ
(
cçùÜ
 * 
chª_width_io
 + 0.5);

478 ià(
nio
 == 0) {

479 
nio
 = 1;

482 
chª_width_x
[0] = chª_width_x[
num_grid_rows
] = 
nio
;

483 
chª_width_y
[0] = chª_width_y[
num_grid_cŞumns
] = 
nio
;

485 
x
, 
£·¿tiÚ
;

486 
i
;

488 ià(
num_grid_rows
 > 1) {

489 
£·¿tiÚ
 = 1.0 / (
num_grid_rows
 - 2.0);

490 
x
 = 0.0;

491 
chª_width_x
[1] = ()
	`æoÜ
(
cçùÜ
 * 
	`comp_width
(&
chª_x_di¡
, 
x
,

492 
£·¿tiÚ
) + 0.5);

494 
chª_width_x
[1] = 
	`max
(chan_width_x[1], 1);

497 
i
 = 1; i < 
num_grid_rows
-1; ++i) {

498 
x
 = ()
i
 / (()(
num_grid_rows
 - 2.0));

499 
chª_width_x
[
i
+1] = ()
	`æoÜ
(
cçùÜ
 * 
	`comp_width
(&
chª_x_di¡
, 
x
,

500 
£·¿tiÚ
) + 0.5);

501 
chª_width_x
[
i
+1] = 
	`max
(chan_width_x[i+1], 1);

505 ià(
num_grid_cŞumns
 > 1) {

506 
£·¿tiÚ
 = 1.0 / (
num_grid_cŞumns
 - 2.0);

507 
x
 = 0.0;

508 
chª_width_y
[1] = ()
	`æoÜ
(
cçùÜ
 * 
	`comp_width
(&
chª_y_di¡
, 
x
,

509 
£·¿tiÚ
) + 0.5);

510 
chª_width_y
[1] = 
	`max
(chan_width_y[1], 1);

512 
i
 = 1; i < 
num_grid_cŞumns
 - 1; i++) {

513 
x
 = ()
i
 / (()(
num_grid_cŞumns
 - 2.0));

514 
chª_width_y
[
i
 + 1] = ()
	`æoÜ
(
cçùÜ
 * 
	`comp_width
(&
chª_y_di¡
, 
x
,

515 
£·¿tiÚ
) + 0.5);

516 
chª_width_y
[
i
 + 1] = 
	`max
(chan_width_y[i + 1], 1);

520 #ifdeà
VERBOSE


521 
	`´štf
("\nchan_width_x:\n");

522 
i
 = 0; i <ğ
num_grid_rows
; i++) {

523 
	`´štf
("%d ", 
chª_width_x
[
i
]);

526 
	`´štf
("\n\nchan_width_y:\n");

527 
i
 = 0; i <ğ
num_grid_cŞumns
; i++) {

528 
	`´štf
("%d ", 
chª_width_y
[
i
]);

531 
	`´štf
("\n\n");

533 
	}
}

536 
	$comp_width
(
chªÃl_t
* 
chª
, 
x
, 
£·¿tiÚ
)

542 
v®
;

544 
chª
->
ty³
) {

545 
UNIFORM
:

546 
v®
 = 
chª
->
³ak
;

549 
GAUSSIAN
:

550 
v®
 = (
x
 - 
chª
->
x³ak
è* (x - chª->x³akè/ (2 * chª->
width
 *

551 
chª
->
width
);

552 
v®
 = 
chª
->
³ak
 * 
	`exp
(-val);

553 
v®
 +ğ
chª
->
dc
;

556 
PULSE
:

557 
v®
 = (è
	`çbs
(()(
x
 - 
chª
->
x³ak
));

559 ià(
v®
 > 
chª
->
width
 / 2.) {

560 
v®
 = 0;

562 
v®
 = 
chª
->
³ak
;

565 
v®
 +ğ
chª
->
dc
;

568 
DELTA
:

569 
v®
 = 
x
 - 
chª
->
x³ak
;

571 ià(
v®
 > -
£·¿tiÚ
 / 2. && val <= separation / 2.) {

572 
v®
 = 
chª
->
³ak
;

574 
v®
 = 0.;

577 
v®
 +ğ
chª
->
dc
;

581 
	`´štf
("E¼Ü iÀcomp_width: UnknowÀchªÃÈty³ %d.\n", 
chª
->
ty³
);

582 
	`ex™
(1);

586  
v®
;

587 
	}
}

	@place_and_route.h

1 #iâdeà
PLACE_AND_ROUTE_H


2 
	#PLACE_AND_ROUTE_H


	)

4 
	~"v´_ty³s.h
"

6 
¶aû_ªd_rou‹
(
İ”©iÚ_ty³s_t
 
İ”©iÚ
,

7 
¶aûr_İts_t
 
¶aûr_İts
,

8 * 
¶aû_fe
, * 
Ãi¡_fe
,

9 * 
¬ch_fe
, * 
rou‹_fe
,

10 
boŞ—n
 
fuÎ_¡©s
, boŞ—À
v”ify_bš¬y_£¬ch
,

11 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

12 
rou‹r_İts_t
 
rou‹r_İts
,

13 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

14 
£gm’t_šfo_t
* 
£gm’t_šf
, 
timšg_šfo_t
 
timšg_šf
,

15 
subblock_d©a_t
* 
subblock_d©a_±r
,

16 
chª_width_di¡r_t
 
chª_width_di¡
);

18 
š™_chªÃl_t
(
cçùÜ
,

19 
chª_width_di¡r_t
 
chª_width_di¡
);

	@place_parallel.c

1 
	~<¡ršg.h
>

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~<as£¹.h
>

5 
	~<time.h
>

6 
	~<±h»ad.h
>

7 
	~<sys/time.h
>

9 
	~"ut.h
"

10 
	~"glob®s.h
"

11 
	~"¶aû.h
"

12 
	~"¶aû_·¿Î–.h
"

13 
	~"»ad_¶aû.h
"

14 
	~"d¿w.h
"

15 
	~"¶aû_ªd_rou‹.h
"

16 
	~"Ãt_d–ay.h
"

17 
	~"·th_d–ay.h
"

18 
	~"·th_d–ay2.h
"

19 
	~"·th_d–ay_·¿Î–.h
"

20 
	~"timšg_¶aû_lookup.h
"

21 
	~"timšg_¶aû.h
"

23 
	#_XOPEN_SOURCE
 600

	)

24 
	#T_CONSTANT_GENERATOR
 -1000

	)

26 
	#TIMING_UPDATE
 5

	)

27 
	#PARITION_UPDATE
 80

	)

30 
	#SMALL_NET
 4

	)

33 
	#FROM
 0

	)

34 
	#TO
 1

	)

35 
	#FROM_AND_TO
 2

	)

37 
	#ERROR_TOL
 .0025

	)

38 
	#MAX_MOVES_BEFORE_RECOMPUTE
 50000

	)

40 cÚ¡ 
	gkFLOAT_ZERO
 = 0.0000000001;

49 
	gx_·¹™iÚ
[64] = {

65 
	gy_·¹™iÚ
[64] = {

83 
grid_te_t
** 
	gloÿlv”t_grid
 = 
NULL
;

88 * 
	gdu¶iÿ‹_pšs
;

92 ** 
	gunique_pš_li¡
;

95 * 
	gÃt_co¡
 = 
NULL
;

96 * 
	g‹mp_Ãt_co¡
 = 
NULL
;

101 ** 
	gpošt_to_pošt_timšg_co¡
 = 
NULL
;

102 ** 
	g‹mp_pošt_to_pošt_timšg_co¡
 = 
NULL
;

106 ** 
	gpošt_to_pošt_d–ay_co¡
 = 
NULL
;

107 ** 
	g‹mp_pošt_to_pošt_d–ay_co¡
 = 
NULL
;

113 ** 
	gÃt_pš_šdex
 = 
NULL
;

118 
bbox_t
* 
	gbb_coÜds
 = 
NULL
;

119 
bbox_t
* 
	gbb_num_Ú_edges
 = 
NULL
;

125 
¶aû_»giÚ_t
** 
	g¶aû_»giÚ_x
 = 
NULL
;

126 
¶aû_»giÚ_t
** 
	g¶aû_»giÚ_y
 = 
NULL
;

129 * 
	g¶aû_»giÚ_bounds_x
 = 
NULL
;

130 * 
	g¶aû_»giÚ_bounds_y
 = 
NULL
;

139 ** 
	gchªx_¶aû_co¡_çc
;

140 ** 
	gchªy_¶aû_co¡_çc
;

145 cÚ¡ 
	güoss_couÁ
[50] = {

154 
±h»ad_d©a_t
 
	gth»ad_d©a_¬¿y
[
NUM_OF_THREADS
];

159 
	gs_¿ndnum_u£d_times
 = 0;

164 
	gs_¿ndnum_g’”©ed_couÁ
 = 0;

169 
	gg_»cÜd_¿ndnum
[
NUM_OF_SUB_REGIONS
];

173 
b¬r›r_pŞlšg
(
th»ad_id
);

175 
b¬r›r_pŞlšg_»£t
();

177 * 
Œy_¶aû_·¿Î–
(
±h»ad_d©a_t
* 
¬gs
);

179 
Œy_¶aû_a_sub»giÚ
(cÚ¡ 
kth»ad_id
,

180 cÚ¡ 
krow
,

181 cÚ¡ 
kcŞ
,

182 cÚ¡ 
k´ob
,

183 * 
move_couÁ”
,

184 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

185 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
);

188 
š™Ÿl_commÚ_·¿s
(
±h»ad_d©a_t
* 
šput_¬gs
,

189 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
);

191 
®loc_memÜy_fÜ_sw­_d©a
(cÚ¡ 
max_pšs_³r_şb
,

192 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

193 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
);

195 
š™Ÿl_sw­_d©a
(
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

196 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
);

198 
fšd_çnš_·¿Î–
(cÚ¡ 
kth»ad_id
);

200 
š™Ÿl_loÿlv”t_grid
();

202 
³rfÜm_timšg_ª®yze_·¿Î–
(cÚ¡ 
th»ad_id
,

203 *** 
Ãt_d–ay
,

204 
±h»ad_d©a_t
* 
šput_¬gs
,

205 * 
max_d–ay
);

207 
compu‹_Ãt_¦ack_fuÎ
(cÚ¡ 
kth»ad_id
,

208 *** 
Ãt_¦ack
,

209 * 
timšg_co¡
,

210 * 
d–ay_co¡
,

211 
ü™_expÚ’t
,

212 
max_d–ay
,

213 
±h»ad_d©a_t
* 
šput_¬gs
);

215 
ÿlcuÏ‹_timšg_w™hout_upd©e_ü™
(cÚ¡ 
th»ad_id
,

216 * 
timšg_co¡
,

217 * 
d–ay_co¡
,

218 
±h»ad_d©a_t
* 
šput_¬gs
);

220 
upd©e_äom_glob®_to_loÿl_grid
(cÚ¡ 
k™”
,

221 
±h»ad_d©a_t
* 
šput_¬gs
,

222 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

223 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
);

225 
b®ªû_two_cÚ£cutive_th»ads_edge
(cÚ¡ 
kth»ad_id
);

227 
b®ªû_two_cÚ£cutive_th»ads_sšks
(cÚ¡ 
kth»ad_id
);

229 
compu‹_bb_co¡_·¿Î–
(cÚ¡ 
k¡¬t_Ãt
,

230 cÚ¡ 
k’d_Ãt
);

233 
Œy_sw­_·¿Î–
(cÚ¡ 
kt
,

234 cÚ¡ 
kth»ad_id
,

235 cÚ¡ 
kx_äom
,

236 cÚ¡ 
ky_äom
,

237 cÚ¡ 
kz_äom
,

238 cÚ¡ 
krow
,

239 cÚ¡ 
kcŞ
,

240 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

241 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
);

243 
fšd_afãùed_Ãts_·¿Î–
(* 
Ãts_to_upd©e
,

244 * 
Ãt_block_moved
,

245 
äom_block
,

246 
to_block
,

247 
num_of_pšs
,

248 * 
loÿl_‹mp_Ãt_co¡
);

250 
g‘_bb_äom_sü©ch_·¿Î–
(
š‘
,

251 
bbox_t
* 
coÜds
,

252 
bbox_t
* 
num_Ú_edges
,

253 
loÿl_block_t
* 
loÿl_block
);

255 
g‘_nÚ_upd©—bË_bb_·¿Î–
(
š‘
,

256 
bbox_t
* 
bb_coÜd_Ãw
,

257 
loÿl_block_t
* 
loÿl_block
);

259 
compu‹_d–_td_co¡_·¿Î–
(cÚ¡ 
käom_block
,

260 cÚ¡ 
kto_block
,

261 
num_of_pšs
,

262 * 
d–_timšg
,

263 * 
d–_d–ay
,

264 
loÿl_block_t
* 
loÿl_block
,

265 ** 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
,

266 ** 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
);

268 
as£ss_sw­_·¿Î–
(
d–_c
,

269 
t
,

270 
loÿl_£ed
);

272 
upd©e_bb_·¿Î–
(
š‘
,

273 
bbox_t
* 
loÿl_bb_coÜd
,

274 
bbox_t
* 
loÿl_bb_edge
,

275 
bbox_t
* 
bb_coÜd_Ãw
,

276 
bbox_t
* 
bb_edge_Ãw
,

277 
xŞd
,

278 
yŞd
,

279 
xÃw
,

280 
yÃw
,

281 
loÿl_block_t
* 
loÿl_block
);

283 
boŞ—n
 
fšd_to_block_·¿Î–
(
x_äom
,

284 
y_äom
,

285 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

286 * 
x_to
,

287 * 
y_to
,

288 
th»ad_id
,

289 
xmš
, 
xmax
,

290 
ymš
, 
ymax
);

293 
upd©e_äom_loÿl_to_glob®
(
loÿl_block_t
* 
loÿl_block
,

294 
grid_te_t
** 
loÿl_grid
,

295 
x_¡¬t
, 
x_’d
,

296 
y_¡¬t
, 
y_’d
);

298 
upd©e_äom_glob®_to_loÿl_grid_Úly
(
grid_te_t
** 
loÿl_grid
,

299 cÚ¡ 
x_¡¬t
,

300 cÚ¡ 
x_’d
,

301 cÚ¡ 
y_¡¬t
,

302 cÚ¡ 
y_’d
);

304 
upd©e_loÿl_d©a_äom_glob®
(cÚ¡ * 
»giÚ_x_bound¬y
,

305 cÚ¡ * 
»giÚ_y_bound¬y
,

306 
grid_te_t
** 
loÿl_grid
,

307 
loÿl_block_t
* 
loÿl_block
,

308 cÚ¡ 
krow
,

309 cÚ¡ 
kcŞ
);

311 
upd©e_äom_glob®_to_loÿl_hÜi
(
loÿl_block_t
* 
loÿl_block
,

312 
grid_te_t
** 
loÿl_grid
,

313 
x_¡¬t
, 
x_’d
,

314 
y_¡¬t
, 
y_’d
);

316 
upd©e_äom_glob®_to_loÿl_v”t
(
loÿl_block_t
* 
loÿl_block
,

317 
grid_te_t
** 
loÿl_grid
,

318 
x_¡¬t
, 
x_’d
,

319 
y_¡¬t
, 
y_’d
);

321 
upd©e_t_·¿Î–
(* 
t
,

322 * 
šÃr_™”_num
,

323 
¿nge_lim™
,

324 
sucûss_¿t
,

325 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
);

328 
my_difáime2
(
timev®
* 
¡¬t
,

329 
timev®
* 
’d
);

334 
®loc_ªd_lßd_unique_pš_li¡
();

336 
ä“_unique_pš_li¡
();

338 
®loc_¶aû_»giÚs
(
num_»giÚs
);

340 
lßd_¶aû_»giÚs
(
num_»giÚs
);

342 
ä“_¶aû_»giÚs
(
num_»giÚs
);

344 
®loc_ªd_lßd_¶aûm’t_¡ruùs
(
¶aû_co¡_ty³
,

345 
num_»giÚs
,

346 
¶aû_co¡_exp
,

347 ** *
Şd_»giÚ_occ_x
,

348 ** *
Şd_»giÚ_occ_y
,

349 
¶aûr_İts_t


350 
¶aûr_İts
);

352 
ä“_¶aûm’t_¡ruùs
(
¶aû_co¡_ty³
,

353 
num_»giÚs
,

354 ** 
Şd_»giÚ_occ_x
,

355 ** 
Şd_»giÚ_occ_y
,

356 
¶aûr_İts_t
 
¶aûr_İts
);

358 
®loc_ªd_lßd_fÜ_ç¡_co¡_upd©e
(
¶aû_co¡_exp
);

360 
š™Ÿl_¶aûm’t
(
·d_loc_t
 
·d_loc_ty³
,

361 * 
·d_loc_fe
);

363 
comp_bb_co¡
(
m‘hod
,

364 
¶aû_co¡_ty³
,

365 
num_»giÚs
);

368 
Œy_sw­
(
t
,

369 * 
co¡
,

370 * 
bb_co¡
,

371 * 
timšg_co¡
,

372 
¿nge_lim™
,

373 
¶aû_co¡_ty³
,

374 ** 
Şd_»giÚ_occ_x
,

375 ** 
Şd_»giÚ_occ_y
,

376 
num_»giÚs
,

377 
boŞ—n
 
fixed_pšs
,

378 
¶aû_®gÜ™hm_t
 
¶aû_®gÜ™hm
,

379 
timšg_Œadeoff
,

380 
šv”£_´ev_bb_co¡
,

381 
šv”£_´ev_timšg_co¡
,

382 * 
d–ay_co¡
);

384 
check_¶aû
(
bb_co¡
,

385 
timšg_co¡
,

386 
¶aû_co¡_ty³
,

387 
num_»giÚs
,

388 
¶aû_®gÜ™hm_t
 
¶aû_®gÜ™hm
,

389 
d–ay_co¡
);

391 
¡¬tšg_t
(* 
co¡_±r
,

392 * 
bb_co¡_±r
,

393 * 
timšg_co¡_±r
,

394 cÚ¡ 
¶aû_co¡_ty³
,

395 ** 
Şd_»giÚ_occ_x
,

396 ** 
Şd_»giÚ_occ_y
,

397 cÚ¡ 
num_»giÚs
,

398 cÚ¡ 
boŞ—n
 
fixed_pšs
,

399 cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

400 cÚ¡ 
max_moves
,

401 cÚ¡ 
¿nge_lim™
,

402 cÚ¡ 
¶aû_®gÜ™hm_t
 
¶aû_®gÜ™hm
,

403 cÚ¡ 
timšg_Œadeoff
,

404 cÚ¡ 
šv”£_´ev_bb_co¡
,

405 cÚ¡ 
šv”£_´ev_timšg_co¡
,

406 * 
d–ay_co¡_±r
);

408 
upd©e_¾im
(* 
¿nge_lim™
,

409 
sucûss_¿t
);

411 
ex™_ü™
(
t
,

412 
co¡
,

413 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
);

415 
couÁ_cÚÃùiÚs
();

417 
compu‹_Ãt_pš_šdex_v®ues
();

419 
g‘_¡d_dev
(
n
,

420 
sum_x_squ¬ed
,

421 
av_x
);

423 
ä“_ç¡_co¡_upd©e_¡ruùs
();

425 
compu‹_pošt_to_pošt_d–ay
(
š‘
,

426 
š
);

428 
comp_td_pošt_to_pošt_d–ay_·¿Î–
(
š‘
,

429 
š
,

430 
loÿl_block_t
* 
loÿl_block
);

432 
upd©e_td_co¡
(
äom_block
,

433 
to_block
,

434 
num_of_pšs
);

436 
compu‹_d–_td_co¡
(
äom_block
,

437 
to_block
,

438 
num_of_pšs
,

439 * 
d–_timšg
,

440 * 
d–_d–ay
);

442 
compu‹_td_co¡s_·¿Î–_w™hout_upd©e_ü™
(* 
timšg_co¡
,

443 * 
cÚÃùiÚ_d–ay_sum
,

444 
¡¬t_Ãts
,

445 
fšish_Ãts
);

447 
compu‹_td_co¡s_·¿Î–_w™h_upd©e_ü™
(* 
timšg_co¡
,

448 * 
cÚÃùiÚ_d–ay_sum
,

449 ** 
Ãt_¦ack
,

450 
max_d–ay
,

451 
ü™_expÚ’t
,

452 
¡¬t
,

453 
fšish
);

455 
compu‹_td_co¡s
(* 
timšg_co¡
,

456 * 
cÚÃùiÚ_d–ay_sum
);

458 
as£ss_sw­
(
d–_c
,

459 
t
);

461 
fšd_to
(
x_äom
,

462 
y_äom
,

463 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

464 
¿nge_lim™
,

465 * 
x_to
,

466 * 
y_to
);

468 
g‘_nÚ_upd©—bË_bb
(
š‘
,

469 
bbox_t
* 
bb_coÜd_Ãw
);

471 
upd©e_bb
(
š‘
,

472 
bbox_t
* 
bb_coÜd_Ãw
,

473 
bbox_t
* 
bb_edge_Ãw
,

474 
xŞd
,

475 
yŞd
,

476 
xÃw
,

477 
yÃw
);

479 
fšd_afãùed_Ãts
(* 
Ãts_to_upd©e
,

480 * 
Ãt_block_moved
,

481 
äom_block
,

482 
to_block
,

483 
num_of_pšs
);

485 
g‘_Ãt_co¡
(
š‘
,

486 
bbox_t
* 
bb_±r
);

488 
nÚlš—r_cÚg_co¡
(
num_»giÚs
);

490 
upd©e_»giÚ_occ
(
š‘
,

491 
bbox_t
* 
coÜds
,

492 
add_Ü_sub
,

493 
num_»giÚs
);

495 
§ve_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

496 ** 
Şd_»giÚ_occ_y
,

497 
num_»giÚs
);

499 
»¡Üe_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

500 ** 
Şd_»giÚ_occ_y
,

501 
num_»giÚs
);

503 
g‘_bb_äom_sü©ch
(
š‘
,

504 
bbox_t
* 
coÜds
,

505 
bbox_t
* 
num_Ú_edges
);

507 
g‘_Ãt_wœ–’gth_e¡im©e
(
š‘
,

508 
bbox_t
* 
bb±r
);

510 
upd©e_ªd_´št_commÚ_·¿s
(cÚ¡ 
kth»ad_id
,

511 * 
move_couÁ”_±r
,

512 * 
šÃr_™”_num_±r
,

513 
±h»ad_d©a_t
* 
šput_¬gs
,

514 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
);

525 
	$Œy_¶aû_u£_muÉi_th»ads
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

526 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

527 
chª_width_di¡r_t
 
chª_width_di¡
,

528 
rou‹r_İts_t
 
rou‹r_İts
,

529 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

530 
£gm’t_šfo_t
* 
£gm’t_šf
,

531 
timšg_šfo_t
 
timšg_šf
,

532 
subblock_d©a_t
* 
subblock_d©a_±r
)

535 ** 
»memb”_Ãt_d–ay_Üigš®_±r
 = 
NULL
;

536 ** 
Ãt_¦ack
 = 
NULL
;

537 ** 
Ãt_d–ay
 = 
NULL
;

538 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®go
 = 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
;

539 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

540 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE
 ||

541 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

544 
	`®loc_ªd_lßd_timšg_g¿ph
(
¶aûr_İts_±r
,

545 
timšg_šf
,

546 *
subblock_d©a_±r
);

547 
Ãt_¦ack
 = 
	`®loc_Ãt_¦ack
();

548 
	`as£¹
(
Ãt_¦ack
 !ğ
NULL
);

550 
	`®loc_d–ay_lookup_m©rixes_ªd_ü™iÿl™›s
(
¶aûr_İts_±r
,

551 *
subblock_d©a_±r
,

552 
chª_width_di¡
,

553 
timšg_šf
,

554 
rou‹r_İts
,

555 
d‘_routšg_¬ch
,

556 
£gm’t_šf
,

557 &
Ãt_d–ay
);

558 
»memb”_Ãt_d–ay_Üigš®_±r
 = 
Ãt_d–ay
;

561 
boŞ—n
 
fixed_pšs
 = 
FALSE
;

562 ià(
¶aûr_İts_±r
->
·d_loc_ty³
 =ğ
FREE
) {

563 
fixed_pšs
 = 
FALSE
;

565 
fixed_pšs
 = 
TRUE
;

568 
width_çc
 = 
¶aûr_İts_±r
->
¶aû_chª_width
;

569 
	`š™_chªÃl_t
(
width_çc
,

570 
chª_width_di¡
);

572 ** 
Şd_»giÚ_occ_x
;

573 ** 
Şd_»giÚ_occ_y
;

574 
	`®loc_ªd_lßd_¶aûm’t_¡ruùs
(
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

575 
¶aûr_İts_±r
->
num_»giÚs
,

576 
¶aûr_İts_±r
->
¶aû_co¡_exp
,

577 &
Şd_»giÚ_occ_x
,

578 &
Şd_»giÚ_occ_y
,

579 *
¶aûr_İts_±r
);

581 
	`š™Ÿl_¶aûm’t
(
¶aûr_İts_±r
->
·d_loc_ty³
,

582 
¶aûr_İts_±r
->
·d_loc_fe
);

584 
	`š™_d¿w_coÜds
(()
width_çc
);

589 
g_pšs_Ú_block
 = (*)
	`my_m®loc
(5 * ());

590 
g_pšs_Ú_block
[
B_CLB_TYPE
] = 
max_pšs_³r_şb
;

591 
g_pšs_Ú_block
[
IO_TYPE
] = 1;

592 
g_pšs_Ú_block
[
EMPTY_TYPE
] = 0;

593 
g_pšs_Ú_block
[
OUTPAD_TYPE
] = 1;

594 
g_pšs_Ú_block
[
INPAD_TYPE
] = 1;

597 
bb_co¡
 = 
	`comp_bb_co¡
(
NORMAL
,

598 
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

599 
¶aûr_İts_±r
->
num_»giÚs
);

601 
num_cÚÃùiÚs
 = 0;

602 
ü™_expÚ’t
 = 0.0;

603 
max_d–ay
 = 0.0;

604 
¶aû_d–ay_v®ue
 = 0.0;

605 
timšg_co¡
, 
d–ay_co¡
;

606 
šv”£_´ev_bb_co¡
 = 0.0;

607 
šv”£_´ev_timšg_co¡
 = 0.0;

608 
co¡
 = 0.0;

609 
š‘
 = 0;

610 
š
 = 0;

611 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

612 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

614 
ü™_expÚ’t
 = 
¶aûr_İts_±r
->
td_¶aû_exp_fœ¡
;

616 
	`compu‹_Ãt_pš_šdex_v®ues
();

618 
num_cÚÃùiÚs
 = 
	`couÁ_cÚÃùiÚs
();

619 
	`´štf
("\nThere‡re %d…ointo…oint connections inhis circuit\n\n",

620 
num_cÚÃùiÚs
);

622 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
) {

623 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

624 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

625 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

626 
timšg_¶aû_ü™
[
š‘
][
š
] = 0;

631 
	`compu‹_td_co¡s
(&
timšg_co¡
,

632 &
d–ay_co¡
);

633 
¶aû_d–ay_v®ue
 = 
d–ay_co¡
 / 
num_cÚÃùiÚs
;

634 
	`lßd_cÚ¡ªt_Ãt_d–ay
(
Ãt_d–ay
,

635 
¶aû_d–ay_v®ue
);

637 
¶aû_d–ay_v®ue
 = 0;

640 ià(
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

645 
Ãt_d–ay
 = 
pošt_to_pošt_d–ay_co¡
;

648 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

652 
max_d–ay
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

653 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

655 
	`lßd_ü™iÿl™›s
(
Ãt_¦ack
,

656 
max_d–ay
,

657 
ü™_expÚ’t
);

660 
	`compu‹_td_co¡s
(&
timšg_co¡
,

661 &
d–ay_co¡
);

663 
šv”£_´ev_timšg_co¡
 = 1 / 
timšg_co¡
;

664 
šv”£_´ev_bb_co¡
 = 1 / 
bb_co¡
;

665 
co¡
 = 1;

670 
co¡
 = 
bb_co¡
;

671 
timšg_co¡
 = 
d–ay_co¡
 = 
num_cÚÃùiÚs
 = 
max_d–ay
 = 0;

672 
¶aû_d–ay_v®ue
 = 
ü™_expÚ’t
 = 0;

674 
šv”£_´ev_timšg_co¡
 = 0;

675 
šv”£_´ev_bb_co¡
 = 0;

682 
move_lim
 = ()(10 * 
	`pow
(
num_blocks
, 1.3333));

683 ià(
move_lim
 <= 0) {

684 
move_lim
 = 1;

687 
¿nge_lim™
 = ()
	`max
(
num_grid_cŞumns
, 
num_grid_rows
);

689 
t
 = 
	`¡¬tšg_t
(&
co¡
,

690 &
bb_co¡
,

691 &
timšg_co¡
,

692 
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

693 
Şd_»giÚ_occ_x
,

694 
Şd_»giÚ_occ_y
,

695 
¶aûr_İts_±r
->
num_»giÚs
,

696 
fixed_pšs
,

697 
ªÃ®šg_sched
,

698 
move_lim
,

699 
¿nge_lim™
,

700 
k¶aû_®go
,

701 
¶aûr_İts_±r
->
timšg_Œadeoff
,

702 
šv”£_´ev_bb_co¡
,

703 
šv”£_´ev_timšg_co¡
,

704 &
d–ay_co¡
);

706 
tÙ_™”
 = 0;

707 
	`´štf
("Initial Placement Cost: %g bb_cost: %gd_cost: %g delay_cost: %g\n\n",

708 
co¡
, 
bb_co¡
, 
timšg_co¡
, 
d–ay_co¡
);

710 #iâdeà
SPEC


711 
	`´štf
("%11s %10s %11s %11s %11s %11s %11s %9s %8s %7s %7s %10s %7s\n",

715 
	`´štf
("%11s %10s %11s %11s %11s %11s %11s %9s %8s %7s %7s %10s %7s\n",

721 
msg
[
BUFSIZE
];

722 
	`¥rštf
(
msg
,

724 "\ˆmax_d–ay %g ChªÃÈFaùÜ: %d", 
co¡
, 
bb_co¡
, 
timšg_co¡
,

725 
d–ay_co¡
, 
max_d–ay
, 
width_çc
);

726 
	`upd©e_sü“n
(
MAJOR
, 
msg
, 
PLACEMENT
, 
FALSE
);

728 
şock_t
 
¡¬t_time
 = 
	`şock
();

729 
timev®
 
¡¬t
;

730 
	`g‘timeofday
(&
¡¬t
, 
NULL
);

731 
	`my_¤ªdom
(0);

733 
šÃr_™”_num
 = 
ªÃ®šg_sched
.
šÃr_num
;

735 
	`±h»ad_mu‹x_š™
(&
glob®_d©a_acûss
.
mu‹x
, 
NULL
);

736 
	`b¬r›r_pŞlšg_»£t
();

741 cÚ¡ 
hÜizÚ_»giÚs
 = 
x_·¹™iÚ
[
NUM_OF_THREADS
 - 1];

742 cÚ¡ 
v”ti_»giÚs
 = 
y_·¹™iÚ
[
NUM_OF_THREADS
 - 1];

743 ià(
hÜizÚ_»giÚs
 < 1 || 
v”ti_»giÚs
 < 1 || 
NUM_OF_THREADS
 > 64) {

744 
	`´štf
("Thi ´og¿m cªnÙ b¿Àw™h %dh»ads,ry‡nÙh” cÚfigu¿tiÚ.\n", 
NUM_OF_THREADS
);

745 
	`as£¹
 (0);

747 
	`as£¹
(
hÜizÚ_»giÚs
 * 
v”ti_»giÚs
 =ğ
NUM_OF_THREADS
);

752 cÚ¡ 
cŞs_assign_to_th»ad
 = (
num_grid_cŞumns
 + 2è/ 
hÜizÚ_»giÚs
;

753 cÚ¡ 
rows_assign_to_th»ad
 = (
num_grid_rows
 + 2è/ 
v”ti_»giÚs
;

754 cÚ¡ 
exŒa_cŞs
 =

755 (
num_grid_cŞumns
 + 2è- 
cŞs_assign_to_th»ad
 * 
hÜizÚ_»giÚs
;

756 cÚ¡ 
exŒa_rows
 =

757 (
num_grid_rows
 + 2è- 
rows_assign_to_th»ad
 * 
v”ti_»giÚs
;

759 
sucûss_sum
, 
ex™
;

760 
sucûss_¿t
;

761 
av_co¡
, 
av_bb_co¡
, 
av_timšg_co¡
, 
av_d–ay_co¡
, 
sum_of_squ¬es
;

762 
¡d_dev
;

763 
loÿl_´ob
 = 
¶aûr_İts_±r
->
m_´ob
;

766 
±h»ad_t
 
¶aû_th»ads
[
NUM_OF_THREADS
];

769 
thd_id
 = -1;

770 
thd_id
 = 0;hd_id < 
NUM_OF_SUB_REGIONS
; ++thd_id) {

771 
g_»cÜd_¿ndnum
[
thd_id
] = 0;

774 
thd_id
 = 
NUM_OF_THREADS
 - 1;hd_id >= 0 ; --thd_id) {

776 ià(
thd_id
 % 
hÜizÚ_»giÚs
 == 0 || horizon_regions == 1) {

777 
th»ad_d©a_¬¿y
[
thd_id
].
x_¡¬t
 = 0;

778 } ià(
thd_id
 % 
hÜizÚ_»giÚs
 == 1) {

779 
th»ad_d©a_¬¿y
[
thd_id
].
x_¡¬t
 = 
cŞs_assign_to_th»ad
;

780 } ià(
thd_id
 % 
hÜizÚ_»giÚs
 < 
exŒa_cŞs
 + 1) {

781 
th»ad_d©a_¬¿y
[
thd_id
].
x_¡¬t
 =

782 (
thd_id
 % 
hÜizÚ_»giÚs
 - 1è* (
cŞs_assign_to_th»ad
 + 1)

783 + 
cŞs_assign_to_th»ad
;

785 
th»ad_d©a_¬¿y
[
thd_id
].
x_¡¬t
 =

786 (
thd_id
 % 
hÜizÚ_»giÚs
è* 
cŞs_assign_to_th»ad
 + 
exŒa_cŞs
;

789 ià(
thd_id
 % 
hÜizÚ_»giÚs
 == horizon_regions - 1 || horizon_regions == 1) {

790 
th»ad_d©a_¬¿y
[
thd_id
].
x_’d
 = 
num_grid_cŞumns
 + 2;

791 } ià(
thd_id
 % 
hÜizÚ_»giÚs
 == 0) {

792 
th»ad_d©a_¬¿y
[
thd_id
].
x_’d
 = 
cŞs_assign_to_th»ad
;

793 } ià(
thd_id
 % 
hÜizÚ_»giÚs
 < 
exŒa_cŞs
 + 1) {

794 
th»ad_d©a_¬¿y
[
thd_id
].
x_’d
 =

795 (
thd_id
 % 
hÜizÚ_»giÚs
è* (
cŞs_assign_to_th»ad
 + 1)

796 + 
cŞs_assign_to_th»ad
;

798 
th»ad_d©a_¬¿y
[
thd_id
].
x_’d
 =

799 (
thd_id
 % 
hÜizÚ_»giÚs
 + 1è* 
cŞs_assign_to_th»ad
 + 
exŒa_cŞs
;

802 ià(
thd_id
 / 
hÜizÚ_»giÚs
 =ğ0 || 
v”ti_»giÚs
 == 1) {

803 
th»ad_d©a_¬¿y
[
thd_id
].
y_¡¬t
 = 0;

804 } ià(
thd_id
 / 
hÜizÚ_»giÚs
 == 1) {

805 
th»ad_d©a_¬¿y
[
thd_id
].
y_¡¬t
 = 
rows_assign_to_th»ad
;

806 } ià(
thd_id
 / 
hÜizÚ_»giÚs
 < 
exŒa_rows
 + 1) {

807 
th»ad_d©a_¬¿y
[
thd_id
].
y_¡¬t
 =

808 (
thd_id
 / 
hÜizÚ_»giÚs
 - 1è* (
rows_assign_to_th»ad
 + 1)

809 + 
rows_assign_to_th»ad
;

811 
th»ad_d©a_¬¿y
[
thd_id
].
y_¡¬t
 =

812 (
thd_id
 / 
hÜizÚ_»giÚs
è* 
rows_assign_to_th»ad
 + 
exŒa_rows
;

815 ià(
thd_id
 / 
hÜizÚ_»giÚs
 =ğ
v”ti_»giÚs
 - 1 || verti_regions == 1) {

816 
th»ad_d©a_¬¿y
[
thd_id
].
y_’d
 = 
num_grid_rows
 + 2;

817 } ià(
thd_id
 / 
hÜizÚ_»giÚs
 == 0) {

818 
th»ad_d©a_¬¿y
[
thd_id
].
y_’d
 = 
rows_assign_to_th»ad
;

819 } ià(
thd_id
 / 
hÜizÚ_»giÚs
 < 
exŒa_rows
 + 1) {

820 
th»ad_d©a_¬¿y
[
thd_id
].
y_’d
 =

821 (
thd_id
 / 
hÜizÚ_»giÚs
è* (
rows_assign_to_th»ad
 + 1)

822 + 
rows_assign_to_th»ad
;

824 
th»ad_d©a_¬¿y
[
thd_id
].
y_’d
 =

825 ((
thd_id
 / 
hÜizÚ_»giÚs
è+ 1è* 
rows_assign_to_th»ad
 + 
exŒa_rows
;

831 
	`as£¹
(
th»ad_d©a_¬¿y
[
thd_id
].
x_’d
 -h»ad_d©a_¬¿y[thd_id].
x_¡¬t
 > 8);

832 
	`as£¹
(
th»ad_d©a_¬¿y
[
thd_id
].
y_’d
 -h»ad_d©a_¬¿y[thd_id].
y_¡¬t
 > 8);

834 
th»ad_d©a_¬¿y
[
thd_id
].
th»ad_id
 =hd_id;

837 
th»ad_d©a_¬¿y
[
thd_id
].
¶aûr_İts
 = *
¶aûr_İts_±r
;

838 
th»ad_d©a_¬¿y
[
thd_id
].
ªÃ®šg_sched
 =‡nnealing_sched;

839 
th»ad_d©a_¬¿y
[
thd_id
].
fixed_pšs
 = fixed_pins;

840 
th»ad_d©a_¬¿y
[
thd_id
].
Ãt_¦ack
 =‚et_slack;

841 
th»ad_d©a_¬¿y
[
thd_id
].
Ãt_d–ay
 =‚et_delay;

843 
th»ad_d©a_¬¿y
[
thd_id
].
t
 = &t;

845 
th»ad_d©a_¬¿y
[
thd_id
].
bb_co¡
 = &bb_cost;

846 
th»ad_d©a_¬¿y
[
thd_id
].
timšg_co¡
 = &timing_cost;

847 
th»ad_d©a_¬¿y
[
thd_id
].
d–ay_co¡
 = &delay_cost;

848 
th»ad_d©a_¬¿y
[
thd_id
].
šv”£_´ev_bb_co¡
 = &inverse_prev_bb_cost;

849 
th»ad_d©a_¬¿y
[
thd_id
].
šv”£_´ev_timšg_co¡
 = &inverse_prev_timing_cost;

850 
th»ad_d©a_¬¿y
[
thd_id
].
av_co¡
 = &av_cost;

851 
th»ad_d©a_¬¿y
[
thd_id
].
av_bb_co¡
 = &av_bb_cost;

852 
th»ad_d©a_¬¿y
[
thd_id
].
av_timšg_co¡
 = &av_timing_cost;

853 
th»ad_d©a_¬¿y
[
thd_id
].
av_d–ay_co¡
 = &av_delay_cost;

854 
th»ad_d©a_¬¿y
[
thd_id
].
co¡
 = &cost;

856 
th»ad_d©a_¬¿y
[
thd_id
].
move_lim
 = &move_lim;

857 
th»ad_d©a_¬¿y
[
thd_id
].
šÃr_™”_num
 = &inner_iter_num;

858 
th»ad_d©a_¬¿y
[
thd_id
].
tÙ_™”
 = &tot_iter;

859 
th»ad_d©a_¬¿y
[
thd_id
].
sucûss_sum
 = &success_sum;

860 
th»ad_d©a_¬¿y
[
thd_id
].
sucûss_¿t
 = &success_rat;

861 
th»ad_d©a_¬¿y
[
thd_id
].
sum_of_squ¬es
 = &sum_of_squares;

862 
th»ad_d©a_¬¿y
[
thd_id
].
¡d_dev
 = &std_dev;

864 
th»ad_d©a_¬¿y
[
thd_id
].
¶aû_d–ay_v®ue
 = &place_delay_value;

865 
th»ad_d©a_¬¿y
[
thd_id
].
max_d–ay
 = &max_delay;

866 
th»ad_d©a_¬¿y
[
thd_id
].
num_cÚÃùiÚs
 = &num_connections;

868 
th»ad_d©a_¬¿y
[
thd_id
].
ü™_expÚ’t
 = &crit_exponent;

869 
th»ad_d©a_¬¿y
[
thd_id
].
ex™
 = &exit;

870 
th»ad_d©a_¬¿y
[
thd_id
].
¿nge_lim™
 = &range_limit;

871 
th»ad_d©a_¬¿y
[
thd_id
].
m_´ob
 = &
loÿl_´ob
;

874 
th»ad_d©a_¬¿y
[
thd_id
].
¿ndom_num_
 = -1;

876 
th»ad_d©a_¬¿y
[
thd_id
].
¶aûd_sub_»giÚs
 = 0;

878 
	`as£¹
(
th»ad_d©a_¬¿y
[
thd_id
].
y_’d
 >h»ad_d©a_¬¿y[thd_id].
y_¡¬t
);

880 ià(
thd_id
 != 0) {

881 
	`±h»ad_ü—‹
(&
¶aû_th»ads
[
thd_id
],

882 
NULL
,

883 
Œy_¶aû_·¿Î–
,

884 (*)&
th»ad_d©a_¬¿y
[
thd_id
]);

887 
	`Œy_¶aû_·¿Î–
(&
th»ad_d©a_¬¿y
[
thd_id
]);

891 
thd_id
 = 
NUM_OF_THREADS
 - 1;hd_id > 0; --thd_id) {

892 
	`±h»ad_još
(
¶aû_th»ads
[
thd_id
], 
NULL
);

895 
	`±h»ad_mu‹x_de¡roy
(&
glob®_d©a_acûss
.
mu‹x
);

897 
şock_t
 
’d_time
 = 
	`şock
();

898 
timev®
 
fšish
;

899 
	`g‘timeofday
(&
fšish
, 
NULL
);

900 
bb_co¡
 = 
	`check_¶aû
(bb_cost,

901 
timšg_co¡
,

902 
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

903 
¶aûr_İts_±r
->
num_»giÚs
,

904 
¶aûr_İts_±r
->
¶aû_®gÜ™hm
,

905 
d–ay_co¡
);

907 ià(
¶aûr_İts_±r
->
’abË_timšg_computiÚs


908 && 
k¶aû_®go
 =ğ
BOUNDING_BOX_PLACE
) {

911 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

912 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

913 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

914 
timšg_¶aû_ü™
[
š‘
][
š
] = 0;

918 
	`compu‹_td_co¡s
(&
timšg_co¡
,

919 &
d–ay_co¡
);

922 
¶aû_e¡_ü™_d–ay
 = 0.0;

923 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

924 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE
 ||

925 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

926 
Ãt_d–ay
 = 
pošt_to_pošt_d–ay_co¡
;

928 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

932 
¶aû_e¡_ü™_d–ay
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

933 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

935 #ifdeà
CREATE_ECHO_FILES


937 
	`´št_Ãt_¦ack
("¶aûm’t_Ãt_¦acks.echo", 
Ãt_¦ack
);

938 
	`´št_ü™iÿl_·th
("placement_crit_path.echo",

939 *
subblock_d©a_±r
);

942 
	`´štf
("Placement Estimated Crit Path Delay: %g\n\n",

943 
¶aû_e¡_ü™_d–ay
);

946 
	`¥rštf
(
msg
,

948 
co¡
, 
bb_co¡
, 
timšg_co¡
, 
width_çc
, 
max_d–ay
);

949 
	`´štf
("Placement. Cost: %g bb_cost: %gd_cost: %g delay_cost: %g.\n",

950 
co¡
, 
bb_co¡
, 
timšg_co¡
, 
d–ay_co¡
);

952 
	`´štf
("NUM_OF_THREADS: %d, Inner Loop Wall: %f sec, Main Placement cost %f seconds.\n",

953 
NUM_OF_THREADS
, 
	`my_difáime2
(&
¡¬t
, &
fšish
),

954 ()(
’d_time
 - 
¡¬t_time
è/ 
CLOCKS_PER_SEC
);

955 
	`upd©e_sü“n
(
MAJOR
, 
msg
, 
PLACEMENT
, 
FALSE
);

957 #ifdeà
SPEC


958 
	`´štf
("TÙ® move ©‹m±ed: %d.0\n", 
tÙ_™”
);

961 ià(
k¶aû_®go
 =ğ
NET_TIMING_DRIVEN_PLACE


962 || 
k¶aû_®go
 =ğ
PATH_TIMING_DRIVEN_PLACE


963 || 
¶aûr_İts_±r
->
’abË_timšg_computiÚs
) {

964 
Ãt_d–ay
 = 
»memb”_Ãt_d–ay_Üigš®_±r
;

966 
	`ä“_¶aûm’t_¡ruùs
(
¶aûr_İts_±r
->
¶aû_co¡_ty³
,

967 
¶aûr_İts_±r
->
num_»giÚs
,

968 
Şd_»giÚ_occ_x
,

969 
Şd_»giÚ_occ_y
,

970 *
¶aûr_İts_±r
);

972 
	`ä“_lookups_ªd_ü™iÿl™›s
(
¶aûr_İts_±r
,

973 &
Ãt_d–ay
,

974 &
Ãt_¦ack
);

977 
	`ä“
(
g_grid_ÿ·c™y
);

978 
g_grid_ÿ·c™y
 = 
NULL
;

980 
	`ä“
(
g_pšs_Ú_block
);

981 
g_pšs_Ú_block
 = 
NULL
;

982 
	}
}

998 
	$b¬r›r_pŞlšg
(
kth»ad_id
)

1000 ++(
th»ad_b¬r›rs
[
kth»ad_id
].
’Œy
);

1002 cÚ¡ 
loÿl_’Œy
 = (
th»ad_b¬r›rs
[
kth»ad_id
].
’Œy
 ) % 2;

1003 ià(
NUM_OF_THREADS
 == 1) {

1005 } ià(
kth»ad_id
 == 0) {

1007 
th»ad_b¬r›rs
[1].
¬rived
 !ğ
loÿl_’Œy
) {};

1009 
th»ad_b¬r›rs
[1].
´oûed
 = 
loÿl_’Œy
;

1010 } ià(
kth»ad_id
 == 1) {

1012 ià(
NUM_OF_THREADS
 > 3) {

1013 
th»ad_b¬r›rs
[2].
¬rived
 !ğ
loÿl_’Œy


1014 || 
th»ad_b¬r›rs
[3].
¬rived
 !ğ
loÿl_’Œy
) {};

1015 } ià(
NUM_OF_THREADS
 > 2) {

1016 
th»ad_b¬r›rs
[2].
¬rived
 !ğ
loÿl_’Œy
) {};

1020 
th»ad_b¬r›rs
[
kth»ad_id
].
¬rived
 = 
loÿl_’Œy
;

1022 
th»ad_b¬r›rs
[
kth»ad_id
].
´oûed
 !ğ
loÿl_’Œy
) {};

1025 ià(
NUM_OF_THREADS
 > 3) {

1026 
th»ad_b¬r›rs
[2].
´oûed
 =h»ad_b¬r›rs[3].´oûed = 
loÿl_’Œy
;

1027 } ià(
NUM_OF_THREADS
 > 2) {

1028 
th»ad_b¬r›rs
[2].
´oûed
 = 
loÿl_’Œy
;

1032 ià(
NUM_OF_THREADS
 > 
kth»ad_id
 * 2 + 1) {

1033 
th»ad_b¬r›rs
[
kth»ad_id
 * 2].
¬rived
 !ğ
loÿl_’Œy


1034 || 
th»ad_b¬r›rs
[
kth»ad_id
 * 2 + 1].
¬rived
 !ğ
loÿl_’Œy
) {};

1035 } ià(
NUM_OF_THREADS
 > 
kth»ad_id
 * 2) {

1036 
th»ad_b¬r›rs
[
kth»ad_id
 * 2].
¬rived
 !ğ
loÿl_’Œy
) {};

1040 
th»ad_b¬r›rs
[
kth»ad_id
].
¬rived
 = 
loÿl_’Œy
;

1042 
th»ad_b¬r›rs
[
kth»ad_id
].
´oûed
 !ğ
loÿl_’Œy
) {};

1045 ià(
NUM_OF_THREADS
 > 
kth»ad_id
 * 2 + 1) {

1046 
th»ad_b¬r›rs
[
kth»ad_id
 * 2].
´oûed
 =

1047 
th»ad_b¬r›rs
[
kth»ad_id
 * 2 + 1].
´oûed
 = 
loÿl_’Œy
;

1048 } ià(
NUM_OF_THREADS
 > 
kth»ad_id
 * 2) {

1049 
th»ad_b¬r›rs
[
kth»ad_id
 * 2].
´oûed
 = 
loÿl_’Œy
;

1052 
	}
}

1054 
	$b¬r›r_pŞlšg_»£t
()

1056 
x
 = -1;

1057 
x
 = 0; x < 
NUM_OF_THREADS
; ++x) {

1058 
th»ad_b¬r›rs
[
x
].
¬rived
 = 0;

1059 
th»ad_b¬r›rs
[
x
].
´oûed
 = 0;

1060 
th»ad_b¬r›rs
[
x
].
’Œy
 = 0;

1062 
	}
}

1065 * 
	$Œy_¶aû_·¿Î–
(
±h»ad_d©a_t
* 
šput_¬gs
)

1067 
cÜe_affš™y
 = 
	`pow
(2,

1068 
šput_¬gs
->
th»ad_id
);

1070 ià(
	`±h»ad_£ffš™y_Å
(
	`±h»ad_£lf
(),

1071 (
cÜe_affš™y
),

1072 &
cÜe_affš™y
) < 0) {

1073 
	`´štf
("core‡ffinityƒrror:hread-%d couldn't get Core-%d\n",

1074 
šput_¬gs
->
th»ad_id
, 
cÜe_affš™y
);

1075 
	`ex™
(-1);

1078 
th»ad_loÿl_commÚ_·¿s_t
 
commÚ_·¿s
;

1080 
	`š™Ÿl_commÚ_·¿s
(
šput_¬gs
,

1081 &
commÚ_·¿s
);

1083 
th»ad_loÿl_d©a_fÜ_sw­_t
 
sw­_d©a
;

1085 
	`®loc_memÜy_fÜ_sw­_d©a
(
max_pšs_³r_şb
,

1086 &
commÚ_·¿s
,

1087 &
sw­_d©a
);

1090 
	`š™Ÿl_sw­_d©a
(&
commÚ_·¿s
,

1091 &
sw­_d©a
);

1093 cÚ¡ 
kth»ad_id
 = 
commÚ_·¿s
.
loÿl_th»ad_id
;

1095 
	`fšd_çnš_·¿Î–
(
kth»ad_id
);

1097 ià(
	`±h»ad_mu‹x_Œylock
(&
glob®_d©a_acûss
.
mu‹x
) != 0) {

1098 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1101 
	`š™Ÿl_loÿlv”t_grid
();

1103 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1105 
	`±h»ad_mu‹x_uÆock
(&
glob®_d©a_acûss
.
mu‹x
);

1109 
´ob
 = *(
šput_¬gs
->
m_´ob
);

1110 
timšg_upd©e_th»shŞd
 = 
TIMING_UPDATE
;

1112 
äeq
 = 
timšg_upd©e_th»shŞd
;

1115 
™”
 = 0;

1116 
move_couÁ”
 = -1;

1117 
	`çbs
(
commÚ_·¿s
.
loÿl_‹m³r
è> 
kFLOAT_ZERO
) {

1119 
commÚ_·¿s
.
loÿl_‹m³r
 = *(
šput_¬gs
->
t
);

1120 
šÃr_™”_num
 = *(
šput_¬gs
->inner_iter_num);

1121 
commÚ_·¿s
.
loÿl_ü™_expÚ’t
 = *(
šput_¬gs
->
ü™_expÚ’t
);

1122 
commÚ_·¿s
.
loÿl_sucûss_¿tio
 = *(
šput_¬gs
->
sucûss_¿t
);

1123 
commÚ_·¿s
.
loÿl_¿nge_lim™
 = *(
šput_¬gs
->
¿nge_lim™
);

1125 
™”
 = 0; i‹¸< 
šÃr_™”_num
; ++iter) {

1127 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1129 
commÚ_·¿s
.
loÿl_d–ay_co¡
 = *(
šput_¬gs
->
d–ay_co¡
);

1131 
commÚ_·¿s
.
loÿl_¶aû_d–ay_v®ue
 =

1132 
commÚ_·¿s
.
loÿl_d–ay_co¡
 / commÚ_·¿s.
loÿl_num_cÚns
;

1136 ià(
äeq
 >ğ
timšg_upd©e_th»shŞd
) {

1138 
	`³rfÜm_timšg_ª®yze_·¿Î–
(
kth»ad_id
,

1139 &(
commÚ_·¿s
.
loÿl_Ãt_d–ay
),

1140 
šput_¬gs
,

1141 &(
commÚ_·¿s
.
loÿl_max_d–ay
));

1143 
	`compu‹_Ãt_¦ack_fuÎ
(
kth»ad_id
,

1144 &(
commÚ_·¿s
.
loÿl_Ãt_¦ack
),

1145 &(
commÚ_·¿s
.
loÿl_timšg_co¡
),

1146 &(
commÚ_·¿s
.
loÿl_d–ay_co¡
),

1147 
commÚ_·¿s
.
loÿl_ü™_expÚ’t
,

1148 
commÚ_·¿s
.
loÿl_max_d–ay
,

1149 
šput_¬gs
);

1151 
äeq
 = 0;

1154 ià(
	`±h»ad_mu‹x_Œylock
(&
glob®_d©a_acûss
.
mu‹x
) != 0) {

1155 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1157 *(
šput_¬gs
->
timšg_co¡
) = 0.0;

1158 *(
šput_¬gs
->
d–ay_co¡
) = 0.0;

1159 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1161 
	`±h»ad_mu‹x_uÆock
(&
glob®_d©a_acûss
.
mu‹x
);

1165 
	`ÿlcuÏ‹_timšg_w™hout_upd©e_ü™
(
kth»ad_id
,

1166 &(
commÚ_·¿s
.
loÿl_timšg_co¡
),

1167 &(
commÚ_·¿s
.
loÿl_d–ay_co¡
),

1168 
šput_¬gs
);

1169 ++
äeq
;

1172 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1174 
	`upd©e_äom_glob®_to_loÿl_grid
(
™”
,

1175 
šput_¬gs
,

1176 &
commÚ_·¿s
,

1177 &
sw­_d©a
);

1179 ià(
™”
 == 0) {

1180 
commÚ_·¿s
.
loÿl_sucûss_sum
 = 0;

1181 
move_couÁ”
 = 0;

1182 
commÚ_·¿s
.
loÿl_av_co¡
 = 0.0;

1183 
commÚ_·¿s
.
loÿl_av_bb_co¡
 = 0.0;

1184 
commÚ_·¿s
.
loÿl_av_timšg_co¡
 = 0.0;

1185 
commÚ_·¿s
.
loÿl_av_d–ay_co¡
 = 0.0;

1186 
commÚ_·¿s
.
loÿl_sum_of_squ¬es
 = 0.0;

1189 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1192 
row
, 
cŞ
;

1204 
¿ndnum
 = -1;

1205 
i
 = -1;

1206 ià(0 =ğ
s_¿ndnum_u£d_times
) {

1210 ià(
NUM_OF_SUB_REGIONS
 =ğ
s_¿ndnum_g’”©ed_couÁ
) {

1211 
i
 = 0; i < 
NUM_OF_SUB_REGIONS
; ++i) {

1212 
g_»cÜd_¿ndnum
[
i
] = 0;

1215 
¿ndnum
 = 
	`¿nd
(è% 
NUM_OF_SUB_REGIONS
;

1216 ià(
g_»cÜd_¿ndnum
[
¿ndnum
] > 0) {

1217 
¿ndnum
 = 
	`¿nd
(è% 
NUM_OF_SUB_REGIONS
;

1219 
g_»cÜd_¿ndnum
[
¿ndnum
] = 1;

1220 ++
s_¿ndnum_g’”©ed_couÁ
;

1223 
i
 = 0; i < 
NUM_OF_THREADS
; ++i) {

1224 
th»ad_d©a_¬¿y
[
i
].
¿ndom_num_
 = 
¿ndnum
;

1228 
row
 = 
¿ndnum
 / 2;

1229 
cŞ
 = 
¿ndnum
 % 2;

1230 
	`Œy_¶aû_a_sub»giÚ
(
kth»ad_id
,

1231 
row
, 
cŞ
,

1232 
´ob
,

1233 &
move_couÁ”
,

1234 &
commÚ_·¿s
,

1235 &
sw­_d©a
);

1237 
s_¿ndnum_u£d_times
 += 1;

1240 
¿ndnum
 = 
th»ad_d©a_¬¿y
[
kth»ad_id
].
¿ndom_num_
;

1241 
row
 = 
¿ndnum
 / 2;

1242 
cŞ
 = 
¿ndnum
 % 2;

1244 
	`Œy_¶aû_a_sub»giÚ
(
kth»ad_id
,

1245 
row
, 
cŞ
,

1246 
´ob
,

1247 &
move_couÁ”
,

1248 &
commÚ_·¿s
,

1249 &
sw­_d©a
);

1251 ++
s_¿ndnum_u£d_times
;

1252 ià(
NUM_OF_THREADS
 =ğ
s_¿ndnum_u£d_times
) {

1253 
s_¿ndnum_u£d_times
 = 0;

1258 ià(
	`±h»ad_mu‹x_Œylock
(&
glob®_d©a_acûss
.
mu‹x
) != 0) {

1259 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1261 *(
šput_¬gs
->
bb_co¡
) = 0.;

1262 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1263 
	`±h»ad_mu‹x_uÆock
(&
glob®_d©a_acûss
.
mu‹x
);

1269 
wœ–’gth_co¡
 =

1270 
	`compu‹_bb_co¡_·¿Î–
(
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
,

1271 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks
);

1272 
commÚ_·¿s
.
loÿl_bb_co¡
 = 
wœ–’gth_co¡
;

1273 
·¹Ÿl_bb_»suÉs
[
kth»ad_id
] = 
wœ–’gth_co¡
;

1275 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1276 ià(
kth»ad_id
 == 0) {

1277 
wœ–’gth_co¡
 = 0.0;

1278 
upd©e_couÁ
 = -1;

1279 
upd©e_couÁ
 = 0; upd©e_couÁ < 
NUM_OF_THREADS
; ++update_count) {

1280 
wœ–’gth_co¡
 +ğ
·¹Ÿl_bb_»suÉs
[
upd©e_couÁ
];

1283 *(
šput_¬gs
->
bb_co¡
èğ
wœ–’gth_co¡
;

1288 
	`±h»ad_mu‹x_lock
(&
glob®_d©a_acûss
.
mu‹x
);

1289 *(
šput_¬gs
->
sucûss_sum
 ) +ğ
commÚ_·¿s
.
loÿl_sucûss_sum
;

1290 *(
šput_¬gs
->
move_lim
è+ğ
move_couÁ”
;

1291 *(
šput_¬gs
->
av_co¡
è+ğ
commÚ_·¿s
.
loÿl_av_co¡
;

1292 *(
šput_¬gs
->
av_bb_co¡
è+ğ
commÚ_·¿s
.
loÿl_av_bb_co¡
;

1293 *(
šput_¬gs
->
av_timšg_co¡
è+ğ
commÚ_·¿s
.
loÿl_av_timšg_co¡
;

1294 *(
šput_¬gs
->
av_d–ay_co¡
è+ğ
commÚ_·¿s
.
loÿl_av_d–ay_co¡
;

1295 *(
šput_¬gs
->
sum_of_squ¬es
è+ğ
commÚ_·¿s
.
loÿl_sum_of_squ¬es
;

1296 
	`±h»ad_mu‹x_uÆock
(&
glob®_d©a_acûss
.
mu‹x
);

1298 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1300 
	`upd©e_ªd_´št_commÚ_·¿s
(
kth»ad_id
,

1301 &
move_couÁ”
,

1302 &
šÃr_™”_num
,

1303 
šput_¬gs
,

1304 &
commÚ_·¿s
);

1306 ià(
commÚ_·¿s
.
loÿl_‹m³r
 != 0.0) {

1307 
	`b¬r›r_pŞlšg
(
commÚ_·¿s
.
loÿl_th»ad_id
);

1312 
š‘
 = -1;

1313 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®gÜ™hm
 =

1314 
commÚ_·¿s
.
loÿl_¶aûr_İts
.
¶aû_®gÜ™hm
;

1315 ià(
k¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

1316 
k¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

1317 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1319 (
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
])++;

1320 
	`ä“
(
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
]);

1322 
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
]++;

1323 
	`ä“
(
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
]);

1326 
	`ä“
(
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
);

1327 
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
 = 
NULL
;

1329 
	`ä“
(
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
);

1330 
sw­_d©a
.
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
 = 
NULL
;

1333 
	`ä“
(
sw­_d©a
.
m_loÿl_block
);

1334 
sw­_d©a
.
m_loÿl_block
 = 
NULL
;

1335 
	`ä“
(
sw­_d©a
.
m_loÿl_‹mp_Ãt_co¡
);

1336 
sw­_d©a
.
m_loÿl_‹mp_Ãt_co¡
 = 
NULL
;

1337 
	`ä“
(
sw­_d©a
.
m_loÿl_Ãt_co¡
);

1338 
sw­_d©a
.
m_loÿl_Ãt_co¡
 = 
NULL
;

1340 
	`ä“
(
sw­_d©a
.
m_loÿl_bb_coÜd
);

1341 
sw­_d©a
.
m_loÿl_bb_coÜd
 = 
NULL
;

1342 
	`ä“
(
sw­_d©a
.
m_loÿl_bb_edge
);

1343 
sw­_d©a
.
m_loÿl_bb_edge
 = 
NULL
;

1345 
	`ä“
(
sw­_d©a
.
m_Ãts_to_upd©e
);

1346 
sw­_d©a
.
m_Ãts_to_upd©e
 = 
NULL
;

1348 
	`ä“
(
sw­_d©a
.
m_Ãt_block_moved
);

1349 
sw­_d©a
.
m_Ãt_block_moved
 = 
NULL
;

1351 
	`ä“
(
sw­_d©a
.
m_bb_coÜd_Ãw
);

1352 
sw­_d©a
.
m_bb_coÜd_Ãw
 = 
NULL
;

1354 
	`ä“
(
sw­_d©a
.
m_bb_edge_Ãw
);

1355 
sw­_d©a
.
m_bb_edge_Ãw
 = 
NULL
;

1356 
	}
}

1358 
	$Œy_¶aû_a_sub»giÚ
(cÚ¡ 
kth»ad_id
,

1359 cÚ¡ 
ksub»giÚ_row
,

1360 cÚ¡ 
ksub»giÚ_cŞ
,

1361 cÚ¡ 
k´ob
,

1362 * 
move_couÁ”
,

1363 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

1364 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
)

1366 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1370 cÚ¡ * 
k»giÚ_x_bound¬y
 = 
commÚ_·¿s_±r
->
loÿl_»giÚ_x_bound¬y
;

1371 cÚ¡ * 
k»giÚ_y_bound¬y
 = 
commÚ_·¿s_±r
->
loÿl_»giÚ_y_bound¬y
;

1372 
grid_te_t
** 
loÿl_grid
 = 
sw­_d©a_±r
->
m_loÿl_grid
;

1373 
loÿl_block_t
* 
loÿl_block
 = 
sw­_d©a_±r
->
m_loÿl_block
;

1375 
	`upd©e_loÿl_d©a_äom_glob®
(
k»giÚ_x_bound¬y
,

1376 
k»giÚ_y_bound¬y
,

1377 
loÿl_grid
,

1378 
loÿl_block
,

1379 
ksub»giÚ_row
,

1380 
ksub»giÚ_cŞ
);

1383 cÚ¡ 
hÜi_¡¬t_bound
 = 
k»giÚ_x_bound¬y
[
ksub»giÚ_row
];

1384 cÚ¡ 
hÜi_’d_bound
 = 
k»giÚ_x_bound¬y
[
ksub»giÚ_row
 + 1];

1385 cÚ¡ 
v”t_¡¬t_bound
 = 
k»giÚ_y_bound¬y
[
ksub»giÚ_cŞ
];

1386 cÚ¡ 
v”t_’d_bound
 = 
k»giÚ_y_bound¬y
[
ksub»giÚ_cŞ
 + 1];

1387 cÚ¡ 
boŞ—n
 
kfixed_pšs
 = 
commÚ_·¿s_±r
->
loÿl_fixed_pšs
;

1388 cÚ¡ 
kt
 = 
commÚ_·¿s_±r
->
loÿl_‹m³r
;

1389 
x_äom
 = 0;

1390 
y_äom
 = 0;

1391 
z_äom
 = 0;

1392 
x_äom
 = 
hÜi_¡¬t_bound
; x_äom < 
hÜi_’d_bound
; ++x_from) {

1393 
y_äom
 = 
v”t_¡¬t_bound
; y_äom < 
v”t_’d_bound
; ++y_from) {

1394 ià((
loÿl_grid
[
x_äom
][
y_äom
].
grid_ty³
 =ğ
EMPTY_TYPE
)

1395 || (
kfixed_pšs
 && 
loÿl_grid
[
x_äom
][
y_äom
].
grid_ty³


1396 =ğ
IO_TYPE
)) {

1399 cÚ¡ 
kÿ·c™y
 = 
loÿl_grid
[
x_äom
][
y_äom
].
m_ÿ·c™y
;

1400 
z_äom
 = 0; z_äom < 
kÿ·c™y
; ++z_from) {

1403 ià(
loÿl_grid
[
x_äom
][
y_äom
].
š_blocks
[
z_äom
] =ğ
EMPTY
) {

1408 ià(
	`my_œªd_·¿Î–
(100, 
kth»ad_id
è>ğ
k´ob
) {

1409 ++(*
move_couÁ”
);

1410 
»tuº_v®
 = 
	`Œy_sw­_·¿Î–
(
kt
, 
kth»ad_id
,

1411 
x_äom
, 
y_äom
, 
z_äom
,

1412 
ksub»giÚ_row
,

1413 
ksub»giÚ_cŞ
,

1414 
commÚ_·¿s_±r
,

1415 
sw­_d©a_±r
);

1416 ià(
»tuº_v®
 == 1) {

1417 ++(
commÚ_·¿s_±r
->
loÿl_sucûss_sum
);

1418 cÚ¡ 
ktÙ®_co¡
 = 
commÚ_·¿s_±r
->
loÿl_tÙ®_co¡
;

1419 
commÚ_·¿s_±r
->
loÿl_av_co¡
 +ğ
ktÙ®_co¡
;

1420 
commÚ_·¿s_±r
->
loÿl_av_bb_co¡
 +=

1421 
commÚ_·¿s_±r
->
loÿl_bb_co¡
;

1422 
commÚ_·¿s_±r
->
loÿl_av_timšg_co¡
 +=

1423 
commÚ_·¿s_±r
->
loÿl_timšg_co¡
;

1424 
commÚ_·¿s_±r
->
loÿl_av_d–ay_co¡
 +=

1425 
commÚ_·¿s_±r
->
loÿl_d–ay_co¡
;

1426 
commÚ_·¿s_±r
->
loÿl_sum_of_squ¬es
 +=

1427 
ktÙ®_co¡
 * ktotal_cost;

1435 
	`upd©e_äom_loÿl_to_glob®
(
loÿl_block
,

1436 
loÿl_grid
,

1437 
	`max
(0, 
k»giÚ_x_bound¬y
[
ksub»giÚ_row
] - 2),

1438 
	`mš
(
num_grid_cŞumns
 + 2,

1439 
k»giÚ_x_bound¬y
[
ksub»giÚ_row
 + 1] + 2),

1440 
	`max
(0, 
k»giÚ_y_bound¬y
[
ksub»giÚ_cŞ
] - 2),

1441 
	`mš
(
num_grid_rows
 + 2,

1442 
k»giÚ_y_bound¬y
[
ksub»giÚ_cŞ
 + 1] + 2));

1443 
	}
}

1447 
	$š™Ÿl_commÚ_·¿s
(
±h»ad_d©a_t
* 
šput_¬gs
,

1448 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
)

1451 
commÚ_·¿s_±r
->
loÿl_th»ad_id
 = 
šput_¬gs
->
th»ad_id
;

1452 
commÚ_·¿s_±r
->
loÿl_y_¡¬t
 = 
šput_¬gs
->
y_¡¬t
;

1453 
commÚ_·¿s_±r
->
loÿl_y_’d
 = 
šput_¬gs
->
y_’d
;

1454 
commÚ_·¿s_±r
->
loÿl_x_¡¬t
 = 
šput_¬gs
->
x_¡¬t
;

1455 
commÚ_·¿s_±r
->
loÿl_x_’d
 = 
šput_¬gs
->
x_’d
;

1458 
commÚ_·¿s_±r
->
loÿl_fixed_pšs
 = 
šput_¬gs
->
fixed_pšs
;

1459 
commÚ_·¿s_±r
->
loÿl_‹m³r
 = *(
šput_¬gs
->
t
);

1460 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
 = 
šput_¬gs
->
¶aûr_İts
;

1463 cÚ¡ 
ky_¡¬t
 = 
commÚ_·¿s_±r
->
loÿl_y_¡¬t
;

1464 cÚ¡ 
ky_’d
 = 
commÚ_·¿s_±r
->
loÿl_y_’d
;

1465 cÚ¡ 
kx_¡¬t
 = 
commÚ_·¿s_±r
->
loÿl_x_¡¬t
;

1466 cÚ¡ 
kx_’d
 = 
commÚ_·¿s_±r
->
loÿl_x_’d
;

1467 
commÚ_·¿s_±r
->
loÿl_»giÚ_y_bound¬y
[0] = 
ky_¡¬t
;

1468 
commÚ_·¿s_±r
->
loÿl_»giÚ_y_bound¬y
[1] =

1469 
ky_¡¬t
 + (()(
ky_’d
 - ky_start) / 2);

1470 
commÚ_·¿s_±r
->
loÿl_»giÚ_y_bound¬y
[2] = 
ky_’d
;

1472 
commÚ_·¿s_±r
->
loÿl_»giÚ_x_bound¬y
[0] = 
kx_¡¬t
;

1473 
commÚ_·¿s_±r
->
loÿl_»giÚ_x_bound¬y
[1] =

1474 
kx_¡¬t
 + (()(
kx_’d
 - kx_start) / 2);

1475 
commÚ_·¿s_±r
->
loÿl_»giÚ_x_bound¬y
[2] = 
kx_’d
;

1478 
commÚ_·¿s_±r
->
loÿl_fœ¡_¾im
 = ()
	`max
(
num_grid_cŞumns
,

1479 
num_grid_rows
);

1480 
commÚ_·¿s_±r
->
loÿl_¿nge_lim™
 = commÚ_·¿s_±r->
loÿl_fœ¡_¾im
;

1481 
commÚ_·¿s_±r
->
loÿl_fš®_¾im
 = 1;

1482 
commÚ_·¿s_±r
->
loÿl_šv”£_d–_¾im
 =

1483 1 / (
commÚ_·¿s_±r
->
loÿl_fœ¡_¾im
 - commÚ_·¿s_±r->
loÿl_fš®_¾im
);

1485 
commÚ_·¿s_±r
->
loÿl_¶aû_d–ay_v®ue
 = *(
šput_¬gs
->
¶aû_d–ay_v®ue
);

1486 
commÚ_·¿s_±r
->
loÿl_max_d–ay
 = *(
šput_¬gs
->
max_d–ay
);

1487 
commÚ_·¿s_±r
->
loÿl_num_cÚns
 = *(
šput_¬gs
->
num_cÚÃùiÚs
);

1488 
commÚ_·¿s_±r
->
loÿl_d–ay_co¡
 = *(
šput_¬gs
->
d–ay_co¡
);

1489 
commÚ_·¿s_±r
->
loÿl_Ãt_¦ack
 = 
šput_¬gs
->
Ãt_¦ack
;

1490 
commÚ_·¿s_±r
->
loÿl_Ãt_d–ay
 = 
šput_¬gs
->
Ãt_d–ay
;

1493 cÚ¡ 
kÃts_assign_to_th»ad
 = 
	`û
(()
num_Ãts
 / 
NUM_OF_THREADS
);

1494 cÚ¡ 
kth»ad_id
 = 
commÚ_·¿s_±r
->
loÿl_th»ad_id
;

1495 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_edge
 = kth»ad_id * 
kÃts_assign_to_th»ad
;

1496 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_edge
 =

1497 
	`mš
(
num_Ãts
, (
kth»ad_id
 + 1è* 
kÃts_assign_to_th»ad
);

1499 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
 =

1500 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_edge
;

1501 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks
 =

1502 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_edge
;

1504 
¡¬t_fšish_Ãts
[
kth»ad_id
].
edge_·¹™iÚ_size
 =

1505 (
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_edge


1506 - 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_edge
);

1507 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšk_·¹™iÚ_size
 =

1508 (
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks


1509 - 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
);

1511 
¡¬t_fšish_Ãts
[
kth»ad_id
].
couÁ”_sšk
 = 0;

1512 
¡¬t_fšish_Ãts
[
kth»ad_id
].
couÁ”_edge
 = 0;

1513 
	}
}

1515 
	$®loc_memÜy_fÜ_sw­_d©a
(cÚ¡ 
max_pšs_³r_şb
,

1516 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

1517 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
)

1520 
sw­_d©a_±r
->
m_loÿl_grid
 =

1521 (
grid_te_t
**)
	`®loc_m©rix
(0, (
num_grid_cŞumns
 + 1),

1522 0, (
num_grid_rows
 + 1),

1523 (
grid_te_t
));

1525 
sw­_d©a_±r
->
m_loÿl_block
 =

1526 (
loÿl_block_t
*)
	`m®loc
(
num_blocks
 * (local_block_t));

1529 
sw­_d©a_±r
->
m_bb_coÜd_Ãw
 =

1530 (
bbox_t
*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * (bbox_t));

1531 
sw­_d©a_±r
->
m_bb_edge_Ãw
 =

1532 (
bbox_t
*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * (bbox_t));

1534 
sw­_d©a_±r
->
m_Ãts_to_upd©e
 =

1535 (*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * ());

1536 
sw­_d©a_±r
->
m_Ãt_block_moved
 =

1537 (*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * ());

1539 
sw­_d©a_±r
->
m_loÿl_bb_coÜd
 =

1540 (
bbox_t
*)
	`my_m®loc
(
num_Ãts
 * (bbox_t));

1541 
sw­_d©a_±r
->
m_loÿl_bb_edge
 =

1542 (
bbox_t
*)
	`my_m®loc
(
num_Ãts
 * (bbox_t));

1544 
sw­_d©a_±r
->
m_loÿl_‹mp_Ãt_co¡
 = (*)
	`m®loc
(
num_Ãts
 * ());

1545 
sw­_d©a_±r
->
m_loÿl_Ãt_co¡
 = (*)
	`m®loc
(
num_Ãts
 * ());

1549 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®gÜ™hm
 =

1550 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
¶aû_®gÜ™hm
;

1551 ià(
k¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


1552 || 
k¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

1553 
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
 =

1554 (**)
	`my_m®loc
(
num_Ãts
 * (*));

1555 
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
 =

1556 (**)
	`my_m®loc
(
num_Ãts
 * (*));

1558 
š‘
 = -1;

1559 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

1560 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1561 (
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
)[
š‘
] =

1562 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

1563 --(
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
)[
š‘
];

1565 (
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
)[
š‘
] =

1566 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

1567 --(
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
)[
š‘
];

1570 
	}
}

1575 
	$š™Ÿl_sw­_d©a
(
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

1576 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
)

1578 
	`memıy
(
sw­_d©a_±r
->
m_loÿl_bb_edge
,

1579 
bb_num_Ú_edges
, 
num_Ãts
 * (
bbox_t
));

1580 
	`memıy
(
sw­_d©a_±r
->
m_loÿl_bb_coÜd
,

1581 
bb_coÜds
, 
num_Ãts
 * (
bbox_t
));

1583 
x
, 
y
, 
z
;

1584 
x
 = 0; x < 
num_Ãts
; ++x) {

1585 
sw­_d©a_±r
->
m_loÿl_‹mp_Ãt_co¡
[
x
] = 
‹mp_Ãt_co¡
[x];

1586 
sw­_d©a_±r
->
m_loÿl_Ãt_co¡
[
x
] = 
Ãt_co¡
[x];

1590 
grid_te_t
** 
loÿl_grid
 = 
sw­_d©a_±r
->
m_loÿl_grid
;

1591 cÚ¡ * 
k»giÚ_x_bound¬y
 = 
commÚ_·¿s_±r
->
loÿl_»giÚ_x_bound¬y
;

1592 
x
 = 
k»giÚ_x_bound¬y
[0] - 2;

1593 
x
 < 
k»giÚ_x_bound¬y
[2] + 2 && x < (
num_grid_cŞumns
 + 2); ++x) {

1595 ià(
x
 < 0) {

1596 
x
 = 0;

1599 
y
 = 0; y <ğ(
num_grid_rows
 + 1); ++y) {

1600 
loÿl_grid
[
x
][
y
].
grid_ty³
 = 
bš_grids
[x][y].grid_type;

1601 
loÿl_grid
[
x
][
y
].
m_u§ge
 = 
bš_grids
[x][y].m_usage;

1602 
loÿl_grid
[
x
][
y
].
m_off£t
 = 
bš_grids
[x][y].m_offset;

1604 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
x
][
y
].
m_ÿ·c™y
;

1605 
loÿl_grid
[
x
][
y
].
m_ÿ·c™y
 = 
kbš_ÿ·c™y
;

1606 
loÿl_grid
[
x
][
y
].
š_blocks
 = (*)
	`my_m®loc
(() *

1607 
kbš_ÿ·c™y
);

1608 
z
 = 0; z < 
kbš_ÿ·c™y
; ++z) {

1609 
loÿl_grid
[
x
][
y
].
š_blocks
[
z
] = 
bš_grids
[x][y].in_blocks[z];

1614 
loÿl_block_t
* 
loÿl_block
 = 
sw­_d©a_±r
->
m_loÿl_block
;

1615 
x
 = 0; x < 
num_blocks
; ++x) {

1616 
loÿl_block
[
x
].x = 
blocks
[x].x;

1617 
loÿl_block
[
x
].
y
 = 
blocks
[x].y;

1618 
loÿl_block
[
x
].
z
 = 
blocks
[x].z;

1620 
	}
}

1624 
	$b®ªû_two_cÚ£cutive_th»ads_edge
(cÚ¡ 
kth»ad_id
)

1626 ++(
¡¬t_fšish_Ãts
[
kth»ad_id
].
couÁ”_edge
);

1627 
wÜk_š_this_»giÚ
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
edges_š_this_·¹™iÚ
;

1628 
wÜk_š_Ãxt_»giÚ
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].
edges_š_this_·¹™iÚ
;

1632 
Ãt_shiá
 = 0;

1633 
exûed_¿tio
 = 0.0;

1634 
edge_·¹™iÚ_size
 = 0;

1635 ià(
wÜk_š_this_»giÚ
 < 
wÜk_š_Ãxt_»giÚ
) {

1636 
exûed_¿tio
 = (
wÜk_š_Ãxt_»giÚ
 - 
wÜk_š_this_»giÚ
) / work_in_this_region;

1637 
edge_·¹™iÚ_size
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].edge_partition_size;

1638 
Ãt_shiá
 = ()(
	`mš
(1, 
exûed_¿tio
è* 
edge_·¹™iÚ_size
 * 0.25);

1640 ià(
Ãt_shiá
 =ğ0 && (
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].
edge_·¹™iÚ_size
 >= 2)) {

1641 
Ãt_shiá
 = 1;

1644 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_edge
 +ğ
Ãt_shiá
;

1645 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].
¡¬t_edge
 +ğ
Ãt_shiá
;

1646 } ià(
wÜk_š_this_»giÚ
 > 
wÜk_š_Ãxt_»giÚ
) {

1649 
exûed_¿tio
 = (
wÜk_š_this_»giÚ
 - 
wÜk_š_Ãxt_»giÚ
) / work_in_next_region;

1650 
edge_·¹™iÚ_size
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].edge_partition_size;

1651 
Ãt_shiá
 = ()(
	`mš
(1, 
exûed_¿tio
è* 
edge_·¹™iÚ_size
 * 0.25);

1653 ià(
Ãt_shiá
 =ğ0 && 
¡¬t_fšish_Ãts
[
kth»ad_id
].
edge_·¹™iÚ_size
 >= 2) {

1654 
Ãt_shiá
 = 1;

1657 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_edge
 -ğ
Ãt_shiá
;

1658 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].
¡¬t_edge
 -ğ
Ãt_shiá
;

1663 
	`as£¹
(
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_edge


1664 > 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_edge
);

1665 
	}
}

1669 
	$b®ªû_two_cÚ£cutive_th»ads_sšks
(cÚ¡ 
kth»ad_id
)

1671 ++(
¡¬t_fšish_Ãts
[
kth»ad_id
].
couÁ”_sšk
);

1672 
wÜk_š_this_»giÚ
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšks_š_this_·¹™iÚ
;

1673 
wÜk_š_Ãxt_»giÚ
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].
sšks_š_this_·¹™iÚ
;

1677 
Ãt_shiá
 = 0;

1678 
exûed_¿tio
 = 0.0;

1679 
sšk_·¹™iÚ_size
 = 0;

1680 ià(
wÜk_š_this_»giÚ
 < 
wÜk_š_Ãxt_»giÚ
) {

1681 
exûed_¿tio
 = (
wÜk_š_Ãxt_»giÚ
 - 
wÜk_š_this_»giÚ
) / work_in_this_region;

1682 
sšk_·¹™iÚ_size
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].sink_partition_size;

1683 
Ãt_shiá
 = ()(
	`mš
(1, 
exûed_¿tio
è* 
sšk_·¹™iÚ_size
 * 0.25);

1685 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks
 +ğ
Ãt_shiá
;

1686 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].
¡¬t_sšks
 +ğ
Ãt_shiá
;

1687 } ià(
wÜk_š_this_»giÚ
 > 
wÜk_š_Ãxt_»giÚ
) {

1690 
exûed_¿tio
 = (
wÜk_š_this_»giÚ
 - 
wÜk_š_Ãxt_»giÚ
) / work_in_next_region;

1691 
sšk_·¹™iÚ_size
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].sink_partition_size;

1692 
Ãt_shiá
 = ()(
	`mš
(1, 
exûed_¿tio
è* 
sšk_·¹™iÚ_size
 * 0.25);

1694 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks
 -ğ
Ãt_shiá
;

1695 
¡¬t_fšish_Ãts
[
kth»ad_id
 + 1].
¡¬t_sšks
 -ğ
Ãt_shiá
;

1700 
	`as£¹
 (
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks


1701 > 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
);

1702 
	}
}

1706 
	$fšd_çnš_·¿Î–
(cÚ¡ 
kth»ad_id
)

1708 
Šodes_assign_to_th»ad
 = 
	`û
(()
num_of_v”‹xs
 / 
NUM_OF_THREADS
);

1709 
¡¬t_Šode
 = 
kth»ad_id
 * 
Šodes_assign_to_th»ad
;

1710 
fšish_Šode
 = 
	`mš
((
kth»ad_id
 + 1è* 
Šodes_assign_to_th»ad
,

1711 
num_of_v”‹xs
);

1712 
i
 = 0;

1713 
i
 = 
¡¬t_Šode
; i < 
fšish_Šode
; ++i) {

1714 
num_out_edges
 = 
v”‹xes
[
i
].num_out_edges;

1715 
edge_t
* 
‹dge
 = 
v”‹xes
[
i
].
out_edges
;

1717 
›dge
 = 0;

1718 
›dge
 = 0; iedg< 
num_out_edges
; ++iedge) {

1719 
to_node
 = 
‹dge
[
›dge
].to_node;

1721 
couÁ”
 = 
v”‹xes
[
to_node
].
num_·»Ás
++;

1722 
v”‹xes
[
to_node
].
š_edges
[
couÁ”
].to_nodğ
i
;

1725 
	}
}

1727 
	$š™Ÿl_loÿlv”t_grid
()

1731 
loÿlv”t_grid
 = (
grid_te_t
**)
	`®loc_m©rix
(0, (
num_grid_cŞumns
 + 1),

1732 0, (
num_grid_rows
 + 1),

1733 (
grid_te_t
));

1734 
cŞ
, 
row
, 
ÿp
;

1735 
cŞ
 = 0; cŞ < (
num_grid_cŞumns
 + 2); ++col) {

1736 
row
 = 0;„ow < (
num_grid_rows
 + 2); ++row) {

1737 
loÿlv”t_grid
[
row
][
cŞ
].
grid_ty³
 = 
bš_grids
[col][row].grid_type;

1738 
loÿlv”t_grid
[
row
][
cŞ
].
m_u§ge
 = 
bš_grids
[col][row].m_usage;

1739 
loÿlv”t_grid
[
row
][
cŞ
].
m_off£t
 = 
bš_grids
[col][row].m_offset;

1741 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
cŞ
][
row
].
m_ÿ·c™y
;

1743 
loÿlv”t_grid
[
row
][
cŞ
].
m_ÿ·c™y
 = 
kbš_ÿ·c™y
;

1744 
loÿlv”t_grid
[
row
][
cŞ
].
š_blocks
 = (*)
	`my_m®loc
(() *

1745 
kbš_ÿ·c™y
);

1747 
ÿp
 = 0; c­ < 
kbš_ÿ·c™y
; ++cap) {

1748 
loÿlv”t_grid
[
row
][
cŞ
].
š_blocks
[
ÿp
] =

1749 
bš_grids
[
cŞ
][
row
].
š_blocks
[
ÿp
];

1753 
	}
}

1757 
	$³rfÜm_timšg_ª®yze_·¿Î–
(cÚ¡ 
kth»ad_id
,

1758 *** 
Ãt_d–ay
,

1759 
±h»ad_d©a_t
* 
šput_¬gs
,

1760 * 
max_d–ay
)

1763 cÚ¡ 
couÁ”_sšk
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].counter_sink;

1764 ià(
kth»ad_id
 !ğ
NUM_OF_THREADS
 - 1

1765 && 
couÁ”_sšk
 < (
num_Ãts
 / 
PARITION_UPDATE
)) {

1766 cÚ¡ 
·¹™iÚ_size
 = (
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks


1767 - 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
);

1768 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšk_·¹™iÚ_size
 = 
·¹™iÚ_size
;

1772 cÚ¡ 
cur_th»ad_¡¬t_sšks
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
;

1773 cÚ¡ 
cur_th»ad_fšish_sšks
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks
;

1774 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšks_š_this_·¹™iÚ
 =

1775 
	`lßd_timšg_g¿ph_Ãt_d–ays_·¿Î–
(*
Ãt_d–ay
,

1776 
cur_th»ad_¡¬t_sšks
,

1777 
cur_th»ad_fšish_sšks
);

1779 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1781 ià(
kth»ad_id
 !ğ
NUM_OF_THREADS
 - 1 && 
couÁ”_sšk
 < 
num_Ãts
 / 
PARITION_UPDATE
) {

1782 
	`b®ªû_two_cÚ£cutive_th»ads_sšks
(
kth»ad_id
);

1785 ià(
kth»ad_id
 == 0) {

1786 *(
šput_¬gs
->
timšg_co¡
) = 0;

1787 *(
šput_¬gs
->
d–ay_co¡
) = 0;

1788 *(
šput_¬gs
->
max_d–ay
) = 0.0;

1796 
Šodes_assign_to_th»ad
 = 
	`û
(()
num_of_v”‹xs
 / 
NUM_OF_THREADS
);

1797 
¡¬t_node
 = 
kth»ad_id
 * 
Šodes_assign_to_th»ad
;

1798 
fšish_node
 = 
	`mš
((
kth»ad_id
 + 1è* 
Šodes_assign_to_th»ad
, 
num_of_v”‹xs
);

1799 
i
 = 0;

1800 
i
 = 
¡¬t_node
; i < 
fšish_node
; ++i) {

1801 
v”‹xes
[
i
].
¬r_time
 = 
T_CONSTANT_GENERATOR
;

1804 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1807 
Šodes_©_Ëv–0
 = 
Šodes_©_Ëv–
[0].
ÃËm
;

1808 
Šodes_assign_to_th»ad
 = 
	`û
(()
Šodes_©_Ëv–0
 / 
NUM_OF_THREADS
);

1809 
¡¬t_node
 = 
kth»ad_id
 * 
Šodes_assign_to_th»ad
;

1810 
fšish_node
 = 
	`mš
((
kth»ad_id
 + 1è* 
Šodes_assign_to_th»ad
,

1811 
Šodes_©_Ëv–0
);

1812 
i
 = 
¡¬t_node
; i < 
fšish_node
; ++i) {

1813 
node_šdex
 = 
Šodes_©_Ëv–
[0].
li¡
[
i
];

1814 
v”‹xes
[
node_šdex
].
¬r_time
 = 0.0;

1816 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1823 *
max_d–ay
 = 0.0;

1824 
ev–
 = 0;

1825 
ev–
 = 1; iËv– < 
num_Šode_Ëv–s
; ++ilevel) {

1826 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1827 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

1828 
num_of_th»ad_u£d
 = 
	`û
(()
num_©_Ëv–
 / 100);

1829 
Šodes_assign_to_th»ad
 = 
	`û
(()
num_©_Ëv–
 /

1830 
	`mš
(
NUM_OF_THREADS
, 
num_of_th»ad_u£d
));

1833 ià(
kth»ad_id
 < 
num_of_th»ad_u£d
) {

1834 
¡¬t_node
 = 
kth»ad_id
 * 
Šodes_assign_to_th»ad
;

1835 
fšish_node
 = 
	`mš
((
kth»ad_id
 + 1è* 
Šodes_assign_to_th»ad
,

1836 
num_©_Ëv–
);

1839 *
max_d–ay
 = 
	`max
(*max_delay,

1840 
	`ÿlc_Šodes_¬r_time_·¿Î–
(
¡¬t_node
,

1841 
fšish_node
,

1842 
ev–
));

1847 
	`±h»ad_mu‹x_lock
(&
glob®_d©a_acûss
.
mu‹x
);

1848 *(
šput_¬gs
->
max_d–ay
èğ
	`max
(*(input_args->max_delay), *max_delay);

1849 
	`±h»ad_mu‹x_uÆock
(&
glob®_d©a_acûss
.
mu‹x
);

1853 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1854 *
max_d–ay
 = *(
šput_¬gs
->max_delay);

1855 
ev–
 = 
num_Šode_Ëv–s
 - 1; ilevel >= 0; --ilevel) {

1856 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

1857 
num_of_th»ad_u£d
 = 
	`û
(()
num_©_Ëv–
 / 100);

1858 
Šodes_assign_to_th»ad
 = 
	`û
(()
num_©_Ëv–
 /

1859 
	`mš
(
NUM_OF_THREADS
, 
num_of_th»ad_u£d
));

1862 ià(
kth»ad_id
 < 
num_of_th»ad_u£d
) {

1863 
¡¬t_node
 = 
kth»ad_id
 * 
Šodes_assign_to_th»ad
;

1864 
fšish_node
 = 
	`mš
((
kth»ad_id
 + 1è* 
Šodes_assign_to_th»ad
,

1865 
num_©_Ëv–
);

1866 
	`ÿlc_Šodes_»q_time_·¿Î–
(*
max_d–ay
,

1867 
¡¬t_node
,

1868 
fšish_node
,

1869 
ev–
);

1871 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1873 
	}
}

1877 
	$compu‹_Ãt_¦ack_fuÎ
(cÚ¡ 
kth»ad_id
,

1878 *** 
Ãt_¦ack
,

1879 * 
timšg_co¡
,

1880 * 
d–ay_co¡
,

1881 
ü™_expÚ’t
,

1882 
max_d–ay
,

1883 
±h»ad_d©a_t
* 
šput_¬gs
)

1887 cÚ¡ 
th»ad_¡¬t_edge
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_edge
;

1888 cÚ¡ 
th»ad_fšish_edge
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_edge
;

1889 cÚ¡ 
·¹™iÚ_size
 = 
th»ad_fšish_edge
 - 
th»ad_¡¬t_edge
;

1891 cÚ¡ 
th»ad_couÁ”_edge
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
couÁ”_edge
;

1892 ià(
th»ad_couÁ”_edge
 < (
num_Ãts
 / 
PARITION_UPDATE
)) {

1893 
¡¬t_fšish_Ãts
[
kth»ad_id
].
edge_·¹™iÚ_size
 = 
·¹™iÚ_size
;

1897 
¡¬t_fšish_Ãts
[
kth»ad_id
].
edges_š_this_·¹™iÚ
 =

1898 
	`compu‹_Ãt_¦acks_·¿Î–
(*
Ãt_¦ack
,

1899 
th»ad_¡¬t_edge
,

1900 
th»ad_fšish_edge
);

1901 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1904 ià(
kth»ad_id
 !ğ
NUM_OF_THREADS
 - 1

1905 && 
th»ad_couÁ”_edge
 < (
num_Ãts
 / 
PARITION_UPDATE
)) {

1908 
	`b®ªû_two_cÚ£cutive_th»ads_edge
(
kth»ad_id
);

1911 cÚ¡ 
th»ad_¡¬t_sšks
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
;

1912 cÚ¡ 
th»ad_fšish_sšks
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks
;

1913 cÚ¡ 
th»ad_couÁ”_sšk
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
couÁ”_sšk
;

1914 ià(
kth»ad_id
 !ğ
NUM_OF_THREADS
 - 1

1915 && 
th»ad_couÁ”_sšk
 < (
num_Ãts
 / 
PARITION_UPDATE
)) {

1916 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšk_·¹™iÚ_size
 =

1917 
th»ad_fšish_sšks
 - 
th»ad_¡¬t_sšks
;

1921 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšks_š_this_·¹™iÚ
 =

1922 
	`compu‹_td_co¡s_·¿Î–_w™h_upd©e_ü™
(
timšg_co¡
,

1923 
d–ay_co¡
,

1924 *
Ãt_¦ack
,

1925 
max_d–ay
,

1926 
ü™_expÚ’t
,

1927 
th»ad_¡¬t_sšks
,

1928 
th»ad_fšish_sšks
);

1932 
·¹Ÿl_timšg_»suÉs
[
kth»ad_id
] = *
timšg_co¡
;

1933 
·¹Ÿl_d–ay_»suÉs
[
kth»ad_id
] = *
d–ay_co¡
;

1935 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1937 ià(
kth»ad_id
 == 0) {

1938 *
timšg_co¡
 = 0.0;

1939 *
d–ay_co¡
 = 0.0;

1940 
th»ad_idx
 = 0;

1941 
th»ad_idx
 = 0;h»ad_idx < 
NUM_OF_THREADS
; ++thread_idx) {

1942 *
timšg_co¡
 +ğ
·¹Ÿl_timšg_»suÉs
[
th»ad_idx
];

1943 *
d–ay_co¡
 +ğ
·¹Ÿl_d–ay_»suÉs
[
th»ad_idx
];

1946 *(
šput_¬gs
->
timšg_co¡
) = *timing_cost;

1947 *(
šput_¬gs
->
d–ay_co¡
) = *delay_cost;

1950 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1952 ià(
kth»ad_id
 !ğ
NUM_OF_THREADS
 - 1

1953 && 
th»ad_couÁ”_sšk
 < 
num_Ãts
 / 
PARITION_UPDATE
) {

1954 
	`b®ªû_two_cÚ£cutive_th»ads_sšks
(
kth»ad_id
);

1956 
	}
}

1958 
	$ÿlcuÏ‹_timšg_w™hout_upd©e_ü™
(cÚ¡ 
kth»ad_id
,

1959 * 
timšg_co¡
,

1960 * 
d–ay_co¡
,

1961 
±h»ad_d©a_t
* 
šput_¬gs
)

1963 cÚ¡ 
th»ad_couÁ”_sšk
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
couÁ”_sšk
;

1964 cÚ¡ 
th»ad_fšish_sšks
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
fšish_sšks
;

1965 cÚ¡ 
th»ad_¡¬t_sšks
 = 
¡¬t_fšish_Ãts
[
kth»ad_id
].
¡¬t_sšks
;

1966 ià(
kth»ad_id
 !ğ
NUM_OF_THREADS
 - 1 && 
th»ad_couÁ”_sšk
 < 
num_Ãts
 / 
PARITION_UPDATE
) {

1967 cÚ¡ 
·¹™iÚ_size
 = 
th»ad_fšish_sšks
 - 
th»ad_¡¬t_sšks
;

1968 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšk_·¹™iÚ_size
 = 
·¹™iÚ_size
;

1971 
¡¬t_fšish_Ãts
[
kth»ad_id
].
sšks_š_this_·¹™iÚ
 =

1972 
	`compu‹_td_co¡s_·¿Î–_w™hout_upd©e_ü™
(
timšg_co¡
,

1973 
d–ay_co¡
,

1974 
th»ad_¡¬t_sšks
,

1975 
th»ad_fšish_sšks
);

1976 
	`±h»ad_mu‹x_lock
(&
glob®_d©a_acûss
.
mu‹x
);

1977 *(
šput_¬gs
->
timšg_co¡
) += *timing_cost;

1978 *(
šput_¬gs
->
d–ay_co¡
) += *delay_cost;

1979 
	`±h»ad_mu‹x_uÆock
(&
glob®_d©a_acûss
.
mu‹x
);

1980 
	`b¬r›r_pŞlšg
(
kth»ad_id
);

1982 ià(
kth»ad_id
 !ğ
NUM_OF_THREADS
 - 1 && 
th»ad_couÁ”_sšk
 < 
num_Ãts
 / 
PARITION_UPDATE
) {

1983 
	`b®ªû_two_cÚ£cutive_th»ads_sšks
(
kth»ad_id
);

1985 
	}
}

1988 
	$upd©e_äom_glob®_to_loÿl_grid
(cÚ¡ 
k™”
,

1989 
±h»ad_d©a_t
* 
šput_¬gs
,

1990 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

1991 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
)

1994 cÚ¡ 
kth»ad_id
 = 
commÚ_·¿s_±r
->
loÿl_th»ad_id
;

1995 cÚ¡ * 
k»giÚ_x_bound¬y
 = 
commÚ_·¿s_±r
->
loÿl_»giÚ_x_bound¬y
;

1996 cÚ¡ * 
k»giÚ_y_bound¬y
 = 
commÚ_·¿s_±r
->
loÿl_»giÚ_y_bound¬y
;

1997 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®gÜ™hm
 =

1998 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
¶aû_®gÜ™hm
;

1999 ià(
kth»ad_id
 / 
	`sq¹
(
NUM_OF_THREADS
) == 0) {

2007 ià(
k¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

2008 
k¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

2009 *(
šput_¬gs
->
co¡
èğ
commÚ_·¿s_±r
->
loÿl_tÙ®_co¡
 = 1.0;

2012 ià(
k™”
 =ğ0 && 
kth»ad_id
 == 0) {

2013 *(
šput_¬gs
->
av_co¡
) = 0.0;

2014 *(
šput_¬gs
->
av_bb_co¡
) = 0.0;

2015 *(
šput_¬gs
->
av_timšg_co¡
) = 0.0;

2016 *(
šput_¬gs
->
av_d–ay_co¡
) = 0.0;

2017 *(
šput_¬gs
->
sum_of_squ¬es
) = 0.0;

2018 *(
šput_¬gs
->
sucûss_sum
) = 0.0;

2019 *(
šput_¬gs
->
move_lim
) = 0;

2023 
	`upd©e_äom_glob®_to_loÿl_grid_Úly
(
sw­_d©a_±r
->
m_loÿl_grid
,

2024 
	`max
(0, 
k»giÚ_x_bound¬y
[0] - 2),

2025 
k»giÚ_x_bound¬y
[0] + 2,

2026 
	`max
(
k»giÚ_y_bound¬y
[0] - 2 , 0),

2027 
	`mš
(
k»giÚ_y_bound¬y
[2] + 2,

2028 
num_grid_rows
 + 2));

2032 
x
 = -1;

2033 
loÿl_block_t
* 
loÿl_block
 = 
sw­_d©a_±r
->
m_loÿl_block
;

2034 
x
 = 0; x < 
num_blocks
; ++x) {

2035 
loÿl_block
[
x
].x = 
blocks
[x].x;

2036 
loÿl_block
[
x
].
y
 = 
blocks
[x].y;

2037 
loÿl_block
[
x
].
z
 = 
blocks
[x].z;

2041 ià(
k¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

2042 
k¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

2043 
commÚ_·¿s_±r
->
loÿl_tÙ®_co¡
 = 1.0;

2045 
commÚ_·¿s_±r
->
loÿl_timšg_co¡
 = *(
šput_¬gs
->
timšg_co¡
);

2046 
commÚ_·¿s_±r
->
loÿl_šv”£_´ev_timšg_co¡
 =

2047 1 / 
commÚ_·¿s_±r
->
loÿl_timšg_co¡
;

2048 
commÚ_·¿s_±r
->
loÿl_d–ay_co¡
 = *(
šput_¬gs
->
d–ay_co¡
);

2051 
commÚ_·¿s_±r
->
loÿl_bb_co¡
 = *(
šput_¬gs
->
bb_co¡
);

2052 
commÚ_·¿s_±r
->
loÿl_šv”£_´ev_bb_co¡
 =

2053 1 / 
commÚ_·¿s_±r
->
loÿl_bb_co¡
;

2055 
	`memıy
(
sw­_d©a_±r
->
m_loÿl_bb_edge
,

2056 
bb_num_Ú_edges
, 
num_Ãts
 * (
bbox_t
));

2057 
	`memıy
(
sw­_d©a_±r
->
m_loÿl_bb_coÜd
,

2058 
bb_coÜds
, 
num_Ãts
 * (
bbox_t
));

2059 
	`memıy
(
sw­_d©a_±r
->
m_loÿl_‹mp_Ãt_co¡
,

2060 
‹mp_Ãt_co¡
, 
num_Ãts
 * ());

2061 
	`memıy
(
sw­_d©a_±r
->
m_loÿl_Ãt_co¡
,

2062 
Ãt_co¡
, 
num_Ãts
 * ());

2063 
	}
}

2066 
	$upd©e_loÿl_d©a_äom_glob®
(cÚ¡ * 
»giÚ_x_bound¬y
,

2067 cÚ¡ * 
»giÚ_y_bound¬y
,

2068 
grid_te_t
** 
loÿl_grid
,

2069 
loÿl_block_t
* 
loÿl_block
,

2070 cÚ¡ 
krow
,

2071 cÚ¡ 
kcŞ
)

2075 ià(
krow
 =ğ0 && 
kcŞ
 == 0) {

2077 
	`upd©e_äom_glob®_to_loÿl_hÜi
(
loÿl_block
,

2078 
loÿl_grid
,

2079 
	`max
(2, 
»giÚ_x_bound¬y
[0] - 2),

2080 
»giÚ_x_bound¬y
[0] + 2,

2081 
	`max
(0, 
»giÚ_y_bound¬y
[0] + 2),

2082 
»giÚ_y_bound¬y
[1] + 2);

2084 
	`upd©e_äom_glob®_to_loÿl_v”t
(
loÿl_block
,

2085 
loÿl_grid
,

2086 
	`max
(0, 
»giÚ_x_bound¬y
[0] - 2),

2087 
»giÚ_x_bound¬y
[1] + 2,

2088 
	`max
(2, 
»giÚ_y_bound¬y
[0] - 2),

2089 
»giÚ_y_bound¬y
[0] + 2);

2090 } ià(
krow
 =ğ0 && 
kcŞ
 == 1) {

2092 
	`upd©e_äom_glob®_to_loÿl_hÜi
(
loÿl_block
,

2093 
loÿl_grid
,

2094 
	`max
(2, 
»giÚ_x_bound¬y
[0] - 2),

2095 
»giÚ_x_bound¬y
[0] + 2,

2096 
»giÚ_y_bound¬y
[1] + 2,

2097 
	`mš
(
num_grid_rows
 + 2,

2098 
»giÚ_y_bound¬y
[2] + 2));

2100 
	`upd©e_äom_glob®_to_loÿl_v”t
(
loÿl_block
,

2101 
loÿl_grid
,

2102 
	`max
(0, 
»giÚ_x_bound¬y
[0] - 2),

2103 
»giÚ_x_bound¬y
[1] + 2,

2104 
»giÚ_y_bound¬y
[2] - 2,

2105 
	`mš
(
num_grid_rows
 - 2,

2106 
»giÚ_y_bound¬y
[2] + 2));

2107 } ià(
krow
 =ğ1 && 
kcŞ
 == 0) {

2109 
	`upd©e_äom_glob®_to_loÿl_hÜi
(
loÿl_block
,

2110 
loÿl_grid
,

2111 
»giÚ_x_bound¬y
[2] - 2,

2112 
	`mš
(
num_grid_cŞumns
 - 2,

2113 
»giÚ_x_bound¬y
[2] + 2),

2114 
	`max
(0, 
»giÚ_y_bound¬y
[0] + 2),

2115 
»giÚ_y_bound¬y
[1] + 2);

2117 
	`upd©e_äom_glob®_to_loÿl_v”t
(
loÿl_block
,

2118 
loÿl_grid
,

2119 
»giÚ_x_bound¬y
[1] - 2,

2120 
	`mš
(
num_grid_cŞumns
 + 2,

2121 
»giÚ_x_bound¬y
[2] + 2),

2122 
	`max
(0, 
»giÚ_y_bound¬y
[0] - 2),

2123 
»giÚ_y_bound¬y
[0] + 2);

2124 } ià(
krow
 =ğ1 && 
kcŞ
 == 1) {

2126 
	`upd©e_äom_glob®_to_loÿl_hÜi
(
loÿl_block
,

2127 
loÿl_grid
,

2128 
»giÚ_x_bound¬y
[2] - 2,

2129 
	`mš
(
num_grid_cŞumns
 - 2,

2130 
»giÚ_x_bound¬y
[2] + 2),

2131 
»giÚ_y_bound¬y
[1] + 2,

2132 
	`mš
(
num_grid_cŞumns
 + 2,

2133 
»giÚ_y_bound¬y
[2] + 2));

2135 
	`upd©e_äom_glob®_to_loÿl_v”t
(
loÿl_block
,

2136 
loÿl_grid
,

2137 
»giÚ_x_bound¬y
[1] - 2,

2138 
	`mš
(
num_grid_cŞumns
 + 2,

2139 
»giÚ_x_bound¬y
[2] + 2),

2140 
»giÚ_y_bound¬y
[2] - 2,

2141 
	`mš
(
num_grid_rows
 - 2,

2142 
»giÚ_y_bound¬y
[2] + 2));

2144 
	`´štf
("šcÜ»ù„ow,cŞ combš©iÚ iÀšÃ¸loİ: (%d, %d)", 
krow
, 
kcŞ
);

2146 
	}
}

2150 
	$upd©e_t_·¿Î–
(* 
t
,

2151 * 
šÃr_™”_num
,

2152 
¿nge_lim™
,

2153 
sucûss_¿t
,

2154 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
)

2156 ià(
ªÃ®šg_sched
.
ty³
 =ğ
USER_SCHED
) {

2157 *
t
 = 
ªÃ®šg_sched
.
®pha_t
 * (*t);

2160 *
šÃr_™”_num
 = 
ªÃ®šg_sched
.
šÃr_num
;

2161 ià(
sucûss_¿t
 > 0.96) {

2162 *
t
 = (*t) * 0.5;

2163 } ià(
sucûss_¿t
 > 0.8) {

2164 *
t
 = (*t) * 0.9;

2165 } ià(
sucûss_¿t
 > 0.15 || 
¿nge_lim™
 > 1.) {

2166 *
t
 = (*t) * 0.9;

2167 *
šÃr_™”_num
 = 
ªÃ®šg_sched
.
šÃr_num
 / 4;

2169 *
t
 = (*t) * 0.6;

2170 *
šÃr_™”_num
 = 
ªÃ®šg_sched
.
šÃr_num
 / 20;

2173 
	}
}

2179 
	$fšd_afãùed_Ãts_·¿Î–
(* 
Ãts_to_upd©e
,

2180 * 
Ãt_block_moved
,

2181 
äom_block
,

2182 
to_block
,

2183 
num_block_pšs
,

2184 * 
loÿl_‹mp_Ãt_co¡
)

2186 
afãùed_šdex
 = 0;

2187 
k
, 
š‘
, 
couÁ
;

2188 
k
 = 0; k < 
num_block_pšs
; ++k) {

2189 
š‘
 = 
blocks
[
äom_block
].
Ãts
[
k
];

2190 ià(
OPEN
 =ğ
š‘
 || 
TRUE
 =ğ
is_glob®
[inet]) {

2194 ià(
loÿl_‹mp_Ãt_co¡
[
š‘
] > 0.0) {

2198 
Ãts_to_upd©e
[
afãùed_šdex
] = 
š‘
;

2199 
Ãt_block_moved
[
afãùed_šdex
] = 
FROM
;

2200 ++
afãùed_šdex
;

2201 
loÿl_‹mp_Ãt_co¡
[
š‘
] = 1.0;

2204 ià(
to_block
 !ğ
EMPTY
) {

2205 
k
 = 0; k < 
num_block_pšs
; ++k) {

2206 
š‘
 = 
blocks
[
to_block
].
Ãts
[
k
];

2207 ià(
OPEN
 =ğ
š‘
 || 
TRUE
 =ğ
is_glob®
[inet]) {

2211 ià(
loÿl_‹mp_Ãt_co¡
[
š‘
] > 0.0) {

2213 
couÁ
 = 0; couÁ < 
afãùed_šdex
; ++count) {

2214 ià(
Ãts_to_upd©e
[
couÁ
] =ğ
š‘
) {

2215 ià(
Ãt_block_moved
[
couÁ
] =ğ
FROM
) {

2216 
Ãt_block_moved
[
couÁ
] = 
FROM_AND_TO
;

2222 ià(
couÁ
 > 
afãùed_šdex
) {

2223 
	`´štf
("Error in find_affected_nets -- count = %d,"

2224 "‡fãùed index = %d.\n", 
couÁ
,

2225 
afãùed_šdex
);

2226 
	`ex™
(1);

2230 
Ãts_to_upd©e
[
afãùed_šdex
] = 
š‘
;

2231 
Ãt_block_moved
[
afãùed_šdex
] = 
TO
;

2232 ++
afãùed_šdex
;

2233 
loÿl_‹mp_Ãt_co¡
[
š‘
] = 1.;

2238  
afãùed_šdex
;

2239 
	}
}

2241 
	$as£ss_sw­_·¿Î–
(
d–_c
,

2242 
t
,

2243 
loÿl_£ed
)

2246 
acû±
 = -1;

2247 ià(
d–_c
 <= 0) {

2248 #ifdeà
SPEC


2249 
âum
 = 
	`my_äªd_·¿Î–
(
loÿl_£ed
);

2251 
acû±
 = 1;

2252  (
acû±
);

2255 ià(
t
 == 0.) {

2259 
âum
 = 
	`my_äªd_·¿Î–
(
loÿl_£ed
);

2260 
´ob_çc
 = 
	`exp
(-
d–_c
 / 
t
);

2261 ià(
´ob_çc
 > 
âum
) {

2262 
acû±
 = 1;

2264 
acû±
 = 0;

2267  (
acû±
);

2268 
	}
}

2270 
boŞ—n
 
	$fšd_to_block_·¿Î–
(
x_äom
,

2271 
y_äom
,

2272 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

2273 * 
x_to
,

2274 * 
y_to
,

2275 
kth»ad_id
,

2276 
xmš
, 
xmax
,

2277 
ymš
, 
ymax
)

2280 
choiû
 = 0;

2284 ià(
kblock_ty³
 =ğ
INPAD_TYPE
 || kblock_ty³ =ğ
OUTPAD_TYPE
) {

2287 ià(
xmš
 =ğ0 && 
ymš
 == 0) {

2289 ià(
	`my_œªd_·¿Î–
(1, 
kth»ad_id
)) {

2291 *
x_to
 = 0;

2292 
choiû
 = 
	`my_œªd_·¿Î–
(
ymax
 - 
ymš
, 
kth»ad_id
);

2293 *
y_to
 = 
	`max
(1, 
choiû
);

2296 
choiû
 = 
	`my_œªd_·¿Î–
(
xmax
 - 
xmš
, 
kth»ad_id
);

2297 *
x_to
 = 
	`max
(1, 
choiû
);

2298 *
y_to
 = 0;

2300 } ià(
xmax
 =ğ
num_grid_cŞumns
 + 1 && 
ymš
 == 0) {

2303 ià(
	`my_œªd_·¿Î–
(1, 
kth»ad_id
)) {

2305 *
x_to
 = 
num_grid_cŞumns
 + 1;

2306 
choiû
 = 
	`my_œªd_·¿Î–
(
ymax
 - 
ymš
, 
kth»ad_id
);

2307 *
y_to
 = 
	`max
(1, 
choiû
);

2310 
choiû
 = 
xmš
 + 
	`my_œªd_·¿Î–
(
xmax
 - xmš, 
kth»ad_id
);

2311 *
x_to
 = 
	`mš
(
num_grid_cŞumns
, 
choiû
);

2312 *
y_to
 = 0;

2314 } ià(
xmš
 =ğ0 && 
ymax
 =ğ
num_grid_rows
 + 1) {

2317 ià(
	`my_œªd_·¿Î–
(1, 
kth»ad_id
)) {

2319 *
x_to
 = 0;

2320 
choiû
 = 
ymš
 + 
	`my_œªd_·¿Î–
(
ymax
 - ymš, 
kth»ad_id
);

2321 *
y_to
 = 
	`mš
(
num_grid_rows
, 
choiû
);

2324 
choiû
 = 
	`my_œªd_·¿Î–
(
xmax
 - 
xmš
, 
kth»ad_id
);

2325 *
x_to
 = 
	`max
(1, 
choiû
);

2326 *
y_to
 = 
num_grid_rows
 + 1;

2328 } ià(
xmax
 =ğ
num_grid_cŞumns
 + 1 && 
ymax
 =ğ
num_grid_rows
 + 1) {

2331 ià(
	`my_œªd_·¿Î–
(1, 
kth»ad_id
)) {

2333 *
x_to
 = 
num_grid_cŞumns
 + 1;

2334 
choiû
 = 
ymš
 + 
	`my_œªd_·¿Î–
(
ymax
 - ymš, 
kth»ad_id
);

2335 *
y_to
 = 
	`mš
(
num_grid_rows
, 
choiû
);

2338 
choiû
 = 
xmš
 + 
	`my_œªd_·¿Î–
(
xmax
 - xmš, 
kth»ad_id
);

2339 *
x_to
 = 
	`mš
(
num_grid_cŞumns
, 
choiû
);

2340 *
y_to
 = 
num_grid_rows
 + 1;

2342 } ià(
xmš
 =ğ0 || 
xmax
 =ğ
num_grid_cŞumns
 + 1) {

2343 *
x_to
 = 
x_äom
;

2344 *
y_to
 = 
ymš
 + 
	`my_œªd_·¿Î–
(
ymax
 - ymš, 
kth»ad_id
);

2345 } ià(
ymš
 =ğ0 || 
ymax
 =ğ
num_grid_rows
 + 1) {

2346 *
x_to
 = 
xmš
 + 
	`my_œªd_·¿Î–
(
xmax
 - xmš, 
kth»ad_id
);

2347 *
y_to
 = 
y_äom
;

2349 
	`´štf
("cameo‡ wrong†oop\n");

2350 
	`ex™
(-1);

2353 
	`as£¹
(
IO_TYPE
 =ğ
bš_grids
[*
x_to
][*
y_to
].
grid_ty³
);

2354 
	`as£¹
((*
x_to
 >ğ0 || *x_tØ<ğ
num_grid_cŞumns
 + 1)

2355 && (*
y_to
 >ğ0 || *y_tØ<ğ
num_grid_rows
 + 1));

2359 
x_off£t
 = 
	`my_œªd_·¿Î–
(
xmax
 - 
xmš
, 
kth»ad_id
);

2360 
y_off£t
 = 
	`my_œªd_·¿Î–
(
ymax
 - 
ymš
, 
kth»ad_id
);

2362 *
x_to
 = 
x_off£t
 + 
xmš
;

2363 *
y_to
 = 
y_off£t
 + 
ymš
;

2366 *
x_to
 = 
	`max
(1, *x_to);

2367 *
x_to
 = 
	`mš
(
num_grid_cŞumns
, *x_to);

2368 *
y_to
 = 
	`max
(1, *y_to);

2369 *
y_to
 = 
	`mš
(
num_grid_rows
, *y_to);

2371 
	`as£¹
((*
x_to
 >ğ1 && *x_tØ<ğ
num_grid_cŞumns
)

2372 && (*
y_to
 >ğ1 && *y_tØ<ğ
num_grid_rows
));

2373 
	`as£¹
(
B_CLB_TYPE
 =ğ
bš_grids
[*
x_to
][*
y_to
].
grid_ty³
);

2375 } (
x_äom
 =ğ*
x_to
è&& (
y_äom
 =ğ*
y_to
));

2377  
TRUE
;

2378 
	}
}

2380 
	$comp_td_pošt_to_pošt_d–ay_·¿Î–
(
š‘
,

2381 
š
,

2382 
loÿl_block_t
* 
loÿl_block
)

2385 
sourû_block
 = 
Ãt
[
š‘
].
node_blocks
[0];

2386 
sšk_block
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

2387 
	`as£¹
(
sourû_block
 !ğ
sšk_block
);

2389 
block_ty³s_t
 
sourû_ty³
 = 
blocks
[
sourû_block
].
block_ty³
;

2390 
block_ty³s_t
 
sšk_ty³
 = 
blocks
[
sšk_block
].
block_ty³
;

2391 
	`as£¹
(
sourû_ty³
 !ğ
EMPTY_TYPE
 && 
sšk_ty³
 != EMPTY_TYPE);

2393 
d–_x
 = 
	`abs
(
loÿl_block
[
sšk_block
].
x
 -†oÿl_block[
sourû_block
].x);

2394 
d–_y
 = 
	`abs
(
loÿl_block
[
sšk_block
].
y
 -†oÿl_block[
sourû_block
].y);

2400 
d–ay_sourû_to_sšk
 = 0.0;

2401 ià(
sourû_ty³
 =ğ
B_CLB_TYPE
) {

2402 ià(
sšk_ty³
 =ğ
B_CLB_TYPE
) {

2403 
d–ay_sourû_to_sšk
 = 
d–_şb_to_şb
[
d–_x
][
d–_y
];

2404 } ià(
sšk_ty³
 =ğ
OUTPAD_TYPE
) {

2406 
d–ay_sourû_to_sšk
 = 
d–_şb_to_ouad
[
d–_x
][
d–_y
];

2408 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, \
 from clb output…ino input…ad\n");

2410 
	`ex™
(1);

2412 } ià(
sourû_ty³
 =ğ
INPAD_TYPE
) {

2413 ià(
sšk_ty³
 =ğ
B_CLB_TYPE
) {

2414 
d–ay_sourû_to_sšk
 = 
d–_š·d_to_şb
[
d–_x
][
d–_y
];

2415 } ià(
sšk_ty³
 =ğ
OUTPAD_TYPE
) {

2416 
d–ay_sourû_to_sšk
 = 
d–_š·d_to_ouad
[
d–_x
][
d–_y
];

2418 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, \
 from input…ado input…ad\n");

2420 
	`ex™
(1);

2423 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, bad source_type\n");

2424 
	`ex™
(1);

2427 ià(
d–ay_sourû_to_sšk
 < 0.0) {

2428 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, Tdel is†esshan 0\n");

2429 
	`ex™
(1);

2432  
d–ay_sourû_to_sšk
;

2433 
	}
}

2440 
	$compu‹_d–_td_co¡_·¿Î–
(cÚ¡ 
käom_block
,

2441 cÚ¡ 
kto_block
,

2442 
num_block_pšs
,

2443 * 
d–_timšg
,

2444 * 
d–_d–ay
,

2445 
loÿl_block_t
* 
loÿl_block
,

2446 ** 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
,

2447 ** 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
)

2449 
d–_timšg_co¡
 = 0.0;

2450 
d–_d–ay_co¡
 = 0.0;

2451 
‹mp_d–ay
 = 0.0;

2453 
pš_šdex
 = -1;

2454 
š
 = 0;

2455 
pš_šdex
 = 0;…š_šdex < 
num_block_pšs
; ++pin_index) {

2456 cÚ¡ 
š‘
 = 
blocks
[
käom_block
].
Ãts
[
pš_šdex
];

2457 ià(
OPEN
 =ğ
š‘
 || 
TRUE
 =ğ
is_glob®
[inet]) {

2461 cÚ¡ 
Ãt_pš
 = 
Ãt_pš_šdex
[
käom_block
][
pš_šdex
];

2462 ià(
Ãt_pš
 != 0) {

2469 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
kto_block


2470 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
käom_block
) {

2473 
‹mp_d–ay
 = 
	`comp_td_pošt_to_pošt_d–ay_·¿Î–
(
š‘
,

2474 
Ãt_pš
,

2475 
loÿl_block
);

2477 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = 
‹mp_d–ay
;

2478 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2479 
timšg_¶aû_ü™
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

2481 
d–_d–ay_co¡
 +=

2482 (
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]

2483 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]);

2484 
d–_timšg_co¡
 +=

2485 (
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]

2486 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]);

2491 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2492 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2493 
‹mp_d–ay
 = 
	`comp_td_pošt_to_pošt_d–ay_·¿Î–
(
š‘
,

2494 
š
,

2495 
loÿl_block
);

2496 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay
;

2497 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2498 
timšg_¶aû_ü™
[
š‘
][
š
] * 
‹mp_d–ay
;

2500 
d–_d–ay_co¡
 +=

2501 (
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]

2502 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]);

2503 
d–_timšg_co¡
 +=

2504 (
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
]

2505 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
]);

2511 ià(
kto_block
 !ğ
EMPTY
) {

2512 
pš_šdex
 = 0;…š_šdex < 
num_block_pšs
; ++pin_index) {

2513 cÚ¡ 
š‘
 = 
blocks
[
kto_block
].
Ãts
[
pš_šdex
];

2514 ià(
OPEN
 =ğ
š‘
 || 
TRUE
 =ğ
is_glob®
[inet]) {

2518 cÚ¡ 
Ãt_pš
 = 
Ãt_pš_šdex
[
kto_block
][
pš_šdex
];

2519 ià(
Ãt_pš
 != 0) {

2526 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
kto_block


2527 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
käom_block
) {

2528 
‹mp_d–ay
 = 
	`comp_td_pošt_to_pošt_d–ay_·¿Î–
(
š‘
,

2529 
Ãt_pš
,

2530 
loÿl_block
);

2532 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = 
‹mp_d–ay
;

2533 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

2534 
timšg_¶aû_ü™
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

2536 
d–_d–ay_co¡
 +=

2537 (
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]

2538 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]);

2539 
d–_timšg_co¡
 +=

2540 (
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]

2541 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]);

2546 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2547 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2548 
‹mp_d–ay
 = 
	`comp_td_pošt_to_pošt_d–ay_·¿Î–
(
š‘
,

2549 
š
,

2550 
loÿl_block
);

2552 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay
;

2553 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

2554 
timšg_¶aû_ü™
[
š‘
][
š
] * 
‹mp_d–ay
;

2556 
d–_d–ay_co¡
 +=

2557 (
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]

2558 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]);

2559 
d–_timšg_co¡
 +=

2560 (
loÿl_‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
]

2561 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
]);

2567 *
d–_timšg
 = 
d–_timšg_co¡
;

2568 *
d–_d–ay
 = 
d–_d–ay_co¡
;

2569 
	}
}

2574 
	$compu‹_td_co¡s_·¿Î–_w™hout_upd©e_ü™
(* 
timšg_co¡
,

2575 * 
cÚÃùiÚ_d–ay_sum
,

2576 
¡¬t_Ãt
,

2577 
fšish_Ãt
)

2579 
loc_timšg_co¡
 = 0.0;

2580 
loc_cÚÃùiÚ_d–ay_sum
 = 0.0;

2581 
loÿl_wÜk
 = 0;

2583 
š‘
 = 0;

2584 
š‘
 = 
¡¬t_Ãt
; iÃˆ< 
fšish_Ãt
; ++inet) {

2586 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

2588 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2589 
loÿl_wÜk
 +ğ
knum_Ãt_pšs
;

2591 
š
 = 0;

2592 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2593 
‹mp_d–ay_co¡
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2594 
š
);

2595 
‹mp_timšg_co¡
 =

2596 
‹mp_d–ay_co¡
 * 
timšg_¶aû_ü™
[
š‘
][
š
];

2598 
loc_cÚÃùiÚ_d–ay_sum
 +ğ
‹mp_d–ay_co¡
;

2599 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay_co¡
;

2600 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

2602 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = 
‹mp_timšg_co¡
;

2603 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

2604 
loc_timšg_co¡
 +ğ
‹mp_timšg_co¡
;

2609 *
timšg_co¡
 = 
loc_timšg_co¡
;

2610 *
cÚÃùiÚ_d–ay_sum
 = 
loc_cÚÃùiÚ_d–ay_sum
;

2612  
loÿl_wÜk
;

2613 
	}
}

2618 
	$compu‹_td_co¡s_·¿Î–_w™h_upd©e_ü™
(* 
timšg_co¡
,

2619 * 
cÚÃùiÚ_d–ay_sum
,

2620 ** 
Ãt_¦ack
,

2621 
max_d–ay
,

2622 
ü™_expÚ’t
,

2623 
¡¬t_Ãt
,

2624 
fšish_Ãt
)

2626 
loc_timšg_co¡
 = 0.0;

2627 
loc_cÚÃùiÚ_d–ay_sum
 = 0.0;

2628 
loÿl_wÜk
 = 0;

2629 
š‘
 = 0;

2631 
š‘
 = 
¡¬t_Ãt
; iÃˆ< 
fšish_Ãt
; ++inet) {

2632 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

2634 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2635 
loÿl_wÜk
 +ğ
knum_Ãt_pšs
;

2637 
š
 = 0;

2638 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

2639 
pš_ü™
 = 
	`max
(1 - 
Ãt_¦ack
[
š‘
][
š
] / 
max_d–ay
,

2641 
timšg_¶aû_ü™
[
š‘
][
š
] = 
	`pow
(
pš_ü™
,

2642 
ü™_expÚ’t
);

2643 
‹mp_d–ay_co¡
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

2644 
š
);

2645 
‹mp_timšg_co¡
 =

2646 
‹mp_d–ay_co¡
 * 
timšg_¶aû_ü™
[
š‘
][
š
];

2648 
loc_cÚÃùiÚ_d–ay_sum
 +ğ
‹mp_d–ay_co¡
;

2649 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay_co¡
;

2650 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

2652 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = 
‹mp_timšg_co¡
;

2653 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

2654 
loc_timšg_co¡
 +ğ
‹mp_timšg_co¡
;

2659 *
timšg_co¡
 = 
loc_timšg_co¡
;

2660 *
cÚÃùiÚ_d–ay_sum
 = 
loc_cÚÃùiÚ_d–ay_sum
;

2662  
loÿl_wÜk
;

2663 
	}
}

2673 
	$compu‹_bb_co¡_·¿Î–
(cÚ¡ 
k¡¬t_Ãt
,

2674 cÚ¡ 
k’d_Ãt
)

2676 
co¡
 = 0;

2677 
k
 = 0;

2678 
k
 = 
k¡¬t_Ãt
; k < 
k’d_Ãt
; ++k) {

2680 ià(
is_glob®
[
k
] =ğ
FALSE
) {

2684 
	`g‘_nÚ_upd©—bË_bb
(
k
, &
bb_coÜds
[k]);

2686 
Ãt_co¡
[
k
] = 
	`g‘_Ãt_co¡
(k, &
bb_coÜds
[k]);

2687 
co¡
 +ğ
Ãt_co¡
[
k
];

2690  
co¡
;

2691 
	}
}

2697 
	$g‘_bb_äom_sü©ch_·¿Î–
(
š‘
,

2698 
bbox_t
* 
coÜds
,

2699 
bbox_t
* 
num_Ú_edges
,

2700 
loÿl_block_t
* 
loÿl_block
)

2705 
n_pšs
 = -1;

2706 * 
¶i¡
 = 
NULL
;

2707 ià(
du¶iÿ‹_pšs
[
š‘
] == 0) {

2708 
¶i¡
 = 
Ãt
[
š‘
].
node_blocks
;

2710 
n_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2712 
¶i¡
 = 
unique_pš_li¡
[
š‘
];

2714 
n_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
 - 
du¶iÿ‹_pšs
[inet];

2717 
x
 = 
loÿl_block
[
¶i¡
[0]].x;

2718 
y
 = 
loÿl_block
[
¶i¡
[0]].y;

2719 
x
 = 
	`max
(
	`mš
(x, 
num_grid_cŞumns
), 1);

2720 
y
 = 
	`max
(
	`mš
(y, 
num_grid_rows
), 1);

2721 
xmš
 = 
x
;

2722 
xmax
 = 
x
;

2723 
ymš
 = 
y
;

2724 
ymax
 = 
y
;

2726 
xmš_edge
 = 1;

2727 
ymš_edge
 = 1;

2728 
xmax_edge
 = 1;

2729 
ymax_edge
 = 1;

2731 
š
 = -1;

2732 
block_num
 = 0;

2733 
š
 = 1; ipš < 
n_pšs
; ++ipin) {

2734 
block_num
 = 
¶i¡
[
š
];

2735 
x
 = 
loÿl_block
[
block_num
].x;

2736 
y
 = 
loÿl_block
[
block_num
].y;

2745 
x
 = 
	`max
(
	`mš
(x, 
num_grid_cŞumns
), 1);

2746 ià(
x
 =ğ
xmš
) {

2747 ++
xmš_edge
;

2749 ià(
x
 =ğ
xmax
) {

2751 ++
xmax_edge
;

2752 } ià(
x
 < 
xmš
) {

2753 
xmš
 = 
x
;

2754 
xmš_edge
 = 1;

2755 } ià(
x
 > 
xmax
) {

2756 
xmax
 = 
x
;

2757 
xmax_edge
 = 1;

2760 
y
 = 
	`max
(
	`mš
(y, 
num_grid_rows
), 1);

2761 ià(
y
 =ğ
ymš
) {

2762 ++
ymš_edge
;

2764 ià(
y
 =ğ
ymax
) {

2765 ++
ymax_edge
;

2766 } ià(
y
 < 
ymš
) {

2767 
ymš
 = 
y
;

2768 
ymš_edge
 = 1;

2769 } ià(
y
 > 
ymax
) {

2770 
ymax
 = 
y
;

2771 
ymax_edge
 = 1;

2777 
coÜds
->
xmš
 = xmin;

2778 
coÜds
->
xmax
 = xmax;

2779 
coÜds
->
ymš
 = ymin;

2780 
coÜds
->
ymax
 = ymax;

2782 
num_Ú_edges
->
xmš
 = 
xmš_edge
;

2783 
num_Ú_edges
->
xmax
 = 
xmax_edge
;

2784 
num_Ú_edges
->
ymš
 = 
ymš_edge
;

2785 
num_Ú_edges
->
ymax
 = 
ymax_edge
;

2786 
	}
}

2795 
	$g‘_nÚ_upd©—bË_bb_·¿Î–
(
š‘
,

2796 
bbox_t
* 
bb_coÜd_Ãw_±r
,

2797 
loÿl_block_t
* 
loÿl_block_±r
)

2800 
x
 = 
loÿl_block_±r
[
Ãt
[
š‘
].
node_blocks
[0]].x;

2801 
y
 = 
loÿl_block_±r
[
Ãt
[
š‘
].
node_blocks
[0]].y;

2804 
xmš
 = 
x
;

2805 
ymš
 = 
y
;

2806 
xmax
 = 
x
;

2807 
ymax
 = 
y
;

2809 
k
 = 0;

2810 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

2811 
k
 = 1; k < 
knum_Ãt_pšs
; ++k) {

2812 
x
 = 
loÿl_block_±r
[
Ãt
[
š‘
].
node_blocks
[
k
]].x;

2813 
y
 = 
loÿl_block_±r
[
Ãt
[
š‘
].
node_blocks
[
k
]].y;

2815 ià(
x
 < 
xmš
) {

2816 
xmš
 = 
x
;

2817 } ià(
x
 > 
xmax
) {

2818 
xmax
 = 
x
;

2821 ià(
y
 < 
ymš
) {

2822 
ymš
 = 
y
;

2823 } ià(
y
 > 
ymax
) {

2824 
ymax
 = 
y
;

2834 
bb_coÜd_Ãw_±r
->
xmš
 = 
	`max
(
	`mš
(xmš, 
num_grid_cŞumns
), 1);

2835 
bb_coÜd_Ãw_±r
->
ymš
 = 
	`max
(
	`mš
(ymš, 
num_grid_rows
), 1);

2836 
bb_coÜd_Ãw_±r
->
xmax
 = 
	`max
(
	`mš
(xmax, 
num_grid_cŞumns
), 1);

2837 
bb_coÜd_Ãw_±r
->
ymax
 = 
	`max
(
	`mš
(ymax, 
num_grid_rows
), 1);

2838 
	}
}

2851 
	$upd©e_bb_·¿Î–
(
š‘
,

2852 
bbox_t
* 
loÿl_bb_coÜd_±r
,

2853 
bbox_t
* 
loÿl_bb_edge_±r
,

2854 
bbox_t
* 
bb_coÜd_Ãw_±r
,

2855 
bbox_t
* 
bb_edge_Ãw_±r
,

2856 
xŞd
, 
yŞd
,

2857 
xÃw
, 
yÃw
,

2858 
loÿl_block_t
* 
loÿl_block
)

2861 
xÃw
 = 
	`max
(
	`mš
(xÃw, 
num_grid_cŞumns
), 1);

2862 
yÃw
 = 
	`max
(
	`mš
(yÃw, 
num_grid_rows
), 1);

2863 
xŞd
 = 
	`max
(
	`mš
(xŞd, 
num_grid_cŞumns
), 1);

2864 
yŞd
 = 
	`max
(
	`mš
(yŞd, 
num_grid_rows
), 1);

2868 ià(
xÃw
 < 
xŞd
) {

2871 ià(
xŞd
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
xmax
) {

2873 ià(
loÿl_bb_edge_±r
[
š‘
].
xmax
 == 1) {

2874 
	`g‘_bb_äom_sü©ch_·¿Î–
(
š‘
,

2875 
bb_coÜd_Ãw_±r
,

2876 
bb_edge_Ãw_±r
,

2877 
loÿl_block
);

2880 
bb_coÜd_Ãw_±r
->
xmax
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmax;

2881 
bb_edge_Ãw_±r
->
xmax
 = 
loÿl_bb_edge_±r
[
š‘
].xmax - 1;

2885 
bb_coÜd_Ãw_±r
->
xmax
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmax;

2886 
bb_edge_Ãw_±r
->
xmax
 = 
loÿl_bb_edge_±r
[
š‘
].xmax;

2890 ià(
xÃw
 < 
loÿl_bb_coÜd_±r
[
š‘
].
xmš
) {

2892 
bb_coÜd_Ãw_±r
->
xmš
 = 
xÃw
;

2893 
bb_edge_Ãw_±r
->
xmš
 = 1;

2894 } ià(
xÃw
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
xmš
) {

2896 
bb_coÜd_Ãw_±r
->
xmš
 = 
xÃw
;

2897 
bb_edge_Ãw_±r
->
xmš
 = 
loÿl_bb_edge_±r
[
š‘
].xmin + 1;

2900 
bb_coÜd_Ãw_±r
->
xmš
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmin;

2901 
bb_edge_Ãw_±r
->
xmš
 = 
loÿl_bb_edge_±r
[
š‘
].xmin;

2904 } ià(
xÃw
 > 
xŞd
) {

2907 ià(
xŞd
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
xmš
) {

2909 ià(
loÿl_bb_edge_±r
[
š‘
].
xmš
 == 1) {

2910 
	`g‘_bb_äom_sü©ch_·¿Î–
(
š‘
,

2911 
bb_coÜd_Ãw_±r
,

2912 
bb_edge_Ãw_±r
,

2913 
loÿl_block
);

2916 
bb_edge_Ãw_±r
->
xmš
 = 
loÿl_bb_edge_±r
[
š‘
].xmin - 1;

2917 
bb_coÜd_Ãw_±r
->
xmš
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmin;

2921 
bb_coÜd_Ãw_±r
->
xmš
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmin;

2922 
bb_edge_Ãw_±r
->
xmš
 = 
loÿl_bb_edge_±r
[
š‘
].xmin;

2926 ià(
xÃw
 > 
loÿl_bb_coÜd_±r
[
š‘
].
xmax
) {

2928 
bb_coÜd_Ãw_±r
->
xmax
 = 
xÃw
;

2929 
bb_edge_Ãw_±r
->
xmax
 = 1;

2930 } ià(
xÃw
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
xmax
) {

2932 
bb_coÜd_Ãw_±r
->
xmax
 = 
xÃw
;

2933 
bb_edge_Ãw_±r
->
xmax
 = 
loÿl_bb_edge_±r
[
š‘
].xmax + 1;

2936 
bb_coÜd_Ãw_±r
->
xmax
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmax;

2937 
bb_edge_Ãw_±r
->
xmax
 = 
loÿl_bb_edge_±r
[
š‘
].xmax;

2942 
bb_coÜd_Ãw_±r
->
xmš
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmin;

2943 
bb_coÜd_Ãw_±r
->
xmax
 = 
loÿl_bb_coÜd_±r
[
š‘
].xmax;

2944 
bb_edge_Ãw_±r
->
xmš
 = 
loÿl_bb_edge_±r
[
š‘
].xmin;

2945 
bb_edge_Ãw_±r
->
xmax
 = 
loÿl_bb_edge_±r
[
š‘
].xmax;

2949 ià(
yÃw
 < 
yŞd
) {

2952 ià(
yŞd
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
ymax
) {

2954 ià(
loÿl_bb_edge_±r
[
š‘
].
ymax
 == 1) {

2955 
	`g‘_bb_äom_sü©ch_·¿Î–
(
š‘
,

2956 
bb_coÜd_Ãw_±r
,

2957 
bb_edge_Ãw_±r
,

2958 
loÿl_block
);

2961 
bb_edge_Ãw_±r
->
ymax
 = 
loÿl_bb_edge_±r
[
š‘
].ymax - 1;

2962 
bb_coÜd_Ãw_±r
->
ymax
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymax;

2966 
bb_coÜd_Ãw_±r
->
ymax
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymax;

2967 
bb_edge_Ãw_±r
->
ymax
 = 
loÿl_bb_edge_±r
[
š‘
].ymax;

2971 ià(
yÃw
 < 
loÿl_bb_coÜd_±r
[
š‘
].
ymš
) {

2973 
bb_coÜd_Ãw_±r
->
ymš
 = 
yÃw
;

2974 
bb_edge_Ãw_±r
->
ymš
 = 1;

2975 } ià(
yÃw
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
ymš
) {

2977 
bb_coÜd_Ãw_±r
->
ymš
 = 
yÃw
;

2978 
bb_edge_Ãw_±r
->
ymš
 = 
loÿl_bb_edge_±r
[
š‘
].ymin + 1;

2981 
bb_coÜd_Ãw_±r
->
ymš
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymin;

2982 
bb_edge_Ãw_±r
->
ymš
 = 
loÿl_bb_edge_±r
[
š‘
].ymin;

2985 } ià(
yÃw
 > 
yŞd
) {

2988 ià(
yŞd
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
ymš
) {

2990 ià(
loÿl_bb_edge_±r
[
š‘
].
ymš
 == 1) {

2991 
	`g‘_bb_äom_sü©ch_·¿Î–
(
š‘
,

2992 
bb_coÜd_Ãw_±r
,

2993 
bb_edge_Ãw_±r
,

2994 
loÿl_block
);

2997 
bb_edge_Ãw_±r
->
ymš
 = 
loÿl_bb_edge_±r
[
š‘
].ymin - 1;

2998 
bb_coÜd_Ãw_±r
->
ymš
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymin;

3002 
bb_coÜd_Ãw_±r
->
ymš
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymin;

3003 
bb_edge_Ãw_±r
->
ymš
 = 
loÿl_bb_edge_±r
[
š‘
].ymin;

3007 ià(
yÃw
 > 
loÿl_bb_coÜd_±r
[
š‘
].
ymax
) {

3009 
bb_coÜd_Ãw_±r
->
ymax
 = 
yÃw
;

3010 
bb_edge_Ãw_±r
->
ymax
 = 1;

3011 } ià(
yÃw
 =ğ
loÿl_bb_coÜd_±r
[
š‘
].
ymax
) {

3013 
bb_coÜd_Ãw_±r
->
ymax
 = 
yÃw
;

3014 
bb_edge_Ãw_±r
->
ymax
 = 
loÿl_bb_edge_±r
[
š‘
].ymax + 1;

3017 
bb_coÜd_Ãw_±r
->
ymax
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymax;

3018 
bb_edge_Ãw_±r
->
ymax
 = 
loÿl_bb_edge_±r
[
š‘
].ymax;

3023 
bb_coÜd_Ãw_±r
->
ymš
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymin;

3024 
bb_coÜd_Ãw_±r
->
ymax
 = 
loÿl_bb_coÜd_±r
[
š‘
].ymax;

3025 
bb_edge_Ãw_±r
->
ymš
 = 
loÿl_bb_edge_±r
[
š‘
].ymin;

3026 
bb_edge_Ãw_±r
->
ymax
 = 
loÿl_bb_edge_±r
[
š‘
].ymax;

3028 
	}
}

3032 
	$Œy_sw­_·¿Î–
(cÚ¡ 
kt
,

3033 cÚ¡ 
kth»ad_id
,

3034 cÚ¡ 
kx_äom
,

3035 cÚ¡ 
ky_äom
,

3036 cÚ¡ 
kz_äom
,

3037 cÚ¡ 
krow
,

3038 cÚ¡ 
kcŞ
,

3039 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
,

3040 
th»ad_loÿl_d©a_fÜ_sw­_t
* 
sw­_d©a_±r
)

3045 cÚ¡ 
k¿nge_lim™
 = 
commÚ_·¿s_±r
->
loÿl_¿nge_lim™
;

3047 
lim™
 = 
	`mš
(10, ()
k¿nge_lim™
);

3049 cÚ¡ * 
k»giÚ_x_bound¬y
 = 
commÚ_·¿s_±r
->
loÿl_»giÚ_x_bound¬y
;

3050 cÚ¡ * 
k»giÚ_y_bound¬y
 = 
commÚ_·¿s_±r
->
loÿl_»giÚ_y_bound¬y
;

3052 
x_mš
 = 
	`max
(
k»giÚ_x_bound¬y
[
krow
] - 2, 0);

3053 
x_max
 = 
	`mš
(
k»giÚ_x_bound¬y
[
krow
 + 1] + 1,

3054 
num_grid_cŞumns
 + 1);

3055 
y_mš
 = 
	`max
(
k»giÚ_y_bound¬y
[
kcŞ
] - 2, 0);

3056 
y_max
 = 
	`mš
(
k»giÚ_y_bound¬y
[
kcŞ
 + 1] + 1,

3057 
num_grid_rows
 + 1);

3059 
x_mš
 = 
	`max
(x_mš, 
kx_äom
 - 
lim™
);

3060 
x_max
 = 
	`mš
(x_max, 
kx_äom
 + 
lim™
);

3061 
y_mš
 = 
	`max
(y_mš, 
ky_äom
 - 
lim™
);

3062 
y_max
 = 
	`mš
(y_max, 
ky_äom
 + 
lim™
);

3065 
grid_te_t
** 
loÿl_grid
 = 
sw­_d©a_±r
->
m_loÿl_grid
;

3066 cÚ¡ 
käom_block
 = 
loÿl_grid
[
kx_äom
][
ky_äom
].
š_blocks
[
kz_äom
];

3071 cÚ¡ 
block_ty³s_t
 
käom_block_ty³
 = 
blocks
[
käom_block
].
block_ty³
;

3072 
x_to
 = 0;

3073 
y_to
 = 0;

3076 
	`fšd_to_block_·¿Î–
(
kx_äom
,

3077 
ky_äom
,

3078 
käom_block_ty³
,

3079 &
x_to
,

3080 &
y_to
,

3081 
kth»ad_id
,

3082 
x_mš
,

3083 
x_max
,

3084 
y_mš
,

3085 
y_max
);

3087 
	`as£¹
(
loÿl_grid
[
kx_äom
][
ky_äom
].
grid_ty³
 ==

3088 
loÿl_grid
[
x_to
][
y_to
].
grid_ty³
);

3091 
z_to
 = 0;

3092 
to_grid_ÿ·c™y
 = 
loÿl_grid
[
x_to
][
y_to
].
m_ÿ·c™y
;

3093 ià(
to_grid_ÿ·c™y
 > 1) {

3094 
to_grid_ÿ·c™y
 -= 1;

3095 
z_to
 = 
	`my_œªd_·¿Î–
(
to_grid_ÿ·c™y
,

3096 
kth»ad_id
);

3101 
loÿl_block_t
* 
loÿl_block
 = 
sw­_d©a_±r
->
m_loÿl_block
;

3102 
to_block
 = 
EMPTY
;

3103 ià(
loÿl_grid
[
x_to
][
y_to
].
š_blocks
[
z_to
] =ğ
EMPTY
) {

3105 
to_block
 = 
EMPTY
;

3106 
loÿl_block
[
käom_block
].
x
 = 
x_to
;

3107 
loÿl_block
[
käom_block
].
y
 = 
y_to
;

3108 
loÿl_block
[
käom_block
].
z
 = 
z_to
;

3111 
to_block
 = 
loÿl_grid
[
x_to
][
y_to
].
š_blocks
[
z_to
];

3112 
loÿl_block
[
to_block
].
x
 = 
kx_äom
;

3113 
loÿl_block
[
to_block
].
y
 = 
ky_äom
;

3114 
loÿl_block
[
to_block
].
z
 = 
kz_äom
;

3116 
loÿl_block
[
käom_block
].
x
 = 
x_to
;

3117 
loÿl_block
[
käom_block
].
y
 = 
y_to
;

3118 
loÿl_block
[
käom_block
].
z
 = 
z_to
;

3123 
bb_d–_c
 = 0.0;

3124 
num_block_pšs
 = 
g_pšs_Ú_block
[
käom_block_ty³
];

3127 * 
Ãts_to_upd©e
 = 
sw­_d©a_±r
->
m_Ãts_to_upd©e
;

3128 * 
Ãt_block_moved
 = 
sw­_d©a_±r
->
m_Ãt_block_moved
;

3129 * 
loÿl_‹mp_Ãt_co¡
 = 
sw­_d©a_±r
->
m_loÿl_‹mp_Ãt_co¡
;

3130 cÚ¡ 
knum_Ãts_afãùed
 = 
	`fšd_afãùed_Ãts_·¿Î–
(
Ãts_to_upd©e
,

3131 
Ãt_block_moved
,

3132 
käom_block
,

3133 
to_block
,

3134 
num_block_pšs
,

3135 
loÿl_‹mp_Ãt_co¡
);

3137 
bbox_t
* 
bb_coÜd_Ãw
 = 
sw­_d©a_±r
->
m_bb_coÜd_Ãw
;

3138 
bbox_t
* 
bb_edge_Ãw
 = 
sw­_d©a_±r
->
m_bb_edge_Ãw
;

3140 
bbox_t
* 
loÿl_bb_coÜd
 = 
sw­_d©a_±r
->
m_loÿl_bb_coÜd
;

3141 
bbox_t
* 
loÿl_bb_edge
 = 
sw­_d©a_±r
->
m_loÿl_bb_edge
;

3143 * 
loÿl_Ãt_co¡
 = 
sw­_d©a_±r
->
m_loÿl_Ãt_co¡
;

3144 cÚ¡ 
¶aû_cÚg_ty³s_t
 
k¶aû_co¡_ty³
 =

3145 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
¶aû_co¡_ty³
;

3147 
bb_šdex
 = 0;

3148 
k
 = -1;

3149 
k
 = 0; k < 
knum_Ãts_afãùed
; ++k) {

3150 
š‘
 = 
Ãts_to_upd©e
[
k
];

3151 ià(
Ãt_block_moved
[
k
] =ğ
FROM_AND_TO
) {

3156 ià(
Ãt
[
š‘
].
num_Ãt_pšs
 < 
SMALL_NET
) {

3157 
	`g‘_nÚ_upd©—bË_bb_·¿Î–
(
š‘
,

3158 &
bb_coÜd_Ãw
[
bb_šdex
],

3159 
loÿl_block
);

3161 ià(
Ãt_block_moved
[
k
] =ğ
FROM
) {

3164 
	`upd©e_bb_·¿Î–
(
š‘
,

3165 
loÿl_bb_coÜd
,

3166 
loÿl_bb_edge
,

3167 &
bb_coÜd_Ãw
[
bb_šdex
],

3168 &
bb_edge_Ãw
[
bb_šdex
],

3169 
kx_äom
, 
ky_äom
,

3170 
x_to
, 
y_to
,

3171 
loÿl_block
);

3173 
	`upd©e_bb_·¿Î–
(
š‘
,

3174 
loÿl_bb_coÜd
,

3175 
loÿl_bb_edge
,

3176 &
bb_coÜd_Ãw
[
bb_šdex
],

3177 &
bb_edge_Ãw
[
bb_šdex
],

3178 
x_to
, 
y_to
,

3179 
kx_äom
, 
ky_äom
,

3180 
loÿl_block
);

3184 ià(
k¶aû_co¡_ty³
 !ğ
NONLINEAR_CONG
) {

3185 
loÿl_‹mp_Ãt_co¡
[
š‘
] =

3186 
	`g‘_Ãt_co¡
(
š‘
, &
bb_coÜd_Ãw
[
bb_šdex
]);

3187 
bb_d–_c
 +ğ(
loÿl_‹mp_Ãt_co¡
[
š‘
] - 
loÿl_Ãt_co¡
[inet]);

3189 
	`´štf
("can't do‚onlinear_cong\n");

3190 
	`ex™
(-1);

3193 ++
bb_šdex
;

3197 
timšg_d–_c
 = 0.0;

3198 
d–ay_d–_c
 = 0.0;

3199 
d–_c
 = 0.0;

3200 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®gÜ™hm
 =

3201 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
¶aû_®gÜ™hm
;

3202 cÚ¡ 
ktimšg_Œadeoff
 =

3203 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
timšg_Œadeoff
;

3204 cÚ¡ 
kšv”£_´ev_bb_co¡
 =

3205 
commÚ_·¿s_±r
->
loÿl_šv”£_´ev_bb_co¡
;

3206 cÚ¡ 
kšv”£_´ev_timšg_co¡
 =

3207 
commÚ_·¿s_±r
->
loÿl_šv”£_´ev_timšg_co¡
;

3208 ** 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
 =

3209 
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
;

3210 ** 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
 =

3211 
sw­_d©a_±r
->
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
;

3212 ià(
k¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

3213 
k¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

3216 
	`compu‹_d–_td_co¡_·¿Î–
(
käom_block
,

3217 
to_block
,

3218 
num_block_pšs
,

3219 &
timšg_d–_c
,

3220 &
d–ay_d–_c
,

3221 
loÿl_block
,

3222 
loÿl_‹mp_pošt_to_pošt_timšg_co¡
,

3223 
loÿl_‹mp_pošt_to_pošt_d–ay_co¡
);

3225 cÚ¡ 
knÜm®_bb_co¡
 = 
bb_d–_c
 * 
kšv”£_´ev_bb_co¡
;

3226 cÚ¡ 
knÜm®_timšg_co¡
 = 
timšg_d–_c
 * 
kšv”£_´ev_timšg_co¡
;

3227 
d–_c
 = (1 - 
ktimšg_Œadeoff
è* 
knÜm®_bb_co¡
 +

3228 
ktimšg_Œadeoff
 * 
knÜm®_timšg_co¡
;

3230 
d–_c
 = 
bb_d–_c
;

3235 
k“p_sw™ch
 = 
	`as£ss_sw­_·¿Î–
(
d–_c
,

3236 
kt
,

3237 
kth»ad_id
);

3238 ià(
k“p_sw™ch
) {

3240 
commÚ_·¿s_±r
->
loÿl_tÙ®_co¡
 +ğ
d–_c
;

3241 
commÚ_·¿s_±r
->
loÿl_bb_co¡
 +ğ
bb_d–_c
;

3242 ià(
k¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


3243 || 
k¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

3244 
commÚ_·¿s_±r
->
loÿl_timšg_co¡
 +ğ
timšg_d–_c
;

3245 
commÚ_·¿s_±r
->
loÿl_d–ay_co¡
 +ğ
d–ay_d–_c
;

3249 
bb_šdex
 = 0;

3250 
k
 = 0; k < 
knum_Ãts_afãùed
; ++k) {

3251 
š‘
 = 
Ãts_to_upd©e
[
k
];

3252 ià(
Ãt_block_moved
[
k
] =ğ
FROM_AND_TO
) {

3253 
loÿl_‹mp_Ãt_co¡
[
š‘
] = -1;

3257 
loÿl_bb_coÜd
[
š‘
] = 
bb_coÜd_Ãw
[
bb_šdex
];

3258 ià(
Ãt
[
š‘
].
num_Ãt_pšs
 >ğ
SMALL_NET
) {

3259 
loÿl_bb_edge
[
š‘
] = 
bb_edge_Ãw
[
bb_šdex
];

3261 ++
bb_šdex
;

3263 
loÿl_Ãt_co¡
[
š‘
] = 
loÿl_‹mp_Ãt_co¡
[inet];

3264 
loÿl_‹mp_Ãt_co¡
[
š‘
] = -1;

3267 
loÿl_grid
[
x_to
][
y_to
].
š_blocks
[
z_to
] = 
käom_block
;

3268 
loÿl_grid
[
kx_äom
][
ky_äom
].
š_blocks
[
kz_äom
] = 
to_block
;

3270 ià(
EMPTY
 =ğ
to_block
) {

3271 ++(
loÿl_grid
[
x_to
][
y_to
].
m_u§ge
);

3272 --(
loÿl_grid
[
kx_äom
][
ky_äom
].
m_u§ge
);

3275 
k
 = 0; k < 
knum_Ãts_afãùed
; ++k) {

3276 
š‘
 = 
Ãts_to_upd©e
[
k
];

3277 
loÿl_‹mp_Ãt_co¡
[
š‘
] = -1;

3280 
loÿl_block
[
käom_block
].
x
 = 
kx_äom
;

3281 
loÿl_block
[
käom_block
].
y
 = 
ky_äom
;

3282 
loÿl_block
[
käom_block
].
z
 = 
kz_äom
;

3284 ià(
to_block
 !ğ
EMPTY
) {

3285 
loÿl_block
[
to_block
].
x
 = 
x_to
;

3286 
loÿl_block
[
to_block
].
y
 = 
y_to
;

3287 
loÿl_block
[
to_block
].
z
 = 
z_to
;

3291  
k“p_sw™ch
;

3292 
	}
}

3295 
	$upd©e_äom_loÿl_to_glob®
(
loÿl_block_t
* 
loÿl_block
,

3296 
grid_te_t
** 
loÿl_grid
,

3297 
x_¡¬t
, 
x_’d
,

3298 
y_¡¬t
, 
y_’d
)

3300 
x
, 
y
, 
z
, 
block_moved
;

3301 
x
 = 
x_¡¬t
; x < 
x_’d
; ++x) {

3302 
y
 = 
y_¡¬t
; y < 
y_’d
; ++y) {

3303 ià(
loÿl_grid
[
x
][
y
].
grid_ty³
 !ğ
EMPTY_TYPE
) {

3304 ià(
y_’d
 - 
y
 < 5 || y - 
y_¡¬t
 < 5) {

3305 
loÿlv”t_grid
[
y
][
x
].
m_u§ge
 = 
loÿl_grid
[x][y].m_usage;

3308 
bš_grids
[
x
][
y
].
m_u§ge
 = 
loÿl_grid
[x][y].m_usage;

3309 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
x
][
y
].
m_ÿ·c™y
;

3310 
z
 = 0; z < 
kbš_ÿ·c™y
; ++z) {

3311 ià(
loÿl_grid
[
x
][
y
].
š_blocks
[
z
] !=

3312 
bš_grids
[
x
][
y
].
š_blocks
[
z
]) {

3314 
block_moved
 = 
loÿl_grid
[
x
][
y
].
š_blocks
[
z
];

3316 ià(
y_’d
 - 
y
 < 5 || y - 
y_¡¬t
 < 5) {

3317 
loÿlv”t_grid
[
y
][
x
].
š_blocks
[
z
] = 
block_moved
;

3320 
bš_grids
[
x
][
y
].
š_blocks
[
z
] = 
block_moved
;

3323 ià(
block_moved
 == -1) {

3327 
blocks
[
block_moved
].
x
 = 
loÿl_block
[block_moved].x;

3328 
blocks
[
block_moved
].
y
 = 
loÿl_block
[block_moved].y;

3329 
blocks
[
block_moved
].
z
 = 
loÿl_block
[block_moved].z;

3335 
	}
}

3337 
	$upd©e_äom_glob®_to_loÿl_hÜi
(
loÿl_block_t
* 
loÿl_block
,

3338 
grid_te_t
** 
loÿl_grid
,

3339 
x_¡¬t
, 
x_’d
,

3340 
y_¡¬t
, 
y_’d
)

3342 
x
, 
y
, 
z
, 
block_moved
;

3343 
x
 = 
x_¡¬t
; x < 
x_’d
; ++x) {

3344 
y
 = 
y_¡¬t
; y < 
y_’d
; ++y) {

3345 ià(
bš_grids
[
x
][
y
].
grid_ty³
 !ğ
EMPTY_TYPE
) {

3346 
loÿl_grid
[
x
][
y
].
m_u§ge
 = 
bš_grids
[x][y].m_usage;

3348 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
x
][
y
].
m_ÿ·c™y
;

3349 
z
 = 0; z < 
kbš_ÿ·c™y
; ++z) {

3350 ià(
bš_grids
[
x
][
y
].
š_blocks
[
z
] !ğ
loÿl_grid
[x][y].in_blocks[z]) {

3352 
block_moved
 = 
bš_grids
[
x
][
y
].
š_blocks
[
z
];

3353 
loÿl_grid
[
x
][
y
].
š_blocks
[
z
] = 
block_moved
;

3355 ià(
block_moved
 == -1) {

3359 
loÿl_block
[
block_moved
].
x
 = 
blocks
[block_moved].x;

3360 
loÿl_block
[
block_moved
].
y
 = 
blocks
[block_moved].y;

3361 
loÿl_block
[
block_moved
].
z
 = 
blocks
[block_moved].z;

3367 
	}
}

3369 
	$upd©e_äom_glob®_to_loÿl_v”t
(
loÿl_block_t
* 
loÿl_block
,

3370 
grid_te_t
** 
loÿl_grid
,

3371 
x_¡¬t
, 
x_’d
,

3372 
y_¡¬t
, 
y_’d
)

3374 
x
, 
y
, 
z
, 
block_moved
;

3375 
y
 = 
y_¡¬t
; y < 
y_’d
; ++y) {

3376 
x
 = 
x_¡¬t
; x < 
x_’d
; ++x) {

3377 ià(
loÿlv”t_grid
[
y
][
x
].
grid_ty³
 !ğ
EMPTY_TYPE
) {

3378 
loÿl_grid
[
x
][
y
].
m_u§ge
 = 
loÿlv”t_grid
[y][x].m_usage;

3380 cÚ¡ 
kbš_ÿ·c™y
 = 
loÿlv”t_grid
[
y
][
x
].
m_ÿ·c™y
;

3381 
z
 = 0; z < 
kbš_ÿ·c™y
; ++z) {

3382 ià(
loÿlv”t_grid
[
y
][
x
].
š_blocks
[
z
] !=

3383 
loÿl_grid
[
x
][
y
].
š_blocks
[
z
]) {

3385 
block_moved
 = 
loÿlv”t_grid
[
y
][
x
].
š_blocks
[
z
];

3386 
loÿl_grid
[
x
][
y
].
š_blocks
[
z
] = 
block_moved
;

3388 ià(
block_moved
 == -1) {

3392 
loÿl_block
[
block_moved
].
x
 = 
blocks
[block_moved].x;

3393 
loÿl_block
[
block_moved
].
y
 = 
blocks
[block_moved].y;

3394 
loÿl_block
[
block_moved
].
z
 = 
blocks
[block_moved].z;

3400 
	}
}

3402 
	$upd©e_äom_glob®_to_loÿl_grid_Úly
(
grid_te_t
** 
loÿl_grid
,

3403 cÚ¡ 
x_¡¬t
,

3404 cÚ¡ 
x_’d
,

3405 cÚ¡ 
y_¡¬t
,

3406 cÚ¡ 
y_’d
)

3408 
x
, 
y
, 
z
;

3409 
x
 = 
x_¡¬t
; x < 
x_’d
; ++x) {

3410 
y
 = 
y_¡¬t
; y < 
y_’d
; ++y) {

3411 ià(
bš_grids
[
x
][
y
].
grid_ty³
 !ğ
EMPTY_TYPE
) {

3412 
loÿl_grid
[
x
][
y
].
m_u§ge
 = 
bš_grids
[x][y].m_usage;

3414 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
x
][
y
].
m_ÿ·c™y
;

3415 
z
 = 0; z < 
kbš_ÿ·c™y
; ++z) {

3416 ià(
bš_grids
[
x
][
y
].
š_blocks
[
z
] !ğ
loÿl_grid
[x][y].in_blocks[z]) {

3418 
loÿl_grid
[
x
][
y
].
š_blocks
[
z
] = 
bš_grids
[x][y].in_blocks[z];

3424 
	}
}

3426 
	$my_difáime2
(
timev®
* 
¡¬t
,

3427 
timev®
* 
’d
)

3429 
u£c
 = 
’d
->
tv_u£c
 - 
¡¬t
->tv_usec;

3430 
£c
 = 
’d
->
tv_£c
 - 
¡¬t
->tv_sec;

3431 ià(
u£c
 < 0) {

3432 
£c
--;

3433 
u£c
 += 1000000;

3436 
»t
 = ()
£c
;

3437 
»t
 +ğ()
u£c
 / 1000000;

3439  
»t
;

3440 
	}
}

3443 
	$upd©e_ªd_´št_commÚ_·¿s
(cÚ¡ 
kth»ad_id
,

3444 * 
move_couÁ”_±r
,

3445 * 
šÃr_™”_num_±r
,

3446 
±h»ad_d©a_t
* 
šput_¬gs
,

3447 
th»ad_loÿl_commÚ_·¿s_t
* 
commÚ_·¿s_±r
)

3449 ià(
kth»ad_id
 == 0) {

3450 
commÚ_·¿s_±r
->
loÿl_sucûss_sum
 = *(
šput_¬gs
->
sucûss_sum
);

3451 
commÚ_·¿s_±r
->
loÿl_sum_of_squ¬es
 = *(
šput_¬gs
->
sum_of_squ¬es
);

3452 *
move_couÁ”_±r
 = *(
šput_¬gs
->
move_lim
);

3454 
commÚ_·¿s_±r
->
loÿl_tÙ®_™”
 = *(
šput_¬gs
->
tÙ_™”
);

3455 
commÚ_·¿s_±r
->
loÿl_tÙ®_™”
 +ğ*
move_couÁ”_±r
;

3457 cÚ¡ 
ksucûss_sum
 = 
commÚ_·¿s_±r
->
loÿl_sucûss_sum
;

3458 
commÚ_·¿s_±r
->
loÿl_sucûss_¿tio
 =

3459 (()
ksucûss_sum
è/ *
move_couÁ”_±r
;

3461 
commÚ_·¿s_±r
->
loÿl_av_co¡
 = *(
šput_¬gs
->
av_co¡
);

3462 
commÚ_·¿s_±r
->
loÿl_av_bb_co¡
 = *(
šput_¬gs
->
av_bb_co¡
);

3463 
commÚ_·¿s_±r
->
loÿl_av_timšg_co¡
 = *(
šput_¬gs
->
av_timšg_co¡
);

3464 
commÚ_·¿s_±r
->
loÿl_av_d–ay_co¡
 = *(
šput_¬gs
->
av_d–ay_co¡
);

3468 ià(
ksucûss_sum
 == 0) {

3469 
commÚ_·¿s_±r
->
loÿl_av_co¡
 = commÚ_·¿s_±r->
loÿl_tÙ®_co¡
;

3470 
commÚ_·¿s_±r
->
loÿl_av_bb_co¡
 = commÚ_·¿s_±r->
loÿl_bb_co¡
;

3471 
commÚ_·¿s_±r
->
loÿl_av_timšg_co¡
 = commÚ_·¿s_±r->
loÿl_timšg_co¡
;

3472 
commÚ_·¿s_±r
->
loÿl_av_d–ay_co¡
 = commÚ_·¿s_±r->
loÿl_d–ay_co¡
;

3474 
commÚ_·¿s_±r
->
loÿl_av_co¡
 /ğ
ksucûss_sum
;

3475 
commÚ_·¿s_±r
->
loÿl_av_bb_co¡
 /ğ
ksucûss_sum
;

3476 
commÚ_·¿s_±r
->
loÿl_av_timšg_co¡
 /ğ
ksucûss_sum
;

3477 
commÚ_·¿s_±r
->
loÿl_av_d–ay_co¡
 /ğ
ksucûss_sum
;

3480 cÚ¡ 
ksum_of_squ¬es
 = 
commÚ_·¿s_±r
->
loÿl_sum_of_squ¬es
;

3481 cÚ¡ 
kav_co¡
 = 
commÚ_·¿s_±r
->
loÿl_av_co¡
;

3482 
commÚ_·¿s_±r
->
loÿl_¡d_dev
 = 
	`g‘_¡d_dev
(
ksucûss_sum
,

3483 
ksum_of_squ¬es
,

3484 
kav_co¡
);

3485 cÚ¡ 
ksucûss_¿tio
 = 
commÚ_·¿s_±r
->
loÿl_sucûss_¿tio
;

3486 
	`upd©e_¾im
(&(
commÚ_·¿s_±r
->
loÿl_¿nge_lim™
),

3487 
ksucûss_¿tio
);

3489 cÚ¡ 
¶aû_®gÜ™hm_t
 
k¶aû_®gÜ™hm
 =

3490 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
¶aû_®gÜ™hm
;

3491 cÚ¡ 
k¿nge_lim™
 = 
commÚ_·¿s_±r
->
loÿl_¿nge_lim™
;

3492 cÚ¡ 
kfš®_¾im
 = 
commÚ_·¿s_±r
->
loÿl_fš®_¾im
;

3493 cÚ¡ 
kšv”£_d–_¾im
 = 
commÚ_·¿s_±r
->
loÿl_šv”£_d–_¾im
;

3494 cÚ¡ 
ktd_¶aû_exp_Ï¡
 =

3495 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
td_¶aû_exp_Ï¡
;

3496 cÚ¡ 
ktd_¶aû_exp_fœ¡
 =

3497 
commÚ_·¿s_±r
->
loÿl_¶aûr_İts
.
td_¶aû_exp_fœ¡
;

3498 ià(
k¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE


3499 || 
k¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

3500 
commÚ_·¿s_±r
->
loÿl_ü™_expÚ’t
 =

3501 (1 - (
k¿nge_lim™
 - 
kfš®_¾im
è* 
kšv”£_d–_¾im
)

3502 * (
ktd_¶aû_exp_Ï¡
 - 
ktd_¶aû_exp_fœ¡
)

3503 + 
ktd_¶aû_exp_fœ¡
;

3506 ià(
commÚ_·¿s_±r
->
loÿl_‹m³r
 != 0) {

3508 
commÚ_·¿s_±r
->
loÿl_Şd_‹m³r
 = commÚ_·¿s_±r->
loÿl_‹m³r
;

3510 
	`upd©e_t_·¿Î–
(&(
commÚ_·¿s_±r
->
loÿl_‹m³r
),

3511 
šÃr_™”_num_±r
,

3513 
ksucûss_¿tio
,

3514 
šput_¬gs
->
ªÃ®šg_sched
);

3517 cÚ¡ 
kŞd_t
 = 
commÚ_·¿s_±r
->
loÿl_Şd_‹m³r
;

3518 cÚ¡ 
kav_bb_co¡
 = 
commÚ_·¿s_±r
->
loÿl_av_bb_co¡
;

3519 cÚ¡ 
kav_timšg_co¡
 = 
commÚ_·¿s_±r
->
loÿl_av_timšg_co¡
;

3520 cÚ¡ 
kav_d–ay_co¡
 = 
commÚ_·¿s_±r
->
loÿl_av_d–ay_co¡
;

3521 cÚ¡ 
k¡d_dev
 = 
commÚ_·¿s_±r
->
loÿl_¡d_dev
;

3522 cÚ¡ 
kü™_expÚ’t
 = 
commÚ_·¿s_±r
->
loÿl_ü™_expÚ’t
;

3523 cÚ¡ 
ktÙ®_™”
 = 
commÚ_·¿s_±r
->
loÿl_tÙ®_™”
;

3524 #iâdeà
SPEC


3525 
	`´štf
("%d %11.5g %10.6g %11.6g %11.6g %11.6g %11.6g %11.4g %9.4g %8.3g %7.4g %7.4g %10d \n",

3526 
kth»ad_id
,

3527 
kŞd_t
,

3528 
kav_co¡
,

3529 
kav_bb_co¡
,

3530 
kav_timšg_co¡
,

3531 
kav_d–ay_co¡
,

3532 
commÚ_·¿s_±r
->
loÿl_¶aû_d–ay_v®ue
,

3533 
commÚ_·¿s_±r
->
loÿl_max_d–ay
,

3534 
ksucûss_¿tio
,

3535 
k¡d_dev
,

3536 
k¿nge_lim™
,

3537 
kü™_expÚ’t
,

3538 
ktÙ®_™”
);

3541 
msg
[
BUFSIZE
];

3542 cÚ¡ 
kt
 = 
commÚ_·¿s_±r
->
loÿl_‹m³r
;

3543 
	`¥rštf
(
msg
,

3545 
commÚ_·¿s_±r
->
loÿl_tÙ®_co¡
,

3546 
commÚ_·¿s_±r
->
loÿl_bb_co¡
,

3547 
commÚ_·¿s_±r
->
loÿl_timšg_co¡
,

3548 
kt
,

3549 
commÚ_·¿s_±r
->
loÿl_max_d–ay
);

3551 
	`upd©e_sü“n
(
MINOR
,

3552 
msg
,

3553 
PLACEMENT
,

3554 
FALSE
);

3556 ià(
kt
 != 0.0) {

3557 *(
šput_¬gs
->
šÃr_™”_num
èğ*
šÃr_™”_num_±r
;

3558 *(
šput_¬gs
->
ex™
èğ
	`ex™_ü™
(
kt
,

3559 
kav_co¡
,

3560 
šput_¬gs
->
ªÃ®šg_sched
);

3561 *(
šput_¬gs
->
t
èğ
kt
;

3562 ià(*(
šput_¬gs
->
ex™
) == 0) {

3563 *(
šput_¬gs
->
t
èğ
kt
;

3565 *(
šput_¬gs
->
t
) = 0.0;

3568 *(
šput_¬gs
->
av_co¡
èğ
kav_co¡
;

3569 *(
šput_¬gs
->
av_bb_co¡
èğ
kav_bb_co¡
;

3570 *(
šput_¬gs
->
av_timšg_co¡
èğ
kav_timšg_co¡
;

3571 *(
šput_¬gs
->
av_d–ay_co¡
èğ
kav_d–ay_co¡
;

3572 *(
šput_¬gs
->
¡d_dev
èğ
k¡d_dev
;

3573 *(
šput_¬gs
->
¿nge_lim™
 ) = 
k¿nge_lim™
;

3574 *(
šput_¬gs
->
ü™_expÚ’t
èğ
kü™_expÚ’t
;

3575 *(
šput_¬gs
->
sucûss_¿t
èğ
ksucûss_¿tio
;

3576 *(
šput_¬gs
->
tÙ_™”
èğ
ktÙ®_™”
;

3579 #ifdeà
VERBOSE


3580 
	`dump_şbs
();

3583 
	}
}

3589 
	$couÁ_cÚÃùiÚs
()

3592 
couÁ
 = 0;

3593 
š‘
 = -1;

3594 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

3595 ià(
is_glob®
[
š‘
] =ğ
TRUE
) {

3598 
couÁ
 +ğ(
Ãt
[
š‘
].
num_Ãt_pšs
 - 1);

3601  
couÁ
;

3602 
	}
}

3607 
	$compu‹_Ãt_pš_šdex_v®ues
()

3610 
iblk
 = -1;

3611 
š
 = 0;

3612 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

3613 
š
 = 0; ipš < 
max_pšs_³r_şb
; ++ipin) {

3614 
Ãt_pš_šdex
[
iblk
][
š
] = 
OPEN
;

3618 
š‘
 = -1;

3619 
Ãš
 = -1;

3620 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

3621 ià(
is_glob®
[
š‘
] =ğ
TRUE
) {

3625 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

3626 
Ãš
 = 0;‚‘pš < 
knum_Ãt_pšs
; ++netpin) {

3627 cÚ¡ 
blk_šdex
 = 
Ãt
[
š‘
].
node_blocks
[
Ãš
];

3630 ià(
blocks
[
blk_šdex
].
block_ty³
 =ğ
INPAD_TYPE
) {

3631 
Ãt_pš_šdex
[
blk_šdex
][0] = 0;

3632 } ià(
blocks
[
blk_šdex
].
block_ty³
 =ğ
OUTPAD_TYPE
) {

3634 
Ãt_pš_šdex
[
blk_šdex
][0] = 
Ãš
;

3636 
Ãt_pš_šdex
[
blk_šdex
][
Ãt
[
š‘
].
node_block_pšs
[
Ãš
]] =‚etpin;

3640 
	}
}

3646 
	$g‘_¡d_dev
(
n
,

3647 
sum_x_squ¬ed
,

3648 
av_x
)

3650 
¡d_dev
 = 0.0;

3651 ià(
n
 <= 1) {

3652 
¡d_dev
 = 0.0;

3654 
¡d_dev
 = (
sum_x_squ¬ed
 - 
n
 * 
av_x
 *‡v_x) / ()(n - 1);

3657 ià(
¡d_dev
 > 0.) {

3658 
¡d_dev
 = 
	`sq¹
(std_dev);

3660 
¡d_dev
 = 0.;

3663  (
¡d_dev
);

3664 
	}
}

3668 
	$upd©e_¾im
(* 
¿nge_lim™
,

3669 
sucûss_¿t
)

3671 *
¿nge_lim™
 = (*¿nge_lim™è* (1.0 - 0.6 + 
sucûss_¿t
);

3672 
uµ”_lim
 = 
	`max
(
num_grid_cŞumns
, 
num_grid_rows
);

3673 *
¿nge_lim™
 = 
	`mš
(*¿nge_lim™, 
uµ”_lim
);

3674 *
¿nge_lim™
 = 
	`max
(*range_limit, 1.0);

3675 
	}
}

3679 
	$ex™_ü™
(
t
,

3680 
co¡
,

3681 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
)

3683 ià(
ªÃ®šg_sched
.
ty³
 =ğ
USER_SCHED
) {

3684 ià(
t
 < 
ªÃ®šg_sched
.
ex™_t
) {

3692 ià(
t
 < 0.005 * 
co¡
 / 
num_Ãts
) {

3697 
	}
}

3700 
	$¡¬tšg_t
(* 
co¡_±r
,

3701 * 
bb_co¡_±r
,

3702 * 
timšg_co¡_±r
,

3703 cÚ¡ 
¶aû_co¡_ty³
,

3704 ** 
Şd_»giÚ_occ_x
,

3705 ** 
Şd_»giÚ_occ_y
,

3706 cÚ¡ 
num_»giÚs
,

3707 cÚ¡ 
boŞ—n
 
fixed_pšs
,

3708 cÚ¡ 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

3709 cÚ¡ 
max_moves
,

3710 cÚ¡ 
¿nge_lim™
,

3711 cÚ¡ 
¶aû_®gÜ™hm_t
 
¶aû_®gÜ™hm
,

3712 cÚ¡ 
timšg_Œadeoff
,

3713 cÚ¡ 
šv”£_´ev_bb_co¡
,

3714 cÚ¡ 
šv”£_´ev_timšg_co¡
,

3715 * 
d–ay_co¡_±r
)

3718 ià(
ªÃ®šg_sched
.
ty³
 =ğ
USER_SCHED
) {

3719  (
ªÃ®šg_sched
.
š™_t
);

3722 
move_lim
 = 
	`mš
(
max_moves
, 
num_blocks
);

3723 
num_acû±ed
 = 0;

3724 
av
 = 0.;

3725 
sum_of_squ¬es
 = 0.;

3728 
i
;

3729 
i
 = 0; i < 
move_lim
; ++i) {

3730 ià(
	`Œy_sw­
(1.e30,

3731 
co¡_±r
,

3732 
bb_co¡_±r
,

3733 
timšg_co¡_±r
,

3734 
¿nge_lim™
,

3735 
¶aû_co¡_ty³
,

3736 
Şd_»giÚ_occ_x
,

3737 
Şd_»giÚ_occ_y
,

3738 
num_»giÚs
,

3739 
fixed_pšs
,

3740 
¶aû_®gÜ™hm
,

3741 
timšg_Œadeoff
,

3742 
šv”£_´ev_bb_co¡
,

3743 
šv”£_´ev_timšg_co¡
,

3744 
d–ay_co¡_±r
) == 1) {

3745 
num_acû±ed
++;

3746 
av
 +ğ*
co¡_±r
;

3747 
sum_of_squ¬es
 +ğ*
co¡_±r
 * (*cost_ptr);

3751 ià(
num_acû±ed
 != 0) {

3752 
av
 /ğ
num_acû±ed
;

3754 
av
 = 0.;

3757 
¡d_dev
 = 
	`g‘_¡d_dev
(
num_acû±ed
,

3758 
sum_of_squ¬es
,

3759 
av
);

3761 #ifdeà
DEBUG


3762 ià(
num_acû±ed
 !ğ
move_lim
) {

3763 
	`´štf
("Warning: Starting: %d of %d configurations‡ccepted.\n",

3764 
num_acû±ed
, 
move_lim
);

3768 #ifdeà
VERBOSE


3769 
	`´štf
("std_dev: %g,‡verage cost: %g, startingemp: %g\n",

3770 
¡d_dev
, 
av
, 20.0 * std_dev);

3775  (20.0 * 
¡d_dev
);

3776 
	}
}

3783 
	$Œy_sw­
(
t
,

3784 * 
co¡
,

3785 * 
bb_co¡
,

3786 * 
timšg_co¡
,

3787 
¿nge_lim™
,

3788 
¶aû_co¡_ty³
,

3789 ** 
Şd_»giÚ_occ_x
,

3790 ** 
Şd_»giÚ_occ_y
,

3791 
num_»giÚs
,

3792 
boŞ—n
 
fixed_pšs
,

3793 
¶aû_®gÜ™hm_t
 
¶aû_®gÜ™hm
,

3794 
timšg_Œadeoff
,

3795 
šv”£_´ev_bb_co¡
,

3796 
šv”£_´ev_timšg_co¡
,

3797 * 
d–ay_co¡
)

3800 
bbox_t
* 
bb_coÜd_Ãw
 = 
NULL
;

3801 
bbox_t
* 
bb_edge_Ãw
 = 
NULL
;

3802 * 
Ãts_to_upd©e
 = 
NULL
;

3803 * 
Ãt_block_moved
 = 
NULL
;

3804 ià(
bb_coÜd_Ãw
 =ğ
NULL
) {

3805 
bb_coÜd_Ãw
 = (
bbox_t
*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * (bbox_t));

3806 
bb_edge_Ãw
 = (
bbox_t
*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * (bbox_t));

3807 
Ãts_to_upd©e
 = (*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * ());

3808 
Ãt_block_moved
 = (*)
	`my_m®loc
(2 * 
max_pšs_³r_şb
 * ());

3811 
äom_block
 = 
	`my_œªd
(
num_blocks
 - 1);

3812 cÚ¡ 
block_ty³s_t
 
käom_block_ty³
 = 
blocks
[
äom_block
].
block_ty³
;

3820 ià(
fixed_pšs
 =ğ
TRUE
) {

3821 
käom_block_ty³
 =ğ
INPAD_TYPE


3822 || 
käom_block_ty³
 =ğ
OUTPAD_TYPE
) {

3823 
äom_block
 = 
	`my_œªd
(
num_blocks
 - 1);

3827 
x_äom
 = 
blocks
[
äom_block
].
x
;

3828 
y_äom
 = 
blocks
[
äom_block
].
y
;

3829 
z_äom
 = 
blocks
[
äom_block
].
z
;

3830 
x_to
 = 0;

3831 
y_to
 = 0;

3832 
	`fšd_to
(
x_äom
,

3833 
y_äom
,

3834 
käom_block_ty³
,

3835 
¿nge_lim™
,

3836 &
x_to
,

3837 &
y_to
);

3843 
z_to
 = 0;

3844 ià(
bš_grids
[
x_to
][
y_to
].
m_ÿ·c™y
 > 1) {

3845 
z_to
 = 
	`my_œªd
(
bš_grids
[
x_to
][
y_to
].
m_ÿ·c™y
 - 1);

3848 
to_block
 = 0;

3849 ià(
bš_grids
[
x_to
][
y_to
].
š_blocks
[
z_to
] =ğ
EMPTY
) {

3851 
to_block
 = 
EMPTY
;

3852 
blocks
[
äom_block
].
x
 = 
x_to
;

3853 
blocks
[
äom_block
].
y
 = 
y_to
;

3854 
blocks
[
äom_block
].
z
 = 
z_to
;

3857 
to_block
 = 
bš_grids
[
x_to
][
y_to
].
š_blocks
[
z_to
];

3858 
blocks
[
to_block
].
x
 = 
x_äom
;

3859 
blocks
[
to_block
].
y
 = 
y_äom
;

3860 
blocks
[
to_block
].
z
 = 
z_äom
;

3862 
blocks
[
äom_block
].
x
 = 
x_to
;

3863 
blocks
[
äom_block
].
y
 = 
y_to
;

3864 
blocks
[
äom_block
].
z
 = 
z_to
;

3869 
num_of_pšs
 = 
g_pšs_Ú_block
[
käom_block_ty³
];

3870 
num_Ãts_afãùed
 = 
	`fšd_afãùed_Ãts
(
Ãts_to_upd©e
,

3871 
Ãt_block_moved
,

3872 
äom_block
,

3873 
to_block
,

3874 
num_of_pšs
);

3875 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

3876 
	`§ve_»giÚ_occ
(
Şd_»giÚ_occ_x
,

3877 
Şd_»giÚ_occ_y
,

3878 
num_»giÚs
);

3883 
d–_c
 = 0.0;

3884 
bb_d–_c
 = 0.0;

3885 
bb_šdex
 = 0;

3886 
k
 = -1;

3887 
k
 = 0; k < 
num_Ãts_afãùed
; ++k) {

3888 
š‘
 = 
Ãts_to_upd©e
[
k
];

3891 ià(
Ãt_block_moved
[
k
] =ğ
FROM_AND_TO
) {

3895 ià(
Ãt
[
š‘
].
num_Ãt_pšs
 < 
SMALL_NET
) {

3896 
	`g‘_nÚ_upd©—bË_bb
(
š‘
, &
bb_coÜd_Ãw
[
bb_šdex
]);

3898 ià(
Ãt_block_moved
[
k
] =ğ
FROM
) {

3899 
	`upd©e_bb
(
š‘
, &
bb_coÜd_Ãw
[
bb_šdex
],

3900 &
bb_edge_Ãw
[
bb_šdex
],

3901 
x_äom
, 
y_äom
,

3902 
x_to
, 
y_to
);

3904 
	`upd©e_bb
(
š‘
, &
bb_coÜd_Ãw
[
bb_šdex
],

3905 &
bb_edge_Ãw
[
bb_šdex
],

3906 
x_to
, 
y_to
, 
x_äom
,

3907 
y_äom
);

3911 ià(
¶aû_co¡_ty³
 !ğ
NONLINEAR_CONG
) {

3912 
‹mp_Ãt_co¡
[
š‘
] = 
	`g‘_Ãt_co¡
(inet,

3913 &
bb_coÜd_Ãw
[
bb_šdex
]);

3914 
bb_d–_c
 +ğ
‹mp_Ãt_co¡
[
š‘
] - 
Ãt_co¡
[inet];

3917 
	`upd©e_»giÚ_occ
(
š‘
, &
bb_coÜds
[inet], -1,

3918 
num_»giÚs
);

3919 
	`upd©e_»giÚ_occ
(
š‘
, &
bb_coÜd_Ãw
[
bb_šdex
], 1,

3920 
num_»giÚs
);

3923 ++
bb_šdex
;

3926 
Ãwco¡
 = 0.0;

3927 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

3928 
Ãwco¡
 = 
	`nÚlš—r_cÚg_co¡
(
num_»giÚs
);

3929 
bb_d–_c
 = 
Ãwco¡
 - *
bb_co¡
;

3932 
timšg_d–_c
 = 0.0;

3933 
d–ay_d–_c
 = 0.0;

3934 ià(
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

3935 
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

3939 
	`compu‹_d–_td_co¡
(
äom_block
,

3940 
to_block
,

3941 
num_of_pšs
,

3942 &
timšg_d–_c
,

3943 &
d–ay_d–_c
);

3945 
d–_c
 = (1 - 
timšg_Œadeoff
è* 
bb_d–_c
 * 
šv”£_´ev_bb_co¡


3946 + 
timšg_Œadeoff
 * 
timšg_d–_c
 * 
šv”£_´ev_timšg_co¡
;

3948 
d–_c
 = 
bb_d–_c
;

3952 
k“p_sw™ch
 = 
	`as£ss_sw­
(
d–_c
,

3953 
t
);

3954 ià(
k“p_sw™ch
) {

3955 *
co¡
 = *co¡ + 
d–_c
;

3956 *
bb_co¡
 = *bb_co¡ + 
bb_d–_c
;

3958 ià(
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

3959 
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
) {

3962 *
timšg_co¡
 = *timšg_co¡ + 
timšg_d–_c
;

3963 *
d–ay_co¡
 = *d–ay_co¡ + 
d–ay_d–_c
;

3964 
	`upd©e_td_co¡
(
äom_block
,

3965 
to_block
,

3966 
num_of_pšs
);

3970 
bb_šdex
 = 0;

3971 
k
 = 0; k < 
num_Ãts_afãùed
; ++k) {

3972 
š‘
 = 
Ãts_to_upd©e
[
k
];

3975 ià(
Ãt_block_moved
[
k
] =ğ
FROM_AND_TO
) {

3976 
‹mp_Ãt_co¡
[
š‘
] = -1;

3980 
bb_coÜds
[
š‘
] = 
bb_coÜd_Ãw
[
bb_šdex
];

3981 ià(
Ãt
[
š‘
].
num_Ãt_pšs
 >ğ
SMALL_NET
) {

3982 
bb_num_Ú_edges
[
š‘
] = 
bb_edge_Ãw
[
bb_šdex
];

3985 ++
bb_šdex
;

3987 
Ãt_co¡
[
š‘
] = 
‹mp_Ãt_co¡
[inet];

3988 
‹mp_Ãt_co¡
[
š‘
] = -1;

3993 
bš_grids
[
x_to
][
y_to
].
š_blocks
[
z_to
] = 
äom_block
;

3994 
bš_grids
[
x_äom
][
y_äom
].
š_blocks
[
z_äom
] = 
to_block
;

3996 ià(
EMPTY
 =ğ
to_block
) {

3998 ++(
bš_grids
[
x_to
][
y_to
].
m_u§ge
);

3999 --(
bš_grids
[
x_äom
][
y_äom
].
m_u§ge
);

4004 
k
 = 0; k < 
num_Ãts_afãùed
; ++k) {

4005 
š‘
 = 
Ãts_to_upd©e
[
k
];

4006 
‹mp_Ãt_co¡
[
š‘
] = -1;

4010 
blocks
[
äom_block
].
x
 = 
x_äom
;

4011 
blocks
[
äom_block
].
y
 = 
y_äom
;

4012 
blocks
[
äom_block
].
z
 = 
z_äom
;

4013 ià(
to_block
 !ğ
EMPTY
) {

4014 
blocks
[
to_block
].
x
 = 
x_to
;

4015 
blocks
[
to_block
].
y
 = 
y_to
;

4016 
blocks
[
to_block
].
z
 = 
z_to
;

4020 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

4021 
	`»¡Üe_»giÚ_occ
(
Şd_»giÚ_occ_x
,

4022 
Şd_»giÚ_occ_y
,

4023 
num_»giÚs
);

4027  
k“p_sw™ch
;

4028 
	}
}

4032 
	$§ve_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

4033 ** 
Şd_»giÚ_occ_y
,

4034 
num_»giÚs
)

4038 
i
, 
j
;

4039 
i
 = 0; i < 
num_»giÚs
; ++i) {

4040 
j
 = 0; j < 
num_»giÚs
; ++j) {

4041 
Şd_»giÚ_occ_x
[
i
][
j
] = 
¶aû_»giÚ_x
[i][j].
occu·ncy
;

4042 
Şd_»giÚ_occ_y
[
i
][
j
] = 
¶aû_»giÚ_y
[i][j].
occu·ncy
;

4045 
	}
}

4049 
	$»¡Üe_»giÚ_occ
(** 
Şd_»giÚ_occ_x
,

4050 ** 
Şd_»giÚ_occ_y
,

4051 
num_»giÚs
)

4055 
i
, 
j
;

4056 
i
 = 0; i < 
num_»giÚs
; ++i) {

4057 
j
 = 0; j < 
num_»giÚs
; ++j) {

4058 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 = 
Şd_»giÚ_occ_x
[i][j];

4059 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 = 
Şd_»giÚ_occ_y
[i][j];

4062 
	}
}

4068 
	$fšd_afãùed_Ãts
(* 
Ãts_to_upd©e
,

4069 * 
Ãt_block_moved
,

4070 
äom_block
,

4071 
to_block
,

4072 
num_of_pšs
)

4074 
š‘
, 
couÁ
;

4075 
afãùed_šdex
 = 0;

4076 
k
 = -1;

4077 
k
 = 0; k < 
num_of_pšs
; ++k) {

4078 
š‘
 = 
blocks
[
äom_block
].
Ãts
[
k
];

4079 ià(
š‘
 =ğ
OPEN
 || 
TRUE
 =ğ
is_glob®
[inet]) {

4083 ià(
‹mp_Ãt_co¡
[
š‘
] > 0.0) {

4087 
Ãts_to_upd©e
[
afãùed_šdex
] = 
š‘
;

4088 
Ãt_block_moved
[
afãùed_šdex
] = 
FROM
;

4089 
afãùed_šdex
++;

4090 
‹mp_Ãt_co¡
[
š‘
] = 1.;

4093 ià(
to_block
 !ğ
EMPTY
) {

4094 
k
 = 0; k < 
num_of_pšs
; ++k) {

4095 
š‘
 = 
blocks
[
to_block
].
Ãts
[
k
];

4096 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

4100 ià(
‹mp_Ãt_co¡
[
š‘
] > 0.) {

4102 
couÁ
 = 0; couÁ < 
afãùed_šdex
; ++count) {

4103 ià(
Ãts_to_upd©e
[
couÁ
] =ğ
š‘
) {

4104 ià(
Ãt_block_moved
[
couÁ
] =ğ
FROM
) {

4105 
Ãt_block_moved
[
couÁ
] = 
FROM_AND_TO
;

4112 #ifdeà
DEBUG


4113 ià(
couÁ
 > 
afãùed_šdex
) {

4114 
	`´štf
("Error in find_affected_nets -- count = %d,"

4115 "‡fãùed index = %d.\n", 
couÁ
, 
afãùed_šdex
);

4116 
	`ex™
(1);

4121 
Ãts_to_upd©e
[
afãùed_šdex
] = 
š‘
;

4122 
Ãt_block_moved
[
afãùed_šdex
] = 
TO
;

4123 
afãùed_šdex
++;

4124 
‹mp_Ãt_co¡
[
š‘
] = 1.;

4129  (
afãùed_šdex
);

4130 
	}
}

4137 
	$fšd_to
(
x_äom
,

4138 
y_äom
,

4139 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

4140 
¿nge_lim™
,

4141 * 
x_to
,

4142 * 
y_to
)

4145 cÚ¡ 
¾x
 = 
	`mš
(
num_grid_cŞumns
, 
¿nge_lim™
);

4147 cÚ¡ 
¾y
 = 
	`mš
(
num_grid_rows
, 
¿nge_lim™
);

4148 #ifdeà
DEBUG


4149 ià(
¾x
 < 1 ||„lx > 
num_grid_cŞumns
) {

4150 
	`´štf
("E¼Ü iÀfšd_to:„lx = %d\n", 
¾x
);

4151 
	`ex™
(1);

4156 
x_»l
 = 0;

4157 
y_»l
 = 0;

4158 ià(
kblock_ty³
 =ğ
B_CLB_TYPE
) {

4159 
x_»l
 = 
	`my_œªd
(2 * 
¾x
);

4160 
y_»l
 = 
	`my_œªd
(2 * 
¾y
);

4164 *
x_to
 = 
x_äom
 + (
x_»l
 - 
¾x
);

4165 *
y_to
 = 
y_äom
 + (
y_»l
 - 
¾y
);

4167 ià(*
x_to
 > 
num_grid_cŞumns
) {

4168 *
x_to
 = *x_tØ- 
num_grid_cŞumns
;

4170 ià(*
x_to
 < 1) {

4171 *
x_to
 = *x_tØ+ 
num_grid_cŞumns
;

4174 ià(*
y_to
 > 
num_grid_rows
) {

4175 *
y_to
 = *y_tØ- 
num_grid_rows
;

4177 ià(*
y_to
 < 1) {

4178 *
y_to
 = *y_tØ+ 
num_grid_rows
;

4181 
iside
 = 0;

4182 
Ïû
 = 0;

4183 ià(
¾x
 >ğ
num_grid_cŞumns
) {

4184 
iside
 = 
	`my_œªd
(3);

4194 
iside
) {

4196 
Ïû
 = 
	`my_œªd
(
num_grid_rows
 - 1) + 1;

4197 *
x_to
 = 0;

4198 *
y_to
 = 
Ïû
;

4202 
Ïû
 = 
	`my_œªd
(
num_grid_cŞumns
 - 1) + 1;

4203 *
x_to
 = 
Ïû
;

4204 *
y_to
 = 
num_grid_rows
 + 1;

4208 
Ïû
 = 
	`my_œªd
(
num_grid_rows
 - 1) + 1;

4209 *
x_to
 = 
num_grid_cŞumns
 + 1;

4210 *
y_to
 = 
Ïû
;

4214 
Ïû
 = 
	`my_œªd
(
num_grid_cŞumns
 - 1) + 1;

4215 *
x_to
 = 
Ïû
;

4216 *
y_to
 = 0;

4220 
	`´štf
("Error in find_to. Unexpected io swap†ocation.\n");

4221 
	`ex™
(1);

4224 ià(
x_äom
 == 0) {

4225 
Ïû
 = 
	`my_œªd
(2 * 
¾y
);

4226 *
y_to
 = 
y_äom
 + (
Ïû
 - 
¾y
);

4227 *
x_to
 = 
x_äom
;

4229 ià(*
y_to
 > 
num_grid_rows
) {

4230 *
y_to
 = 
num_grid_rows
 + 1;

4231 *
x_to
 = 
	`my_œªd
(
¾x
 - 1) + 1;

4232 } ià(*
y_to
 < 1) {

4233 *
y_to
 = 0;

4234 *
x_to
 = 
	`my_œªd
(
¾x
 - 1) + 1;

4236 } ià(
x_äom
 =ğ
num_grid_cŞumns
 + 1) {

4237 
Ïû
 = 
	`my_œªd
(2 * 
¾y
);

4238 *
y_to
 = 
y_äom
 + (
Ïû
 - 
¾y
);

4239 *
x_to
 = 
x_äom
;

4241 ià(*
y_to
 > 
num_grid_rows
) {

4242 *
y_to
 = 
num_grid_rows
 + 1;

4243 *
x_to
 = 
num_grid_cŞumns
 - 
	`my_œªd
(
¾x
 - 1);

4244 } ià(*
y_to
 < 1) {

4245 *
y_to
 = 0;

4246 *
x_to
 = 
num_grid_cŞumns
 - 
	`my_œªd
(
¾x
 - 1);

4248 } ià(
y_äom
 == 0) {

4249 
Ïû
 = 
	`my_œªd
(2 * 
¾x
);

4250 *
x_to
 = 
x_äom
 + (
Ïû
 - 
¾x
);

4251 *
y_to
 = 
y_äom
;

4253 ià(*
x_to
 > 
num_grid_cŞumns
) {

4254 *
x_to
 = 
num_grid_cŞumns
 + 1;

4255 *
y_to
 = 
	`my_œªd
(
¾y
 - 1) + 1;

4256 } ià(*
x_to
 < 1) {

4257 *
x_to
 = 0;

4258 *
y_to
 = 
	`my_œªd
(
¾y
 - 1) + 1;

4261 
Ïû
 = 
	`my_œªd
(2 * 
¾x
);

4262 *
x_to
 = 
x_äom
 + (
Ïû
 - 
¾x
);

4263 *
y_to
 = 
y_äom
;

4265 ià(*
x_to
 > 
num_grid_cŞumns
) {

4266 *
x_to
 = 
num_grid_cŞumns
 + 1;

4267 *
y_to
 = 
num_grid_rows
 - 
	`my_œªd
(
¾y
 - 1);

4268 } ià(*
x_to
 < 1) {

4269 *
x_to
 = 0;

4270 *
y_to
 = 
num_grid_rows
 - 
	`my_œªd
(
¾y
 - 1);

4275 } (
x_äom
 =ğ*
x_to
è&& (
y_äom
 =ğ*
y_to
));

4277 ià(*
x_to
 < 0 || *x_tØ> 
num_grid_cŞumns
 + 1 || *
y_to
 < 0

4278 || *
y_to
 > 
num_grid_rows
 + 1) {

4279 
	`´štf
("Error in„outine find_to: (x_to,y_to) = (%d,%d)\n",

4280 *
x_to
, *
y_to
);

4281 
	`ex™
(1);

4284 ià(
kblock_ty³
 =ğ
B_CLB_TYPE
) {

4285 ià(
bš_grids
[*
x_to
][*
y_to
].
grid_ty³
 !ğ
B_CLB_TYPE
) {

4286 
	`´štf
("Error: Moving CLB_TYPEo illegalype blocks‡t (%d,%d)\n",

4287 *
x_to
, *
y_to
);

4288 
	`ex™
(1);

4291 ià(
bš_grids
[*
x_to
][*
y_to
].
grid_ty³
 !ğ
IO_TYPE
) {

4292 
	`´štf
("Error: Moving IO_TYPE blockso illegalype†ocation‡t "

4293 "(%d,%d)\n", *
x_to
, *
y_to
);

4294 
	`ex™
(1);

4297 
	}
}

4301 
	$as£ss_sw­
(
d–_c
,

4302 
t
)

4304 
acû±
;

4305 
´ob_çc
, 
âum
;

4306 ià(
d–_c
 <= 0) {

4307 #ifdeà
SPEC


4308 
âum
 = 
	`my_äªd
();

4312 
acû±
 = 1;

4313  (
acû±
);

4316 ià(
t
 == 0.) {

4320 
âum
 = 
	`my_äªd
();

4321 
´ob_çc
 = 
	`exp
(-
d–_c
 / 
t
);

4323 ià(
´ob_çc
 > 
âum
) {

4324 
acû±
 = 1;

4326 
acû±
 = 0;

4329  (
acû±
);

4330 
	}
}

4334 
	$compu‹_pošt_to_pošt_d–ay
(
š‘
,

4335 
š
)

4340 cÚ¡ 
sourû_block
 = 
Ãt
[
š‘
].
node_blocks
[0];

4341 cÚ¡ 
sšk_block
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

4342 
	`as£¹
(
sourû_block
 !ğ
sšk_block
);

4344 cÚ¡ 
block_ty³s_t
 
sourû_ty³
 = 
blocks
[
sourû_block
].
block_ty³
;

4345 cÚ¡ 
block_ty³s_t
 
sšk_ty³
 = 
blocks
[
sšk_block
].
block_ty³
;

4346 
	`as£¹
(
sourû_ty³
 !ğ
EMPTY_TYPE
 && 
sšk_ty³
 != EMPTY_TYPE);

4348 cÚ¡ 
d–_x
 = 
	`abs
(
blocks
[
sšk_block
].
x
 - blocks[
sourû_block
].x);

4349 cÚ¡ 
d–_y
 = 
	`abs
(
blocks
[
sšk_block
].
y
 - blocks[
sourû_block
].y);

4356 
d–ay_sourû_to_sšk
 = 0.0;

4361 ià(
sourû_ty³
 =ğ
B_CLB_TYPE
) {

4362 ià(
sšk_ty³
 =ğ
B_CLB_TYPE
) {

4365 
d–ay_sourû_to_sšk
 = 
d–_şb_to_şb
[
d–_x
][
d–_y
];

4366 } ià(
sšk_ty³
 =ğ
OUTPAD_TYPE
) {

4368 
d–ay_sourû_to_sšk
 = 
d–_şb_to_ouad
[
d–_x
][
d–_y
];

4371 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, \
 from clb output…ino input…ad\n");

4373 
	`ex™
(1);

4375 } ià(
sourû_ty³
 =ğ
INPAD_TYPE
) {

4376 ià(
sšk_ty³
 =ğ
B_CLB_TYPE
) {

4378 
d–ay_sourû_to_sšk
 = 
d–_š·d_to_şb
[
d–_x
][
d–_y
];

4379 } ià(
sšk_ty³
 =ğ
OUTPAD_TYPE
) {

4381 
d–ay_sourû_to_sšk
 = 
d–_š·d_to_ouad
[
d–_x
][
d–_y
];

4384 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, \
 from input…ado input…ad\n");

4386 
	`ex™
(1);

4389 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, bad source_type\n");

4390 
	`ex™
(1);

4393 ià(
d–ay_sourû_to_sšk
 < 0.0) {

4394 
	`´štf
("Error in compute_point_to_point_delay in…lace.c, Tdel is†esshan 0\n");

4395 
	`ex™
(1);

4398  
d–ay_sourû_to_sšk
;

4399 
	}
}

4402 
	$upd©e_td_co¡
(
äom_block
,

4403 
to_block
,

4404 
num_of_pšs
)

4408 
blkpš
, 
Ãt_pš
, 
š‘
, 
š
;

4409 
blkpš
 = 0; blkpš < 
num_of_pšs
; ++blkpin) {

4410 
š‘
 = 
blocks
[
äom_block
].
Ãts
[
blkpš
];

4411 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

4415 
Ãt_pš
 = 
Ãt_pš_šdex
[
äom_block
][
blkpš
];

4416 ià(
Ãt_pš
 != 0) {

4418 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


4419 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

4421 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] =

4422 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
];

4423 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = -1;

4425 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

4426 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
];

4427 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] = -1;

4432 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4433 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

4435 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] =

4436 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
];

4437 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

4439 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

4440 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
];

4441 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

4446 ià(
to_block
 !ğ
EMPTY
) {

4447 
blkpš
 = 0; blkpš < 
num_of_pšs
; ++blkpin) {

4448 
š‘
 = 
blocks
[
to_block
].
Ãts
[
blkpš
];

4449 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

4453 
Ãt_pš
 = 
Ãt_pš_šdex
[
to_block
][
blkpš
];

4454 ià(
Ãt_pš
 != 0) {

4456 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


4457 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

4459 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] =

4460 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
];

4461 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = -1;

4463 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]

4464 ğ
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
];

4465 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] = -1;

4470 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4471 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

4473 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] =

4474 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
];

4475 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

4477 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

4478 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
];

4479 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

4484 
	}
}

4490 
	$compu‹_d–_td_co¡
(
äom_block
,

4491 
to_block
,

4492 
num_of_pšs
,

4493 * 
d–_timšg
,

4494 * 
d–_d–ay
)

4496 
š‘
, 
k
, 
š
;

4498 
d–_timšg_co¡
 = 0.0;

4499 
d–_d–ay_co¡
 = 0.0;

4500 
k
 = 0; k < 
num_of_pšs
; ++k) {

4501 cÚ¡ 
š‘
 = 
blocks
[
äom_block
].
Ãts
[
k
];

4502 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

4506 cÚ¡ 
Ãt_pš
 = 
Ãt_pš_šdex
[
äom_block
][
k
];

4507 ià(
Ãt_pš
 != 0) {

4514 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


4515 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

4516 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

4517 
Ãt_pš
);

4519 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = 
‹mp_d–ay
;

4520 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

4521 
timšg_¶aû_ü™
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

4523 
d–_d–ay_co¡
 +ğ(
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]

4524 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]);

4526 
d–_timšg_co¡
 +ğ(
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]

4527 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]);

4532 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4533 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

4534 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

4535 
š
);

4536 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay
;

4537 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

4538 
timšg_¶aû_ü™
[
š‘
][
š
] * 
‹mp_d–ay
;

4540 
d–_d–ay_co¡
 +ğ(
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]

4541 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]);

4543 
d–_timšg_co¡
 +ğ(
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
]

4544 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
]);

4549 ià(
to_block
 !ğ
EMPTY
) {

4550 
k
 = 0; k < 
num_of_pšs
; ++k) {

4551 
š‘
 = 
blocks
[
to_block
].
Ãts
[
k
];

4552 ià(
š‘
 =ğ
OPEN
 || 
is_glob®
[š‘] =ğ
TRUE
) {

4556 cÚ¡ 
Ãt_pš
 = 
Ãt_pš_šdex
[
to_block
][
k
];

4557 ià(
Ãt_pš
 != 0) {

4565 ià(
Ãt
[
š‘
].
node_blocks
[0] !ğ
to_block


4566 && 
Ãt
[
š‘
].
node_blocks
[0] !ğ
äom_block
) {

4567 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

4568 
Ãt_pš
);

4569 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
] = 
‹mp_d–ay
;

4570 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
] =

4571 
timšg_¶aû_ü™
[
š‘
][
Ãt_pš
] * 
‹mp_d–ay
;

4573 
d–_d–ay_co¡
 +ğ
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
]

4574 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
Ãt_pš
];

4575 
d–_timšg_co¡
 +ğ
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
]

4576 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
Ãt_pš
];

4581 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4582 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

4583 
‹mp_d–ay
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

4584 
š
);

4585 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay
;

4586 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] =

4587 
timšg_¶aû_ü™
[
š‘
][
š
] * 
‹mp_d–ay
;

4589 
d–_d–ay_co¡
 +ğ
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
]

4590 - 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
];

4591 
d–_timšg_co¡
 +ğ
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
]

4592 - 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
];

4598 *
d–_timšg
 = 
d–_timšg_co¡
;

4599 *
d–_d–ay
 = 
d–_d–ay_co¡
;

4600 
	}
}

4605 
	$compu‹_td_co¡s
(* 
timšg_co¡
,

4606 * 
cÚÃùiÚ_d–ay_sum
)

4608 
loc_timšg_co¡
 = 0.0;

4609 
loc_cÚÃùiÚ_d–ay_sum
 = 0.0;

4610 
š‘
 = 0;

4611 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

4613 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

4615 
š
 = 0;

4616 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4617 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

4618 
‹mp_d–ay_co¡
 = 
	`compu‹_pošt_to_pošt_d–ay
(
š‘
,

4619 
š
);

4620 
‹mp_timšg_co¡
 =

4621 
‹mp_d–ay_co¡
 * 
timšg_¶aû_ü™
[
š‘
][
š
];

4623 
loc_cÚÃùiÚ_d–ay_sum
 +ğ
‹mp_d–ay_co¡
;

4624 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 
‹mp_d–ay_co¡
;

4625 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = -1;

4627 
pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = 
‹mp_timšg_co¡
;

4628 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
][
š
] = -1;

4629 
loc_timšg_co¡
 +ğ
‹mp_timšg_co¡
;

4634 *
timšg_co¡
 = 
loc_timšg_co¡
;

4635 *
cÚÃùiÚ_d–ay_sum
 = 
loc_cÚÃùiÚ_d–ay_sum
;

4636 
	}
}

4646 
	$comp_bb_co¡
(
m‘hod
,

4647 
¶aû_co¡_ty³
,

4648 
num_»giÚs
)

4650 
co¡
 = 0;

4651 
ex³ùed_wœ–’gth
 = 0.0;

4654 
i
, 
j
, 
k
;

4655 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

4656 
i
 = 0; i < 
num_»giÚs
; ++i) {

4657 
j
 = 0; j < 
num_»giÚs
; ++j) {

4658 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 = 0.;

4659 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 = 0.;

4664 
k
 = 0; k < 
num_Ãts
; ++k) {

4666 ià(
is_glob®
[
k
] =ğ
FALSE
) {

4670 ià(
Ãt
[
k
].
num_Ãt_pšs
 > 
SMALL_NET
 && 
m‘hod
 =ğ
NORMAL
) {

4671 
	`g‘_bb_äom_sü©ch
(
k
, &
bb_coÜds
[k],

4672 &
bb_num_Ú_edges
[
k
]);

4674 
	`g‘_nÚ_upd©—bË_bb
(
k
, &
bb_coÜds
[k]);

4677 ià(
¶aû_co¡_ty³
 !ğ
NONLINEAR_CONG
) {

4678 
Ãt_co¡
[
k
] = 
	`g‘_Ãt_co¡
(k, &
bb_coÜds
[k]);

4679 
co¡
 +ğ
Ãt_co¡
[
k
];

4681 ià(
m‘hod
 =ğ
CHECK
)

4682 
ex³ùed_wœ–’gth
 +ğ
	`g‘_Ãt_wœ–’gth_e¡im©e
(
k
,

4683 &
bb_coÜds
[
k
]);

4686 
	`upd©e_»giÚ_occ
(
k
, &
bb_coÜds
[k], 1,

4687 
num_»giÚs
);

4692 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

4693 
co¡
 = 
	`nÚlš—r_cÚg_co¡
(
num_»giÚs
);

4700  
co¡
;

4701 
	}
}

4711 
	$nÚlš—r_cÚg_co¡
(
num_»giÚs
)

4713 
co¡
 = 0.0;

4714 
tmp
 = 0.0;

4715 
i
, 
j
;

4716 
i
 = 0; i < 
num_»giÚs
; i++) {

4717 
j
 = 0; j < 
num_»giÚs
; j++) {

4720 ià(
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 <…Ïû_»giÚ_x[i][j].
ÿ·c™y
) {

4721 
co¡
 +ğ
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 *

4722 
¶aû_»giÚ_x
[
i
][
j
].
šv_ÿ·c™y
;

4725 
tmp
 = 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 *

4726 
¶aû_»giÚ_x
[
i
][
j
].
šv_ÿ·c™y
;

4727 
co¡
 +ğ
tmp
 *mp;

4730 ià(
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 <…Ïû_»giÚ_y[i][j].
ÿ·c™y
) {

4731 
co¡
 +ğ
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 *

4732 
¶aû_»giÚ_y
[
i
][
j
].
šv_ÿ·c™y
;

4736 
tmp
 = 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 *

4737 
¶aû_»giÚ_y
[
i
][
j
].
šv_ÿ·c™y
;

4738 
co¡
 +ğ
tmp
 *mp;

4744  (
co¡
);

4745 
	}
}

4752 
	$upd©e_»giÚ_occ
(
š‘
,

4753 
bbox_t
* 
coÜds
,

4754 
add_Ü_sub
,

4755 
num_»giÚs
)

4757 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4758 
üossšg
 = 0.0;

4759 ià(
knum_Ãt_pšs
 >= 50) {

4760 
üossšg
 = 2.7933 + 0.02616 * (
knum_Ãt_pšs
 - 50);

4762 
üossšg
 = 
üoss_couÁ
[
knum_Ãt_pšs
 - 1];

4765 
Ãt_xmš
 = 
coÜds
->
xmš
 - 0.5;

4766 
Ãt_xmax
 = 
coÜds
->
xmax
 + 0.5;

4767 
Ãt_ymš
 = 
coÜds
->
ymš
 - 0.5;

4768 
Ãt_ymax
 = 
coÜds
->
ymax
 + 0.5;

4771 
šv_»giÚ_Ën
 = ()
num_»giÚs
 / ()
num_grid_cŞumns
;

4772 
šv_»giÚ_height
 = ()
num_»giÚs
 / ()
num_grid_rows
;

4780 
imš
 = ()(
Ãt_xmš
 - 0.5è* 
šv_»giÚ_Ën
;

4781 
imax
 = ()(
Ãt_xmax
 - 0.5è* 
šv_»giÚ_Ën
;

4782 
imax
 = 
	`mš
(imax, 
num_»giÚs
 - 1);

4784 
jmš
 = ()(
Ãt_ymš
 - 0.5è* 
šv_»giÚ_height
;

4785 
jmax
 = ()(
Ãt_ymax
 - 0.5è* 
šv_»giÚ_height
;

4786 
jmax
 = 
	`mš
(jmax, 
num_»giÚs
 - 1);

4788 
šv_bb_Ën
 = 1.0 / (
Ãt_xmax
 - 
Ãt_xmš
);

4789 
šv_bb_height
 = 1.0 / (
Ãt_ymax
 - 
Ãt_ymš
);

4793 
ov”Ïp_xlow
, 
ov”Ïp_xhigh
, 
ov”Ïp_ylow
, 
ov”Ïp_yhigh
;

4794 
y_ov”Ïp
, 
x_ov”Ïp
, 
x_occu·ncy
, 
y_occu·ncy
;

4796 
i
, 
j
;

4797 
i
 = 
imš
; i <ğ
imax
; ++i) {

4798 
j
 = 
jmš
; j <ğ
jmax
; ++j) {

4799 
ov”Ïp_xlow
 = 
	`max
(
¶aû_»giÚ_bounds_x
[
i
], 
Ãt_xmš
);

4800 
ov”Ïp_xhigh
 = 
	`mš
(
¶aû_»giÚ_bounds_x
[
i
 + 1], 
Ãt_xmax
);

4801 
ov”Ïp_ylow
 = 
	`max
(
¶aû_»giÚ_bounds_y
[
j
], 
Ãt_ymš
);

4802 
ov”Ïp_yhigh
 = 
	`mš
(
¶aû_»giÚ_bounds_y
[
j
 + 1], 
Ãt_ymax
);

4804 
x_ov”Ïp
 = 
ov”Ïp_xhigh
 - 
ov”Ïp_xlow
;

4805 
y_ov”Ïp
 = 
ov”Ïp_yhigh
 - 
ov”Ïp_ylow
;

4807 #ifdeà
DEBUG


4808 ià(
x_ov”Ïp
 < -0.001) {

4809 
	`´štf
("Error in update_region_occ: x_overlap < 0"

4810 "\Àš‘ = %d, ov”Ï°ğ%g\n", 
š‘
,

4811 
x_ov”Ïp
);

4814 ià(
y_ov”Ïp
 < -0.001) {

4815 
	`´štf
("Error in update_region_occ: y_overlap < 0"

4816 "\Àš‘ = %d, ov”Ï°ğ%g\n", 
š‘
,

4817 
y_ov”Ïp
);

4822 
x_occu·ncy
 = 
üossšg
 * 
y_ov”Ïp
 * 
x_ov”Ïp
 * 
šv_bb_height
 *

4823 
šv_»giÚ_Ën
;

4824 
y_occu·ncy
 = 
üossšg
 * 
x_ov”Ïp
 * 
y_ov”Ïp
 * 
šv_bb_Ën
 *

4825 
šv_»giÚ_height
;

4827 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 +ğ
add_Ü_sub
 * 
x_occu·ncy
;

4828 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 +ğ
add_Ü_sub
 * 
y_occu·ncy
;

4831 
	}
}

4834 
	$ä“_¶aû_»giÚs
(
num_»giÚs
)

4838 
	`ä“_m©rix
(
¶aû_»giÚ_x
, 0, 
num_»giÚs
 - 1,

4839 0, (
¶aû_»giÚ_t
));

4841 
	`ä“_m©rix
(
¶aû_»giÚ_y
, 0, 
num_»giÚs
 - 1,

4842 0, (
¶aû_»giÚ_t
));

4844 
	`ä“
(
¶aû_»giÚ_bounds_x
);

4845 
	`ä“
(
¶aû_»giÚ_bounds_y
);

4846 
	}
}

4849 
	$ä“_¶aûm’t_¡ruùs
(
¶aû_co¡_ty³
,

4850 
num_»giÚs
,

4851 ** 
Şd_»giÚ_occ_x
,

4852 ** 
Şd_»giÚ_occ_y
,

4853 
¶aûr_İts_t
 
¶aûr_İts
)

4857 ià(
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

4858 
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
 ||

4859 
¶aûr_İts
.
’abË_timšg_computiÚs
) {

4860 
š‘
 = -1;

4861 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

4864 
pošt_to_pošt_d–ay_co¡
[
š‘
]++;

4865 
	`ä“
(
pošt_to_pošt_d–ay_co¡
[
š‘
]);

4867 
pošt_to_pošt_timšg_co¡
[
š‘
]++;

4868 
	`ä“
(
pošt_to_pošt_timšg_co¡
[
š‘
]);

4870 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
]++;

4871 
	`ä“
(
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
]);

4873 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
]++;

4874 
	`ä“
(
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
]);

4877 
	`ä“
(
pošt_to_pošt_d–ay_co¡
);

4878 
	`ä“
(
‹mp_pošt_to_pošt_d–ay_co¡
);

4880 
	`ä“
(
pošt_to_pošt_timšg_co¡
);

4881 
	`ä“
(
‹mp_pošt_to_pošt_timšg_co¡
);

4883 
	`ä“_m©rix
(
Ãt_pš_šdex
,

4885 
num_blocks
 - 1,

4891 
	`ä“
(
Ãt_co¡
);

4892 
	`ä“
(
‹mp_Ãt_co¡
);

4893 
	`ä“
(
bb_num_Ú_edges
);

4894 
	`ä“
(
bb_coÜds
);

4896 
Ãt_co¡
 = 
NULL
;

4897 
‹mp_Ãt_co¡
 = 
NULL
;

4898 
bb_num_Ú_edges
 = 
NULL
;

4899 
bb_coÜds
 = 
NULL
;

4901 
	`ä“_unique_pš_li¡
();

4903 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

4904 
	`ä“_¶aû_»giÚs
(
num_»giÚs
);

4905 
	`ä“_m©rix
(
Şd_»giÚ_occ_x
, 0, 
num_»giÚs
 - 1, 0,

4907 
	`ä“_m©rix
(
Şd_»giÚ_occ_y
, 0, 
num_»giÚs
 - 1, 0,

4909 } ià(
¶aû_co¡_ty³
 =ğ
LINEAR_CONG
) {

4910 
	`ä“_ç¡_co¡_upd©e_¡ruùs
();

4914 
	}
}

4919 
	$®loc_ªd_lßd_¶aûm’t_¡ruùs
(
¶aû_co¡_ty³
,

4920 
num_»giÚs
,

4921 
¶aû_co¡_exp
,

4922 *** 
Şd_»giÚ_occ_x
,

4923 *** 
Şd_»giÚ_occ_y
,

4924 
¶aûr_İts_t
 
¶aûr_İts
)

4926 
š‘
, 
š
;

4929 ià(
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
NET_TIMING_DRIVEN_PLACE
 ||

4930 
¶aûr_İts
.
¶aû_®gÜ™hm
 =ğ
PATH_TIMING_DRIVEN_PLACE
 ||

4931 
¶aûr_İts
.
’abË_timšg_computiÚs
) {

4932 
pošt_to_pošt_d–ay_co¡
 =

4933 (**)
	`my_m®loc
(
num_Ãts
 * (*));

4934 
‹mp_pošt_to_pošt_d–ay_co¡
 =

4935 (**)
	`my_m®loc
(
num_Ãts
 * (*));

4937 
pošt_to_pošt_timšg_co¡
 =

4938 (**)
	`my_m®loc
(
num_Ãts
 * (*));

4939 
‹mp_pošt_to_pošt_timšg_co¡
 =

4940 (**)
	`my_m®loc
(
num_Ãts
 * (*));

4942 
Ãt_pš_šdex
 = (**)
	`®loc_m©rix
(0, 
num_blocks
 - 1,

4943 0, 
max_pšs_³r_şb
 - 1,

4945 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

4948 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4949 
pošt_to_pošt_d–ay_co¡
[
š‘
] =

4950 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

4951 --(
pošt_to_pošt_d–ay_co¡
[
š‘
]);

4953 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
] =

4954 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

4955 --(
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
]);

4957 
pošt_to_pošt_timšg_co¡
[
š‘
] =

4958 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

4959 --(
pošt_to_pošt_timšg_co¡
[
š‘
]);

4961 
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
] =

4962 (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 1) * ());

4963 --(
‹mp_pošt_to_pošt_timšg_co¡
[
š‘
]);

4966 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

4967 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

4968 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

4969 
pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 0;

4970 
‹mp_pošt_to_pošt_d–ay_co¡
[
š‘
][
š
] = 0;

4975 
Ãt_co¡
 = (*)
	`my_m®loc
(
num_Ãts
 * ());

4976 
‹mp_Ãt_co¡
 = (*)
	`my_m®loc
(
num_Ãts
 * ());

4980 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

4981 
‹mp_Ãt_co¡
[
š‘
] = -1.0;

4984 
bb_coÜds
 = (
bbox_t
*)
	`my_m®loc
(
num_Ãts
 * (bbox_t));

4985 
bb_num_Ú_edges
 = (
bbox_t
*)
	`my_m®loc
(
num_Ãts
 * (bbox_t));

4988 
	`®loc_ªd_lßd_unique_pš_li¡
();

4991 ià(
¶aû_co¡_ty³
 =ğ
NONLINEAR_CONG
) {

4992 
	`®loc_¶aû_»giÚs
(
num_»giÚs
);

4993 
	`lßd_¶aû_»giÚs
(
num_»giÚs
);

4994 *
Şd_»giÚ_occ_x
 = (**)
	`®loc_m©rix
(0, 
num_»giÚs
 - 1,

4995 0, 
num_»giÚs
 - 1,

4997 *
Şd_»giÚ_occ_y
 = (**)
	`®loc_m©rix
(0, 
num_»giÚs
 - 1,

4998 0, 
num_»giÚs
 - 1,

5002 *
Şd_»giÚ_occ_x
 = 
NULL
;

5003 *
Şd_»giÚ_occ_y
 = 
NULL
;

5006 ià(
¶aû_co¡_ty³
 =ğ
LINEAR_CONG
) {

5007 
	`®loc_ªd_lßd_fÜ_ç¡_co¡_upd©e
(
¶aû_co¡_exp
);

5009 
	}
}

5014 
	$®loc_¶aû_»giÚs
(
num_»giÚs
)

5016 
¶aû_»giÚ_x
 =

5017 (
¶aû_»giÚ_t
**)
	`®loc_m©rix
(0, 
num_»giÚs
 - 1, 0,

5018 
num_»giÚs
 - 1,

5019 (
¶aû_»giÚ_t
));

5021 
¶aû_»giÚ_y
 =

5022 (
¶aû_»giÚ_t
**)
	`®loc_m©rix
(0, 
num_»giÚs
 - 1, 0,

5023 
num_»giÚs
 - 1,

5024 (
¶aû_»giÚ_t
));

5026 
¶aû_»giÚ_bounds_x
 = (*)
	`my_m®loc
((
num_»giÚs
 + 1) *

5029 
¶aû_»giÚ_bounds_y
 = (*)
	`my_m®loc
((
num_»giÚs
 + 1) *

5031 
	}
}

5035 
	$lßd_¶aû_»giÚs
(
num_»giÚs
)

5038 
i
, 
j
, 
low_block
, 
high_block
, 
ºum
;

5039 
low_lim
, 
high_lim
, 
ÿ·c™y
, 
çc
, 
block_ÿ·c™y
;

5040 
Ën_çc
, 
height_çc
;

5043 
j
 = 0; j < 
num_»giÚs
; j++) {

5044 
ÿ·c™y
 = 0.;

5045 
low_lim
 = ()
j
 / ()
num_»giÚs
 * 
num_grid_rows
 + 1.;

5046 
high_lim
 = ()(
j
 + 1è/ ()
num_»giÚs
 * 
num_grid_rows
;

5048 
low_block
 = 
	`æoÜ
(
low_lim
);

5049 
low_block
 = 
	`max
(1,†ow_block);

5050 
high_block
 = 
	`û
(
high_lim
);

5051 
high_block
 = 
	`mš
(high_block, 
num_grid_rows
);

5053 
block_ÿ·c™y
 = (
chª_width_x
[
low_block
 - 1] +

5054 
chª_width_x
[
low_block
]) / 2.;

5056 ià(
low_block
 == 1) {

5057 
block_ÿ·c™y
 +ğ
chª_width_x
[0] / 2.;

5060 
çc
 = 1. - (
low_lim
 - 
low_block
);

5061 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

5063 
ºum
 = 
low_block
 + 1;„num < 
high_block
;„num++) {

5064 
block_ÿ·c™y
 =

5065 (
chª_width_x
[
ºum
 - 1] + chan_width_x[rnum]) / 2.;

5066 
ÿ·c™y
 +ğ
block_ÿ·c™y
;

5069 
block_ÿ·c™y
 = (
chª_width_x
[
high_block
 - 1] +

5070 
chª_width_x
[
high_block
]) / 2.;

5072 ià(
high_block
 =ğ
num_grid_rows
) {

5073 
block_ÿ·c™y
 +ğ
chª_width_x
[
num_grid_rows
] / 2.;

5076 
çc
 = 1. - (
high_block
 - 
high_lim
);

5077 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

5079 
i
 = 0; i < 
num_»giÚs
; i++) {

5080 
¶aû_»giÚ_x
[
i
][
j
].
ÿ·c™y
 = capacity;

5081 
¶aû_»giÚ_x
[
i
][
j
].
šv_ÿ·c™y
 = 1. / 
ÿ·c™y
;

5082 
¶aû_»giÚ_x
[
i
][
j
].
occu·ncy
 = 0.;

5083 
¶aû_»giÚ_x
[
i
][
j
].
co¡
 = 0.;

5088 
i
 = 0; i < 
num_»giÚs
; ++i) {

5089 
ÿ·c™y
 = 0.;

5090 
low_lim
 = ()
i
 / ()
num_»giÚs
 * 
num_grid_cŞumns
 + 1.;

5091 
high_lim
 = ()(
i
 + 1è/ ()
num_»giÚs
 * 
num_grid_cŞumns
;

5093 
low_block
 = 
	`æoÜ
(
low_lim
);

5094 
low_block
 = 
	`max
(1,†ow_block);

5095 
high_block
 = 
	`û
(
high_lim
);

5096 
high_block
 = 
	`mš
(high_block, 
num_grid_cŞumns
);

5098 
block_ÿ·c™y
 = (
chª_width_y
[
low_block
 - 1] +

5099 
chª_width_y
[
low_block
]) / 2.;

5101 ià(
low_block
 == 1) {

5102 
block_ÿ·c™y
 +ğ
chª_width_y
[0] / 2.;

5105 
çc
 = 1. - (
low_lim
 - 
low_block
);

5106 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

5108 
ºum
 = 
low_block
 + 1;„num < 
high_block
;„num++) {

5109 
block_ÿ·c™y
 = (
chª_width_y
[
ºum
 - 1] + chan_width_y[rnum]) / 2.;

5110 
ÿ·c™y
 +ğ
block_ÿ·c™y
;

5113 
block_ÿ·c™y
 = (
chª_width_y
[
high_block
 - 1] + chan_width_y[high_block]) / 2.;

5115 ià(
high_block
 =ğ
num_grid_cŞumns
) {

5116 
block_ÿ·c™y
 +ğ
chª_width_y
[
num_grid_cŞumns
] / 2.;

5119 
çc
 = 1. - (
high_block
 - 
high_lim
);

5120 
ÿ·c™y
 +ğ
çc
 * 
block_ÿ·c™y
;

5122 
j
 = 0; j < 
num_»giÚs
; j++) {

5123 
¶aû_»giÚ_y
[
i
][
j
].
ÿ·c™y
 = capacity;

5124 
¶aû_»giÚ_y
[
i
][
j
].
šv_ÿ·c™y
 = 1. / 
ÿ·c™y
;

5125 
¶aû_»giÚ_y
[
i
][
j
].
occu·ncy
 = 0.;

5126 
¶aû_»giÚ_y
[
i
][
j
].
co¡
 = 0.;

5132 
Ën_çc
 = ()
num_grid_cŞumns
 / ()
num_»giÚs
;

5133 
height_çc
 = ()
num_grid_rows
 / ()
num_»giÚs
;

5135 
¶aû_»giÚ_bounds_x
[0] = 0.5;

5136 
¶aû_»giÚ_bounds_y
[0] = 0.5;

5138 
i
 = 1; i <ğ
num_»giÚs
; i++) {

5139 
¶aû_»giÚ_bounds_x
[
i
] =…Ïû_»giÚ_bounds_x[˜- 1] + 
Ën_çc
;

5140 
¶aû_»giÚ_bounds_y
[
i
] =

5141 
¶aû_»giÚ_bounds_y
[
i
 - 1] + 
height_çc
;

5143 
	}
}

5147 
	$ä“_unique_pš_li¡
()

5149 
ªy_dup
 = 0;

5151 
š‘
;

5152 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

5153 ià(
du¶iÿ‹_pšs
[
š‘
] != 0) {

5154 
	`ä“
(
unique_pš_li¡
[
š‘
]);

5155 
ªy_dup
 = 1;

5159 ià(
ªy_dup
 != 0) {

5160 
	`ä“
(
unique_pš_li¡
);

5163 
	`ä“
(
du¶iÿ‹_pšs
);

5164 
	}
}

5172 
	$®loc_ªd_lßd_unique_pš_li¡
()

5174 
du¶iÿ‹_pšs
 = (*)
	`my_ÿÎoc
(
num_Ãts
,

5178 * 
times_li¡ed
 = (*)
	`my_ÿÎoc
(
num_blocks
,

5180 
ªy_dups
 = 0;

5182 
š‘
 = -1;

5183 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

5184 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

5185 
num_dup
 = 0;

5187 
š
 = -1;

5188 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

5190 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

5191 ++
times_li¡ed
[
block_num
];

5192 ià(
times_li¡ed
[
block_num
] > 1) {

5193 ++
num_dup
;

5197 ià(
num_dup
 > 0) {

5199 
du¶iÿ‹_pšs
[
š‘
] = 
num_dup
;

5200 ià(
ªy_dups
 == 0) {

5202 
unique_pš_li¡
 = (**)
	`my_ÿÎoc
(
num_Ãts
,

5204 
ªy_dups
 = 1;

5207 
unique_pš_li¡
[
š‘
] = (*)
	`my_m®loc
((
knum_Ãt_pšs
 - 
num_dup
)

5210 
off£t
 = 0;

5211 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

5212 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

5215 ià(
times_li¡ed
[
block_num
] != 0) {

5216 
times_li¡ed
[
block_num
] = 0;

5217 
unique_pš_li¡
[
š‘
][
off£t
] = 
block_num
;

5218 ++
off£t
;

5223 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

5224 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

5225 
times_li¡ed
[
block_num
] = 0;

5230 
	`ä“
(
times_li¡ed
);

5231 
times_li¡ed
 = 
NULL
;

5232 
	}
}

5239 
	$g‘_bb_äom_sü©ch
(
š‘
,

5240 
bbox_t
* 
coÜds
,

5241 
bbox_t
* 
num_Ú_edges
)

5243 
n_pšs
;

5244 * 
¶i¡
;

5248 ià(
du¶iÿ‹_pšs
[
š‘
] == 0) {

5249 
¶i¡
 = 
Ãt
[
š‘
].
node_blocks
;

5250 
n_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
 + 1;

5252 
¶i¡
 = 
unique_pš_li¡
[
š‘
];

5253 
n_pšs
 = (
Ãt
[
š‘
].
num_Ãt_pšs
 + 1è- 
du¶iÿ‹_pšs
[inet];

5256 
x
 = 
blocks
[
¶i¡
[0]].x;

5257 
y
 = 
blocks
[
¶i¡
[0]].y;

5258 
x
 = 
	`max
(
	`mš
(x, 
num_grid_cŞumns
), 1);

5259 
y
 = 
	`max
(
	`mš
(y, 
num_grid_rows
), 1);

5261 
xmš
 = 
x
;

5262 
ymš
 = 
y
;

5263 
xmax
 = 
x
;

5264 
ymax
 = 
y
;

5265 
xmš_edge
 = 1;

5266 
ymš_edge
 = 1;

5267 
xmax_edge
 = 1;

5268 
ymax_edge
 = 1;

5270 
š
, 
block_num
;

5271 
š
 = 1; ipš < 
n_pšs
; ++ipin) {

5272 
block_num
 = 
¶i¡
[
š
];

5273 
x
 = 
blocks
[
block_num
].x;

5274 
y
 = 
blocks
[
block_num
].y;

5282 
x
 = 
	`max
(
	`mš
(x, 
num_grid_cŞumns
), 1);

5283 ià(
x
 =ğ
xmš
) {

5284 
xmš_edge
++;

5287 ià(
x
 =ğ
xmax
) {

5289 
xmax_edge
++;

5290 } ià(
x
 < 
xmš
) {

5291 
xmš
 = 
x
;

5292 
xmš_edge
 = 1;

5293 } ià(
x
 > 
xmax
) {

5294 
xmax
 = 
x
;

5295 
xmax_edge
 = 1;

5298 
y
 = 
	`max
(
	`mš
(y, 
num_grid_rows
), 1);

5299 ià(
y
 =ğ
ymš
) {

5300 
ymš_edge
++;

5303 ià(
y
 =ğ
ymax
) {

5304 
ymax_edge
++;

5305 } ià(
y
 < 
ymš
) {

5306 
ymš
 = 
y
;

5307 
ymš_edge
 = 1;

5308 } ià(
y
 > 
ymax
) {

5309 
ymax
 = 
y
;

5310 
ymax_edge
 = 1;

5316 
coÜds
->
xmš
 = xmin;

5317 
coÜds
->
xmax
 = xmax;

5318 
coÜds
->
ymš
 = ymin;

5319 
coÜds
->
ymax
 = ymax;

5321 
num_Ú_edges
->
xmš
 = 
xmš_edge
;

5322 
num_Ú_edges
->
xmax
 = 
xmax_edge
;

5323 
num_Ú_edges
->
ymš
 = 
ymš_edge
;

5324 
num_Ú_edges
->
ymax
 = 
ymax_edge
;

5325 
	}
}

5330 
	$g‘_Ãt_wœ–’gth_e¡im©e
(
š‘
,

5331 
bbox_t
* 
bb±r
)

5333 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

5334 
nco¡
, 
üossšg
;

5337 ià((
knum_Ãt_pšs
 > 50) && (knum_net_pins < 85)) {

5338 
üossšg
 = 2.7933 + 0.02616 * (
knum_Ãt_pšs
 - 50);

5339 } ià(
knum_Ãt_pšs
 >= 85) {

5340 
üossšg
 = 2.7933 + 0.011 * 
knum_Ãt_pšs
 -

5341 0.0000018 * 
knum_Ãt_pšs
 * knum_net_pins;

5343 
üossšg
 = 
üoss_couÁ
[
knum_Ãt_pšs
 - 1];

5352 
nco¡
 = (
bb±r
->
xmax
 - bb±r->
xmš
 + 1è* 
üossšg
;

5353 
nco¡
 +ğ(
bb±r
->
ymax
 - bb±r->
ymš
 + 1è* 
üossšg
;

5355  (
nco¡
);

5356 
	}
}

5360 
	$g‘_Ãt_co¡
(
š‘
,

5361 
bbox_t
* 
bbox_±r
)

5365 
üossšg
 = 0.0;

5366 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

5367 ià(
knum_Ãt_pšs
 > 50) {

5369 
üossšg
 = 2.7933 + 0.02616 * (
knum_Ãt_pšs
 - 50);

5371 
üossšg
 = 
üoss_couÁ
[
knum_Ãt_pšs
 - 1];

5380 cÚ¡ 
xmš
 = 
bbox_±r
->xmin;

5381 cÚ¡ 
xmax
 = 
bbox_±r
->xmax;

5382 cÚ¡ 
ymš
 = 
bbox_±r
->ymin;

5383 cÚ¡ 
ymax
 = 
bbox_±r
->ymax;

5384 
	`as£¹
((
xmš
 >ğ0 && xmš <ğ
num_grid_cŞumns
 + 1è&& (
xmax
 >= 0 &&

5385 
xmax
 <ğ
num_grid_cŞumns
 + 1));

5386 
	`as£¹
((
ymš
 >ğ0 && ymš <ğ
num_grid_rows
 + 1è&& (
ymax
 >= 0 &&

5387 
ymax
 <ğ
num_grid_rows
 + 1));

5389 
Ãt_co¡
 = (
xmax
 - 
xmš
 + 1è* 
üossšg
 *

5390 
chªx_¶aû_co¡_çc
[
ymax
][
ymš
-1];

5391 
Ãt_co¡
 +ğ(
ymax
 - 
ymš
 + 1è* 
üossšg
 *

5392 
chªy_¶aû_co¡_çc
[
xmax
][
xmš
-1];

5394  
Ãt_co¡
;

5395 
	}
}

5404 
	$g‘_nÚ_upd©—bË_bb
(
š‘
,

5405 
bbox_t
* 
bb_coÜd_Ãw
)

5408 
x
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[0]].x;

5409 
y
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[0]].y;

5412 
xmš
 = 
x
;

5413 
ymš
 = 
y
;

5414 
xmax
 = 
x
;

5415 
ymax
 = 
y
;

5416 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

5417 
k
 = 0;

5418 
k
 = 1; k < 
knum_Ãt_pšs
; ++k) {

5419 
x
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[
k
]].x;

5420 
y
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[
k
]].y;

5422 ià(
x
 < 
xmš
) {

5423 
xmš
 = 
x
;

5424 } ià(
x
 > 
xmax
) {

5425 
xmax
 = 
x
;

5428 ià(
y
 < 
ymš
) {

5429 
ymš
 = 
y
;

5430 } ià(
y
 > 
ymax
) {

5431 
ymax
 = 
y
;

5441 
bb_coÜd_Ãw
->
xmš
 = 
	`max
(
	`mš
(xmš, 
num_grid_cŞumns
), 1);

5442 
bb_coÜd_Ãw
->
ymš
 = 
	`max
(
	`mš
(ymš, 
num_grid_rows
), 1);

5443 
bb_coÜd_Ãw
->
xmax
 = 
	`max
(
	`mš
(xmax, 
num_grid_cŞumns
), 1);

5444 
bb_coÜd_Ãw
->
ymax
 = 
	`max
(
	`mš
(ymax, 
num_grid_rows
), 1);

5445 
	}
}

5457 
	$upd©e_bb
(
š‘
,

5458 
bbox_t
* 
bb_coÜd_Ãw
,

5459 
bbox_t
* 
bb_edge_Ãw
,

5460 
xŞd
, 
yŞd
,

5461 
xÃw
, 
yÃw
)

5464 
xÃw
 = 
	`max
(
	`mš
(xÃw, 
num_grid_cŞumns
), 1);

5465 
yÃw
 = 
	`max
(
	`mš
(yÃw, 
num_grid_rows
), 1);

5466 
xŞd
 = 
	`max
(
	`mš
(xŞd, 
num_grid_cŞumns
), 1);

5467 
yŞd
 = 
	`max
(
	`mš
(yŞd, 
num_grid_rows
), 1);

5470 ià(
xÃw
 < 
xŞd
) {

5473 ià(
xŞd
 =ğ
bb_coÜds
[
š‘
].
xmax
) {

5475 ià(
bb_num_Ú_edges
[
š‘
].
xmax
 == 1) {

5476 
	`g‘_bb_äom_sü©ch
(
š‘
,

5477 
bb_coÜd_Ãw
,

5478 
bb_edge_Ãw
);

5481 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax - 1;

5482 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

5486 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

5487 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax;

5491 ià(
xÃw
 < 
bb_coÜds
[
š‘
].
xmš
) {

5493 
bb_coÜd_Ãw
->
xmš
 = 
xÃw
;

5494 
bb_edge_Ãw
->
xmš
 = 1;

5495 } ià(
xÃw
 =ğ
bb_coÜds
[
š‘
].
xmš
) {

5497 
bb_coÜd_Ãw
->
xmš
 = 
xÃw
;

5498 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin + 1;

5501 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

5502 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin;

5505 } ià(
xÃw
 > 
xŞd
) {

5508 ià(
xŞd
 =ğ
bb_coÜds
[
š‘
].
xmš
) {

5510 ià(
bb_num_Ú_edges
[
š‘
].
xmš
 == 1) {

5511 
	`g‘_bb_äom_sü©ch
(
š‘
,

5512 
bb_coÜd_Ãw
,

5513 
bb_edge_Ãw
);

5516 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin - 1;

5517 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

5521 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

5522 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin;

5526 ià(
xÃw
 > 
bb_coÜds
[
š‘
].
xmax
) {

5528 
bb_coÜd_Ãw
->
xmax
 = 
xÃw
;

5529 
bb_edge_Ãw
->
xmax
 = 1;

5530 } ià(
xÃw
 =ğ
bb_coÜds
[
š‘
].
xmax
) {

5532 
bb_coÜd_Ãw
->
xmax
 = 
xÃw
;

5533 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax + 1;

5536 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

5537 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax;

5542 
bb_coÜd_Ãw
->
xmš
 = 
bb_coÜds
[
š‘
].xmin;

5543 
bb_coÜd_Ãw
->
xmax
 = 
bb_coÜds
[
š‘
].xmax;

5544 
bb_edge_Ãw
->
xmš
 = 
bb_num_Ú_edges
[
š‘
].xmin;

5545 
bb_edge_Ãw
->
xmax
 = 
bb_num_Ú_edges
[
š‘
].xmax;

5549 ià(
yÃw
 < 
yŞd
) {

5552 ià(
yŞd
 =ğ
bb_coÜds
[
š‘
].
ymax
) {

5554 ià(
bb_num_Ú_edges
[
š‘
].
ymax
 == 1) {

5555 
	`g‘_bb_äom_sü©ch
(
š‘
,

5556 
bb_coÜd_Ãw
,

5557 
bb_edge_Ãw
);

5560 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax - 1;

5561 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

5565 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

5566 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax;

5570 ià(
yÃw
 < 
bb_coÜds
[
š‘
].
ymš
) {

5572 
bb_coÜd_Ãw
->
ymš
 = 
yÃw
;

5573 
bb_edge_Ãw
->
ymš
 = 1;

5574 } ià(
yÃw
 =ğ
bb_coÜds
[
š‘
].
ymš
) {

5576 
bb_coÜd_Ãw
->
ymš
 = 
yÃw
;

5577 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin + 1;

5580 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

5581 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin;

5584 } ià(
yÃw
 > 
yŞd
) {

5587 ià(
yŞd
 =ğ
bb_coÜds
[
š‘
].
ymš
) {

5589 ià(
bb_num_Ú_edges
[
š‘
].
ymš
 == 1) {

5590 
	`g‘_bb_äom_sü©ch
(
š‘
,

5591 
bb_coÜd_Ãw
,

5592 
bb_edge_Ãw
);

5595 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin - 1;

5596 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

5600 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

5601 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin;

5605 ià(
yÃw
 > 
bb_coÜds
[
š‘
].
ymax
) {

5607 
bb_coÜd_Ãw
->
ymax
 = 
yÃw
;

5608 
bb_edge_Ãw
->
ymax
 = 1;

5609 } ià(
yÃw
 =ğ
bb_coÜds
[
š‘
].
ymax
) {

5611 
bb_coÜd_Ãw
->
ymax
 = 
yÃw
;

5612 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax + 1;

5615 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

5616 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax;

5621 
bb_coÜd_Ãw
->
ymš
 = 
bb_coÜds
[
š‘
].ymin;

5622 
bb_coÜd_Ãw
->
ymax
 = 
bb_coÜds
[
š‘
].ymax;

5623 
bb_edge_Ãw
->
ymš
 = 
bb_num_Ú_edges
[
š‘
].ymin;

5624 
bb_edge_Ãw
->
ymax
 = 
bb_num_Ú_edges
[
š‘
].ymax;

5626 
	}
}

5629 
	$š™Ÿl_¶aûm’t
(
·d_loc_t
 
·d_loc_ty³
,

5630 * 
·d_loc_fe
)

5633 
pos
 = (
s_pos
**)
	`my_m®loc
(
g_num_grid_ty³s
 * (s_pos*));

5635 * 
ava_diff_ty³_grids
 = (*)
	`my_ÿÎoc
(
g_num_grid_ty³s
, ());

5637 
i
, 
j
, 
k
, 
iblk
;

5638 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

5639 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

5640 
bš_grids
[
i
][
j
].
m_u§ge
 = 0;

5642 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

5643 
k
 = 0; k < 
kbš_ÿ·c™y
; ++k) {

5644 
bš_grids
[
i
][
j
].
š_blocks
[
k
] = 
EMPTY
;

5645 ià(
bš_grids
[
i
][
j
].
m_off£t
 == 0) {

5646 ++
ava_diff_ty³_grids
[
bš_grids
[
i
][
j
].
grid_ty³
];

5652 
i
 = 0; i < 
g_num_grid_ty³s
; ++i) {

5653 
pos
[
i
] = (
s_pos
*)
	`my_m®loc
(
ava_diff_ty³_grids
[i]

5654 * (
s_pos
));

5657 * 
šdex
 = (*)
	`my_ÿÎoc
(
g_num_grid_ty³s
, ());

5658 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

5659 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

5660 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

5661 
k
 = 0; k < 
kbš_ÿ·c™y
; ++k) {

5662 ià(
bš_grids
[
i
][
j
].
m_off£t
 == 0) {

5663 
ty³_šdex
 = 
bš_grids
[
i
][
j
].
grid_ty³
;

5664 
pos
[
ty³_šdex
][
šdex
[ty³_šdex]].
x
 = 
i
;

5665 
pos
[
ty³_šdex
][
šdex
[ty³_šdex]].
y
 = 
j
;

5666 
pos
[
ty³_šdex
][
šdex
[ty³_šdex]].
z
 = 
k
;

5667 ++
šdex
[
ty³_šdex
];

5674 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

5676 ià(!((
blocks
[
iblk
].
block_ty³
 =ğ
INPAD_TYPE


5677 || 
blocks
[
iblk
].
block_ty³
 =ğ
OUTPAD_TYPE
)

5678 && 
·d_loc_ty³
 =ğ
USER
)) {

5679 
block_ty³s_t
 
ty³_šdex
 = 
blocks
[
iblk
].
block_ty³
;

5680 ià(
ty³_šdex
 =ğ
INPAD_TYPE
 ||y³_šdex =ğ
OUTPAD_TYPE
) {

5681 
ty³_šdex
 = 
IO_TYPE
;

5683 
	`as£¹
(
ava_diff_ty³_grids
[
ty³_šdex
] > 0);

5685 
choiû
 = 
	`my_œªd
(
ava_diff_ty³_grids
[
ty³_šdex
] - 1);

5686 
x
 = 
pos
[
ty³_šdex
][
choiû
].x;

5687 
y
 = 
pos
[
ty³_šdex
][
choiû
].y;

5688 
z
 = 
pos
[
ty³_šdex
][
choiû
].z;

5689 
bš_grids
[
x
][
y
].
š_blocks
[
z
] = 
iblk
;

5690 ++
bš_grids
[
x
][
y
].
m_u§ge
;

5694 
pos
[
ty³_šdex
][
choiû
] =

5695 
pos
[
ty³_šdex
][
ava_diff_ty³_grids
[type_index] - 1];

5696 --
ava_diff_ty³_grids
[
ty³_šdex
];

5700 ià(
·d_loc_ty³
 =ğ
USER
) {

5701 
	`»ad_u£r_·d_loc
(
·d_loc_fe
);

5706 
i
 = 0; i <ğ(
num_grid_cŞumns
 + 1); ++i) {

5707 
j
 = 0; j <ğ(
num_grid_rows
 + 1); ++j) {

5708 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

5709 
k
 = 0; k < 
kbš_ÿ·c™y
; ++k) {

5710 
	`as£¹
(
bš_grids
[
i
][
j
].
š_blocks
 !ğ
NULL
);

5712 
iblk
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

5713 ià(
iblk
 !ğ
EMPTY
) {

5714 
blocks
[
iblk
].
x
 = 
i
;

5715 
blocks
[
iblk
].
y
 = 
j
;

5716 
blocks
[
iblk
].
z
 = 
k
;

5722 #ifdeà
VERBOSE


5723 
	`´štf
("Atƒnd of initial_placement.\n");

5724 
	`dump_şbs
();

5727 
i
 = 0; i < 
g_num_grid_ty³s
; ++i) {

5728 
	`ä“
(
pos
[
i
]);

5731 
	`ä“
(
pos
);

5732 
	`ä“
(
šdex
);

5733 
	`ä“
(
ava_diff_ty³_grids
);

5734 
	}
}

5738 
	$ä“_ç¡_co¡_upd©e_¡ruùs
()

5740 
i
;

5741 
i
 = 0; i <ğ
num_grid_rows
; i++) {

5742 
	`ä“
(
chªx_¶aû_co¡_çc
[
i
]);

5745 
	`ä“
(
chªx_¶aû_co¡_çc
);

5747 
i
 = 0; i <ğ
num_grid_cŞumns
; i++) {

5748 
	`ä“
(
chªy_¶aû_co¡_çc
[
i
]);

5751 
	`ä“
(
chªy_¶aû_co¡_çc
);

5752 
	}
}

5765 
	$®loc_ªd_lßd_fÜ_ç¡_co¡_upd©e
(
¶aû_co¡_exp
)

5770 
low
, 
high
, 
i
;

5771 
chªx_¶aû_co¡_çc
 = (**)
	`my_m®loc
((
num_grid_rows
 + 1) * (*));

5772 
i
 = 0; i <ğ
num_grid_rows
; i++) {

5773 
chªx_¶aû_co¡_çc
[
i
] = (*)
	`my_m®loc
((i + 1) * ());

5776 
chªy_¶aû_co¡_çc
 = (**)
	`my_m®loc
((
num_grid_cŞumns
 + 1) * (*));

5777 
i
 = 0; i <ğ
num_grid_cŞumns
; i++) {

5778 
chªy_¶aû_co¡_çc
[
i
] = (*)
	`my_m®loc
((i + 1) * ());

5784 
chªx_¶aû_co¡_çc
[0][0] = 
chª_width_x
[0];

5785 
high
 = 1; high <ğ
num_grid_rows
; high++) {

5786 
chªx_¶aû_co¡_çc
[
high
][high] = 
chª_width_x
[high];

5788 
low
 = 0;†ow < 
high
;†ow++) {

5789 
chªx_¶aû_co¡_çc
[
high
][
low
] =

5790 
chªx_¶aû_co¡_çc
[
high
 - 1][
low
] + 
chª_width_x
[high];

5801 
high
 = 0; high <ğ
num_grid_rows
; high++)

5802 
low
 = 0;†ow <ğ
high
;†ow++) {

5803 
chªx_¶aû_co¡_çc
[
high
][
low
] = (high -†ow + 1.) /

5804 
chªx_¶aû_co¡_çc
[
high
][
low
];

5805 
chªx_¶aû_co¡_çc
[
high
][
low
] =

5806 
	`pow
(()
chªx_¶aû_co¡_çc
[
high
][
low
],

5807 ()
¶aû_co¡_exp
);

5812 
chªy_¶aû_co¡_çc
[0][0] = 
chª_width_y
[0];

5813 
high
 = 1; high <ğ
num_grid_cŞumns
; high++) {

5814 
chªy_¶aû_co¡_çc
[
high
][high] = 
chª_width_y
[high];

5816 
low
 = 0;†ow < 
high
;†ow++) {

5817 
chªy_¶aû_co¡_çc
[
high
][
low
] =

5818 
chªy_¶aû_co¡_çc
[
high
 - 1][
low
] + 
chª_width_y
[high];

5824 
high
 = 0; high <ğ
num_grid_cŞumns
; high++)

5825 
low
 = 0;†ow <ğ
high
;†ow++) {

5826 
chªy_¶aû_co¡_çc
[
high
][
low
] = (high -†ow + 1.) /

5827 
chªy_¶aû_co¡_çc
[
high
][
low
];

5828 
chªy_¶aû_co¡_çc
[
high
][
low
] =

5829 
	`pow
(()
chªy_¶aû_co¡_çc
[
high
][
low
],

5830 ()
¶aû_co¡_exp
);

5832 
	}
}

5839 
	$check_¶aû
(
bb_co¡
,

5840 
timšg_co¡
,

5841 
¶aû_co¡_ty³
,

5842 
num_»giÚs
,

5843 
¶aû_®gÜ™hm_t
 
¶aû_®gÜ™hm
,

5844 
d–ay_co¡
)

5846 
”rÜ
 = 0;

5847 
bb_co¡_check
 = 
	`comp_bb_co¡
(
CHECK
, 
¶aû_co¡_ty³
, 
num_»giÚs
);

5848 
	`´štf
("bb_co¡„ecompu‹d from sü©ch i %g.\n", 
bb_co¡_check
);

5849 ià(
	`çbs
(
bb_co¡_check
 - 
bb_co¡
è> bb_co¡ * 
ERROR_TOL
) {

5850 
	`´štf
("Error: bb_cost_check: %g‡nd bb_cost: %g differ in check_place.\n",

5851 
bb_co¡_check
, 
bb_co¡
);

5852 ++
”rÜ
;

5883 
i
, 
j
, 
k
, 
block_num
;

5884 * 
bdÚe
;

5885 
bdÚe
 = (*)
	`my_m®loc
(
num_blocks
 * ());

5886 
i
 = 0; i < 
num_blocks
; i++) {

5887 
bdÚe
[
i
] = 0;

5890 
u§ge_check
 = 0;

5892 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

5893 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

5894 cÚ¡ 
kbš_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

5895 ià(
bš_grids
[
i
][
j
].
m_u§ge
 > 
kbš_ÿ·c™y
) {

5896 
	`´štf
("Error: blocks‡t bin_grids†ocation (%d,%d) overused. "

5897 "U§gi %d\n", 
i
, 
j
, 
bš_grids
[i][j].
m_u§ge
);

5898 ++
”rÜ
;

5901 
u§ge_check
 = 0;

5902 
k
 = 0; k < 
kbš_ÿ·c™y
; ++k) {

5903 
block_num
 = 
bš_grids
[
i
][
j
].
š_blocks
[
k
];

5904 ià(
EMPTY
 =ğ
block_num
) {

5908 cÚ¡ 
block_ty³s_t
 
kblock_ty³
 = 
blocks
[
block_num
].
block_ty³
;

5909 cÚ¡ 
block_ty³s_t
 
kgrid_ty³
 = 
bš_grids
[
i
][
j
].
grid_ty³
;

5910 ià((
INPAD_TYPE
 =ğ
kblock_ty³
 || 
OUTPAD_TYPE
 == kblock_type)

5911 && 
IO_TYPE
 =ğ
kgrid_ty³
) {

5913 } ià((
B_CLB_TYPE
 !ğ
kblock_ty³
)

5914 && (
B_CLB_TYPE
 =ğ
kgrid_ty³
)) {

5915 
	`´štf
("Error: blocks[%d]ype does‚ot match bin[%d][%d]ype.\n\n",

5916 
block_num
, 
i
, 
j
);

5917 ++
”rÜ
;

5922 ià((
blocks
[
block_num
].
x
 !ğ
i
è|| (blocks[block_num].
y
 !ğ
j
)

5923 || (
blocks
[
block_num
].
z
 !ğ
k
)) {

5924 
	`´štf
("Error: blocks[%d](%d,%d,%d) coord conflicts with bin[%d][%d][%d].\n",

5925 
block_num
, 
blocks
[block_num].
x
, blocks[block_num].
y
,

5926 
blocks
[
block_num
].
z
, 
i
, 
j
, 
k
);

5927 ++
”rÜ
;

5930 ++
u§ge_check
;

5931 
bdÚe
[
block_num
]++;

5934 ià(
u§ge_check
 !ğ
bš_grids
[
i
][
j
].
m_u§ge
) {

5935 
	`´štf
("Error: bin[%d][%d] usage is %d, but has‡ctual usage %d.\n",

5936 
i
, 
j
, 
bš_grids
[i][j].
m_u§ge
, 
u§ge_check
);

5942 
i
 = 0; i < 
num_blocks
; ++i)

5943 ià(
bdÚe
[
i
] != 1) {

5944 
	`´štf
("Error: block %d†isted %dimes in data structures.\n",

5945 
i
, 
bdÚe
[i]);

5946 
”rÜ
++;

5949 
	`ä“
(
bdÚe
);

5951 ià(
”rÜ
 == 0) {

5952 
	`´štf
("\nCompleted…lacement consistency check successfully.\n\n");

5953 #ifdeà
PRINT_REL_POS_DISTR


5954 
	`´št_»Ïtive_pos_di¡r
();

5957 
	`´štf
("\nCompleted…lacement consistency check, %d Errors found.\n\n",

5958 
”rÜ
);

5959 
	`´štf
("Aborting…rogram.\n");

5963  
bb_co¡_check
;

5964 
	}
}

	@place_parallel.h

1 #iâdeà
PLACE_PARALLEL_H


2 
	#PLACE_PARALLEL_H


	)

4 
	~"v´_ty³s.h
"

20 
	s¡¬t_fšish_Ãts
 {

21 
	m¡¬t_edge
, 
	mfšish_edge
, 
	m¡¬t_sšks
, 
	mfšish_sšks
;

22 
	medge_·¹™iÚ_size
, 
	msšk_·¹™iÚ_size
, 
	mcouÁ”_edge
, 
	mcouÁ”_sšk
;

23 
	medges_š_this_·¹™iÚ
;

24 
	msšks_š_this_·¹™iÚ
;

25 } 
	g¡¬t_fšish_Ãts
[
NUM_OF_THREADS
] 
__©Œibu‹__
 ((
®igÃd
(64)));

30 
	ss_loÿl_block
 {

32 
	mx
;

33 
	my
;

35 
	mz
;

36 } 
	tloÿl_block_t
;

39 
	s®igÃd_b¬
 {

40 vŞ©
	m¬rived
;

41 
	m’Œy
;

42 vŞ©
	m´oûed
;

43 } 
	t__©Œibu‹__
((
	t®igÃd
(64))è
	t®igÃd_b¬_t
;

45 
	s®igÃd_ÃighbÜ_b¬
 {

46 vŞ©
¬rived
[4];

47 } 
	t__©Œibu‹__
((
	t®igÃd
(64))è
	t®igÃd_ÃighbÜ_b¬_t
;

50 
	s±h»ad_d©a
 {

51 
th»ad_id
;

54 
y_¡¬t
, 
y_’d
, 
x_¡¬t
, 
x_’d
;

55 
boŞ—n
 
fixed_pšs
;

56 * 
t
;

57 
¶aûr_İts_t
 
¶aûr_İts
;

58 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
;

59 * 
sucûss_sum
, *
move_lim
, *
tÙ_™”
;

60 * 
šÃr_™”_num
;

61 * 
av_co¡
, *
av_bb_co¡
, *
av_timšg_co¡
, *
av_d–ay_co¡
, *
sum_of_squ¬es
;

62 * 
timšg_co¡
, *
d–ay_co¡
;

63 * 
šv”£_´ev_bb_co¡
;

64 * 
šv”£_´ev_timšg_co¡
;

65 * 
co¡
, *
bb_co¡
, *
sucûss_¿t
, *
¡d_dev
;

66 * 
max_d–ay
;

67 * 
num_cÚÃùiÚs
;

68 * 
¶aû_d–ay_v®ue
;

69 ** 
Ãt_¦ack
;

70 ** 
Ãt_d–ay
;

71 * 
ü™_expÚ’t
;

72 * 
ex™
;

73 * 
¿nge_lim™
;

74 * 
m_´ob
;

77 
¿ndom_num_
;

80 
¶aûd_sub_»giÚs
;

81 } 
	t__©Œibu‹__
((
	t®igÃd
(64))è
	t±h»ad_d©a_t
;

87 
	ss_th»ad_loÿl_commÚ_·¿s
 {

88 
¶aûr_İts_t
 
loÿl_¶aûr_İts
;

89 
boŞ—n
 
loÿl_fixed_pšs
;

91 
loÿl_th»ad_id
;

93 
loÿl_x_¡¬t
;

94 
loÿl_x_’d
;

95 
loÿl_y_¡¬t
;

96 
loÿl_y_’d
;

98 
loÿl_»giÚ_x_bound¬y
[3];

99 
loÿl_»giÚ_y_bound¬y
[3];

101 
loÿl_‹m³r
;

102 
loÿl_Şd_‹m³r
;

104 
loÿl_¿nge_lim™
;

105 
loÿl_fœ¡_¾im
;

106 
loÿl_fš®_¾im
;

108 
loÿl_šv”£_d–_¾im
;

111 
loÿl_av_co¡
;

112 
loÿl_av_bb_co¡
;

113 
loÿl_av_timšg_co¡
;

114 
loÿl_av_d–ay_co¡
;

116 
loÿl_šv”£_´ev_bb_co¡
;

117 
loÿl_šv”£_´ev_timšg_co¡
;

119 
loÿl_tÙ®_co¡
;

120 
loÿl_bb_co¡
;

121 
loÿl_timšg_co¡
;

122 
loÿl_d–ay_co¡
;

124 
loÿl_num_cÚns
;

126 
loÿl_¶aû_d–ay_v®ue
;

128 
loÿl_sum_of_squ¬es
;

130 ** 
loÿl_Ãt_¦ack
;

131 ** 
loÿl_Ãt_d–ay
;

133 
loÿl_ü™_expÚ’t
;

134 
loÿl_max_d–ay
;

136 
loÿl_sucûss_sum
;

137 
loÿl_tÙ®_™”
;

139 
loÿl_sucûss_¿tio
;

140 
loÿl_¡d_dev
;

141 } 
	t__©Œibu‹__
((
	t®igÃd
(64))è
	tth»ad_loÿl_commÚ_·¿s_t
;

143 
	ss_th»ad_loÿl_d©a_fÜ_sw­
 {

144 
grid_te_t
** 
m_loÿl_grid
;

145 
loÿl_block_t
* 
m_loÿl_block
;

147 
bbox_t
* 
m_bb_coÜd_Ãw
;

148 
bbox_t
* 
m_bb_edge_Ãw
;

149 * 
m_Ãts_to_upd©e
;

150 * 
m_Ãt_block_moved
;

152 
bbox_t
* 
m_loÿl_bb_coÜd
;

153 
bbox_t
* 
m_loÿl_bb_edge
;

156 * 
m_loÿl_Ãt_co¡
;

157 * 
m_loÿl_‹mp_Ãt_co¡
;

159 ** 
m_loÿl_‹mp_pošt_to_pošt_timšg_co¡
;

160 ** 
m_loÿl_‹mp_pošt_to_pošt_d–ay_co¡
;

161 } 
	t__©Œibu‹__
((
	t®igÃd
(64))è
	tth»ad_loÿl_d©a_fÜ_sw­_t
;

173 
	s®igÃd_mu‹x
 {

174 
±h»ad_mu‹x_t
 
mu‹x
;

175 } 
	t__©Œibu‹__
((
	t®igÃd
(64))è
	t®igÃd_mu‹x_t
;

178 
®igÃd_b¬_t
 
th»ad_b¬r›rs
[
NUM_OF_THREADS
];

179 
®igÃd_mu‹x_t
 
glob®_d©a_acûss
;

182 
·¹Ÿl_timšg_»suÉs
[
NUM_OF_THREADS
];

183 
·¹Ÿl_d–ay_»suÉs
[
NUM_OF_THREADS
];

184 
·¹Ÿl_bb_»suÉs
[
NUM_OF_THREADS
];

188 
£cs
;

189 
u£cs
;

190 } 
	tTIME_DIFF
;

192 
	`Œy_¶aû_u£_muÉi_th»ads
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

193 
ªÃ®šg_sched_t
 
ªÃ®šg_sched
,

194 
chª_width_di¡r_t
 
chª_width_di¡
,

195 
rou‹r_İts_t
 
rou‹r_İts
,

196 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

197 
£gm’t_šfo_t
* 
£gm’t_šf
,

198 
timšg_šfo_t
 
timšg_šf
,

199 
subblock_d©a_t
* 
subblock_d©a_±r
);

	@print_netlist.c

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~"ut.h
"

4 
	~"v´_ty³s.h
"

5 
	~"glob®s.h
"

6 
	~"´št_Ãi¡.h
"

10 
´št_pšnum
(
FILE
* 
å
, 
pšnum
);

14 
	$´št_Ãi¡
(* 
fouut
, * 
Ãt_fe
, 
subblock_d©a_t
 
subblock_d©a
)

18 
i
, 
j
, 
š
, 
max_pš
;

19 
FILE
* 
å
 = 
	`my_fİ’
(
fouut
, "w");

20 
	`årštf
(
å
, "IÅuˆÃi¡ fe: %s\n", 
Ãt_fe
);

21 
	`årštf
(
å
, "num_primary_inputs: %d,‚um_primary_outputs: %d,‚um_clbs: %d\n",

22 
num_´im¬y_šputs
, 
num_´im¬y_ouuts
, 
num_şbs
);

23 
	`årštf
(
å
, "num_blocks: %d,‚um_nets: %d,‚um_globals: %d\n",

24 
num_blocks
, 
num_Ãts
, 
num_glob®s
);

25 
	`årštf
(
å
, "\nNet\tName\t\t#Pins\tDriver\t\tRecvs. (blocks,…in)\n");

27 
i
 = 0; i < 
num_Ãts
; ++i) {

28 
	`årštf
(
å
, "\n%d\t%s\t", 
i
, 
Ãt
[i].
Çme
);

30 ià(
	`¡¾’
(
Ãt
[
i
].
Çme
) < 8) {

31 
	`årštf
(
å
, "\t");

34 
	`årštf
(
å
, "%d", 
Ãt
[
i
].
num_Ãt_pšs
);

36 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
i
].
num_Ãt_pšs
;

37 
j
 = 0; j < 
knum_Ãt_pšs
; ++j) {

38 
	`årštf
(
å
, "\t(%4d,%4d)", 
Ãt
[
i
].
node_blocks
[
j
],

39 
Ãt
[
i
].
node_block_pšs
[
j
]);

43 
	`årštf
(
å
, "\n\n\nBlock List:\t\tBlock Type Legend:\n");

44 
	`årštf
(
å
, "\t\t\tINPAD = %d\tOUTPAD = %d\n", 
INPAD_TYPE
, 
OUTPAD_TYPE
);

45 
	`årštf
(
å
, "\t\t\tCLB = %d\n\n", 
B_CLB_TYPE
);

46 
	`årštf
(
å
, "\nBlock\tName\t\tType\tPin Connections\n\n");

48 
i
 = 0; i < 
num_blocks
; i++) {

49 
	`årštf
(
å
, "\n%d\t%s\t", 
i
, 
blocks
[i].
Çme
);

51 ià(
	`¡¾’
(
blocks
[
i
].
Çme
) < 8) {

52 
	`årštf
(
å
, "\t");

55 
	`årštf
(
å
, "%d", 
blocks
[
i
].
block_ty³
);

57 ià(
blocks
[
i
].
block_ty³
 =ğ
INPAD_TYPE
 || blocks[i].block_ty³ =ğ
OUTPAD_TYPE
) {

58 
max_pš
 = 1;

60 
max_pš
 = 
max_pšs_³r_şb
;

63 
j
 = 0; j < 
max_pš
; j++) {

64 
	`´št_pšnum
(
å
, 
blocks
[
i
].
Ãts
[
j
]);

68 
	`årštf
(
å
, "\n");

70 
subblock_lut_size
 = 
subblock_d©a
.subblock_lut_size;

71 
subblock_t
** 
subblock_šf
 = 
subblock_d©a
.subblock_inf;

72 * 
num_subblocks_³r_block
 = 
subblock_d©a
.num_subblocks_per_block;

73 
	`årštf
(
å
, "\n\nSubblock List:\n\n");

75 
i
 = 0; i < 
num_blocks
; i++) {

76 ià(
blocks
[
i
].
block_ty³
 !ğ
B_CLB_TYPE
) {

80 
	`årštf
(
å
, "\nBlock: %d (%s)\tNum_subblocks: %d\n", 
i
,

81 
blocks
[
i
].
Çme
, 
num_subblocks_³r_block
[i]);

83 
	`årštf
(
å
, "Index\tName\t\tInputs");

85 
j
 = 0; j < 
subblock_lut_size
; j++) {

86 
	`årštf
(
å
, "\t");

89 
	`årštf
(
å
, "Output\tClock\n");

93 
j
 = 0; j < 
num_subblocks_³r_block
[
i
]; j++) {

94 
	`årštf
(
å
, "%d\t%s", 
j
, 
subblock_šf
[
i
][j].
Çme
);

96 ià(
	`¡¾’
(
subblock_šf
[
i
][
j
].
Çme
) < 8) {

97 
	`årštf
(
å
, "\t");

100 
š
 = 0; ipš < 
subblock_lut_size
; ipin++) {

101 
	`´št_pšnum
(
å
, 
subblock_šf
[
i
][
j
].
šputs
[
š
]);

104 
	`´št_pšnum
(
å
, 
subblock_šf
[
i
][
j
].
ouut
);

105 
	`´št_pšnum
(
å
, 
subblock_šf
[
i
][
j
].
şock
);

106 
	`årštf
(
å
, "\n");

110 
	`fşo£
(
å
);

111 
	}
}

114 
	$´št_pšnum
(
FILE
* 
å
, 
pšnum
)

117 ià(
pšnum
 =ğ
OPEN
) {

118 
	`årštf
(
å
, "\tOPEN");

120 
	`årštf
(
å
, "\t%d", 
pšnum
);

122 
	}
}

	@print_netlist.h

1 #iâdeà
PRINT_NETLIST_H


2 
	#PRINT_NETLIST_H


	)

4 
	~"v´_ty³s.h
"

6 
´št_Ãi¡
(* 
fouut
, * 
Ãt_fe
,

7 
subblock_d©a_t
 
subblock_d©a
);

	@read_arch.c

1 
	~<¡ršg.h
>

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~<as£¹.h
>

6 
	~"ut.h
"

7 
	~"v´_ty³s.h
"

8 
	~"glob®s.h
"

9 
	~"»ad_¬ch.h
"

11 
	#NUM_GRID_TYPES
 3

	)

124 
	#NUM_REQUIRED
 8

	)

125 
	#NUM_DETAILED
 9

	)

126 
	#NUM_TIMING
 8

	)

128 
	#DETAILED_START
 
NUM_REQUIRED


	)

129 
	#TIMING_START
 (
NUM_REQUIRED
 + 
NUM_DETAILED
)

	)

132 
	#NUMINP
 (
NUM_REQUIRED
 + 
NUM_DETAILED
 + 
NUM_TIMING
)

	)

136 
	gi¤—d
[
NUMINP
];

137 cÚ¡ * 
	gÇmes
[
NUMINP
] = {"io_ratio",

155 
g‘_doubË
(* 
±r
, 
šp_num
, 
Îim
, 
ulim
,

156 
FILE
* 
å_¬ch
, * 
buf
);

158 
g‘_Úe_doubË
(* 
±r
, 
šp_num
, 
low_lim
,

159 
uµ_lim
, 
FILE
* 
å_¬ch
, * 
buf
);

161 
g‘_št
(* 
±r
, 
šp_num
, 
FILE
* 
å_¬ch
, * 
buf
,

162 
mš_v®
);

164 * 
g‘_middË_tok’
(
FILE
* 
å
, * 
buf
);

166 * 
g‘_Ï¡_tok’
(
FILE
* 
å
, * 
buf
);

168 
check_keywÜd
(
FILE
* 
å
, * 
buf
, cÚ¡ * 
keywÜd
);

170 
check_¬ch
(* 
¬ch_fe
, 
rou‹r_ty³s_t
 
rou‹_ty³
,

171 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

172 
£gm’t_šfo_t
* 
£gm’t_šf
,

173 
timšg_šfo_t
 
timšg_šf
,

174 
max_subblocks_³r_block
,

175 
chª_width_di¡r_t
 
chª_width_di¡
);

177 
fl_¬ch
();

179 
gechªÃl_t
(* 
±r
,

180 
chªÃl_t
* 
chª
,

181 
šp_num
,

182 
FILE
* 
å_¬ch
,

183 * 
buf
);

185 
g‘_pš
(* 
±r
, 
pšnum
, 
pš_ty³s_t
 
ty³
,

186 
FILE
* 
å_¬ch
, * 
buf
);

188 
e_Fc_ty³
 
g‘_Fc_ty³
(* 
±r
, 
FILE
* 
å_¬ch
, * 
buf
);

190 
sw™ch_block_t
 
g‘_sw™ch_block_ty³
(
FILE
* 
å_¬ch
,

191 * 
buf
);

193 
ge£gm’t_šfo_t
(
FILE
* 
å_¬ch
, * 
buf
,

194 
£gm’t_šfo_t
* 
£g_±r
,

195 
num_sw™ch
,

196 
rou‹r_ty³s_t
 
rou‹_ty³
);

198 
g‘_sw™ch_šf
(
FILE
* 
å_¬ch
,

199 * 
buf
,

200 
num_sw™ch
,

201 
rou‹r_ty³s_t
 
rou‹_ty³
);

203 
g‘_T_subblock
(
FILE
* 
å_¬ch
,

204 * 
buf
,

205 
T_subblock_t
* 
T_subblock
);

207 
g‘_şass
(
FILE
* 
å_¬ch
, * 
buf
);

209 
lßd_glob®_£gm’t_ªd_sw™ch
(
d‘a_routšg_¬ch_t
* 
d‘_routšg_¬ch
,

210 
£gm’t_šfo_t
* 
£gm’t_šf
,

211 
timšg_šfo_t
* 
timšg_šf
);

213 
lßd_exŒa_sw™ch_ty³s
(
d‘a_routšg_¬ch_t
* 
d‘_routšg_¬ch
,

214 
timšg_šfo_t
* 
timšg_šf
);

216 
couÁ·ss
(
FILE
* 
å_¬ch
, 
rou‹r_ty³s_t
 
rou‹_ty³
,

217 
£gm’t_šfo_t
** 
£gm’t_šf_±r
,

218 
d‘a_routšg_¬ch_t
* 
d‘_routšg_¬ch_±r
,

219 
timšg_šfo_t
* 
timšg_šf
);

221 
š™_grid_ÿ·c™y
();

225 
	$»ad_¬ch
(* 
¬ch_fe
, 
rou‹r_ty³s_t
 
rou‹_ty³
,

226 
d‘a_routšg_¬ch_t
* 
d‘_routšg_¬ch
, 
£gm’t_šfo_t


227 ** 
£gm’t_šf_±r
, 
timšg_šfo_t
* 
timšg_šf_±r
, 
subblock_d©a_t


228 *
subblock_d©a_±r
, 
chª_width_di¡r_t
* 
chª_width_di¡_±r
)

230 
FILE
* 
å_¬ch
 = 
	`my_fİ’
(
¬ch_fe
, "r");

231 
	`couÁ·ss
(
å_¬ch
,

232 
rou‹_ty³
,

233 
£gm’t_šf_±r
,

234 
d‘_routšg_¬ch
,

235 
timšg_šf_±r
);

236 
	`»wšd
(
å_¬ch
);

238 
lš’um
 = 0;

239 
pšnum
 = 0;

240 
Ãxt_£gm’t
 = 0;

242 
i
, 
j
;

243 
i
 = 0; i < 
NUMINP
; ++i) {

244 
i¤—d
[
i
] = 0;

247 
pšloc
 = (**)
	`®loc_m©rix
(0, 3,

248 0, 
max_pšs_³r_şb
 - 1,

250 
i
 = 0; i <= 3; ++i)

251 
j
 = 0; j < 
max_pšs_³r_şb
; ++j) {

252 
pšloc
[
i
][
j
] = 0;

257 
timšg_šf_±r
->
C_š_cblock
 = 0.;

258 
timšg_šf_±r
->
T_š_cblock
 = 0.;

261 
T_subblock_t
* 
Ãxt_T_subblock_±r
;

262 * 
±r
, 
buf
[
BUFSIZE
];

263 (
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å_¬ch
)è!ğ
NULL
) {

265 
±r
 = 
	`my_¡¹ok
ÕŒ, 
TOKENS
, 
å_¬ch
, 
buf
);

266 ià(
±r
 =ğ
NULL
) {

272 ià(
	`¡rcmp
(
±r
, 
Çmes
[0]) == 0) {

273 
io_¿tio
 = 
	`g‘_št
(
±r
, 0, 
å_¬ch
, 
buf
, 1);

277 ià(
	`¡rcmp
(
±r
, 
Çmes
[1]) == 0) {

278 
	`gechªÃl_t
(
±r
, &
chª_width_di¡_±r
->
chª_x_di¡
, 1, 
å_¬ch
, 
buf
);

282 ià(
	`¡rcmp
(
±r
, 
Çmes
[2]) == 0) {

283 
	`gechªÃl_t
(
±r
, &
chª_width_di¡_±r
->
chª_y_di¡
, 2, 
å_¬ch
, 
buf
);

287 ià(
	`¡rcmp
(
±r
, 
Çmes
[3]) == 0) {

288 
chª_width_di¡_±r
->
chª_width_io
 = 
	`g‘_Úe_doubË
(
±r
, 3, 0. , 5000.,

289 
å_¬ch
, 
buf
);

293 ià(
	`¡rcmp
(
±r
, 
Çmes
[4]) == 0) {

294 
	`g‘_pš
(
±r
, 
pšnum
, 
DRIVER
, 
å_¬ch
, 
buf
);

295 
pšnum
++;

296 
i¤—d
[4]++;

300 ià(
	`¡rcmp
(
±r
, 
Çmes
[5]) == 0) {

301 
	`g‘_pš
(
±r
, 
pšnum
, 
RECEIVER
, 
å_¬ch
, 
buf
);

302 
pšnum
++;

303 
i¤—d
[5]++;

307 ià(
	`¡rcmp
(
±r
, 
Çmes
[6]) == 0) {

308 
subblock_d©a_±r
->
max_subblocks_³r_block
 = 
	`g‘_št
(
±r
, 6, 
å_¬ch
,

309 
buf
, 1);

313 ià(
	`¡rcmp
(
±r
, 
Çmes
[7]) == 0) {

314 
subblock_d©a_±r
->
subblock_lut_size
 = 
	`g‘_št
(
±r
, 7, 
å_¬ch
, 
buf
,

319 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
]) == 0) {

320 
d‘_routšg_¬ch
->
Fc_ouut
 = 
	`g‘_Úe_doubË
(
±r
, 
DETAILED_START
, 0.,

321 1.e20, 
å_¬ch
, 
buf
);

325 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 1]) == 0) {

326 
d‘_routšg_¬ch
->
Fc_šput
 = 
	`g‘_Úe_doubË
(
±r
, 
DETAILED_START
 + 1, 0.,

327 1.e20, 
å_¬ch
, 
buf
);

331 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 2]) == 0) {

332 
d‘_routšg_¬ch
->
Fc_·d
 = 
	`g‘_Úe_doubË
(
±r
, 
DETAILED_START
 + 2, 0.,

333 1.e20, 
å_¬ch
, 
buf
);

337 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 3]) == 0) {

338 
d‘_routšg_¬ch
->
Fc_ty³
 = 
	`g‘_Fc_ty³
(
±r
, 
å_¬ch
, 
buf
);

339 
i¤—d
[
DETAILED_START
 + 3]++;

343 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 4]) == 0) {

344 
d‘_routšg_¬ch
->
sw™ch_block_ty³
 = 
	`g‘_sw™ch_block_ty³
(
å_¬ch
,

345 
buf
);

346 
i¤—d
[
DETAILED_START
 + 4]++;

350 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 5]) == 0) {

351 
	`ge£gm’t_šfo_t
(
å_¬ch
, 
buf
, *
£gm’t_šf_±r
 + 
Ãxt_£gm’t
,

352 
d‘_routšg_¬ch
->
num_sw™ch
, 
rou‹_ty³
);

353 
Ãxt_£gm’t
++;

354 
i¤—d
[
DETAILED_START
 + 5]++;

358 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 6]) == 0) {

359 
	`g‘_sw™ch_šf
(
å_¬ch
, 
buf
, 
d‘_routšg_¬ch
->
num_sw™ch
, 
rou‹_ty³
);

360 
i¤—d
[
DETAILED_START
 + 6]++;

364 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 7]) == 0) {

365 
d‘_routšg_¬ch
->
R_mšW_nmos
 = 
	`g‘_Úe_doubË
(
±r
, 
DETAILED_START
 + 7,

366 0., 1.e20, 
å_¬ch
, 
buf
);

370 ià(
	`¡rcmp
(
±r
, 
Çmes
[
DETAILED_START
 + 8]) == 0) {

371 
d‘_routšg_¬ch
->
R_mšW_pmos
 = 
	`g‘_Úe_doubË
(
±r
, 
DETAILED_START
 + 8,

372 0., 1.e20, 
å_¬ch
, 
buf
);

376 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
]) == 0) {

377 
timšg_šf_±r
->
C_š_cblock
 = 
	`g‘_Úe_doubË
(
±r
, 
TIMING_START
,

378 -1e-30, 1e20, 
å_¬ch
, 
buf
);

382 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
 + 1]) == 0) {

383 
timšg_šf_±r
->
T_š_cblock
 = 
	`g‘_Úe_doubË
(
±r
, 
TIMING_START
 + 1,

384 -1e-30, 1e20, 
å_¬ch
, 
buf
);

388 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
 + 2]) == 0) {

390 
timšg_šf_±r
->
T_sblk_İš_to_sblk_š
 = 
	`g‘_Úe_doubË
(
±r
,

391 
TIMING_START
 + 2, -1e-30, 1e20, 
å_¬ch
, 
buf
);

395 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
 + 3]) == 0) {

397 
timšg_šf_±r
->
T_şb_š_to_sblk_š
 = 
	`g‘_Úe_doubË
(
±r
,

398 
TIMING_START
 + 3,

400 
å_¬ch
,

401 
buf
);

405 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
 + 4]) == 0) {

407 
timšg_šf_±r
->
T_sblk_İš_to_şb_İš
 = 
	`g‘_Úe_doubË
(
±r
,

408 
TIMING_START
 + 4,

411 
å_¬ch
,

412 
buf
);

416 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
 + 5]) == 0) {

417 
timšg_šf_±r
->
T_ad
 = 
	`g‘_Úe_doubË
(
±r
, 
TIMING_START
 + 5,

418 -1e-30, 1e20, 
å_¬ch
, 
buf
);

422 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
 + 6]) == 0) {

423 
timšg_šf_±r
->
T_İad
 = 
	`g‘_Úe_doubË
(
±r
, 
TIMING_START
 + 6,

424 -1e-30, 1e20, 
å_¬ch
, 
buf
);

428 ià(
	`¡rcmp
(
±r
, 
Çmes
[
TIMING_START
 + 7]) == 0) {

429 
Ãxt_T_subblock_±r
 = 
timšg_šf_±r
->
T_subblock
 +

430 
i¤—d
[
TIMING_START
 + 7];

431 
	`g‘_T_subblock
(
å_¬ch
, 
buf
, 
Ãxt_T_subblock_±r
);

432 
i¤—d
[
TIMING_START
 + 7]++;

436 
	`´štf
("E¼Ü: uÄecognized keywÜd (%sèÚ†š%d.\n", 
±r
, 
lš’um
);

437 
	`ex™
(1);

440 ià(
rou‹_ty³
 =ğ
GLOBAL
) {

441 
	`lßd_glob®_£gm’t_ªd_sw™ch
(
d‘_routšg_¬ch
,

442 *
£gm’t_šf_±r
,

443 
timšg_šf_±r
);

445 
	`lßd_exŒa_sw™ch_ty³s
(
d‘_routšg_¬ch
, 
timšg_šf_±r
);

448 
	`check_¬ch
(
¬ch_fe
,

449 
rou‹_ty³
,

450 *
d‘_routšg_¬ch
,

451 *
£gm’t_šf_±r
,

452 *
timšg_šf_±r
,

453 
subblock_d©a_±r
->
max_subblocks_³r_block
,

454 *
chª_width_di¡_±r
);

455 
	`fşo£
(
å_¬ch
);

456 
	}
}

462 
	$couÁ·ss
(
FILE
* 
å_¬ch
,

463 
rou‹r_ty³s_t
 
rou‹_ty³
,

464 
£gm’t_šfo_t
** 
£gm’t_šf_±r
,

465 
d‘a_routšg_¬ch_t
* 
d‘_routšg_¬ch_±r
,

466 
timšg_šfo_t
* 
timšg_šf_±r
)

468 
lš’um
 = 0;

469 
num_pš_şass
 = 1;

470 
num_£gm’t
 = 0;

471 
num_sw™ch
 = 0;

472 
num_T_subblock
 = 0;

473 * 
pšs_³r_şass
 = (*)
	`my_ÿÎoc
(
num_pš_şass
, ());

475 
işass
, 
i
;

476 
buf
[
BUFSIZE
], *
±r
;

477 (
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å_¬ch
)è!ğ
NULL
) {

478 
±r
 = 
	`my_¡¹ok
ÕŒ, 
TOKENS
, 
å_¬ch
, 
buf
);

479 ià(
±r
 =ğ
NULL
) {

483 ià(
	`¡rcmp
(
±r
, "inpin") == 0 || strcmp(ptr, "outpin") == 0

484 || 
	`¡rcmp
(
±r
, "global_inpin") == 0) {

486 
işass
 = 
	`g‘_şass
(
å_¬ch
, 
buf
);

487 ià(
işass
 >ğ
num_pš_şass
) {

488 
pšs_³r_şass
 = (*)
	`my_»®loc
(pins_per_class,

489 (
işass
 + 1) * ());

491 
i
 = 
num_pš_şass
; i <ğ
işass
; i++) {

492 
pšs_³r_şass
[
i
] = 0;

495 
num_pš_şass
 = 
işass
 + 1;

498 
pšs_³r_şass
[
işass
]++;

499 } ià(
	`¡rcmp
(
±r
, "segment") == 0) {

500 ++
num_£gm’t
;

501 } ià(
	`¡rcmp
(
±r
, "switch") == 0) {

502 ++
num_sw™ch
;

503 } ià(
	`¡rcmp
(
±r
, "T_subblock") == 0) {

504 ++
num_T_subblock
;

509 
±r
 !ğ
NULL
) {

510 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

515 
i
 = 0; i < 
num_pš_şass
; i++) {

516 ià(
pšs_³r_şass
[
i
] == 0) {

517 
	`´štf
("\nError: class index %d‚ot used in‡rchitecture "

518 "fe.\n", 
i
);

519 
	`´štf
(" Specified class indices‡re‚ot consecutive.\n");

520 
	`ex™
(1);

526 
şass_šf
 = (
pš_şass_t
*)
	`my_m®loc
(
num_pš_şass
 * (pin_class_t));

527 
max_pšs_³r_şb
 = 0;

528 
i
 = 0; i < 
num_pš_şass
; ++i) {

529 
şass_šf
[
i
].
ty³
 = 
OPEN
;

530 
şass_šf
[
i
].
num_pšs
 = 0;

531 
şass_šf
[
i
].
pšli¡
 = (*)
	`my_m®loc
(
pšs_³r_şass
[i] *

533 
max_pšs_³r_şb
 +ğ
pšs_³r_şass
[
i
];

536 
	`ä“
(
pšs_³r_şass
);

537 
şb_pš_şass
 = (*)
	`my_m®loc
(
max_pšs_³r_şb
 * ());

538 
is_glob®_şb_pš
 = (
boŞ—n
*)
	`my_m®loc
(
max_pšs_³r_şb
 * ());

543 ià(
rou‹_ty³
 =ğ
GLOBAL
) {

544 
num_£gm’t
 = 1;

545 
num_sw™ch
 = 1;

547 
num_sw™ch
 += 2;

551 ià(
num_£gm’t
 < 1) {

552 
	`´štf
("Error: No segment information specified in‡rchitecture.\n");

553 
	`ex™
(1);

556 *
£gm’t_šf_±r
 = (
£gm’t_šfo_t
*)
	`my_m®loc
(
num_£gm’t
 *

557 (
£gm’t_šfo_t
));

558 
d‘_routšg_¬ch_±r
->
num_£gm’t
 =‚um_segment;

560 ià(
num_sw™ch
 < 1) {

561 
	`´štf
("Error: No switch information specified in‡rchitecture.\n");

562 
	`ex™
(1);

565 
sw™ch_šf
 = (
sw™ch_šfo_t
*)
	`my_m®loc
(
num_sw™ch
 *

566 (
sw™ch_šfo_t
));

567 
i
 = 0; i < 
num_sw™ch
; i++) {

568 
sw™ch_šf
[
i
].
R
 = -1.;

571 
d‘_routšg_¬ch_±r
->
num_sw™ch
 =‚um_switch;

573 ià(
num_T_subblock
 != 0)

574 
timšg_šf_±r
->
T_subblock
 = (
T_subblock_t
*è
	`my_m®loc
(
num_T_subblock
 *

575 (
T_subblock_t
));

577 
timšg_šf_±r
->
T_subblock
 = 
NULL
;

579 
	}
}

582 
	$g‘_şass
(
FILE
* 
å_¬ch
, * 
buf
)

587 * 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

588 ià(
±r
 =ğ
NULL
) {

589 
	`´štf
("E¼Ü iÀg‘_şas Ú†š%d oà¬ch™eùu» fe.\n", 
lš’um
);

590 
	`´štf
("Expected class: keyword.\n");

591 
	`ex™
(1);

594 ià(
	`¡rcmp
(
±r
, "class:") != 0) {

595 
	`´štf
("E¼Ü iÀg‘_şas Ú†š%d oà¬ch™eùu» fe.\n", 
lš’um
);

596 
	`´štf
("Expected class: keyword.\n");

597 
	`ex™
(1);

601 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

602 ià(
±r
 =ğ
NULL
) {

603 
	`´štf
("E¼Ü iÀg‘_şas Ú†š%d oà¬ch™eùu» fe.\n", 
lš’um
);

604 
	`´štf
("Expected class‚umber.\n");

605 
	`ex™
(1);

608 
işass
 = 
	`my_©oi
(
±r
);

609 ià(
işass
 < 0) {

610 
	`´štf
("E¼Ü iÀg‘_şas Ú†š%d oà¬ch™eùu» fe.\n", 
lš’um
);

611 
	`´štf
("Ex³ùed cÏs numb” >ğ0, gÙ %d.\n", 
işass
);

612 
	`ex™
(1);

615  (
işass
);

616 
	}
}

621 
	$g‘_pš
(* 
±r
, 
pšnum
, 
pš_ty³s_t
 
ty³
,

622 
FILE
* 
å_¬ch
, * 
buf
)

624 * 
pos™iÚ
[4] = {"top",

629 
i
, 
v®id
;

630 
işass
 = 
	`g‘_şass
(
å_¬ch
, 
buf
);

631 ià(
şass_šf
[
işass
].
ty³
 =ğ
OPEN
) {

632 
şass_šf
[
işass
].
ty³
 =ype;

634 ià(
şass_šf
[
işass
].
ty³
 !=ype) {

635 
	`´štf
("Error in get_pin:‡rchitecture file,†ine %d.\n",

636 
lš’um
);

637 
	`´štf
("CÏs %d cÚš bÙh iÅuˆªd ouuˆpšs.\n", 
işass
);

638 
	`ex™
(1);

642 
š
 = 
şass_šf
[
işass
].
num_pšs
;

643 
şass_šf
[
işass
].
pšli¡
[
š
] = 
pšnum
;

644 
şass_šf
[
işass
].
num_pšs
++;

645 
şb_pš_şass
[
pšnum
] = 
işass
;

646 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

648 ià(
±r
 =ğ
NULL
) {

649 
	`´štf
("Error:…in statement specifies‚o†ocations,†ine %d.\n",

650 
lš’um
);

651 
	`ex™
(1);

654 ià(
ty³
 =ğ
RECEIVER
 && 
	`¡rcmp
(
±r
, "global") == 0) {

655 
is_glob®_şb_pš
[
pšnum
] = 
TRUE
;

656 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

658 ià(
±r
 =ğ
NULL
) {

659 
	`´štf
("Error:…in statement specifies‚o†ocations,†ine %d.\n",

660 
lš’um
);

661 
	`ex™
(1);

664 
is_glob®_şb_pš
[
pšnum
] = 
FALSE
;

668 
v®id
 = 0;

669 
i
 = 0; i <= 3; i++) {

670 ià(
	`¡rcmp
(
±r
, 
pos™iÚ
[
i
]) == 0) {

671 
pšloc
[
i
][
pšnum
] = 1;

672 
v®id
 = 1;

677 ià(
v®id
 != 1) {

678 
	`´štf
("E¼Ü: bad…š†oÿtiÚ oÀlš%d.\n", 
lš’um
);

679 
	`ex™
(1);

681 } (
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
)) != NULL);

682 
	}
}

685 
e_Fc_ty³
 
	$g‘_Fc_ty³
(* 
±r
, 
FILE
* 
å_¬ch
, * 
buf
)

688 
e_Fc_ty³
 
Fc_ty³
;

689 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

691 ià(
±r
 =ğ
NULL
) {

692 
	`´štf
("Error: missing Fc_type value on†ine %d of "

693 "¬ch™eùu» fe.\n", 
lš’um
);

694 
	`ex™
(1);

697 ià(
	`¡rcmp
(
±r
, "absolute") == 0) {

698 
Fc_ty³
 = 
ABSOLUTE
;

699 } ià(
	`¡rcmp
(
±r
, "fractional") == 0) {

700 
Fc_ty³
 = 
FRACTIONAL
;

702 
	`´štf
("Error: Bad Fc_type value (%s) on†ine %d of "

703 "¬ch™eùu» fe.\n", 
±r
, 
lš’um
);

704 
	`ex™
(1);

707 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

709 ià(
±r
 !ğ
NULL
) {

710 
	`´štf
("E¼Ü:ƒxŒ¨ch¬aù” ©ƒnd oàlš%d.\n", 
lš’um
);

711 
	`ex™
(1);

714  (
Fc_ty³
);

715 
	}
}

718 
sw™ch_block_t
 
	$g‘_sw™ch_block_ty³
(
FILE
* 
å_¬ch
,

719 * 
buf
)

723 * 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

724 ià(
±r
 =ğ
NULL
) {

725 
	`´štf
("Error: missing switch_block_type value on†ine %d of "

726 "¬ch™eùu» fe.\n", 
lš’um
);

727 
	`ex™
(1);

730 
sw™ch_block_t
 
sblock_ty³
;

731 ià(
	`¡rcmp
(
±r
, "subset") == 0) {

732 
sblock_ty³
 = 
SUBSET
;

733 } ià(
	`¡rcmp
(
±r
, "wilton") == 0) {

734 
sblock_ty³
 = 
WILTON
;

735 } ià(
	`¡rcmp
(
±r
, "universal") == 0) {

736 
sblock_ty³
 = 
UNIVERSAL
;

738 
	`´štf
("Error: Bad switch_block_type value (%s) on†ine %d of "

739 "¬ch™eùu» fe.\n", 
±r
, 
lš’um
);

740 
	`ex™
(1);

743 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

744 ià(
±r
 !ğ
NULL
) {

745 
	`´štf
("E¼Ü:ƒxŒ¨ch¬aù” ©ƒnd oàlš%d.\n", 
lš’um
);

746 
	`ex™
(1);

749  (
sblock_ty³
);

750 
	}
}

755 
	$g‘_T_subblock
(
FILE
* 
å_¬ch
, * 
buf
, 
T_subblock_t


756 *
T_subblock
)

758 
	`check_keywÜd
(
å_¬ch
, 
buf
, "T_comb:");

759 * 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

760 
T_subblock
->
T_comb
 = 
	`©of
(
±r
);

762 ià(
T_subblock
->
T_comb
 < 0.) {

763 
	`´štf
("Error on†ine %d: T_comb value (%g) is‚egative.\n",

764 
lš’um
, 
T_subblock
->
T_comb
);

765 
	`ex™
(1);

768 
	`check_keywÜd
(
å_¬ch
, 
buf
, "T_seq_in:");

769 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

770 
T_subblock
->
T_£q_š
 = 
	`©of
(
±r
);

772 ià(
T_subblock
->
T_£q_š
 < 0.) {

773 
	`´štf
("Error on†ine %d: T_seq_in value (%g) is‚egative.\n",

774 
lš’um
, 
T_subblock
->
T_£q_š
);

775 
	`ex™
(1);

778 
	`check_keywÜd
(
å_¬ch
, 
buf
, "T_seq_out:");

779 
±r
 = 
	`g‘_Ï¡_tok’
(
å_¬ch
, 
buf
);

780 
T_subblock
->
T_£q_out
 = 
	`©of
(
±r
);

782 ià(
T_subblock
->
T_£q_out
 < 0.) {

783 
	`´štf
("Error on†ine %d: T_seq_out value (%g) is‚egative.\n",

784 
lš’um
, 
T_subblock
->
T_£q_out
);

785 
	`ex™
(1);

787 
	}
}

790 
	$ge£gm’t_šfo_t
(
FILE
* 
å_¬ch
, * 
buf
, 
£gm’t_šfo_t
* 
£g_±r
,

791 
num_sw™ch
, 
rou‹r_ty³s_t
 
rou‹_ty³
)

795 * 
±r
;

796 
num_sb
;

798 ià(
rou‹_ty³
 !ğ
DETAILED
) {

799 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

801 
±r
 !ğ
NULL
) {

802 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

808 
	`check_keywÜd
(
å_¬ch
, 
buf
, "frequency:");

809 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

810 
£g_±r
->
äequ’cy
 = 
	`©of
(
±r
);

812 ià(
£g_±r
->
äequ’cy
 <= 0. || seg_ptr->frequency > 1.) {

813 
	`´štf
("Error on†ine %d: Frequency value (%g) is out of„ange.\n",

814 
lš’um
, 
£g_±r
->
äequ’cy
);

815 
	`ex™
(1);

818 
	`check_keywÜd
(
å_¬ch
, 
buf
, "length:");

819 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

821 ià(
	`¡rcmp
(
±r
, "longline") == 0) {

822 
£g_±r
->
Ëngth
 = -1;

823 
£g_±r
->
lÚglše
 = 
TRUE
;

825 
£g_±r
->
Ëngth
 = 
	`my_©oi
(
±r
);

826 
£g_±r
->
lÚglše
 = 
FALSE
;

828 ià(
£g_±r
->
Ëngth
 < 1) {

829 
	`´štf
("Error on†ine %d: Length value (%d) is†esshan 1.\n",

830 
lš’um
, 
£g_±r
->
Ëngth
);

831 
	`ex™
(1);

835 
	`check_keywÜd
(
å_¬ch
, 
buf
, "wire_switch:");

836 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

837 
£g_±r
->
wœe_sw™ch
 = 
	`my_©oi
(
±r
);

841 ià(
£g_±r
->
wœe_sw™ch
 < 0 || seg_±r->wœe_sw™ch >ğ
num_sw™ch
 - 2) {

842 
	`´štf
("Error on†ine %d: wire_switch value (%d) is out of„ange.\n",

843 
lš’um
, 
£g_±r
->
wœe_sw™ch
);

844 
	`ex™
(1);

847 
	`check_keywÜd
(
å_¬ch
, 
buf
, "opin_switch:");

848 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

849 
£g_±r
->
İš_sw™ch
 = 
	`my_©oi
(
±r
);

853 ià(
£g_±r
->
İš_sw™ch
 < 0 || seg_±r->İš_sw™ch >ğ
num_sw™ch
 - 2) {

854 
	`´štf
("Error on†ine %d: opin_switch value (%d) is out of„ange.\n",

855 
lš’um
, 
£g_±r
->
İš_sw™ch
);

856 
	`ex™
(1);

859 
	`check_keywÜd
(
å_¬ch
, 
buf
, "Frac_cb:");

860 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

861 
£g_±r
->
äac_cb
 = 
	`©of
(
±r
);

863 ià(
£g_±r
->
äac_cb
 < 0. || seg_ptr->frac_cb > 1.) {

864 
	`´štf
("Error on†ine %d: Frac_cb value (%g) is out of„ange.\n",

865 
lš’um
, 
£g_±r
->
äac_cb
);

866 
	`ex™
(1);

869 
	`check_keywÜd
(
å_¬ch
, 
buf
, "Frac_sb:");

870 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

871 
£g_±r
->
äac_sb
 = 
	`©of
(
±r
);

873 ià(
£g_±r
->
äac_sb
 < 0. || seg_ptr->frac_sb > 1.) {

874 
	`´štf
("Error on†ine %d: Frac_sb value (%g) is out of„ange.\n",

875 
lš’um
, 
£g_±r
->
äac_sb
);

876 
	`ex™
(1);

879 ià(
£g_±r
->
lÚglše
 =ğ
FALSE
) {

882 
num_sb
 = 
	`nšt
((
£g_±r
->
Ëngth
 + 1è* seg_±r->
äac_sb
);

884 ià(
num_sb
 < 2) {

885 
	`´štf
("Error on†ine %d: Frac_sb value„esults in only %d switch "

887 "Mšimum 2 sw™ch boxe Ú‚Ú-lÚglš£gm’ts.\n", 
lš’um
,

888 
num_sb
);

889 
	`ex™
(1);

893 
	`check_keywÜd
(
å_¬ch
, 
buf
, "Rmetal:");

894 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

895 
£g_±r
->
Rm‘®
 = 
	`©of
(
±r
);

897 ià(
£g_±r
->
Rm‘®
 < 0.) {

898 
	`´štf
("Error on†ine %d: Rmetal value (%g) is out of„ange.\n",

899 
lš’um
, 
£g_±r
->
Rm‘®
);

900 
	`ex™
(1);

903 
	`check_keywÜd
(
å_¬ch
, 
buf
, "Cmetal:");

904 
±r
 = 
	`g‘_Ï¡_tok’
(
å_¬ch
, 
buf
);

905 
£g_±r
->
Cm‘®
 = 
	`©of
(
±r
);

907 ià(
£g_±r
->
Cm‘®
 < 0.) {

908 
	`´štf
("Error on†ine %d: Cmetal value (%g) is out of„ange.\n",

909 
lš’um
, 
£g_±r
->
Cm‘®
);

910 
	`ex™
(1);

912 
	}
}

915 
	$g‘_sw™ch_šf
(
FILE
* 
å_¬ch
, * 
buf
, 
num_sw™ch
,

916 
rou‹r_ty³s_t
 
rou‹_ty³
)

919 * 
±r
;

920 ià(
rou‹_ty³
 !ğ
DETAILED
) {

921 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

923 
±r
 !ğ
NULL
) {

924 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

930 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

931 
šdex
 = 
	`my_©oi
(
±r
);

932 ià(
šdex
 < 0) {

933 
	`´štf
("Error on†ine %d: switch‚umber (%d) is out of„ange.\n",

934 
lš’um
, 
šdex
);

935 
	`ex™
(1);

938 ià(
šdex
 >ğ
num_sw™ch
) {

939 
	`´štf
("Error on†ine %d: switch‚umbers‡re‚ot consecutive or do \n"

940 "\ŠÙ s¹‡ˆ0.\n", 
lš’um
);

941 
	`ex™
(1);

944 ià(
sw™ch_šf
[
šdex
].
R
 >= 0.) {

945 
	`´štf
("E¼Ü oÀlš%d: sw™ch %d…rİ”t› ®»ady s‘.\n", 
lš’um
,

946 
šdex
);

947 
	`ex™
(1);

950 
	`check_keywÜd
(
å_¬ch
, 
buf
, "buffered:");

951 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

953 ià(
	`¡rcmp
(
±r
, "yes") == 0) {

954 
sw™ch_šf
[
šdex
].
bufã»d
 = 
TRUE
;

955 } ià(
	`¡rcmp
(
±r
, "no") == 0) {

956 
sw™ch_šf
[
šdex
].
bufã»d
 = 
FALSE
;

958 
	`´štf
("E¼Ü oÀlš%d: inv®id bufã»d v®ue: %s.\n", 
lš’um
, 
±r
);

959 
	`ex™
(1);

962 
	`check_keywÜd
(
å_¬ch
, 
buf
, "R:");

963 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

964 
sw™ch_šf
[
šdex
].
R
 = 
	`©of
(
±r
);

966 ià(
sw™ch_šf
[
šdex
].
R
 < 0) {

967 
	`´štf
("Error on†ine %d:„esistance value (%g) is‚egative.\n",

968 
lš’um
, 
sw™ch_šf
[
šdex
].
R
);

969 
	`ex™
(1);

972 
	`check_keywÜd
(
å_¬ch
, 
buf
, "Cin:");

973 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

974 
sw™ch_šf
[
šdex
].
Cš
 = 
	`©of
(
±r
);

976 ià(
sw™ch_šf
[
šdex
].
Cš
 < 0) {

977 
	`´štf
("Error on†ine %d: capacitance value (%g) is‚egative.\n",

978 
lš’um
, 
sw™ch_šf
[
šdex
].
Cš
);

979 
	`ex™
(1);

982 
	`check_keywÜd
(
å_¬ch
, 
buf
, "Cout:");

983 
±r
 = 
	`g‘_middË_tok’
(
å_¬ch
, 
buf
);

984 
sw™ch_šf
[
šdex
].
Cout
 = 
	`©of
(
±r
);

986 ià(
sw™ch_šf
[
šdex
].
Cout
 < 0) {

987 
	`´štf
("Error on†ine %d: capacitance value (%g) is‚egative.\n",

988 
lš’um
, 
sw™ch_šf
[
šdex
].
Cout
);

989 
	`ex™
(1);

992 ià(
sw™ch_šf
[
šdex
].
bufã»d
 =ğ
FALSE
 && sw™ch_šf[šdex].
Cout


993 !ğ
sw™ch_šf
[
šdex
].
Cš
) {

994 
	`´štf
("Error on†ine %d: Cin (%g)‡nd Cout (%g) differ for‡ "

995 "·s Œªs™Ü (sw™ch #%d).\n", 
lš’um
, 
sw™ch_šf
[
šdex
].
Cš
,

996 
sw™ch_šf
[
šdex
].
Cout
, index);

997 
	`ex™
(1);

1000 
	`check_keywÜd
(
å_¬ch
, 
buf
, "Tdel:");

1001 
±r
 = 
	`g‘_Ï¡_tok’
(
å_¬ch
, 
buf
);

1002 
sw™ch_šf
[
šdex
].
Td–
 = 
	`©of
(
±r
);

1004 ià(
sw™ch_šf
[
šdex
].
Td–
 < 0) {

1005 
	`´štf
("Error on†ine %d: Tdel value (%g) is‚egative.\n",

1006 
lš’um
, 
sw™ch_šf
[
šdex
].
Td–
);

1007 
	`ex™
(1);

1009 
	}
}

1015 
	$lßd_glob®_£gm’t_ªd_sw™ch
(
d‘a_routšg_¬ch_t
* 
d‘_routšg_¬ch
,

1016 
£gm’t_šfo_t
* 
£gm’t_šf
,

1017 
timšg_šfo_t
* 
timšg_šf
)

1019 
d‘_routšg_¬ch
->
sw™ch_block_ty³
 = 
SUBSET
;

1020 
d‘_routšg_¬ch
->
Fc_ouut
 = 1.;

1021 
d‘_routšg_¬ch
->
Fc_šput
 = 1.;

1022 
d‘_routšg_¬ch
->
Fc_·d
 = 1.;

1023 
d‘_routšg_¬ch
->
Fc_ty³
 = 
ABSOLUTE
;

1024 
d‘_routšg_¬ch
->
Td–Ëss_sw™ch
 = 0;

1025 
d‘_routšg_¬ch
->
wœe_to_š_sw™ch
 = 0;

1026 
£gm’t_šf
[0].
äequ’cy
 = 1.;

1027 
£gm’t_šf
[0].
Ëngth
 = 1;

1028 
£gm’t_šf
[0].
wœe_sw™ch
 = 0;

1029 
£gm’t_šf
[0].
İš_sw™ch
 = 0;

1030 
£gm’t_šf
[0].
äac_cb
 = 1.;

1031 
£gm’t_šf
[0].
äac_sb
 = 1.;

1032 
£gm’t_šf
[0].
lÚglše
 = 
FALSE
;

1033 
£gm’t_šf
[0].
Rm‘®
 = 0.;

1034 
£gm’t_šf
[0].
Cm‘®
 = 0.;

1035 
sw™ch_šf
[0].
bufã»d
 = 
TRUE
;

1036 
sw™ch_šf
[0].
R
 = 0.;

1037 
sw™ch_šf
[0].
Cš
 = 0.;

1038 
sw™ch_šf
[0].
Cout
 = 0.;

1039 
sw™ch_šf
[0].
Td–
 = 1.;

1041 
	}
}

1044 
	$lßd_exŒa_sw™ch_ty³s
(
d‘a_routšg_¬ch_t
 *

1045 
d‘_routšg_¬ch
, 
timšg_šfo_t
* 
timšg_šf
)

1051 
Td–Ëss_sw™ch
, 
wœe_to_š_sw™ch
;

1052 
Td–Ëss_sw™ch
 = 
d‘_routšg_¬ch
->
num_sw™ch
 - 1;

1053 
d‘_routšg_¬ch
->
Td–Ëss_sw™ch
 = Tdelless_switch;

1054 
wœe_to_š_sw™ch
 = 
d‘_routšg_¬ch
->
num_sw™ch
 - 2;

1055 
d‘_routšg_¬ch
->
wœe_to_š_sw™ch
 = wire_to_ipin_switch;

1057 ià(
sw™ch_šf
[
Td–Ëss_sw™ch
].
R
 >= 0. ||

1058 
sw™ch_šf
[
wœe_to_š_sw™ch
].
R
 >= 0.) {

1059 
	`´štf
("Error: switch indices‡re‚ot consecutive or do‚ot start‡t 0."

1061 
	`ex™
(1);

1064 
sw™ch_šf
[
Td–Ëss_sw™ch
].
bufã»d
 = 
TRUE
;

1065 
sw™ch_šf
[
Td–Ëss_sw™ch
].
R
 = 0.;

1066 
sw™ch_šf
[
Td–Ëss_sw™ch
].
Cš
 = 0.;

1067 
sw™ch_šf
[
Td–Ëss_sw™ch
].
Cout
 = 0.;

1068 
sw™ch_šf
[
Td–Ëss_sw™ch
].
Td–
 = 0.;

1069 
sw™ch_šf
[
wœe_to_š_sw™ch
].
bufã»d
 = 
TRUE
;

1070 
sw™ch_šf
[
wœe_to_š_sw™ch
].
R
 = 0.;

1071 
sw™ch_šf
[
wœe_to_š_sw™ch
].
Cš
 = 
timšg_šf
->
C_š_cblock
;

1072 
sw™ch_šf
[
wœe_to_š_sw™ch
].
Cout
 = 0.;

1073 
sw™ch_šf
[
wœe_to_š_sw™ch
].
Td–
 = 
timšg_šf
->
T_š_cblock
;

1074 
	}
}

1076 
	$check_keywÜd
(
FILE
* 
å
,

1077 * 
buf
,

1078 cÚ¡ * 
keywÜd
)

1082 * 
±r
 = 
	`g‘_middË_tok’
(
å
, 
buf
);

1083 ià(
	`¡rcmp
(
±r
, 
keywÜd
) != 0) {

1084 
	`´štf
("E¼Ü oÀlš%d: Ex³ùed keywÜd %s, gÙ %s.\n", 
lš’um
,

1085 
keywÜd
, 
±r
);

1086 
	`ex™
(1);

1088 
	}
}

1091 * 
	$g‘_middË_tok’
(
FILE
* 
å
, * 
buf
)

1095 * 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

1096 ià(
±r
 =ğ
NULL
) {

1097 
	`´štf
("E¼Ü:†š%d i šcom¶‘e.\n", 
lš’um
);

1098 
	`ex™
(1);

1101  (
±r
);

1102 
	}
}

1105 * 
	$g‘_Ï¡_tok’
(
FILE
* 
å
, * 
buf
)

1108 * 
±r
 = 
	`g‘_middË_tok’
(
å
, 
buf
);

1110 * 
±r2
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

1111 ià(
±r2
 !ğ
NULL
) {

1112 
	`´štf
("E¼Ü: ExŒ¨ch¬aù” ©ƒnd oàlš%d.\n", 
lš’um
);

1113 
	`ex™
(1);

1116  (
±r
);

1117 
	}
}

1120 
	$g‘_št
(* 
±r
, 
šp_num
, 
FILE
* 
å_¬ch
, * 
buf
,

1121 
mš_v®
)

1125 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

1126 ià(
±r
 =ğ
NULL
) {

1127 
	`´štf
("Error: missing %s value on†ine %d.\n",

1128 
Çmes
[
šp_num
], 
lš’um
);

1129 
	`ex™
(1);

1132 
v®
 = 
	`my_©oi
(
±r
);

1133 ià(
v®
 < 
mš_v®
) {

1134 
	`´štf
("Error: Bad value. %s = %d on†ine %d.\n",

1135 
Çmes
[
šp_num
], 
v®
, 
lš’um
);

1136 
	`ex™
(1);

1139 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

1141 ià(
±r
 !ğ
NULL
) {

1142 
	`´štf
("E¼Ü:ƒxŒ¨ch¬aù” ©ƒnd oàlš%d.\n", 
lš’um
);

1143 
	`ex™
(1);

1146 
i¤—d
[
šp_num
]++;

1147 (
v®
);

1148 
	}
}

1151 
	$g‘_Úe_doubË
(* 
±r
, 
šp_num
, 
low_lim
,

1152 
uµ_lim
, 
FILE
* 
å_¬ch
, * 
buf
)

1157 
v®
;

1158 
v®
 = 
	`g‘_doubË
(
±r
, 
šp_num
, 
low_lim
, 
uµ_lim
, 
å_¬ch
, 
buf
);

1159 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

1161 ià(
±r
 !ğ
NULL
) {

1162 
	`´štf
("E¼Ü:ƒxŒ¨ch¬aù” ©ƒnd oàlš%d.\n", 
lš’um
);

1163 
	`ex™
(1);

1166 
i¤—d
[
šp_num
]++;

1167  (
v®
);

1168 
	}
}

1171 
	$g‘_doubË
(* 
±r
, 
šp_num
, 
low_lim
,

1172 
uµ_lim
, 
FILE
* 
å_¬ch
, * 
buf
)

1177 
v®
;

1178 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

1180 ià(
±r
 =ğ
NULL
) {

1181 
	`´štf
("Error: missing %s value on†ine %d.\n",

1182 
Çmes
[
šp_num
], 
lš’um
);

1183 
	`ex™
(1);

1186 
v®
 = 
	`©of
(
±r
);

1188 ià(
v®
 <ğ
low_lim
 || v® > 
uµ_lim
) {

1189 
	`´štf
("Error: Bad value…arsing %s. %g on†ine %d.\n",

1190 
Çmes
[
šp_num
], 
v®
, 
lš’um
);

1191 
	`ex™
(1);

1194 (
v®
);

1195 
	}
}

1203 
	$gechªÃl_t
(* 
±r
, 
chªÃl_t
* 
chª
, 
šp_num
, 
FILE
* 
å_¬ch
,

1204 * 
buf
)

1209 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
);

1211 ià(
±r
 =ğ
NULL
) {

1212 
	`´štf
("Error: missing %s value on†ine %d.\n",

1213 
Çmes
[
šp_num
], 
lš’um
);

1214 
	`ex™
(1);

1217 ià(
	`¡rcmp
(
±r
, "uniform") == 0) {

1218 
i¤—d
[
šp_num
]++;

1219 
chª
->
ty³
 = 
UNIFORM
;

1220 
chª
->
³ak
 = 
	`g‘_doubË
(
±r
, 
šp_num
, 0., 1., 
å_¬ch
, 
buf
);

1221 
chª
->
dc
 = 
OPEN
;

1222 
chª
->
width
 = 
OPEN
;

1223 
chª
->
x³ak
 = 
OPEN
;

1224 } ià(
	`¡rcmp
(
±r
, "delta") == 0) {

1225 
i¤—d
[
šp_num
]++;

1226 
chª
->
ty³
 = 
DELTA
;

1227 
chª
->
³ak
 = 
	`g‘_doubË
(
±r
, 
šp_num
, -1.e5, 1.e5, 
å_¬ch
, 
buf
);

1228 
chª
->
x³ak
 = 
	`g‘_doubË
(
±r
, 
šp_num
, -1e-30, 1., 
å_¬ch
, 
buf
);

1229 
chª
->
dc
 = 
	`g‘_doubË
(
±r
, 
šp_num
, -1e-30, 1., 
å_¬ch
, 
buf
);

1230 
chª
->
width
 = 
OPEN
;

1232 ià(
	`¡rcmp
(
±r
, "gaussian") == 0) {

1233 
chª
->
ty³
 = 
GAUSSIAN
;

1236 ià(
	`¡rcmp
(
±r
, "pulse") == 0) {

1237 
chª
->
ty³
 = 
PULSE
;

1240 ià(
chª
->
ty³
 =ğ
GAUSSIAN
 || chª->ty³ =ğ
PULSE
) {

1241 
i¤—d
[
šp_num
]++;

1242 
chª
->
³ak
 = 
	`g‘_doubË
(
±r
, 
šp_num
, -1., 1., 
å_¬ch
, 
buf
);

1243 
chª
->
width
 = 
	`g‘_doubË
(
±r
, 
šp_num
, 0., 1.e10, 
å_¬ch
, 
buf
);

1244 
chª
->
x³ak
 = 
	`g‘_doubË
(
±r
, 
šp_num
, -1e-30, 1., 
å_¬ch
, 
buf
);

1245 
chª
->
dc
 = 
	`g‘_doubË
(
±r
, 
šp_num
, -1e-30, 1., 
å_¬ch
, 
buf
);

1249 ià(
i¤—d
[
šp_num
] == 0) {

1250 
	`´štf
("Error: %s distribution keyword: %s unknown.\n",

1251 
Çmes
[
šp_num
], 
±r
);

1252 
	`ex™
(1);

1255 ià(
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_¬ch
, 
buf
) != NULL) {

1256 
	`´štf
("Error:ƒxtra value for %s‡tƒnd of†ine %d.\n",

1257 
Çmes
[
šp_num
], 
lš’um
);

1258 
	`ex™
(1);

1260 
	}
}

1266 
	$check_¬ch
(* 
¬ch_fe
,

1267 
rou‹r_ty³s_t
 
rou‹_ty³
,

1268 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

1269 
£gm’t_šfo_t
* 
£gm’t_šf
,

1270 
timšg_šfo_t
 
timšg_šf
,

1271 
max_subblocks_³r_block
,

1272 
chª_width_di¡r_t
 
chª_width_di¡
)

1281 
boŞ—n
 
mu¡_be_£t
[
NUMINP
];

1282 
i
 = -1;

1283 
i
 = 0; i < 
NUM_REQUIRED
; i++) {

1284 
mu¡_be_£t
[
i
] = 
TRUE
;

1287 
i
 = 
NUM_REQUIRED
; i < 
NUMINP
; i++) {

1288 
mu¡_be_£t
[
i
] = 
FALSE
;

1291 ià(
rou‹_ty³
 =ğ
DETAILED
) {

1292 
i
 = 
NUM_REQUIRED
; i < NUM_REQUIRED + 
NUM_DETAILED
; i++) {

1293 
mu¡_be_£t
[
i
] = 
TRUE
;

1297 ià(
timšg_šf
.
timšg_ª®ysis_’abËd
) {

1298 
i
 = 
NUM_REQUIRED
 + 
NUM_DETAILED
; i < 
NUMINP
; i++) {

1299 
mu¡_be_£t
[
i
] = 
TRUE
;

1303 
çl
 = 0;

1304 
i
 = 0; i < 
NUMINP
; i++) {

1305 ià(!
mu¡_be_£t
[
i
]) {

1309 ià(
i
 =ğ
TIMING_START
 + 7) {

1310 ià(
i¤—d
[
i
] < 1 || i¤—d[i] !ğ
max_subblocks_³r_block
) {

1311 
	`´štf
("Error: Got %d T_subblock†ines --ƒxpected %d.\n",

1312 
i¤—d
[
i
], 
max_subblocks_³r_block
);

1313 
çl
 = 1;

1315 } ià(
i
 !ğ4 && i !ğ5 && i !ğ
DETAILED_START
 + 5 && i !=

1316 
DETAILED_START
 + 6) {

1317 ià(
i¤—d
[
i
] == 0) {

1318 
	`´štf
("E¼Ü: % nÙ s‘ iÀf%s.\n", 
Çmes
[
i
],

1319 
¬ch_fe
);

1320 
çl
 = 1;

1323 ià(
i¤—d
[
i
] > 1) {

1324 
	`´štf
("E¼Ü: % £ˆ%dime š f%s.\n", 
Çmes
[
i
],

1325 
i¤—d
[
i
], 
¬ch_fe
);

1326 
çl
 = 1;

1329 ià(
i¤—d
[
i
] < 1) {

1330 
	`´štf
("E¼Ü: iÀf%s. Clb ha %d %s(s).\n", 
¬ch_fe
,

1331 
i¤—d
[
i
], 
Çmes
[i]);

1332 
çl
 = 1;

1338 
tÙ®_£gm’t_äeq
 = 0.0;

1339 
İš_sw™ch
 = 0;

1340 
i
 = 0; i < 
d‘_routšg_¬ch
.
num_£gm’t
; i++) {

1341 
tÙ®_£gm’t_äeq
 +ğ
£gm’t_šf
[
i
].
äequ’cy
;

1342 
İš_sw™ch
 = 
£gm’t_šf
[
i
].opin_switch;

1344 ià(
sw™ch_šf
[
İš_sw™ch
].
bufã»d
 =ğ
FALSE
) {

1345 
	`´štf
("Error in check_arch: opin_switch (#%d) of segmentype #%d "

1346 "i nÙ bufã»d.\n", 
İš_sw™ch
, 
i
);

1347 
	`ex™
(1);

1351 ià(
	`çbs
(
tÙ®_£gm’t_äeq
 - 1.) > 0.001) {

1352 
	`´štf
("Error in check_arch: Segment frequencies must sumo 1.\n"

1353 "\tSum i %g.\n", 
tÙ®_£gm’t_äeq
);

1354 
çl
 = 1;

1361 
chªÃl_t
 
chª_x_di¡
, 
chª_y_di¡
;

1362 
chª_width_io
 = 0.0;

1363 ià(
rou‹_ty³
 =ğ
DETAILED
) {

1364 
chª_width_io
 = 
chª_width_di¡
.chan_width_io;

1365 
chª_x_di¡
 = 
chª_width_di¡
.chan_x_dist;

1366 
chª_y_di¡
 = 
chª_width_di¡
.chan_y_dist;

1368 ià(
chª_x_di¡
.
ty³
 !ğ
UNIFORM
 || 
chª_y_di¡
.type != UNIFORM ||

1369 
chª_x_di¡
.
³ak
 !ğ
chª_y_di¡
.peak || chan_x_dist.peak !=

1370 
chª_width_io
) {

1371 
	`´štf
("Error in check_arch: detailed„outing currently only\n"

1373 
çl
 = 1;

1376 ià(
d‘_routšg_¬ch
.
Fc_ty³
 =ğ
ABSOLUTE
) {

1377 ià(
d‘_routšg_¬ch
.
Fc_ouut
 < 1 || d‘_routšg_¬ch.
Fc_šput
 < 1

1378 || 
d‘_routšg_¬ch
.
Fc_·d
 < 1) {

1379 
	`´štf
("Error in check_arch: Fc values must be >= 1 in‡bsolute "

1381 
çl
 = 1;

1384 ià(
d‘_routšg_¬ch
.
Fc_ouut
 > 1. || d‘_routšg_¬ch.
Fc_šput
 > 1.

1385 || 
d‘_routšg_¬ch
.
Fc_·d
 > 1.) {

1386 
	`´štf
("Error in check_arch: Fc values must be <= 1. in "

1388 
çl
 = 1;

1392 
i
 = 0; i < 
d‘_routšg_¬ch
.
num_sw™ch
; i++) {

1393 ià(
sw™ch_šf
[
i
].
bufã»d
) {

1397 ià(
sw™ch_šf
[
i
].
R
 > 2 * 
d‘_routšg_¬ch
.
R_mšW_nmos
) {

1398 
	`´štf
("Error in check_arch: Switch %d R value (%g) is greater"

1399 "hª 2 * R_mšW_nmo (%g).\n", 
i
, 
sw™ch_šf
[i].
R
,

1400 2 * 
d‘_routšg_¬ch
.
R_mšW_nmos
);

1401 
	`ex™
(1);

1404 ià(
sw™ch_šf
[
i
].
R
 > 
d‘_routšg_¬ch
.
R_mšW_nmos
) {

1405 
	`´štf
("Error in check_arch: Switch %d R value (%g) is greater "

1406 "thª R_mšW_nmo (%g).\n", 
i
, 
sw™ch_šf
[i].
R
,

1407 
d‘_routšg_¬ch
.
R_mšW_nmos
);

1408 
	`ex™
(1);

1414 ià(
çl
) {

1415 
	`ex™
(1);

1417 
	}
}

1420 
	$´št_¬ch
(* 
¬ch_fe
,

1421 
rou‹r_ty³s_t
 
rou‹_ty³
,

1422 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

1423 
£gm’t_šfo_t
* 
£gm’t_šf
,

1424 
timšg_šfo_t
 
timšg_šf
,

1425 
subblock_d©a_t
 
subblock_d©a
,

1426 
chª_width_di¡r_t
 
chª_width_di¡
)

1431 
i
, 
j
;

1432 
FILE
* 
å
 = 
	`my_fİ’
("arch.echo", "w");

1433 
chª_width_io
 = 
chª_width_di¡
.chan_width_io;

1434 
chªÃl_t
 
chª_x_di¡
 = 
chª_width_di¡
.chan_x_dist;

1435 
chªÃl_t
 
chª_y_di¡
 = 
chª_width_di¡
.chan_y_dist;

1436 
	`årštf
(
å
, "IÅuˆÃi¡ fe: %s\n\n", 
¬ch_fe
);

1437 
	`årštf
(
å
, "io_¿tio: %d.\n", 
io_¿tio
);

1438 
	`årštf
(
å
, "chan_width_io: %g max_pins_per_clb(pins…er clb): %d\n",

1439 
chª_width_io
, 
max_pšs_³r_şb
);

1440 
	`årštf
(
å
, "\n\nChannel Types: UNIFORM = %d; GAUSSIAN = %d; PULSE = %d;"

1441 " DELTA = %d\n\n", 
UNIFORM
, 
GAUSSIAN
, 
PULSE
, 
DELTA
);

1442 
	`årštf
(
å
, "\nchan_width_x:\n");

1443 
	`årštf
(
å
, "type: %d…eak: %g width: %g xpeak: %g dc: %g\n",

1444 
chª_x_di¡
.
ty³
, chª_x_di¡.
³ak
, chª_x_di¡.
width
,

1445 
chª_x_di¡
.
x³ak
, chª_x_di¡.
dc
);

1446 
	`årštf
(
å
, "\nchan_width_y:\n");

1447 
	`årštf
(
å
, "type: %d…eak: %g width: %g xpeak: %g dc: %g\n\n",

1448 
chª_y_di¡
.
ty³
, chª_y_di¡.
³ak
, chª_y_di¡.
width
,

1449 
chª_y_di¡
.
x³ak
, chª_y_di¡.
dc
);

1450 
	`årštf
(
å
, "Pin #\tclass\ttop\tbottom\tleft\tright\tglobal");

1452 
i
 = 0; i < 
max_pšs_³r_şb
; i++) {

1453 
	`årštf
(
å
, "\n%d\t%d\t", 
i
, 
şb_pš_şass
[i]);

1455 
j
 = 0; j <= 3; j++) {

1456 
	`årštf
(
å
, "%d\t", 
pšloc
[
j
][
i
]);

1459 
	`årštf
(
å
, "%d", 
is_glob®_şb_pš
[
i
]);

1462 
	`årštf
(
å
, "\n\nCÏs ty³s: DRIVER = %d; RECEIVER = %d\n\n", 
DRIVER
,

1463 
RECEIVER
);

1464 
	`årštf
(
å
, "Class\tType\tNumpins\tPins");

1466 
i
 = 0; i < 
num_pš_şass
; i++) {

1467 
	`årštf
(
å
, "\n%d\t%d\t%d\t", 
i
, 
şass_šf
[i].
ty³
, cÏss_šf[i].
num_pšs
);

1469 
j
 = 0; j < 
şass_šf
[
i
].
num_pšs
; j++) {

1470 
	`årštf
(
å
, "%d\t", 
şass_šf
[
i
].
pšli¡
[
j
]);

1474 
	`årštf
(
å
, "\n\n");

1475 
	`årštf
(
å
, "subblocks_per_clb (maximum): %d\n",

1476 
subblock_d©a
.
max_subblocks_³r_block
);

1477 
	`årštf
(
å
, "subblock_lut_size: %d\n", 
subblock_d©a
.
subblock_lut_size
);

1479 ià(
rou‹_ty³
 =ğ
DETAILED
) {

1480 
	`årštf
(
å
, "\n");

1482 ià(
d‘_routšg_¬ch
.
Fc_ty³
 =ğ
ABSOLUTE
) {

1483 
	`årštf
(
å
, "Fc value is‡bsolute‚umber ofracks.\n");

1485 
	`årštf
(
å
, "Fc value is fraction ofracks in‡ channel.\n");

1488 
	`årštf
(
å
, "Fc_output: %g. Fc_input: %g. Fc_pad: %g.\n",

1489 
d‘_routšg_¬ch
.
Fc_ouut
, d‘_routšg_¬ch.
Fc_šput
,

1490 
d‘_routšg_¬ch
.
Fc_·d
);

1492 ià(
d‘_routšg_¬ch
.
sw™ch_block_ty³
 =ğ
SUBSET
) {

1493 
	`årštf
(
å
, "switch_block_type: SUBSET.\n");

1494 } ià(
d‘_routšg_¬ch
.
sw™ch_block_ty³
 =ğ
WILTON
) {

1495 
	`årštf
(
å
, "switch_block_type: WILTON.\n");

1497 
	`årštf
(
å
, "switch_block_type: UNIVERSAL.\n");

1502 
	`årštf
(
å
, "\nnum_segment: %d,‚um_switch: %d.\n",

1503 
d‘_routšg_¬ch
.
num_£gm’t
, d‘_routšg_¬ch.
num_sw™ch
);

1505 ià(
rou‹_ty³
 =ğ
DETAILED
) {

1506 
	`årštf
(
å
, "(Two switchypes were generated‡utomatically.)\n");

1509 
	`årštf
(
å
, "#%d: Tdelless switch. #%d: wire_to_ipin_switch.\n",

1510 
d‘_routšg_¬ch
.
Td–Ëss_sw™ch
,

1511 
d‘_routšg_¬ch
.
wœe_to_š_sw™ch
);

1512 
	`årštf
(
å
, "\nSeg. #\tfreq.\tlength\tlongln\topin_sw\twire_sw\tFrac_cb\t"

1515 
i
 = 0; i < 
d‘_routšg_¬ch
.
num_£gm’t
; i++)

1516 
	`årštf
(
å
, "%d\t%g\t%d\t%d\t%d\t%d\t%g\t%g\t%g\t%g\n", 
i
,

1517 
£gm’t_šf
[
i
].
äequ’cy
, segm’t_šf[i].
Ëngth
,

1518 
£gm’t_šf
[
i
].
lÚglše
, segm’t_šf[i].
İš_sw™ch
,

1519 
£gm’t_šf
[
i
].
wœe_sw™ch
, segm’t_šf[i].
äac_cb
,

1520 
£gm’t_šf
[
i
].
äac_sb
, segm’t_šf[i].
Cm‘®
, segm’t_šf[i].
Rm‘®
);

1522 
	`årštf
(
å
, "\nSwitch#\tbuff?\tR\tCin\tCout\tTdel\n");

1524 
i
 = 0; i < 
d‘_routšg_¬ch
.
num_sw™ch
; i++)

1525 
	`årštf
(
å
, "%d\t%d\t%g\t%g\t%g\t%g\n", 
i
, 
sw™ch_šf
[i].
bufã»d
,

1526 
sw™ch_šf
[
i
].
R
, sw™ch_šf[i].
Cš
, sw™ch_šf[i].
Cout
,

1527 
sw™ch_šf
[
i
].
Td–
);

1529 
	`årštf
(
å
, "\n\nR_minW_nmos: %g R_minW_pmos: %g\n",

1530 
d‘_routšg_¬ch
.
R_mšW_nmos
, d‘_routšg_¬ch.
R_mšW_pmos
);

1532 
T_subblock_t
 
T_subblock
;

1533 ià(
timšg_šf
.
timšg_ª®ysis_’abËd
) {

1534 
	`årštf
(
å
, "\n\nTiming information:\n");

1535 
	`årštf
(
å
, "---------------------------------------------------------\n");

1536 
	`årštf
(
å
, "C_ipin_cblock: %g (F) \nT_ipin_cblock: %g (s)\n\n",

1537 
timšg_šf
.
C_š_cblock
,imšg_šf.
T_š_cblock
);

1538 
	`årštf
(
å
, "T_sblk_opin_to_sblk_ipin: %g (s)\n",

1539 
timšg_šf
.
T_sblk_İš_to_sblk_š
);

1540 
	`årštf
(
å
, "T_clb_ipin_to_sblk_ipin: %g (s)\n",

1541 
timšg_šf
.
T_şb_š_to_sblk_š
);

1542 
	`årštf
(
å
, "T_sblk_opin_to_clb_opin: %g (s)\n",

1543 
timšg_šf
.
T_sblk_İš_to_şb_İš
);

1544 
	`årštf
(
å
, "T_ipad: %g (s) \nT_opad: %g (s)\n",

1545 
timšg_šf
.
T_ad
,imšg_šf.
T_İad
);

1546 
	`årštf
(
å
, "\nSubblock #\tT_comb (s)\tT_seq_in (s)\tT_seq_out (s)\n");

1548 
i
 = 0; i < 
subblock_d©a
.
max_subblocks_³r_block
; i++) {

1549 
T_subblock
 = 
timšg_šf
.T_subblock[
i
];

1550 
	`årštf
(
å
, "%10d\t%10g\t%10g\t%10g (s)\n", 
i
, 
T_subblock
.
T_comb
,

1551 
T_subblock
.
T_£q_š
, T_subblock.
T_£q_out
);

1555 
	`fşo£
(
å
);

1556 
	}
}

1564 
	$š™_¬ch
(
a¥eù_¿tio
, 
boŞ—n
 
u£r_sized
)

1568 ià(
u£r_sized
 =ğ
TRUE
) {

1570 ià(
num_şbs
 > 
num_grid_cŞumns
 * 
num_grid_rows


1571 ||
num_´im¬y_šputs
 + 
num_´im¬y_ouuts
 >

1572 
io_¿tio
 * (2 * (
num_grid_cŞumns
 + 
num_grid_rows
))) {

1573 
	`´štf
("Error: User-specified size isoo small for circuit.\n");

1574 
	`ex™
(1);

1580 
num_grid_rows
 = ()
	`û
(
	`sq¹
(()(
num_şbs
 / 
a¥eù_¿tio
)));

1581 
io_lim
 = ()
	`û
((
num_´im¬y_šputs
 + 
num_´im¬y_ouuts
) /

1582 (2 * 
io_¿tio
 * (1.0 + 
a¥eù_¿tio
)));

1583 
num_grid_rows
 = 
	`max
Òum_grid_rows, 
io_lim
);

1584 
num_grid_cŞumns
 = ()
	`û
(
num_grid_rows
 * 
a¥eù_¿tio
);

1592 ià(
num_grid_cŞumns
 =ğ1 && 
num_grid_rows
 =ğ1 && 
num_şbs
 != 0) {

1593 
	`´štf
("Error:\n");

1594 
	`´štf
("Sorry, can't…lace‡ circuit with only one valid†ocation\n");

1595 
	`´štf
("for‡†ogic blocks (clb).\n");

1596 
	`´štf
("Try me with‡ more„ealistic circuit!\n");

1597 
	`ex™
(1);

1602 ià(
num_grid_cŞumns
 > 32766 || 
num_grid_rows
 > 32766) {

1603 
	`´štf
("Error:‚um_grid_columns‡nd‚um_grid_rows must be†esshan 32767, sincehe \n");

1604 
	`´štf
("router uses shorts (16-bit)o store coordinates.\n");

1605 
	`´štf
("num_grid_cŞumns: %d.‚um_grid_rows: %d.\n", 
num_grid_cŞumns
, 
num_grid_rows
);

1606 
	`ex™
(1);

1609 
bš_grids
 = (
grid_te_t
**)
	`®loc_m©rix
(0, 
num_grid_cŞumns
 + 1,

1610 0, 
num_grid_rows
 + 1,

1611 (
grid_te_t
));

1612 
chª_width_x
 = (*)
	`my_m®loc
((
num_grid_rows
 + 1) * ());

1613 
chª_width_y
 = (*)
	`my_m®loc
((
num_grid_cŞumns
 + 1) * ());

1615 
	`š™_grid_ÿ·c™y
();

1617 
	`fl_¬ch
();

1618 
	}
}

1621 
	$fl_¬ch
()

1626 cÚ¡ 
kio_bš_ÿ·c™y
 = 
g_grid_ÿ·c™y
[
IO_TYPE
];

1627 
i
 = 0;

1628 
k
 = -1;

1629 
i
 = 1; i <ğ
num_grid_cŞumns
; ++i) {

1630 
bš_grids
[
i
][0].
š_blocks
 = (*)
	`my_m®loc
(
kio_bš_ÿ·c™y
 * ());

1631 
bš_grids
[
i
][
num_grid_rows
 + 1].
š_blocks
 =

1632 (*)
	`my_m®loc
(
kio_bš_ÿ·c™y
 * ());

1633 
k
 = 0; k < 
kio_bš_ÿ·c™y
; ++k) {

1634 
bš_grids
[
i
][0].
š_blocks
[
k
] =

1635 
bš_grids
[
i
][
num_grid_rows
 + 1].
š_blocks
[
k
] = 
EMPTY
;

1639 
i
 = 1; i <ğ
num_grid_rows
; ++i) {

1640 
bš_grids
[0][
i
].
š_blocks
 = (*)
	`my_m®loc
(
kio_bš_ÿ·c™y
 * ());

1641 
bš_grids
[
num_grid_cŞumns
 + 1][
i
].
š_blocks
 =

1642 (*)
	`my_m®loc
(
kio_bš_ÿ·c™y
 * ());

1643 
k
 = 0; k < 
kio_bš_ÿ·c™y
; ++k) {

1644 
bš_grids
[0][
i
].
š_blocks
[
k
] =

1645 
bš_grids
[
num_grid_cŞumns
 + 1][
i
].
š_blocks
[
k
] = 
EMPTY
;

1650 
i
 = 1; i <ğ
num_grid_cŞumns
; ++i) {

1651 
bš_grids
[
i
][0].
grid_ty³
 = bš_grids[i][
num_grid_rows
 + 1].grid_type

1652 ğ
IO_TYPE
;

1653 
bš_grids
[
i
][0].
m_off£t
 = bš_grids[i][
num_grid_rows
 + 1].m_offset = 0;

1654 
bš_grids
[
i
][0].
m_u§ge
 = bš_grids[i][
num_grid_rows
 + 1].m_usage = 0;

1655 
bš_grids
[
i
][0].
m_ÿ·c™y
 = bš_grids[i][
num_grid_rows
 + 1].m_capacity

1656 ğ
kio_bš_ÿ·c™y
;

1659 
i
 = 1; i <ğ
num_grid_rows
; ++i) {

1660 
bš_grids
[0][
i
].
grid_ty³
 = bš_grids[
num_grid_cŞumns
 + 1][i].grid_type

1661 ğ
IO_TYPE
;

1662 
bš_grids
[0][
i
].
m_off£t
 = bš_grids[
num_grid_cŞumns
 + 1][i].m_offset = 0;

1663 
bš_grids
[0][
i
].
m_u§ge
 = bš_grids[
num_grid_cŞumns
 + 1][i].m_usage = 0;

1664 
bš_grids
[0][
i
].
m_ÿ·c™y
 = bš_grids[
num_grid_cŞumns
 + 1][i].m_capacity

1665 ğ
kio_bš_ÿ·c™y
;

1668 cÚ¡ 
kşb_bš_ÿ·c™y
 = 
g_grid_ÿ·c™y
[
B_CLB_TYPE
];

1669 
i
 = 1; i <ğ
num_grid_cŞumns
; ++i) {

1670 
j
 = 0;

1671 
j
 = 1; j <ğ
num_grid_rows
; ++j) {

1672 
bš_grids
[
i
][
j
].
š_blocks
 =

1673 (*)
	`my_m®loc
(
kşb_bš_ÿ·c™y
 * ());

1674 
bš_grids
[
i
][
j
].
grid_ty³
 = 
B_CLB_TYPE
;

1675 
bš_grids
[
i
][
j
].
m_ÿ·c™y
 = 
kşb_bš_ÿ·c™y
;

1676 
bš_grids
[
i
][
j
].
m_u§ge
 = 0;

1677 
bš_grids
[
i
][
j
].
m_off£t
 = 0;

1678 
k
 = 0; k < 
kşb_bš_ÿ·c™y
; ++k) {

1679 
bš_grids
[
i
][
j
].
š_blocks
[
k
] = 
EMPTY
;

1685 
bš_grids
[0][0].
grid_ty³
 = bš_grids[
num_grid_cŞumns
 + 1][0].grid_type =

1686 
EMPTY_TYPE
;

1687 
bš_grids
[0][0].
m_ÿ·c™y
 = bš_grids[
num_grid_cŞumns
 + 1][0].m_capacity

1689 
bš_grids
[0][0].
m_off£t
 = bš_grids[
num_grid_cŞumns
 + 1][0].m_offset

1692 
bš_grids
[0][
num_grid_rows
 + 1].
grid_ty³
 =

1693 
bš_grids
[
num_grid_cŞumns
 + 1][
num_grid_rows
 + 1].
grid_ty³
 = 
EMPTY_TYPE
;

1694 
bš_grids
[0][
num_grid_rows
 + 1].
m_ÿ·c™y
 =

1695 
bš_grids
[
num_grid_cŞumns
 + 1][
num_grid_rows
 + 1].
m_ÿ·c™y
 = 0;

1696 
bš_grids
[0][
num_grid_rows
 + 1].
m_off£t
 =

1697 
bš_grids
[
num_grid_cŞumns
 + 1][
num_grid_rows
 + 1].
m_off£t
 = 0;

1698 
	}
}

1700 
	$š™_grid_ÿ·c™y
()

1702 
g_num_grid_ty³s
 = 
NUM_GRID_TYPES
;

1703 
g_grid_ÿ·c™y
 = (*)
	`my_m®loc
(
g_num_grid_ty³s
 * ());

1704 
g_grid_ÿ·c™y
[
B_CLB_TYPE
] = 1;

1706 
	`as£¹
(
io_¿tio
 > 0);

1707 
g_grid_ÿ·c™y
[
IO_TYPE
] = 
io_¿tio
;

1709 
g_grid_ÿ·c™y
[
EMPTY_TYPE
] = 0;

1710 
	}
}

	@read_arch.h

1 #iâdeà
READ_ARCH_H


2 
	#READ_ARCH_H


	)

4 
	~"v´_ty³s.h
"

6 
»ad_¬ch
(* 
¬ch_fe
,

7 
rou‹r_ty³s_t
 
rou‹_ty³
,

8 
d‘a_routšg_¬ch_t
* 
d‘_routšg_¬ch
,

9 
£gm’t_šfo_t
** 
£gm’t_šf_±r
,

10 
timšg_šfo_t
* 
timšg_šf_±r
,

11 
subblock_d©a_t
* 
subblock_d©a_±r
,

12 
chª_width_di¡r_t
* 
chª_width_di¡_±r
);

14 
š™_¬ch
(
a¥eù_¿tio
,

15 
boŞ—n
 
u£r_sized
);

17 
´št_¬ch
(* 
¬ch_fe
,

18 
rou‹r_ty³s_t
 
rou‹_ty³
,

19 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

20 
£gm’t_šfo_t
* 
£gm’t_šf
,

21 
timšg_šfo_t
 
timšg_šf
,

22 
subblock_d©a_t
 
subblock_d©a
,

23 
chª_width_di¡r_t
 
chª_width_di¡
);

	@read_netlist.c

1 
	~<¡ršg.h
>

2 
	~<¡dio.h
>

3 
	~"ut.h
"

4 
	~"v´_ty³s.h
"

5 
	~"glob®s.h
"

6 
	~"»ad_Ãi¡.h
"

7 
	~"hash.h
"

8 
	~"check_Ãi¡.h
"

9 
	~<as£¹.h
>

67 * 
	gnum_driv”
, *
	g‹mp_num_pšs
;

68 
hash_t
** 
	ghash_bË
;

69 
	g‹mp_block_¡Üage
;

73 
	gchunk_by‹s_ava
 = 0;

74 * 
	gchunk_Ãxt_ava_mem
 = 
NULL
;

81 
	gmax_subblocks_³r_block
;

82 
	gsubblock_lut_size
;

83 
subblock_t
** 
	gsubblock_šf
;

84 * 
	gnum_subblocks_³r_block
;

89 
	gch_subblock_by‹s_ava
;

90 * 
	gch_subblock_Ãxt_ava_mem
;

91 
lšked_v±r_t
* 
	gch_subblock_h—d_±r
;

97 
add_Ãt
(* 
±r
,

98 
pš_ty³s_t
 
ty³
,

99 
block_num
,

100 
blk_²um
,

101 
dßÎ
);

103 * 
g‘_tok’
(* 
buf
, 
dßÎ
, 
FILE
* 
å_Ãt
);

105 
add_io
(
dßÎ
,

106 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

107 
FILE
* 
å_Ãt
,

108 * 
buf
);

110 * 
add_şb
(
dßÎ
,

111 
FILE
* 
å_Ãt
,

112 * 
buf
);

114 
add_glob®
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
buf
);

115 
š™_·r£
(
dßÎ
);

116 
ä“_·r£
();

117 
·r£_Çme_ªd_pšli¡
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
buf
);

118 
g‘_pš_numb”
(* 
±r
);

120 
lßd_subblock_¬¿y
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
‹mp_buf
,

121 
num_subblocks
, 
block_num
);

123 
£t_subblock_couÁ
(
block_num
, 
num_subblocks
);

124 * 
·r£_subblocks
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
buf
, 
block_num
);

130 
	$»ad_Ãi¡
(* 
Ãt_fe
,

131 
subblock_d©a_t
* 
subblock_d©a_±r
)

133 
buf
[
BUFSIZE
] = "";

136 
max_subblocks_³r_block
 = 
subblock_d©a_±r
->max_subblocks_per_block;

137 
subblock_lut_size
 = 
subblock_d©a_±r
->subblock_lut_size;

138 
FILE
* 
å_Ãt
 = 
	`my_fİ’
(
Ãt_fe
, "r");

144 
dßÎ
 = -1;

145 
dßÎ
 = 0; doall <= 1; ++doall) {

146 
	`š™_·r£
(
dßÎ
);

148 
lš’um
 = 0;

149 * 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å_Ãt
);

150 
±r
 !ğ
NULL
) {

151 
±r
 = 
	`g‘_tok’
(
buf
,

152 
dßÎ
,

153 
å_Ãt
);

156 
	`»wšd
(
å_Ãt
);

159 
	`fşo£
(
å_Ãt
);

162 
subblock_d©a_±r
->
subblock_šf
 = subblock_inf;

163 
subblock_d©a_±r
->
num_subblocks_³r_block
 =‚um_subblocks_per_block;

164 
subblock_d©a_±r
->
chunk_h—d_±r
 = 
ch_subblock_h—d_±r
;

166 
	`check_Ãi¡
(
subblock_d©a_±r
,

167 
num_driv”
);

169 
	`ä“_·r£
();

170 
	}
}

172 
	$š™_·r£
(
dßÎ
)

175 
i
, 
j
, 
Ën
, 
nšdex
, 
pš_couÁ
;

176 * 
tmp_±r
;

177 
s_hash_™”©Ü
 
hash_™”©Ü
;

178 
hash_t
* 
h_±r
;

180 ià(!
dßÎ
) {

181 
num_Ãts
 = 0;

182 
hash_bË
 = 
	`®loc_hash_bË
();

184 
	#INITIAL_BLOCK_STORAGE
 2000

	)

185 
‹mp_block_¡Üage
 = 
INITIAL_BLOCK_STORAGE
;

186 
num_subblocks_³r_block
 = (*)
	`my_m®loc
(
INITIAL_BLOCK_STORAGE
 *

189 
ch_subblock_by‹s_ava
 = 0;

190 
ch_subblock_Ãxt_ava_mem
 = 
NULL
;

191 
ch_subblock_h—d_±r
 = 
NULL
;

194 
Ãt
 = (
Ãt_t
*)
	`my_m®loc
(
num_Ãts
 * (net_t));

195 
blocks
 = (
block_t
*)
	`my_m®loc
(
num_blocks
 * (block_t));

196 
is_glob®
 = (
boŞ—n
*)
	`my_ÿÎoc
(
num_Ãts
, (boolean));

197 
num_driv”
 = (*)
	`my_m®loc
(
num_Ãts
 * ());

198 
‹mp_num_pšs
 = (*)
	`my_m®loc
(
num_Ãts
 * ());

200 
i
 = 0; i < 
num_Ãts
; ++i) {

201 
num_driv”
[
i
] = 0;

202 
Ãt
[
i
].
num_Ãt_pšs
 = 0;

208 
tmp_±r
 = (*)
	`my_m®loc
(
max_pšs_³r_şb
 * 
num_blocks
 * ());

210 
i
 = 0; i < 
num_blocks
; ++i) {

211 
blocks
[
i
].
Ãts
 = 
tmp_±r
 + i * 
max_pšs_³r_şb
;

220 
hash_™”©Ü
 = 
	`¡¬t_hash_bË_™”©Ü
();

221 
h_±r
 = 
	`g‘_Ãxt_hash
(
hash_bË
, &
hash_™”©Ü
);

223 
h_±r
 !ğ
NULL
) {

224 
nšdex
 = 
h_±r
->
šdex
;

225 
pš_couÁ
 = 
h_±r
->
couÁ
;

226 
Ãt
[
nšdex
].
node_blocks
 = (*)
	`my_chunk_m®loc
(
pš_couÁ
 * (),

227 
NULL
,

228 &
chunk_by‹s_ava
,

229 &
chunk_Ãxt_ava_mem
);

230 
Ãt
[
nšdex
].
node_block_pšs
 = (*)
	`my_chunk_m®loc
(
pš_couÁ
 * (),

231 
NULL
,

232 &
chunk_by‹s_ava
,

233 &
chunk_Ãxt_ava_mem
);

235 
‹mp_num_pšs
[
nšdex
] = 
pš_couÁ
;

236 
Ën
 = 
	`¡¾’
(
h_±r
->
Çme
);

237 
Ãt
[
nšdex
].
Çme
 = (*)
	`my_chunk_m®loc
((
Ën
 + 1) * (),

238 
NULL
,

239 &
chunk_by‹s_ava
,

240 &
chunk_Ãxt_ava_mem
);

241 
	`¡rıy
(
Ãt
[
nšdex
].
Çme
, 
h_±r
->name);

242 
h_±r
 = 
	`g‘_Ãxt_hash
(
hash_bË
, &
hash_™”©Ü
);

246 
num_subblocks_³r_block
 = (*)
	`my_»®loc
(num_subblocks_per_block,

247 
num_blocks
 * ());

248 
subblock_šf
 = (
subblock_t
**)
	`my_m®loc
(
num_blocks
 *

249 (
subblock_t
*));

251 
i
 = 0; i < 
num_blocks
; ++i) {

252 ià(
num_subblocks_³r_block
[
i
] == 0) {

253 
subblock_šf
[
i
] = 
NULL
;

255 
subblock_šf
[
i
] = (
subblock_t
*è
	`my_chunk_m®loc
(

256 
num_subblocks_³r_block
[
i
] * (
subblock_t
),

257 &
ch_subblock_h—d_±r
, &
ch_subblock_by‹s_ava
,

258 &
ch_subblock_Ãxt_ava_mem
);

260 
j
 = 0; j < 
num_subblocks_³r_block
[
i
]; j++)

261 
subblock_šf
[
i
][
j
].
šputs
 = (*è
my_chunk_m®loc


262 (
subblock_lut_size
 * (), &
ch_subblock_h—d_±r
,

263 &
ch_subblock_by‹s_ava
, &
ch_subblock_Ãxt_ava_mem
);

269 
lš’um
 = 0;

270 
num_´im¬y_šputs
 = 0;

271 
num_´im¬y_ouuts
 = 0;

272 
num_şbs
 = 0;

273 
num_blocks
 = 0;

274 
num_glob®s
 = 0;

275 
	}
}

280 * 
	$g‘_tok’
(* 
buf
,

281 
dßÎ
,

282 
FILE
* 
å_Ãt
)

284 * 
±r
 = 
	`my_¡¹ok
(
buf
,

285 
TOKENS
,

286 
å_Ãt
,

287 
buf
);

288 ià(
±r
 =ğ
NULL
) {

289 
±r
 = 
	`my_fg‘s
(
buf
,

290 
BUFSIZE
,

291 
å_Ãt
);

292  
±r
;

294 ià(
	`¡rcmp
(
±r
, ".clb") == 0) {

295 
±r
 = 
	`add_şb
(
dßÎ
, 
å_Ãt
, 
buf
);

296  
±r
;

298 ià(
	`¡rcmp
(
±r
, ".input") == 0) {

299 
	`add_io
(
dßÎ
, 
INPAD_TYPE
, 
å_Ãt
, 
buf
);

300 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å_Ãt
);

301  
±r
;

303 ià(
	`¡rcmp
(
±r
, ".output") == 0) {

304 
	`add_io
(
dßÎ
, 
OUTPAD_TYPE
, 
å_Ãt
, 
buf
);

305 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å_Ãt
);

306  
±r
;

308 ià(
	`¡rcmp
(
±r
, ".global") == 0) {

309 
	`add_glob®
(
dßÎ
, 
å_Ãt
, 
buf
);

310 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å_Ãt
);

311  
±r
;

314 
	`´štf
("Error in get_token while…arsing‚etlist file.\n");

315 
	`´štf
("Lš%d s¹ w™h‡Àšv®idok’ (%s).\n", 
lš’um
, 
±r
);

316 
	`ex™
(1);

317 
	}
}

319 
	$g‘_pš_numb”
(* 
±r
)

326 
v®
;

328 ià(
	`¡rcmp
("İ’", 
±r
) == 0) {

329  (
OPEN
);

332 ià(
	`¡ºcmp
("bË_", 
±r
, 4) == 0) {

333 
v®
 = 
	`my_©oi
(
±r
 + 4);

335 ià(
v®
 < 0 || v® >ğ
max_subblocks_³r_block
) {

336 
	`´štf
("Error in get_pin_number on†ine %d of‚etlist file.\n",

337 
lš’um
);

338 
	`´štf
("Pin ble_%d is out of†egal„ange (ble_%do ble_%d).\n"

339 "AbÜtšg.\n\n", 
v®
, 0, 
max_subblocks_³r_block
 - 1);

340 
	`ex™
(1);

343 
v®
 +ğ
max_pšs_³r_şb
;

344  (
v®
);

348 
v®
 = 
	`my_©oi
(
±r
);

350 ià(
v®
 < 0 || v® >ğ
max_pšs_³r_şb
) {

351 
	`´štf
("Error in get_pin_number on†ine %d of‚etlist file.\n",

352 
lš’um
);

353 
	`´štf
("Pin %d is out of†egal„ange (%do %d).\nAborting.\n\n",

354 
v®
, 0, 
max_pšs_³r_şb
 - 1);

355 
	`ex™
(1);

358  (
v®
);

359 
	}
}

362 
	$lßd_subblock_¬¿y
(
dßÎ
, 
FILE
* 
å_Ãt
,

363 * 
‹mp_buf
, 
num_subblocks
, 
block_num
)

369 
š
, 
Ën
, 
cÚÃù_to
;

370 * 
±r
;

371 
š
 = 0;

372 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
‹mp_buf
);

374 ià(
±r
 =ğ
NULL
) {

375 
	`´štf
("Error in†oad_subblock_array on†ine %d of‚etlist file.\n",

376 
lš’um
);

377 
	`´štf
("Subblock‚ame is missing.\nAborting.\n\n");

378 
	`ex™
(1);

382 ià(
dßÎ
 == 1) {

383 
Ën
 = 
	`¡¾’
(
±r
);

384 
subblock_šf
[
block_num
][
num_subblocks
 - 1].
Çme
 = 
	`my_chunk_m®loc
((
Ën
 + 1) *

385 (), &
ch_subblock_h—d_±r
, &
ch_subblock_by‹s_ava
,

386 &
ch_subblock_Ãxt_ava_mem
);

387 
	`¡rıy
(
subblock_šf
[
block_num
][
num_subblocks
 - 1].
Çme
, 
±r
);

390 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
‹mp_buf
);

392 
±r
 !ğ
NULL
) {

393 ià(
dßÎ
 == 1) {

394 
cÚÃù_to
 = 
	`g‘_pš_numb”
(
±r
);

396 ià(
š
 < 
subblock_lut_size
) {

397 
subblock_šf
[
block_num
][
num_subblocks
 - 1].
šputs
[
š
] = 
cÚÃù_to
;

398 } ià(
š
 =ğ
subblock_lut_size
) {

399 
subblock_šf
[
block_num
][
num_subblocks
 - 1].
ouut
 = 
cÚÃù_to
;

400 } ià(
š
 =ğ
subblock_lut_size
 + 1) {

401 
subblock_šf
[
block_num
][
num_subblocks
 - 1].
şock
 = 
cÚÃù_to
;

405 
š
++;

406 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
‹mp_buf
);

409 ià(
š
 !ğ
subblock_lut_size
 + 2) {

410 
	`´štf
("Error in†oad_subblock_array‡t†ine %d of‚etlist file.\n",

411 
lš’um
);

412 
	`´štf
("Subblock had %d…šs,ƒx³ùed %d.\n", 
š
,

413 
subblock_lut_size
 + 2);

414 
	`´štf
("Aborting.\n\n");

415 
	`ex™
(1);

417 
	}
}

420 
	$£t_subblock_couÁ
(
block_num
, 
num_subblocks
)

424 ià(
block_num
 >ğ
‹mp_block_¡Üage
) {

425 
‹mp_block_¡Üage
 *= 2;

426 
num_subblocks_³r_block
 = (*)
	`my_»®loc
(num_subblocks_per_block,

427 
‹mp_block_¡Üage
 * ());

430 
num_subblocks_³r_block
[
block_num
] = 
num_subblocks
;

431 
	}
}

434 * 
	$·r£_subblocks
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
buf
,

435 
block_num
)

438 
‹mp_buf
[
BUFSIZE
], *
±r
;

439 
num_subblocks
;

440 
num_subblocks
 = 0;

443 
±r
 = 
	`my_fg‘s
(
‹mp_buf
, 
BUFSIZE
, 
å_Ãt
);

445 ià(
±r
 =ğ
NULL
) {

450 
	`¡rıy
(
buf
, 
‹mp_buf
);

451 
±r
 = 
	`my_¡¹ok
(
‹mp_buf
, 
TOKENS
, 
å_Ãt
,emp_buf);

453 ià(
±r
 =ğ
NULL
) {

457 ià(
	`¡rcmp
("subblock:", 
±r
) == 0) {

458 
num_subblocks
++;

459 
	`lßd_subblock_¬¿y
(
dßÎ
, 
å_Ãt
, 
‹mp_buf
, 
num_subblocks
,

460 
block_num
);

466 ià(
num_subblocks
 < 1 ||‚um_subblock > 
max_subblocks_³r_block
) {

467 
	`´štf
("Error in…arse_subblocks on†ine %d of‚etlist file.\n",

468 
lš’um
);

469 
	`´štf
("Block #%d has %d subblocks. Out of„ange.\n",

470 
block_num
, 
num_subblocks
);

471 
	`´štf
("Aborting.\n\n");

472 
	`ex™
(1);

475 ià(
dßÎ
 == 0) {

476 
	`£t_subblock_couÁ
(
block_num
, 
num_subblocks
);

478 
	`as£¹
(
num_subblocks
 =ğ
num_subblocks_³r_block
[
block_num
]);

481  (
±r
);

482 
	}
}

485 * 
	$add_şb
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
buf
)

491 ++
num_blocks
;

492 
	`·r£_Çme_ªd_pšli¡
(
dßÎ
,

493 
å_Ãt
,

494 
buf
);

495 ++
num_şbs
;

496 ià(
dßÎ
) {

497 
blocks
[
num_blocks
 - 1].
block_ty³
 = 
B_CLB_TYPE
;

501 
š‘
 = 0;

502 
pš_šdex
 = -1;

503 * 
±r
 = 
	`my_¡¹ok
(
NULL
,

504 
TOKENS
,

505 
å_Ãt
,

506 
buf
);

507 
±r
 !ğ
NULL
) {

508 ++
pš_šdex
;

509 ià(
pš_šdex
 >ğ
max_pšs_³r_şb
) {

510 
	`´štf
("E¼Ü iÀadd_şb oÀlš%d oàÃi¡ fe.\n", 
lš’um
);

511 
	`´štf
("ToØmªy…š Úhi şb. Ex³ùed %d.\n", 
max_pšs_³r_şb
);

512 
	`ex™
(1);

515 
işass
 = 
şb_pš_şass
[
pš_šdex
];

516 
pš_ty³s_t
 
ty³
 = 
şass_šf
[
işass
].type;

518 ià(
	`¡rcmp
(
±r
, "open") != 0) {

519 
š‘
 = 
	`add_Ãt
(
±r
,

520 
ty³
,

521 
num_blocks
 - 1,

522 
pš_šdex
,

523 
dßÎ
);

524 ià(
dßÎ
) {

525 
blocks
[
num_blocks
 - 1].
Ãts
[
pš_šdex
] = 
š‘
;

528 ià(
dßÎ
) {

529 
blocks
[
num_blocks
 - 1].
Ãts
[
pš_šdex
] = 
OPEN
;

533 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
buf
);

536 ià(
pš_šdex
 !ğ
max_pšs_³r_şb
 - 1) {

537 
	`´štf
("E¼Ü iÀadd_şb oÀlš%d oàÃi¡ fe.\n", 
lš’um
);

538 
	`´štf
("Ex³ùed %d…š Ú clb, gÙ %d.\n", 
max_pšs_³r_şb
, 
pš_šdex
 + 1);

539 
	`ex™
(1);

542 
±r
 = 
	`·r£_subblocks
(
dßÎ
, 
å_Ãt
, 
buf
, 
num_blocks
 - 1);

543  (
±r
);

544 
	}
}

550 
	$add_io
(
dßÎ
,

551 cÚ¡ 
block_ty³s_t
 
kblock_ty³
,

552 
FILE
* 
å_Ãt
,

553 * 
buf
)

555 ++
num_blocks
;

556 
š‘
, 
i
;

558 ià(
dßÎ
 == 0) {

559 
	`£t_subblock_couÁ
(
num_blocks
 - 1, 0);

562 
	`·r£_Çme_ªd_pšli¡
(
dßÎ
, 
å_Ãt
, 
buf
);

564 
pš_ty³s_t
 
pš_ty³
;

565 ià(
kblock_ty³
 =ğ
INPAD_TYPE
) {

566 ++
num_´im¬y_šputs
;

567 
pš_ty³
 = 
DRIVER
;

569 ++
num_´im¬y_ouuts
;

570 
pš_ty³
 = 
RECEIVER
;

573 ià(
dßÎ
) {

574 
blocks
[
num_blocks
 - 1].
block_ty³
 = 
kblock_ty³
;

577 
pš_šdex
 = -1;

578 * 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
buf
);

579 
±r
 !ğ
NULL
) {

580 ++
pš_šdex
;

581 ià(
pš_šdex
 >= 1) {

582 
	`´štf
("E¼Ü iÀadd_iØÚ†š%d oàÃi¡ fe.\n", 
lš’um
);

583 
	`´štf
("Too many…ins onhis io. Expected 1.\n");

584 
	`ex™
(1);

587 ià(
	`¡rcmp
(
±r
, "open") == 0) {

588 
	`´štf
("E¼Ü iÀadd_io,†š%d oàÃi¡ fe.\n", 
lš’um
);

589 
	`´štf
("Inputs‡nd Outputs cannot have open…ins.\n");

590 
	`ex™
(1);

596 
š‘
 = 
	`add_Ãt
(
±r
,

597 
pš_ty³
,

598 
num_blocks
 - 1,

599 
OPEN
,

600 
dßÎ
);

601 ià(
dßÎ
) {

602 
blocks
[
num_blocks
 - 1].
Ãts
[
pš_šdex
] = 
š‘
;

605 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
buf
);

608 ià(
pš_šdex
 != 0) {

609 
	`´štf
("E¼Ü iÀadd_iØÚ†š%d oàÃi¡ fe.\n", 
lš’um
);

610 
	`´štf
("Ex³ùed 1…š oÀ·d, gÙ %d.\n", 
pš_šdex
 + 1);

611 
	`ex™
(1);

614 ià(
dßÎ
) {

615 
i
 = 1; i < 
max_pšs_³r_şb
; i++) {

616 
blocks
[
num_blocks
 - 1].
Ãts
[
i
] = 
OPEN
;

619 
	}
}

630 
	$·r£_Çme_ªd_pšli¡
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
buf
)

633 * 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
buf
);

634 ià(
±r
 =ğ
NULL
) {

635 
	`´štf
("Error in…arse_name_and_pinlist on†ine %d of‚etlist file.\n",

636 
lš’um
);

637 
	`´štf
(".clb, .input or .output†ine has‚o‡ssociated‚ame.\n");

638 
	`ex™
(1);

642 
Ën
 = 0;

643 ià(
dßÎ
 == 1) {

644 
Ën
 = 
	`¡¾’
(
±r
);

645 
blocks
[
num_blocks
 - 1].
Çme
 = (*)
	`my_chunk_m®loc
((
Ën
 + 1) * (),

646 
NULL
,

647 &
chunk_by‹s_ava
,

648 &
chunk_Ãxt_ava_mem
);

649 
	`¡rıy
(
blocks
[
num_blocks
 - 1].
Çme
, 
±r
);

652 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
buf
);

653 ià(
±r
 !ğ
NULL
) {

654 
	`´štf
("Error in…arse_name_and_pinlist on†ine %d of‚etlist file.\n",

655 
lš’um
);

656 
	`´štf
("Extra characters‡tƒnd of†ine.\n");

657 
	`ex™
(1);

664 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å_Ãt
);

665 ià(
±r
 =ğ
NULL
) {

666 
	`´štf
("Error in…arse_name_and_pinlist on†ine %d of‚etlist file.\n",

667 
lš’um
);

668 
	`´štf
("Missing…inlist: keyword.\n");

669 
	`ex™
(1);

672 
±r
 = 
	`my_¡¹ok
(
buf
, 
TOKENS
, 
å_Ãt
, buf);

673 } 
±r
 =ğ
NULL
);

675 ià(
	`¡rcmp
(
±r
, "pinlist:") != 0) {

676 
	`´štf
("Error in…arse_name_and_pinlist on†ine %d of‚etlist file.\n",

677 
lš’um
);

678 
	`´štf
("Ex³ùed…šli¡: keywÜd, gÙ %s.\n", 
±r
);

679 
	`ex™
(1);

681 
	}
}

684 
	$add_glob®
(
dßÎ
, 
FILE
* 
å_Ãt
, * 
buf
)

693 
hash_t
* 
h_±r
;

696 ià(
dßÎ
 == 0) {

700 * 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
buf
);

701 
nšdex
;

702 
±r
 !ğ
NULL
) {

703 
num_glob®s
++;

704 
h_±r
 = 
	`g‘_hash_’Œy
(
hash_bË
, 
±r
);

706 ià(
h_±r
 =ğ
NULL
) {

707 
	`´štf
("E¼Ü iÀadd_glob® oÀÃi¡ flš%d.\n", 
lš’um
);

708 
	`´štf
("Glob® sigÇÈ% dÛ nÙƒxi¡.\n", 
±r
);

709 
	`ex™
(1);

712 
nšdex
 = 
h_±r
->
šdex
;

713 
is_glob®
[
nšdex
] = 
TRUE
;

714 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å_Ãt
, 
buf
);

716 
	}
}

719 
	$add_Ãt
(* 
±r
,

720 
pš_ty³s_t
 
ty³
,

721 
block_num
,

722 
block_pš_num
,

723 
dßÎ
)

731 
hash_t
* 
h_±r
;

732 
j
, 
Ãt_šdex
;

734 ià(
dßÎ
 == 0) {

735 
h_±r
 = 
	`š£¹_š_hash_bË
(
hash_bË
,

736 
±r
,

737 
num_Ãts
);

738 
Ãt_šdex
 = 
h_±r
->
šdex
;

739 ià(
Ãt_šdex
 =ğ
num_Ãts
) {

740 ++
num_Ãts
;

743 
h_±r
 = 
	`g‘_hash_’Œy
(
hash_bË
,

744 
±r
);

745 ià(
h_±r
 =ğ
NULL
) {

746 
	`´štf
("Error in‡dd_net:he second (load)…ass found could‚ot\n");

747 
	`´štf
("fšd‚‘ % šhsymbŞabË.\n", 
±r
);

748 
	`ex™
(1);

751 
Ãt_šdex
 = 
h_±r
->
šdex
;

752 ++(
Ãt
[
Ãt_šdex
].
num_Ãt_pšs
);

754 ià(
ty³
 =ğ
DRIVER
) {

755 ++
num_driv”
[
Ãt_šdex
];

756 
j
 = 0;

758 
j
 = 
Ãt
[
Ãt_šdex
].
num_Ãt_pšs
 - 
num_driv”
[net_index];

761 ià(
j
 >ğ
‹mp_num_pšs
[
Ãt_šdex
]) {

762 
	`´štf
("Error: Net #%d (%s) has‚o driver‡nd will cause\n",

763 
Ãt_šdex
, 
±r
);

764 
	`´štf
("memory corruption.\n");

765 
	`ex™
(1);

769 
Ãt
[
Ãt_šdex
].
node_blocks
[
j
] = 
block_num
;

770 
Ãt
[
Ãt_šdex
].
node_block_pšs
[
j
] = 
block_pš_num
;

772  
Ãt_šdex
;

773 
	}
}

776 
	$ä“_·r£
()

779 
	`ä“
(
num_driv”
);

780 
	`ä“_hash_bË
(
hash_bË
);

781 
	`ä“
(
‹mp_num_pšs
);

782 
	}
}

	@read_netlist.h

1 #iâdeà
READ_NETLIST_H


2 
	#READ_NETLIST_H


	)

4 
	~"v´_ty³s.h
"

6 
»ad_Ãi¡
(* 
Ãt_fe
,

7 
subblock_d©a_t
* 
subblock_d©a_±r
);

	@read_place.c

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~"ut.h
"

4 
	~"v´_ty³s.h
"

5 
	~"glob®s.h
"

6 
	~"hash.h
"

7 
	~"»ad_¶aû.h
"

9 
g‘_subblock
(
i
, 
j
, 
block_num
);

11 
»ad_¶aû_h—d”
(
FILE
* 
å
, * 
Ãt_fe
, * 
¬ch_fe
,

12 * 
buf
);

14 
	$»ad_u£r_·d_loc
(* 
·d_loc_fe
)

17 
hash_t
** 
hash_bË
, *
h_±r
;

18 
buf
[
BUFSIZE
], 
bÇme
[BUFSIZE], *
±r
;

19 
	`´štf
("\nR—dšg†oÿtiÚ oàIO_TYPE…ad äom %s.\n", 
·d_loc_fe
);

20 
lš’um
 = 0;

21 
FILE
* 
å
 = 
	`my_fİ’
(
·d_loc_fe
, "r");

22 
hash_bË
 = 
	`®loc_hash_bË
();

24 
iblk
, 
i
, 
j
, 
xtmp
, 
ytmp
, 
block_num
, 
isubblk
;

25 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

26 ià(
blocks
[
iblk
].
block_ty³
 =ğ
INPAD_TYPE


27 || 
blocks
[
iblk
].
block_ty³
 =ğ
OUTPAD_TYPE
) {

28 
h_±r
 = 
	`š£¹_š_hash_bË
(
hash_bË
, 
blocks
[
iblk
].
Çme
, iblk);

29 
blocks
[
iblk
].
x
 = 
OPEN
;

33 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

34 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

35 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

36 
isubblk
 = 0; isubblk < 
io_¿tio
; ++isubblk) {

37 
bš_grids
[
i
][
j
].
š_blocks
[
isubblk
] = 
OPEN
;

43 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

44 
±r
 !ğ
NULL
) {

45 
±r
 = 
	`my_¡¹ok
(
buf
, 
TOKENS
, 
å
, buf);

47 ià(
±r
 =ğ
NULL
) {

48 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

52 
	`¡rıy
(
bÇme
, 
±r
);

53 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

55 ià(
±r
 =ğ
NULL
) {

56 
	`´štf
("E¼Ü:†š%d i šcom¶‘e.\n", 
lš’um
);

57 
	`ex™
(1);

60 
	`ssÿnf
(
±r
, "%d", &
xtmp
);

61 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

63 ià(
±r
 =ğ
NULL
) {

64 
	`´štf
("E¼Ü:†š%d i šcom¶‘e.\n", 
lš’um
);

65 
	`ex™
(1);

68 
	`ssÿnf
(
±r
, "%d", &
ytmp
);

69 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

71 ià(
±r
 =ğ
NULL
) {

72 
	`´štf
("E¼Ü:†š%d i šcom¶‘e.\n", 
lš’um
);

73 
	`ex™
(1);

76 
	`ssÿnf
(
±r
, "%d", &
isubblk
);

77 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

79 ià(
±r
 !ğ
NULL
) {

80 
	`´štf
("E¼Ü:ƒxŒ¨ch¬aù” ©ƒnd oàlš%d.\n", 
lš’um
);

81 
	`ex™
(1);

84 
h_±r
 = 
	`g‘_hash_’Œy
(
hash_bË
, 
bÇme
);

86 ià(
h_±r
 =ğ
NULL
) {

87 
	`´štf
("Error: blocks %s on†ine %d:‚o such IO_TYPE…ad.\n",

88 
bÇme
, 
lš’um
);

89 
	`ex™
(1);

92 
block_num
 = 
h_±r
->
šdex
;

93 
i
 = 
xtmp
;

94 
j
 = 
ytmp
;

96 ià(
blocks
[
block_num
].
x
 !ğ
OPEN
) {

97 
	`´štf
("Error:†ine %d. Block %s†istedwice in…ad file.\n",

98 
lš’um
, 
bÇme
);

99 
	`ex™
(1);

102 ià(
i
 < 0 || i > 
num_grid_cŞumns
 + 1 || 
j
 < 0 || j > 
num_grid_rows
 + 1) {

103 
	`´štf
("E¼Ü: block #%d (%sèloÿtiÚ\n", 
block_num
, 
bÇme
);

104 
	`´štf
("(%d,%dèi ouˆoà¿nge.\n", 
i
, 
j
);

105 
	`ex™
(1);

108 
blocks
[
block_num
].
x
 = 
i
;

109 
blocks
[
block_num
].
y
 = 
j
;

111 ià(
bš_grids
[
i
][
j
].
grid_ty³
 !ğ
IO_TYPE
) {

112 
	`´štf
("E¼Ü:‡‰em±Ø¶aû IO_TYPE block % š \n", 
bÇme
);

113 
	`´štf
("ª iÎeg®†oÿtiÚ (%d, %d).\n", 
i
, 
j
);

114 
	`ex™
(1);

117 ià(
isubblk
 >ğ
io_¿tio
 || isubblk < 0) {

118 
	`´štf
("Error: Block %s subblock‚umber (%d) on†ine %d is out of "

119 "¿nge.\n", 
bÇme
, 
isubblk
, 
lš’um
);

120 
	`ex™
(1);

123 
bš_grids
[
i
][
j
].
š_blocks
[
isubblk
] = 
block_num
;

124 ++
bš_grids
[
i
][
j
].
m_u§ge
;

125 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

128 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

129 ià((
blocks
[
iblk
].
block_ty³
 =ğ
INPAD_TYPE


130 || 
blocks
[
iblk
].
block_ty³
 =ğ
OUTPAD_TYPE
è&& blocks[iblk].
x
 =ğ
OPEN
) {

131 
	`´štf
("Error: IO_TYPE blocks %s†ocation was‚ot specified in "

132 "th·d fe.\n", 
blocks
[
iblk
].
Çme
);

133 
	`ex™
(1);

137 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

138 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

139 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

140 
isubblk
 = 0; isubblk < 
bš_grids
[
i
][
j
].
m_u§ge
; ++isubblk) {

141 ià(
bš_grids
[
i
][
j
].
š_blocks
[
isubblk
] =ğ
OPEN
) {

142 
	`´štf
("Error: The IO_TYPE blocks‡t (%d, %d) do‚ot have \n"

143 "cÚ£cutivsubblock‚umb” ¡¬tšg‡ˆ0.\n", 
i
, 
j
);

144 
	`ex™
(1);

151 
	`fşo£
(
å
);

152 
	`ä“_hash_bË
(
hash_bË
);

153 
	`´štf
("SucûssfuÎy„—d %s.\n\n", 
·d_loc_fe
);

154 
	}
}

157 
	$dump_şbs
()

160 
i
, 
j
, 
šdex
;

162 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

163 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

164 
	`´štf
("clb (%d,%d):ype: %d m_usage: %d\n",

165 
i
, 
j
, 
bš_grids
[i][j].
grid_ty³
,

166 
bš_grids
[
i
][
j
].
m_u§ge
);

168 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

169 
	`´štf
("blocks: %d\n", 
bš_grids
[
i
][
j
].
š_blocks
[0]);

172 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

173 
	`´štf
("io_blocks: ");

175 cÚ¡ 
kio_bš_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

176 
šdex
 = 0; index < 
kio_bš_ÿ·c™y
; ++index) {

177 
	`´štf
("%d ", 
bš_grids
[
i
][
j
].
š_blocks
[
šdex
]);

180 
	`´štf
("\n");

185 
i
 = 0; i < 
num_blocks
; ++i) {

186 
	`´štf
("blocks: %d, (i,j,k): (%d, %d, %d)\n", 
i
,

187 
blocks
[
i
].
x
, blocks[i].
y
, blocks[i].
z
);

189 
	}
}

192 
	$´št_¶aû
(* 
¶aû_fe
, * 
Ãt_fe
, * 
¬ch_fe
)

198 
i
, 
subblock
;

199 
FILE
* 
å
 = 
	`my_fİ’
(
¶aû_fe
, "w");

200 
	`årštf
(
å
, "N‘li¡ fe: %  Arch™eùu» fe: %s\n", 
Ãt_fe
,

201 
¬ch_fe
);

202 
	`årštf
(
å
, "A¼ay size: %d x %d†ogiøblocks\n\n", 
num_grid_cŞumns
, 
num_grid_rows
);

203 
	`årštf
(
å
, "#blocks‚ame\tx\ty\tsubblk\tblock‚umber\n");

204 
	`årštf
(
å
, "#----------\t--\t--\t------\t------------\n");

206 
i
 = 0; i < 
num_blocks
; i++) {

207 
	`årštf
(
å
, "%s\t", 
blocks
[
i
].
Çme
);

209 ià(
	`¡¾’
(
blocks
[
i
].
Çme
) < 8) {

210 
	`årštf
(
å
, "\t");

213 
	`årštf
(
å
, "%d\t%d", 
blocks
[
i
].
x
, blocks[i].
y
);

215 ià(
blocks
[
i
].
block_ty³
 =ğ
B_CLB_TYPE
) {

216 
	`årštf
(
å
, "\t%d", 0);

218 
subblock
 = 
	`g‘_subblock
(
blocks
[
i
].
x
, blocks[i].
y
, i);

219 
	`årštf
(
å
, "\t%d", 
subblock
);

222 
	`årštf
(
å
, "\t#%d\n", 
i
);

225 
	`fşo£
(
å
);

226 
	}
}

229 
	$g‘_subblock
(
i
, 
j
, 
block_num
)

233 
k
;

234 
k
 = 0; k < 
io_¿tio
; ++k) {

235 ià(
bš_grids
[
i
][
j
].
š_blocks
[
k
] =ğ
block_num
) {

236  (
k
);

240 
	`´štf
("Error in get_subblock. Block %d is‚ot‡t†ocation (%d,%d)\n",

241 
block_num
, 
i
, 
j
);

242 
	`ex™
(1);

243 
	}
}

246 
	$·r£_¶aûm’t_fe
(* 
¶aû_fe
, * 
Ãt_fe
, * 
¬ch_fe
)

249 
bÇme
[
BUFSIZE
];

250 
buf
[
BUFSIZE
], *
±r
;

251 
hash_t
** 
hash_bË
, *
h_±r
;

252 
i
, 
j
, 
block_num
, 
isubblock
, 
xtmp
, 
ytmp
;

253 
	`´štf
("R—dšgh¶aûm’ˆäom f%s.\n", 
¶aû_fe
);

254 
FILE
* 
å
 = 
	`my_fİ’
(
¶aû_fe
, "r");

255 
lš’um
 = 0;

256 
	`»ad_¶aû_h—d”
(
å
, 
Ãt_fe
, 
¬ch_fe
, 
buf
);

258 cÚ¡ 
kio_bš_ÿ·c™y
 = 
g_grid_ÿ·c™y
[
IO_TYPE
];

259 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

260 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

261 
bš_grids
[
i
][
j
].
m_u§ge
 = 0;

263 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

264 
isubblock
 = 0; isubblock < 
kio_bš_ÿ·c™y
; ++isubblock) {

265 
bš_grids
[
i
][
j
].
š_blocks
[
isubblock
] = 
OPEN
;

271 
i
 = 0; i < 
num_blocks
; i++) {

272 
blocks
[
i
].
x
 = 
OPEN
;

275 
hash_bË
 = 
	`®loc_hash_bË
();

277 
i
 = 0; i < 
num_blocks
; i++) {

278 
h_±r
 = 
	`š£¹_š_hash_bË
(
hash_bË
, 
blocks
[
i
].
Çme
, i);

281 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

282 
±r
 !ğ
NULL
) {

283 
±r
 = 
	`my_¡¹ok
(
buf
, 
TOKENS
, 
å
, buf);

285 ià(
±r
 =ğ
NULL
) {

286 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

290 
	`¡rıy
(
bÇme
, 
±r
);

291 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

293 ià(
±r
 =ğ
NULL
) {

294 
	`´štf
("E¼Ü:†š%d i šcom¶‘e.\n", 
lš’um
);

295 
	`ex™
(1);

298 
	`ssÿnf
(
±r
, "%d", &
xtmp
);

299 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

301 ià(
±r
 =ğ
NULL
) {

302 
	`´štf
("E¼Ü:†š%d i šcom¶‘e.\n", 
lš’um
);

303 
	`ex™
(1);

306 
	`ssÿnf
(
±r
, "%d", &
ytmp
);

307 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

308 ià(
±r
 =ğ
NULL
) {

309 
	`´štf
("E¼Ü:†š%d i šcom¶‘e.\n", 
lš’um
);

310 
	`ex™
(1);

313 
	`ssÿnf
(
±r
, "%d", &
isubblock
);

314 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

315 ià(
±r
 !ğ
NULL
) {

316 
	`´štf
("E¼Ü:ƒxŒ¨ch¬aù” ©ƒnd oàlš%d.\n", 
lš’um
);

317 
	`ex™
(1);

320 
h_±r
 = 
	`g‘_hash_’Œy
(
hash_bË
, 
bÇme
);

321 ià(
h_±r
 =ğ
NULL
) {

322 
	`´štf
("Error: blocks %s on†ine %d does‚otƒxist inhe‚etlist.\n",

323 
bÇme
, 
lš’um
);

324 
	`ex™
(1);

327 
i
 = 
xtmp
;

328 
j
 = 
ytmp
;

329 
block_num
 = 
h_±r
->
šdex
;

330 ià(
blocks
[
block_num
].
x
 !ğ
OPEN
) {

331 
	`´štf
("Error:†ine %d. Block %s†istedwice in…lacement file.\n",

332 
lš’um
, 
bÇme
);

333 
	`ex™
(1);

336 ià(
i
 < 0 || i > 
num_grid_cŞumns
 + 1 || 
j
 < 0 || j > 
num_grid_rows
 + 1) {

337 
	`´štf
("E¼Ü iÀ»ad_¶aû. Block #%d (%sèloÿtiÚ\n", 
block_num
, 
bÇme
);

338 
	`´štf
("(%d,%dèi ouˆoà¿nge.\n", 
i
, 
j
);

339 
	`ex™
(1);

342 
blocks
[
block_num
].
x
 = 
i
;

343 
blocks
[
block_num
].
y
 = 
j
;

345 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

346 ià(
blocks
[
block_num
].
block_ty³
 !ğ
B_CLB_TYPE
) {

347 
	`´štf
("Error in„ead_place. Attempto…lace blocks #%d (%s) in\n",

348 
block_num
, 
bÇme
);

349 
	`´štf
("¨logiøblock loÿtiÚ (%d, %d).\n", 
i
, 
j
);

350 
	`ex™
(1);

353 
bš_grids
[
i
][
j
].
š_blocks
[0] = 
block_num
;

354 ++
bš_grids
[
i
][
j
].
m_u§ge
;

355 } ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

357 ià(
blocks
[
block_num
].
block_ty³
 !ğ
INPAD_TYPE


358 && 
blocks
[
block_num
].
block_ty³
 !ğ
OUTPAD_TYPE
) {

359 
	`´štf
("Error in„ead_place. Attempto…lace blocks #%d (%s) in\n",

360 
block_num
, 
bÇme
);

361 
	`´štf
("ª IO_TYPE block loÿtiÚ (%d, %d).\n", 
i
, 
j
);

362 
	`ex™
(1);

365 ià(
isubblock
 >ğ
io_¿tio
 || isubblock < 0) {

366 
	`´štf
("Error: Block %s subblock‚umber (%d) on†ine %d is out of "

367 "¿nge.\n", 
bÇme
, 
isubblock
, 
lš’um
);

368 
	`ex™
(1);

371 
bš_grids
[
i
][
j
].
š_blocks
[
isubblock
] = 
block_num
;

372 ++
bš_grids
[
i
][
j
].
m_u§ge
;

374 
	`´štf
("Error in„ead_place. Block #%d (%s) is in‡n illegal ",

375 
block_num
, 
bÇme
);

376 
	`´štf
("loÿtiÚ.\nLoÿtiÚ s³cif›d: (%d,%d).\n", 
i
, 
j
);

377 
	`ex™
(1);

380 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

383 
	`ä“_hash_bË
(
hash_bË
);

384 
	`fşo£
(
å
);

386 
i
 = 0; i < 
num_blocks
; i++) {

387 ià(
blocks
[
i
].
x
 =ğ
OPEN
) {

388 
	`´štf
("Error in„ead_place: blocks %s†ocation was‚ot specified in "

389 "th¶aûm’ˆfe.\n", 
blocks
[
i
].
Çme
);

390 
	`ex™
(1);

394 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

395 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

396 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

397 
isubblock
 = 0; isubblock < 
bš_grids
[
i
][
j
].
m_u§ge
; ++isubblock) {

398 ià(
bš_grids
[
i
][
j
].
š_blocks
[
isubblock
] =ğ
OPEN
) {

399 
	`´štf
("Error: The IO_TYPE blocks‡t (%d, %d) do‚ot have \n"

400 "cÚ£cutivsubblock‚umb” ¡¬tšg‡ˆ0.\n", 
i
, 
j
);

401 
	`ex™
(1);

408 
	`´štf
("SucûssfuÎy„—d %s.\n", 
¶aû_fe
);

409 
	}
}

412 
	$»ad_¶aû_h—d”
(
FILE
* 
å
, * 
Ãt_fe
, * 
¬ch_fe
,

413 * 
buf
)

417 * 
lše_Úe_Çmes
[] = {"Netlist", "file:", " ", "Architecture", "file:"};

418 * 
lše_two_Çmes
[] = {"Array", "size:", " ", "x", " ", "logic", "blocks"};

419 
Ãt_check
[
BUFSIZE
], 
¬ch_check
[BUFSIZE], *
±r
;

420 
nx_check
, 
ny_check
, 
i
;

421 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

423 ià(
±r
 =ğ
NULL
) {

424 
	`´štf
("Error:‚etlist file‡nd‡rchitecture file used‚ot†isted.\n");

425 
	`ex™
(1);

428 
±r
 = 
	`my_¡¹ok
(
buf
, 
TOKENS
, 
å
, buf);

430 
±r
 =ğ
NULL
) {

431 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

433 ià(
±r
 =ğ
NULL
) {

434 
	`´štf
("Error:‚etlist file‡nd‡rchitecture file used‚ot†isted.\n");

435 
	`ex™
(1);

438 
±r
 = 
	`my_¡¹ok
(
buf
, 
TOKENS
, 
å
, buf);

441 
i
 = 0; i <= 5; i++) {

442 ià(
i
 == 2) {

443 
	`¡rıy
(
Ãt_check
, 
±r
);

444 } ià(
i
 == 5) {

445 
	`¡rıy
(
¬ch_check
, 
±r
);

447 ià(
	`¡rcmp
(
±r
, 
lše_Úe_Çmes
[
i
]) != 0) {

448 
	`´štf
("Error on†ine %d, word %d: \n"

449 "Ex³ùed keywÜd %s, gÙ %s.\n", 
lš’um
, 
i
 + 1,

450 
lše_Úe_Çmes
[
i
], 
±r
);

451 
	`ex™
(1);

455 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

457 ià(
±r
 =ğ
NULL
 && 
i
 != 5) {

458 
	`´štf
("E¼Ü: UÃx³ùedƒnd oàlšÚ†š%d.\n", 
lš’um
);

459 
	`ex™
(1);

463 ià(
	`¡rcmp
(
Ãt_check
, 
Ãt_fe
) != 0) {

464 
	`´štf
("Warning: Placement generated with‚etlist file %s:\n",

465 
Ãt_check
);

466 
	`´štf
("cu¼’ˆÃˆfi %s.\n", 
Ãt_fe
);

469 ià(
	`¡rcmp
(
¬ch_check
, 
¬ch_fe
) != 0) {

470 
	`´štf
("Warning: Placement generated with‡rchitecture file %s:\n",

471 
¬ch_check
);

472 
	`´štf
("cu¼’ˆ¬ch™eùu» fi %s.\n", 
¬ch_fe
);

476 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

478 ià(
±r
 =ğ
NULL
) {

479 
	`´štf
("Error: Array size‚ot†isted.\n");

480 
	`ex™
(1);

483 
±r
 = 
	`my_¡¹ok
(
buf
, 
TOKENS
, 
å
, buf);

485 
±r
 =ğ
NULL
) {

486 
±r
 = 
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
);

488 ià(
±r
 =ğ
NULL
) {

489 
	`´štf
("Error:‡rray size‚ot†isted.\n");

490 
	`ex™
(1);

493 
±r
 = 
	`my_¡¹ok
(
buf
, 
TOKENS
, 
å
, buf);

496 
i
 = 0; i <= 6; i++) {

497 ià(
i
 == 2) {

498 
	`ssÿnf
(
±r
, "%d", &
nx_check
);

499 } ià(
i
 == 4) {

500 
	`ssÿnf
(
±r
, "%d", &
ny_check
);

502 ià(
	`¡rcmp
(
±r
, 
lše_two_Çmes
[
i
]) != 0) {

503 
	`´štf
("Error on†ine %d, word %d: \n"

504 "Ex³ùed keywÜd %s, gÙ %s.\n", 
lš’um
, 
i
 + 1,

505 
lše_two_Çmes
[
i
], 
±r
);

506 
	`ex™
(1);

510 
±r
 = 
	`my_¡¹ok
(
NULL
, 
TOKENS
, 
å
, 
buf
);

512 ià(
±r
 =ğ
NULL
 && 
i
 != 6) {

513 
	`´štf
("E¼Ü: UÃx³ùedƒnd oàlšÚ†š%d.\n", 
lš’um
);

514 
	`ex™
(1);

518 ià(
nx_check
 !ğ
num_grid_cŞumns
 || 
ny_check
 !ğ
num_grid_rows
) {

519 
	`´štf
("Error:…lacement file‡ssumes‡n‡rray size of %d x %d.\n",

520 
nx_check
, 
ny_check
);

521 
	`´štf
("Cu¼’ˆsizi %d x %d.\n", 
num_grid_cŞumns
, 
num_grid_rows
);

522 
	`ex™
(1);

524 
	}
}

	@read_place.h

1 #iâdeà
READ_PLACE_H


2 
	#READ_PLACE_H


	)

4 
·r£_¶aûm’t_fe
(* 
¶aû_fe
, * 
Ãt_fe
, * 
¬ch_fe
);

6 
´št_¶aû
(* 
¶aû_fe
, * 
Ãt_fe
, * 
¬ch_fe
);

8 
»ad_u£r_·d_loc
(* 
·d_loc_fe
);

10 
dump_şbs
();

	@route_breadth_first.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"rou‹_expÜt.h
"

6 
	~"rou‹_commÚ.h
"

7 
	~"rou‹_b»adth_fœ¡.h
"

12 
boŞ—n
 
b»adth_fœ¡_rou‹_Ãt
(
š‘
, 
b’d_co¡
);

14 
b»adth_fœ¡_ex·nd_Œaû_£gm’t
(
s_Œaû
* 
¡¬t_±r
,

15 
»maššg_cÚÃùiÚs_to_sšk
);

17 
b»adth_fœ¡_ex·nd_Ãighbours
(
ivex
, 
pco¡
, 
š‘
,

18 
b’d_co¡
);

20 
b»adth_fœ¡_add_sourû_to_h—p
(
š‘
);

25 
boŞ—n
 
	$Œy_b»adth_fœ¡_rou‹
(
rou‹r_İts_t
 
rou‹r_İts
,

26 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
)

34 
´es_çc
 = 
rou‹r_İts
.
fœ¡_™”_´es_çc
;

36 
™ry
, 
š‘
;

37 
™ry
 = 1; iŒy <ğ
rou‹r_İts
.
max_rou‹r_™”©iÚs
; ++itry) {

39 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

40 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

41 
	`·thfšd”_upd©e_Úe_co¡
(
Œaû_h—d
[
š‘
], -1, 
´es_çc
);

43 
boŞ—n
 
is_roubË
 = 
	`b»adth_fœ¡_rou‹_Ãt
(
š‘
,

44 
rou‹r_İts
.
b’d_co¡
);

46 ià(!
is_roubË
) {

47 
	`´štf
("Routing failed.\n");

48  (
FALSE
);

51 
	`·thfšd”_upd©e_Úe_co¡
(
Œaû_h—d
[
š‘
], 1, 
´es_çc
);

57 
boŞ—n
 
r_up_loÿl_İšs
;

58 ià(
™ry
 == 1) {

59 
r_up_loÿl_İšs
 = 
FALSE
;

61 
r_up_loÿl_İšs
 = 
TRUE
;

64 
	`»£rve_loÿÎy_u£d_İšs
(
´es_çc
, 
r_up_loÿl_İšs
,

65 
şb_İšs_u£d_loÿÎy
);

67 
boŞ—n
 
sucûss
 = 
	`ãasibË_routšg
();

68 ià(
sucûss
) {

69 
	`´štf
("SucûssfuÎy„ou‹d‡á” %d„outšg i‹¿tiÚs.\n", 
™ry
);

70  (
TRUE
);

73 ià(
™ry
 == 1) {

74 
´es_çc
 = 
rou‹r_İts
.
š™Ÿl_´es_çc
;

76 
´es_çc
 *ğ
rou‹r_İts
.
´es_çc_muÉ
;

79 
	`·thfšd”_upd©e_co¡
(
´es_çc
, 
rou‹r_İts
.
acc_çc
);

82 
	`´štf
("Routing failed.\n");

83  (
FALSE
);

84 
	}
}

87 
boŞ—n
 
	$b»adth_fœ¡_rou‹_Ãt
(
š‘
, 
b’d_co¡
)

101 
	`ä“_Œaûback
(
š‘
);

102 
	`b»adth_fœ¡_add_sourû_to_h—p
(
š‘
);

103 
	`m¬k_’ds
(
š‘
);

104 
s_Œaû
* 
Œaû_node
 = 
NULL
;

105 
»maššg_cÚÃùiÚs_to_sšk
 = 0;

107 
i
 = 0;

108 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

109 
i
 = 1; i < 
knum_Ãt_pšs
; ++i) {

110 
	`b»adth_fœ¡_ex·nd_Œaû_£gm’t
(
Œaû_node
,

111 
»maššg_cÚÃùiÚs_to_sšk
);

113 
s_h—p
* 
cu¼’t
 = 
	`g‘_h—p_h—d
();

114 ià(
cu¼’t
 =ğ
NULL
) {

115 
	`»£t_·th_co¡s
();

116  (
FALSE
);

119 
ivex
 = 
cu¼’t
->
šdex
;

120 
¼_node_rou‹_šf
[
ivex
].
rg‘_æag
 == 0) {

121 
pco¡
 = 
¼_node_rou‹_šf
[
ivex
].
·th_co¡
;

122 
Ãw_pco¡
 = 
cu¼’t
->
co¡
;

124 ià(
pco¡
 > 
Ãw_pco¡
) {

125 
¼_node_rou‹_šf
[
ivex
].
·th_co¡
 = 
Ãw_pco¡
;

126 
´ev_node
 = 
cu¼’t
->
u
.prev_node;

127 
¼_node_rou‹_šf
[
ivex
].
´ev_node
 =…rev_node;

128 
¼_node_rou‹_šf
[
ivex
].
´ev_edge
 = 
cu¼’t
->prev_edge;

130 ià(
pco¡
 > 0.99 * 
HUGE_FLOAT
) {

131 
	`add_to_mod_li¡
(&
¼_node_rou‹_šf
[
ivex
].
·th_co¡
);

134 
	`b»adth_fœ¡_ex·nd_Ãighbours
(
ivex
, 
Ãw_pco¡
, 
š‘
, 
b’d_co¡
);

137 
	`ä“_h—p_d©a
(
cu¼’t
);

138 
cu¼’t
 = 
	`g‘_h—p_h—d
();

139 ià(
cu¼’t
 =ğ
NULL
) {

140 
	`»£t_·th_co¡s
();

141  (
FALSE
);

144 
ivex
 = 
cu¼’t
->
šdex
;

147 
¼_node_rou‹_šf
[
ivex
].
rg‘_æag
--;

148 
»maššg_cÚÃùiÚs_to_sšk
 = 
¼_node_rou‹_šf
[
ivex
].
rg‘_æag
;

149 
Œaû_node
 = 
	`upd©e_Œaûback
(
cu¼’t
, 
š‘
);

150 
	`ä“_h—p_d©a
(
cu¼’t
);

153 
	`em±y_h—p
();

154 
	`»£t_·th_co¡s
();

155  (
TRUE
);

156 
	}
}

159 
	$b»adth_fœ¡_ex·nd_Œaû_£gm’t
(
s_Œaû
* 
¡¬t_±r
,

160 
»maššg_cÚÃùiÚs_to_sšk
)

178 
s_Œaû
* 
Œ
 = 
¡¬t_±r
;

179 ià(
»maššg_cÚÃùiÚs_to_sšk
 == 0) {

180 
Œ
 !ğ
NULL
) {

182 
	`node_to_h—p
(
Œ
->
šdex
, 0., 
NO_PREVIOUS
, NO_PREVIOUS, 
OPEN
, OPEN);

183 
Œ
 =±r->
Ãxt
;

191 ià(
Œ
 =ğ
NULL
) {

195 
s_Œaû
* 
Ãxt_±r
 = 
Œ
->
Ãxt
;

196 
Ï¡_š_node
 = 
OPEN
;

200 
Ãxt_±r
 !ğ
NULL
) {

201 
ivex
 = 
Œ
->
šdex
;

202 
	`node_to_h—p
(
ivex
, 0.0, 
NO_PREVIOUS
, NO_PREVIOUS, 
OPEN
, OPEN);

204 ià(
¼_node
[
ivex
].
ty³
 =ğ
IPIN
) {

205 
Ï¡_š_node
 = 
ivex
;

208 
Œ
 = 
Ãxt_±r
;

209 
Ãxt_±r
 = 
Œ
->
Ãxt
;

217 
¼_node_rou‹_šf
[
Ï¡_š_node
].
·th_co¡
 = -
HUGE_FLOAT
;

220 
sšk_node
 = 
Œ
->
šdex
;

221 
¼_node_rou‹_šf
[
sšk_node
].
·th_co¡
 = 
HUGE_FLOAT
;

225 
	`šv®id©e_h—p_’Œ›s
(
sšk_node
, 
Ï¡_š_node
);

227 
	}
}

230 
	$b»adth_fœ¡_ex·nd_Ãighbours
(
ivex
, 
pco¡
, 
š‘
,

231 
b’d_co¡
)

236 
icÚn
, 
to_node
, 
num_edges
;

237 
¼_ty³s_t
 
äom_ty³
, 
to_ty³
;

238 
tÙ_co¡
;

239 
num_edges
 = 
¼_node
[
ivex
].num_edges;

241 
icÚn
 = 0; icÚÀ< 
num_edges
; iconn++) {

242 
to_node
 = 
¼_node
[
ivex
].
edges
[
icÚn
];

244 ià(
¼_node
[
to_node
].
xhigh
 < 
rou‹_bb
[
š‘
].
xmš
 ||

245 
¼_node
[
to_node
].
xlow
 > 
rou‹_bb
[
š‘
].
xmax
 ||

246 
¼_node
[
to_node
].
yhigh
 < 
rou‹_bb
[
š‘
].
ymš
 ||

247 
¼_node
[
to_node
].
ylow
 > 
rou‹_bb
[
š‘
].
ymax
) {

251 
tÙ_co¡
 = 
pco¡
 + 
	`g‘_¼_cÚg_co¡
(
to_node
);

253 ià(
b’d_co¡
 != 0.) {

254 
äom_ty³
 = 
¼_node
[
ivex
].
ty³
;

255 
to_ty³
 = 
¼_node
[
to_node
].
ty³
;

257 ià((
äom_ty³
 =ğ
CHANX
 && 
to_ty³
 =ğ
CHANY
) ||

258 (
äom_ty³
 =ğ
CHANY
 && 
to_ty³
 =ğ
CHANX
)) {

259 
tÙ_co¡
 +ğ
b’d_co¡
;

263 
	`node_to_h—p
(
to_node
, 
tÙ_co¡
, 
ivex
, 
icÚn
, 
OPEN
, OPEN);

265 
	}
}

268 
	$b»adth_fœ¡_add_sourû_to_h—p
(
š‘
)

271 
ivex
 = 
Ãt_¼_‹rmš®s
[
š‘
][0];

272 
co¡
 = 
	`g‘_¼_cÚg_co¡
(
ivex
);

273 
	`node_to_h—p
(
ivex
, 
co¡
, 
NO_PREVIOUS
, NO_PREVIOUS, 
OPEN
, OPEN);

274 
	}
}

	@route_breadth_first.h

1 #iâdeà
ROUTE_BREATH_FIRST_H


2 
	#ROUTE_BREATH_FIRST_H


	)

4 
	~"v´_ty³s.h
"

6 
boŞ—n
 
Œy_b»adth_fœ¡_rou‹
(
rou‹r_İts_t
 
rou‹r_İts
,

7 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
);

	@route_common.c

1 
	~<m©h.h
>

2 
	~<¡dio.h
>

3 
	~"ut.h
"

4 
	~"v´_ty³s.h
"

5 
	~"glob®s.h
"

6 
	~"rou‹_expÜt.h
"

7 
	~"rou‹_commÚ.h
"

8 
	~"rou‹_Œ“_timšg.h
"

9 
	~"rou‹_timšg.h
"

10 
	~"rou‹_b»adth_fœ¡.h
"

11 
	~"¶aû_ªd_rou‹.h
"

12 
	~"¼_g¿ph.h
"

16 
¼_node_t_rou‹_šf
* 
	g¼_node_rou‹_šf
 = 
NULL
;

18 
bbox_t
* 
	grou‹_bb
 = 
NULL
;

23 
s_h—p
** 
	gh—p
;

24 
	gh—p_size
;

25 
	gh—p_
;

28 
s_h—p
* 
	gh—p_ä“_h—d
 = 
NULL
;

31 
s_Œaû
* 
	gŒaû_ä“_h—d
 = 
NULL
;

33 #ifdeà
DEBUG


34 
	gnum_Œaû_®loÿ‹d
 = 0;

35 
	gnum_h—p_®loÿ‹d
 = 0;

36 
	gnum_lšked_f_poš‹r_®loÿ‹d
 = 0;

39 
s_lšked_f_poš‹r
* 
	g¼_modif›d_h—d
 = 
NULL
;

40 
s_lšked_f_poš‹r
* 
	glšked_f_poš‹r_ä“_h—d
 = 
NULL
;

73 
ä“_Œaû_d©a
(
s_Œaû
* 
Œ
);

74 
lßd_rou‹_bb
(
bb_çùÜ
);

76 
s_Œaû
* 
®loc_Œaû_d©a
();

77 
add_to_h—p
(
s_h—p
* 
h±r
);

78 
s_h—p
* 
®loc_h—p_d©a
();

79 
s_lšked_f_poš‹r
* 
®loc_lšked_f_poš‹r
();

81 
veùÜ_t
** 
®loc_ªd_lßd_şb_İšs_u£d_loÿÎy
(
subblock_d©a_t


82 
subblock_d©a
);

83 
adju¡_Úe_¼_occ_ªd_pco¡
(
ivex
, 
add_Ü_sub
, 

84 
´es_çc
);

90 
	$§ve_routšg
(
s_Œaû
** 
be¡_routšg
, 
veùÜ_t


91 ** 
şb_İšs_u£d_loÿÎy
, 
veùÜ_t
** 
§ved_şb_İšs_u£d_loÿÎy
)

100 
š‘
, 
iblk
, 
işass
, 
š
, 
num_loÿl_İšs
;

101 
s_Œaû
* 
Œ
, *
‹mµŒ
;

103 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

105 
Œ
 = 
be¡_routšg
[
š‘
];

107 
Œ
 !ğ
NULL
) {

108 
‹mµŒ
 = 
Œ
->
Ãxt
;

109 
	`ä“_Œaû_d©a
(
Œ
);

110 
Œ
 = 
‹mµŒ
;

114 
be¡_routšg
[
š‘
] = 
Œaû_h—d
[inet];

117 
Œaû_h—d
[
š‘
] = 
NULL
;

118 
Œaû_
[
š‘
] = 
NULL
;

123 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

124 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

125 
num_loÿl_İšs
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

127 
š
 = 0; ipš < 
num_loÿl_İšs
; ipin++) {

128 
§ved_şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
] =

129 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
];

133 
	}
}

136 
	$»¡Üe_routšg
(
s_Œaû
** 
be¡_routšg
, 
veùÜ_t


137 ** 
şb_İšs_u£d_loÿÎy
, 
veùÜ_t
** 
§ved_şb_İšs_u£d_loÿÎy
)

145 
š‘
, 
iblk
, 
š
, 
işass
, 
num_loÿl_İšs
;

147 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

149 
	`ä“_Œaûback
(
š‘
);

151 
Œaû_h—d
[
š‘
] = 
be¡_routšg
[inet];

152 
be¡_routšg
[
š‘
] = 
NULL
;

157 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

158 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

159 
num_loÿl_İšs
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

161 
š
 = 0; ipš < 
num_loÿl_İšs
; ipin++) {

162 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
] =

163 
§ved_şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
];

167 
	}
}

170 
	$g‘_£rŸl_num
()

175 
š‘
, 
£rŸl_num
, 
ivex
;

176 
s_Œaû
* 
Œ
;

177 
£rŸl_num
 = 0;

179 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

182 
Œ
 = 
Œaû_h—d
[
š‘
];

184 
Œ
 !ğ
NULL
) {

185 
ivex
 = 
Œ
->
šdex
;

186 
£rŸl_num
 +ğ(
š‘
 + 1è* (
¼_node
[
ivex
].
xlow
 * (
num_grid_cŞumns
 + 1) -

187 
¼_node
[
ivex
].
yhigh
);

188 
£rŸl_num
 -ğ
¼_node
[
ivex
].
±c_num
 * (
š‘
 + 1) * 10;

189 
£rŸl_num
 -ğ
¼_node
[
ivex
].
ty³
 * (
š‘
 + 1) * 100;

190 
£rŸl_num
 %= 2000000000;

191 
Œ
 =±r->
Ãxt
;

195 
	`´štf
("Serial‚umber (magic cookie) forhe„outing is: %d\n",

196 
£rŸl_num
);

197 
	}
}

201 
boŞ—n
 
	$Œy_rou‹
(
width_çc
, 
rou‹r_İts_t
 
rou‹r_İts
,

202 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

203 
£gm’t_šfo_t
* 
£gm’t_šf
, 
timšg_šfo_t
 
timšg_šf
,

204 ** 
Ãt_¦ack
, ** 
Ãt_d–ay
,

205 
chª_width_di¡r_t
 
chª_width_di¡
,

206 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
)

214 
	`´štf
("\nAttempting„outing with‡ width factor (usually maximum channel ");

215 
	`´štf
("widthèoà%d.\n", 
width_çc
);

218 
	`š™_chªÃl_t
(
width_çc
, 
chª_width_di¡
);

221 
	`ä“_¼_g¿ph
();

224 
	`bud_¼_g¿ph
(
rou‹r_İts
.
rou‹_ty³
, 
d‘_routšg_¬ch
, 
£gm’t_šf
,

225 
timšg_šf
, 
rou‹r_İts
.
rou‹r_ba£_co¡_ty³
);

228 
	`ä“_¼_g¿ph_š‹º®s
(
rou‹r_İts
.
rou‹_ty³
, 
d‘_routšg_¬ch
, 
£gm’t_šf
,

229 
timšg_šf
, 
rou‹r_İts
.
rou‹r_ba£_co¡_ty³
);

233 
	`®loc_ªd_lßd_¼_node_rou‹_¡ruùs
();

234 
	`š™_rou‹_¡ruùs
(
rou‹r_İts
.
bb_çùÜ
);

236 
boŞ—n
 
sucûss
;

237 ià(
rou‹r_İts
.
rou‹r_®gÜ™hm
 =ğ
BREADTH_FIRST
) {

238 
sucûss
 = 
	`Œy_b»adth_fœ¡_rou‹
(
rou‹r_İts
, 
şb_İšs_u£d_loÿÎy
);

240 
sucûss
 = 
	`Œy_timšg_driv’_rou‹
(
rou‹r_İts
, 
Ãt_¦ack
, 
Ãt_d–ay
,

241 
şb_İšs_u£d_loÿÎy
);

244 
	`ä“_¼_node_rou‹_¡ruùs
();

245  (
sucûss
);

246 
	}
}

249 
boŞ—n
 
	$ãasibË_routšg
()

254 
ivex
;

256 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++)

257 ià(
¼_node
[
ivex
].
m_u§ge
 >„r_node[ivex].
ÿ·c™y
) {

258  (
FALSE
);

261  (
TRUE
);

262 
	}
}

265 
	$·thfšd”_upd©e_Úe_co¡
(
s_Œaû
* 
rou‹_£gm’t_¡¬t
,

266 
add_Ü_sub
, 
´es_çc
)

275 
s_Œaû
* 
Œ
;

276 
ivex
, 
m_u§ge
, 
ÿ·c™y
;

277 
Œ
 = 
rou‹_£gm’t_¡¬t
;

279 ià(
Œ
 =ğ
NULL
) {

284 
ivex
 = 
Œ
->
šdex
;

285 
m_u§ge
 = 
¼_node
[
ivex
].m_u§g+ 
add_Ü_sub
;

286 
ÿ·c™y
 = 
¼_node
[
ivex
].capacity;

287 
¼_node
[
ivex
].
m_u§ge
 = m_usage;

293 ià(
m_u§ge
 < 
ÿ·c™y
) {

294 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
 = 1.;

296 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
 = 1. + (
m_u§ge
 + 1 - 
ÿ·c™y
) *

297 
´es_çc
;

300 ià(
¼_node
[
ivex
].
ty³
 =ğ
SINK
) {

301 
Œ
 =±r->
Ãxt
;

303 ià(
Œ
 =ğ
NULL
) {

308 
Œ
 =±r->
Ãxt
;

310 
	}
}

313 
	$·thfšd”_upd©e_co¡
(
´es_çc
, 
acc_çc
)

322 
ivex
, 
m_u§ge
, 
ÿ·c™y
;

324 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

325 
m_u§ge
 = 
¼_node
[
ivex
].m_usage;

326 
ÿ·c™y
 = 
¼_node
[
ivex
].capacity;

328 ià(
m_u§ge
 > 
ÿ·c™y
) {

329 
¼_node_rou‹_šf
[
ivex
].
acc_co¡
 +ğ(
m_u§ge
 - 
ÿ·c™y
è* 
acc_çc
;

330 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
 = 1. + (
m_u§ge
 + 1 - 
ÿ·c™y
) *

331 
´es_çc
;

335 ià(
m_u§ge
 =ğ
ÿ·c™y
) {

336 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
 = 1. + 
´es_çc
;

339 
	}
}

342 
	$š™_rou‹_¡ruùs
(
bb_çùÜ
)

346 
i
;

348 
i
 = 0; i < 
num_Ãts
; i++) {

349 
	`ä“_Œaûback
(
i
);

352 
	`lßd_rou‹_bb
(
bb_çùÜ
);

357 ià(
¼_modif›d_h—d
 !ğ
NULL
) {

358 
	`´štf
("Error in init_route_structs. List of modified„r‚odes is \n"

360 
	`ex™
(1);

363 ià(
h—p_
 != 1) {

364 
	`´štf
("Error in init_route_structs. Heap is‚otƒmpty.\n");

365 
	`ex™
(1);

367 
	}
}

370 
s_Œaû
* 
	$upd©e_Œaûback
(
s_h—p
* 
h±r
, 
š‘
) {

385 
s_Œaû
* 
Œ
, *
´ev±r
, *
‹m±a
, *
»t_±r
;

386 
ivex
;

387 
›dge
;

388 #ifdeà
DEBUG


389 
¼_ty³s_t
 
¼_ty³
;

392 
ivex
 = 
h±r
->
šdex
;

394 #ifdeà
DEBUG


395 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

397 ià(
¼_ty³
 !ğ
SINK
) {

398 
	`´štf
("Error in update_traceback. Expectedype = SINK (%d).\n",

399 
SINK
);

400 
	`´štf
("GÙy³ = %d whŒacšg back‚‘ %d.\n", 
¼_ty³
, 
š‘
);

401 
	`ex™
(1);

406 
Œ
 = 
	`®loc_Œaû_d©a
();

407 
Œ
->
šdex
 = 
ivex
;

408 
Œ
->
isw™ch
 = 
OPEN
;

409 
Œ
->
Ãxt
 = 
NULL
;

410 
‹m±a
 = 
Œ
;

415 
ivex
 = 
h±r
->
u
.
´ev_node
;

416 
›dge
 = 
h±r
->
´ev_edge
;

418 
ivex
 !ğ
NO_PREVIOUS
) {

419 
´ev±r
 = 
	`®loc_Œaû_d©a
();

420 
´ev±r
->
šdex
 = 
ivex
;

421 
´ev±r
->
isw™ch
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

422 
´ev±r
->
Ãxt
 = 
Œ
;

423 
Œ
 = 
´ev±r
;

424 
›dge
 = 
¼_node_rou‹_šf
[
ivex
].
´ev_edge
;

425 
ivex
 = 
¼_node_rou‹_šf
[ivex].
´ev_node
;

428 ià(
Œaû_
[
š‘
] !ğ
NULL
) {

429 
Œaû_
[
š‘
]->
Ãxt
 = 
Œ
;

430 
»t_±r
 = 
Œ
->
Ãxt
;

432 
Œaû_h—d
[
š‘
] = 
Œ
;

433 
»t_±r
 = 
Œ
;

436 
Œaû_
[
š‘
] = 
‹m±a
;

437  (
»t_±r
);

438 
	}
}

441 
	$»£t_·th_co¡s
()

445 
s_lšked_f_poš‹r
* 
mod_±r
;

446 #ifdeà
DEBUG


447 
num_mod_±rs
;

451 ià(
¼_modif›d_h—d
 !ğ
NULL
) {

452 
mod_±r
 = 
¼_modif›d_h—d
;

453 #ifdeà
DEBUG


454 
num_mod_±rs
 = 1;

456 
mod_±r
->
Ãxt
 !ğ
NULL
) {

457 *(
mod_±r
->
åŒ
èğ
HUGE_FLOAT
;

458 
mod_±r
 = mod_±r->
Ãxt
;

459 #ifdeà
DEBUG


460 
num_mod_±rs
++;

464 *(
mod_±r
->
åŒ
èğ
HUGE_FLOAT
;

467 
mod_±r
->
Ãxt
 = 
lšked_f_poš‹r_ä“_h—d
;

468 
lšked_f_poš‹r_ä“_h—d
 = 
¼_modif›d_h—d
;

469 
¼_modif›d_h—d
 = 
NULL
;

470 #ifdeà
DEBUG


471 
num_lšked_f_poš‹r_®loÿ‹d
 -ğ
num_mod_±rs
;

474 
	}
}

477 
	$g‘_¼_cÚg_co¡
(
ivex
)

480 
co¡_šdex
;

481 
co¡
;

482 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

483 
co¡
 = 
¼_šdexed_d©a
[
co¡_šdex
].
ba£_co¡
 *

484 
¼_node_rou‹_šf
[
ivex
].
acc_co¡
 *

485 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
;

486  (
co¡
);

487 
	}
}

490 
	$m¬k_’ds
(
š‘
)

498 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

499 
š
 = 0;

500 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

501 
ivex
 = 
Ãt_¼_‹rmš®s
[
š‘
][
š
];

502 ++(
¼_node_rou‹_šf
[
ivex
].
rg‘_æag
);

504 
	}
}

507 
	$node_to_h—p
(
ivex
, 
co¡
, 
´ev_node
, 
´ev_edge
,

508 
backw¬d_·th_co¡
, 
R_up¡»am
)

516 
s_h—p
* 
h±r
;

518 ià(
co¡
 >ğ
¼_node_rou‹_šf
[
ivex
].
·th_co¡
) {

522 
h±r
 = 
	`®loc_h—p_d©a
();

523 
h±r
->
šdex
 = 
ivex
;

524 
h±r
->
co¡
 = cost;

525 
h±r
->
u
.
´ev_node
 =…rev_node;

526 
h±r
->
´ev_edge
 =…rev_edge;

527 
h±r
->
backw¬d_·th_co¡
 = backward_path_cost;

528 
h±r
->
R_up¡»am
 = R_upstream;

529 
	`add_to_h—p
(
h±r
);

530 
	}
}

533 
	$ä“_Œaûback
(
š‘
)

537 
s_Œaû
* 
Œaû_node
 = 
Œaû_h—d
[
š‘
];

538 
Œaû_node
 !ğ
NULL
) {

540 
s_Œaû
* 
Ãxt_Œaû_node
 = 
Œaû_node
->
Ãxt
;

541 
	`ä“_Œaû_d©a
(
Œaû_node
);

542 
Œaû_node
 = 
Ãxt_Œaû_node
;

545 
Œaû_h—d
[
š‘
] = 
NULL
;

546 
Œaû_
[
š‘
] = 
NULL
;

547 
	}
}

550 
veùÜ_t
** 
	$®loc_rou‹_¡ruùs
(
subblock_d©a_t
 
subblock_d©a
)

553 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
;

554 
Œaû_h—d
 = (
s_Œaû
**è
	`my_ÿÎoc
(
num_Ãts
,

555 (
s_Œaû
*));

556 
Œaû_
 = (
s_Œaû
**è
	`my_m®loc
(
num_Ãts
 *

557 (
s_Œaû
*));

558 
h—p_size
 = 
num_grid_cŞumns
 * 
num_grid_rows
;

559 
h—p
 = (
s_h—p
**è
	`my_m®loc
(
h—p_size
 *

560 (
s_h—p
*));

561 
h—p
--;

562 
h—p_
 = 1;

563 
rou‹_bb
 = (
bbox_t
*è
	`my_m®loc
(
num_Ãts
 * (bbox_t));

564 
şb_İšs_u£d_loÿÎy
 = 
	`®loc_ªd_lßd_şb_İšs_u£d_loÿÎy
(

565 
subblock_d©a
);

566  (
şb_İšs_u£d_loÿÎy
);

567 
	}
}

570 
s_Œaû
** 
	$®loc_§ved_routšg
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
,

571 
veùÜ_t
** *
§ved_şb_İšs_u£d_loÿÎy_±r
) {

577 
s_Œaû
** 
be¡_routšg
;

578 
veùÜ_t
** 
§ved_şb_İšs_u£d_loÿÎy
;

579 
iblk
, 
işass
, 
num_loÿl_İšs
;

581 
be¡_routšg
 = (
s_Œaû
**è
	`my_ÿÎoc
(
num_Ãts
,

582 (
s_Œaû
*));

584 
§ved_şb_İšs_u£d_loÿÎy
 = (
veùÜ_t
**è
	`®loc_m©rix
(0, 
num_blocks
 - 1, 0,

585 
num_pš_şass
 - 1, (
veùÜ_t
));

587 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

588 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

589 
num_loÿl_İšs
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

590 
§ved_şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
 = 
num_loÿl_İšs
;

592 ià(
num_loÿl_İšs
 == 0) {

593 
§ved_şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
 = 
NULL
;

595 
§ved_şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
 = (*)

596 
	`my_m®loc
(
num_loÿl_İšs
 * ());

601 *
§ved_şb_İšs_u£d_loÿÎy_±r
 = 
§ved_şb_İšs_u£d_loÿÎy
;

602  (
be¡_routšg
);

603 
	}
}

606 
veùÜ_t
** 
	$®loc_ªd_lßd_şb_İšs_u£d_loÿÎy
(
subblock_d©a_t


607 
subblock_d©a
)

612 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
;

613 * 
num_subblocks_³r_block
;

614 
subblock_t
** 
subblock_šf
;

615 
iblk
, 
isub
, 
şb_pš
, 
işass
, 
num_loÿl_İšs
;

616 
şb_İšs_u£d_loÿÎy
 = (
veùÜ_t
**è
	`®loc_m©rix
(0, 
num_blocks
 - 1, 0,

617 
num_pš_şass
 - 1, (
veùÜ_t
));

618 
num_subblocks_³r_block
 = 
subblock_d©a
.num_subblocks_per_block;

619 
subblock_šf
 = 
subblock_d©a
.subblock_inf;

621 
iblk
 = 0; iblk < 
num_blocks
; ++iblk) {

622 ià(
blocks
[
iblk
].
block_ty³
 !ğ
B_CLB_TYPE
) {

623 
işass
 = 0; işas < 
num_pš_şass
; ++iclass) {

624 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
 = 0;

625 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
 = 
NULL
;

628 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

629 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
 = 0;

632 
isub
 = 0; isub < 
num_subblocks_³r_block
[
iblk
]; isub++) {

633 
şb_pš
 = 
subblock_šf
[
iblk
][
isub
].
ouut
;

636 ià(
şb_pš
 !ğ
OPEN
 && 
blocks
[
iblk
].
Ãts
[clb_pin] == OPEN) {

637 
işass
 = 
şb_pš_şass
[
şb_pš
];

638 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
++;

642 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

643 
num_loÿl_İšs
 =

644 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

646 ià(
num_loÿl_İšs
 == 0) {

647 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
 = 
NULL
;

649 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
 =

650 (*è
	`my_m®loc
(
num_loÿl_İšs
 * ());

655  (
şb_İšs_u£d_loÿÎy
);

656 
	}
}

658 
	$ä“_Œaû_¡ruùs
()

663 
i
;

665 
i
 = 0; i < 
num_Ãts
; i++) {

666 
	`ä“_Œaûback
(
i
);

669 
	`ä“
(
Œaû_h—d
);

670 
	`ä“
(
Œaû_
);

671 
Œaû_h—d
 = 
NULL
;

672 
Œaû_
 = 
NULL
;

673 
	}
}

675 
	$ä“_rou‹_¡ruùs
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
)

679 
	`ä“
(
h—p
 + 1);

680 
	`ä“
(
rou‹_bb
);

681 
h—p
 = 
NULL
;

682 
rou‹_bb
 = 
NULL
;

683 
	`ä“_ivec_m©rix
(
şb_İšs_u£d_loÿÎy
, 0, 
num_blocks
 - 1, 0, 
num_pš_şass
 - 1);

686 
	}
}

689 
	$ä“_§ved_routšg
(
s_Œaû
** 
be¡_routšg
, 
veùÜ_t


690 ** 
§ved_şb_İšs_u£d_loÿÎy
)

693 
	`ä“
(
be¡_routšg
);

694 
	`ä“_ivec_m©rix
(
§ved_şb_İšs_u£d_loÿÎy
, 0, 
num_blocks
 - 1, 0,

695 
num_pš_şass
 - 1);

696 
	}
}

699 
	$®loc_ªd_lßd_¼_node_rou‹_¡ruùs
()

703 
ivex
;

705 ià(
¼_node_rou‹_šf
 !ğ
NULL
) {

706 
	`´štf
("Error in‡lloc_and_load_rr_node_route_structs: \n"

708 
	`ex™
(1);

711 
¼_node_rou‹_šf
 = 
	`my_m®loc
(
num_¼_nodes
 * (
¼_node_t_rou‹_šf
));

713 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

714 
¼_node_rou‹_šf
[
ivex
].
´ev_node
 = 
NO_PREVIOUS
;

715 
¼_node_rou‹_šf
[
ivex
].
´ev_edge
 = 
NO_PREVIOUS
;

716 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
 = 1.;

717 
¼_node_rou‹_šf
[
ivex
].
acc_co¡
 = 1.;

718 
¼_node_rou‹_šf
[
ivex
].
·th_co¡
 = 
HUGE_FLOAT
;

719 
¼_node_rou‹_šf
[
ivex
].
rg‘_æag
 = 0;

721 
	}
}

724 
	$ä“_¼_node_rou‹_¡ruùs
()

728 
	`ä“
(
¼_node_rou‹_šf
);

729 
¼_node_rou‹_šf
 = 
NULL
;

730 
	}
}

742 
	$lßd_rou‹_bb
(
bb_çùÜ
)

744 
k
, 
xmax
, 
ymax
, 
xmš
, 
ymš
, 
x
, 
y
, 
š‘
;

745 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

746 
x
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[0]].x;

747 
y
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[0]].y;

748 
xmš
 = 
x
;

749 
ymš
 = 
y
;

750 
xmax
 = 
x
;

751 
ymax
 = 
y
;

753 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

754 
k
 = 1; k < 
knum_Ãt_pšs
; ++k) {

755 
x
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[
k
]].x;

756 
y
 = 
blocks
[
Ãt
[
š‘
].
node_blocks
[
k
]].y;

758 ià(
x
 < 
xmš
) {

759 
xmš
 = 
x
;

760 } ià(
x
 > 
xmax
) {

761 
xmax
 = 
x
;

764 ià(
y
 < 
ymš
) {

765 
ymš
 = 
y
;

766 } ià(
y
 > 
ymax
) {

767 
ymax
 = 
y
;

772 
xmš
 -= 1;

773 
ymš
 -= 1;

776 
rou‹_bb
[
š‘
].
xmš
 = 
	`max
(xmš - 
bb_çùÜ
, 0);

777 
rou‹_bb
[
š‘
].
xmax
 = 
	`mš
(xmax + 
bb_çùÜ
, 
num_grid_cŞumns
 + 1);

778 
rou‹_bb
[
š‘
].
ymš
 = 
	`max
(ymš - 
bb_çùÜ
, 0);

779 
rou‹_bb
[
š‘
].
ymax
 = 
	`mš
(ymax + 
bb_çùÜ
, 
num_grid_rows
 + 1);

781 
	}
}

784 
	$add_to_mod_li¡
(* 
åŒ
)

789 
s_lšked_f_poš‹r
* 
mod_±r
;

790 
mod_±r
 = 
	`®loc_lšked_f_poš‹r
();

792 
mod_±r
->
Ãxt
 = 
¼_modif›d_h—d
;

793 
mod_±r
->
åŒ
 = fptr;

794 
¼_modif›d_h—d
 = 
mod_±r
;

795 
	}
}

798 
	$add_to_h—p
(
s_h—p
* 
h±r
)

801 
™o
, 
iäom
;

802 
s_h—p
* 
‹mp_±r
;

804 ià(
h—p_
 > 
h—p_size
) {

805 
h—p_size
 *= 2;

806 
h—p
 = 
	`my_»®loc
((*)(h—°+ 1), 
h—p_size
 *

807 (
s_h—p
*));

808 
h—p
--;

811 
h—p
[
h—p_
] = 
h±r
;

812 
iäom
 = 
h—p_
;

813 
™o
 = 
iäom
 / 2;

814 
h—p_
++;

816 (
™o
 >ğ1è&& (
h—p
[
iäom
]->
co¡
 < heap[ito]->cost)) {

817 
‹mp_±r
 = 
h—p
[
™o
];

818 
h—p
[
™o
] = h—p[
iäom
];

819 
h—p
[
iäom
] = 
‹mp_±r
;

820 
iäom
 = 
™o
;

821 
™o
 = 
iäom
 / 2;

823 
	}
}

826 
s_h—p
* 
	$g‘_h—p_h—d
() {

832 
™o
, 
iäom
;

833 
s_h—p
* 
h—p_h—d
, *
‹mp_±r
;

836 ià(
h—p_
 == 1) {

837 
	`´štf
("Empty heap occurred in get_heap_head.\n");

838 
	`´štf
("Some blocks‡re impossibleo connect inhis‡rchitecture.\n");

839  (
NULL
);

842 
h—p_h—d
 = 
h—p
[1];

844 
h—p_
--;

845 
h—p
[1] = h—p[
h—p_
];

846 
iäom
 = 1;

847 
™o
 = 2 * 
iäom
;

849 
™o
 < 
h—p_
) {

850 ià(
h—p
[
™o
 + 1]->
co¡
 < heap[ito]->cost) {

851 
™o
++;

854 ià(
h—p
[
™o
]->
co¡
 > h—p[
iäom
]->cost) {

858 
‹mp_±r
 = 
h—p
[
™o
];

859 
h—p
[
™o
] = h—p[
iäom
];

860 
h—p
[
iäom
] = 
‹mp_±r
;

861 
iäom
 = 
™o
;

862 
™o
 = 2 * 
iäom
;

864 } 
h—p_h—d
->
šdex
 =ğ
OPEN
);

866 (
h—p_h—d
);

867 
	}
}

870 
	$em±y_h—p
()

872 
i
;

874 
i
 = 1; i < 
h—p_
; i++) {

875 
	`ä“_h—p_d©a
(
h—p
[
i
]);

878 
h—p_
 = 1;

879 
	}
}

881 
	#NCHUNK
 200

	)

884 
s_h—p
* 
	$®loc_h—p_d©a
() {

886 
i
;

887 
s_h—p
* 
‹mp_±r
;

889 ià(
h—p_ä“_h—d
 =ğ
NULL
) {

890 
h—p_ä“_h—d
 = (
s_h—p
*è
	`my_m®loc
(
NCHUNK
 *

891 (
s_h—p
));

897 
i
 = 0; i < 
NCHUNK
 - 1; i++) {

898 (
h—p_ä“_h—d
 + 
i
)->
u
.
Ãxt
 = heap_free_head + i + 1;

901 (
h—p_ä“_h—d
 + 
NCHUNK
 - 1)->
u
.
Ãxt
 = 
NULL
;

904 
‹mp_±r
 = 
h—p_ä“_h—d
;

905 
h—p_ä“_h—d
 = h—p_ä“_h—d->
u
.
Ãxt
;

906 #ifdeà
DEBUG


907 
num_h—p_®loÿ‹d
++;

909  (
‹mp_±r
);

910 
	}
}

913 
	$ä“_h—p_d©a
(
s_h—p
* 
h±r
)

915 
h±r
->
u
.
Ãxt
 = 
h—p_ä“_h—d
;

916 
h—p_ä“_h—d
 = 
h±r
;

917 #ifdeà
DEBUG


918 
num_h—p_®loÿ‹d
--;

920 
	}
}

923 
	$šv®id©e_h—p_’Œ›s
(
sšk_node
, 
š_node
)

928 
i
;

930 
i
 = 1; i < 
h—p_
; i++) {

931 ià(
h—p
[
i
]->
šdex
 =ğ
sšk_node
 && h—p[i]->
u
.
´ev_node
 =ğ
š_node
) {

932 
h—p
[
i
]->
šdex
 = 
OPEN
;

935 
	}
}

938 
s_Œaû
* 
	$®loc_Œaû_d©a
() {

940 
i
;

941 
s_Œaû
* 
‹mp_±r
;

943 ià(
Œaû_ä“_h—d
 =ğ
NULL
) {

944 
Œaû_ä“_h—d
 = (
s_Œaû
*è
	`my_m®loc
(
NCHUNK
 *

945 (
s_Œaû
));

951 
i
 = 0; i < 
NCHUNK
 - 1; i++) {

952 (
Œaû_ä“_h—d
 + 
i
)->
Ãxt
 =race_free_head + i + 1;

955 (
Œaû_ä“_h—d
 + 
NCHUNK
 - 1)->
Ãxt
 = 
NULL
;

958 
‹mp_±r
 = 
Œaû_ä“_h—d
;

959 
Œaû_ä“_h—d
 =¿û_ä“_h—d->
Ãxt
;

960 #ifdeà
DEBUG


961 
num_Œaû_®loÿ‹d
++;

963  (
‹mp_±r
);

964 
	}
}

967 
	$ä“_Œaû_d©a
(
s_Œaû
* 
Œ
)

970 
Œ
->
Ãxt
 = 
Œaû_ä“_h—d
;

971 
Œaû_ä“_h—d
 = 
Œ
;

972 #ifdeà
DEBUG


973 
num_Œaû_®loÿ‹d
--;

975 
	}
}

978 
s_lšked_f_poš‹r
* 
	$®loc_lšked_f_poš‹r
() {

983 
i
;

984 
s_lšked_f_poš‹r
* 
‹mp_±r
;

986 ià(
lšked_f_poš‹r_ä“_h—d
 =ğ
NULL
) {

988 
lšked_f_poš‹r_ä“_h—d
 = (
s_lšked_f_poš‹r
*)

989 
	`my_m®loc
(
NCHUNK
 * (
s_lšked_f_poš‹r
));

995 
i
 = 0; i < 
NCHUNK
 - 1; i++) {

996 (
lšked_f_poš‹r_ä“_h—d
 + 
i
)->
Ãxt
 =†inked_f_pointer_free_head

997 + 
i
 + 1;

1000 (
lšked_f_poš‹r_ä“_h—d
 + 
NCHUNK
 - 1)->
Ãxt
 = 
NULL
;

1003 
‹mp_±r
 = 
lšked_f_poš‹r_ä“_h—d
;

1004 
lšked_f_poš‹r_ä“_h—d
 =†šked_f_poš‹r_ä“_h—d->
Ãxt
;

1006 #ifdeà
DEBUG


1007 
num_lšked_f_poš‹r_®loÿ‹d
++;

1010  (
‹mp_±r
);

1011 
	}
}

1014 
	$´št_rou‹
(* 
rou‹_fe
)

1017 
š‘
, 
ivex
, 
š
, 
block_num
, 
ow
, 
jlow
, 
blk_pš
, 
işass
;

1018 
¼_ty³s_t
 
¼_ty³
;

1019 
s_Œaû
* 
Œ
;

1020 * 
Çme_ty³
[] = {"SOURCE", "SINK", "IPIN", "OPIN", "CHANX", "CHANY"};

1021 
FILE
* 
å
 = 
	`my_fİ’
(
rou‹_fe
, "w");

1022 
	`årštf
(
å
, "A¼ay size: %d x %d†ogiøblocks.\n", 
num_grid_cŞumns
, 
num_grid_rows
);

1023 
	`årštf
(
å
, "\nRouting:");

1025 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

1026 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

1027 
	`årštf
(
å
, "\n\nN‘ %d (%s)\n\n", 
š‘
, 
Ãt
[š‘].
Çme
);

1028 
Œ
 = 
Œaû_h—d
[
š‘
];

1030 
Œ
 !ğ
NULL
) {

1031 
ivex
 = 
Œ
->
šdex
;

1032 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

1033 
ow
 = 
¼_node
[
ivex
].
xlow
;

1034 
jlow
 = 
¼_node
[
ivex
].
ylow
;

1035 
	`årštf
(
å
, "%6 (%d,%dè", 
Çme_ty³
[
¼_ty³
], 
ow
, 
jlow
);

1037 ià((
ow
 !ğ
¼_node
[
ivex
].
xhigh
è|| (
jlow
 !=

1038 
¼_node
[
ivex
].
yhigh
))

1039 
	`årštf
(
å
, "tØ(%d,%dè", 
¼_node
[
ivex
].
xhigh
,

1040 
¼_node
[
ivex
].
yhigh
);

1042 
¼_ty³
) {

1043 
IPIN
:

1044 
OPIN
:

1045 ià(
bš_grids
[
ow
][
jlow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

1046 
	`årštf
(
å
, " Pin: ");

1048 
	`årštf
(
å
, " Pad: ");

1053 
CHANX
:

1054 
CHANY
:

1055 
	`årštf
(
å
, " Track: ");

1058 
SOURCE
:

1059 
SINK
:

1060 ià(
bš_grids
[
ow
][
jlow
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

1061 
	`årštf
(
å
, " Class: ");

1063 
	`årštf
(
å
, " Pad: ");

1069 
	`´štf
("Error in…rint_route: Unexpectedracebackƒlement "

1070 "ty³: %d (%s).\n", 
¼_ty³
, 
Çme_ty³
[rr_type]);

1071 
	`ex™
(1);

1075 
	`årštf
(
å
, "%d ", 
¼_node
[
ivex
].
±c_num
);

1079 
	`årštf
(
å
, "\n");

1080 
Œ
 =±r->
Ãxt
;

1083 
	`årštf
(
å
, "\n\nN‘ %d (%s): glob®‚‘ cÚÃùšg:\n\n", 
š‘
,

1084 
Ãt
[
š‘
].
Çme
);

1086 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

1087 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

1088 
block_num
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

1090 ià(
blocks
[
block_num
].
block_ty³
 =ğ
B_CLB_TYPE
) {

1091 
blk_pš
 = 
Ãt
[
š‘
].
node_block_pšs
[
š
];

1092 
işass
 = 
şb_pš_şass
[
blk_pš
];

1094 
işass
 = 
OPEN
;

1097 
	`årštf
(
å
, "Block %s (#%d)‡t (%d, %d), Pin class %d.\n",

1098 
blocks
[
block_num
].
Çme
, block_num, blocks[block_num].
x
, blocks[block_num].
y
,

1099 
işass
);

1104 
	`fşo£
(
å
);

1105 #ifdeà
DEBUG


1106 
å
 = 
	`my_fİ’
("mem.echo", "w");

1107 
	`årštf
(
å
, "\nNum_heap_allocated: %d Num_trace_allocated: %d\n",

1108 
num_h—p_®loÿ‹d
, 
num_Œaû_®loÿ‹d
);

1109 
	`årštf
(
å
, "Num_linked_f_pointer_allocated: %d\n",

1110 
num_lšked_f_poš‹r_®loÿ‹d
);

1111 
	`fşo£
(
å
);

1113 
	}
}

1116 
	$»£rve_loÿÎy_u£d_İšs
(
´es_çc
, 
boŞ—n
 
r_up_loÿl_İšs
,

1117 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
)

1126 
iblk
, 
num_loÿl_İš
, 
ivex
, 
äom_node
, 
icÚn
, 
num_edges
, 
to_node
;

1127 
işass
, 
š
;

1128 
co¡
;

1129 
s_h—p
* 
h—p_h—d_±r
;

1131 ià(
r_up_loÿl_İšs
) {

1132 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

1133 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

1134 
num_loÿl_İš
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

1137 
š
 = 0; ipš < 
num_loÿl_İš
; ipin++) {

1138 
ivex
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
];

1139 
	`adju¡_Úe_¼_occ_ªd_pco¡
(
ivex
, -1, 
´es_çc
);

1145 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

1146 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

1147 
num_loÿl_İš
 = 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
ÃËm
;

1150 ià(
num_loÿl_İš
 != 0) {

1151 
äom_node
 = 
¼_şb_sourû
[
iblk
][
işass
];

1152 
num_edges
 = 
¼_node
[
äom_node
].num_edges;

1154 
icÚn
 = 0; icÚÀ< 
num_edges
; iconn++) {

1155 
to_node
 = 
¼_node
[
äom_node
].
edges
[
icÚn
];

1156 
co¡
 = 
	`g‘_¼_cÚg_co¡
(
to_node
);

1157 
	`node_to_h—p
(
to_node
, 
co¡
, 
OPEN
, OPEN, 0., 0.);

1160 
š
 = 0; ipš < 
num_loÿl_İš
; ipin++) {

1161 
h—p_h—d_±r
 = 
	`g‘_h—p_h—d
();

1162 
ivex
 = 
h—p_h—d_±r
->
šdex
;

1163 
	`adju¡_Úe_¼_occ_ªd_pco¡
(
ivex
, 1, 
´es_çc
);

1164 
şb_İšs_u£d_loÿÎy
[
iblk
][
işass
].
li¡
[
š
] = 
ivex
;

1165 
	`ä“_h—p_d©a
(
h—p_h—d_±r
);

1168 
	`em±y_h—p
();

1172 
	}
}

1175 
	$adju¡_Úe_¼_occ_ªd_pco¡
(
ivex
, 
add_Ü_sub
, 

1176 
´es_çc
)

1180 
m_u§ge
, 
ÿ·c™y
;

1181 
m_u§ge
 = 
¼_node
[
ivex
].m_u§g+ 
add_Ü_sub
;

1182 
ÿ·c™y
 = 
¼_node
[
ivex
].capacity;

1183 
¼_node
[
ivex
].
m_u§ge
 = m_usage;

1185 ià(
m_u§ge
 < 
ÿ·c™y
) {

1186 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
 = 1.;

1188 
¼_node_rou‹_šf
[
ivex
].
´es_co¡
 = 1. + (
m_u§ge
 + 1 - 
ÿ·c™y
) *

1189 
´es_çc
;

1191 
	}
}

	@route_common.h

1 #iâdeà
ROUTE_COMMNO_H


2 
	#ROUTE_COMMNO_H


	)

4 
	~"glob®s.h
"

5 
	~"ut.h
"

27 
	ss_h—p
 {

28 
	mšdex
;

29 
	mco¡
;

31 
	m´ev_node
;

32 
s_h—p
* 
	mÃxt
;

33 } 
	mu
;

34 
	m´ev_edge
;

35 
	mbackw¬d_·th_co¡
;

36 
	mR_up¡»am
;

59 
	m´ev_node
;

60 
	m´es_co¡
;

61 
	macc_co¡
;

63 
	m·th_co¡
;

64 
	mbackw¬d_·th_co¡
;

65 
	m´ev_edge
;

67 
	mrg‘_æag
;

68 } 
	t¼_node_t_rou‹_šf
;

73 
¼_node_t_rou‹_šf
* 
¼_node_rou‹_šf
;

74 
bbox_t
* 
rou‹_bb
;

78 
·thfšd”_upd©e_Úe_co¡
(
s_Œaû
* 
rou‹_£gm’t_¡¬t
,

79 
add_Ü_sub
, 
´es_çc
);

81 
·thfšd”_upd©e_co¡
(
´es_çc
, 
acc_çc
);

83 
s_Œaû
* 
upd©e_Œaûback
(
s_h—p
* 
h±r
, 
š‘
);

85 
»£t_·th_co¡s
();

87 
g‘_¼_cÚg_co¡
(
ivex
);

89 
m¬k_’ds
(
š‘
);

91 
node_to_h—p
(
ivex
, 
co¡
, 
´ev_node
, 
´ev_edge
,

92 
backw¬d_·th_co¡
, 
R_up¡»am
);

94 
ä“_Œaûback
(
š‘
);

96 
add_to_mod_li¡
(* 
åŒ
);

98 
s_h—p
* 
g‘_h—p_h—d
();

100 
em±y_h—p
();

102 
ä“_h—p_d©a
(
s_h—p
* 
h±r
);

104 
šv®id©e_h—p_’Œ›s
(
sšk_node
, 
š_node
);

106 
š™_rou‹_¡ruùs
(
bb_çùÜ
);

108 
ä“_¼_node_rou‹_¡ruùs
();

110 
®loc_ªd_lßd_¼_node_rou‹_¡ruùs
();

112 
ä“_Œaû_¡ruùs
();

114 
»£rve_loÿÎy_u£d_İšs
(
´es_çc
, 
boŞ—n
 
r_up_loÿl_İšs
,

115 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
);

	@route_export.h

1 #iâdeà
ROUTE_EXPORT_H


2 
	#ROUTE_EXPORT_H


	)

4 
	~"glob®s.h
"

5 
	~"v´_ty³s.h
"

11 
boŞ—n
 
Œy_rou‹
(
width_çc
, 
rou‹r_İts_t
 
rou‹r_İts
,

12 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

13 
£gm’t_šfo_t
* 
£gm’t_šf
, 
timšg_šfo_t
 
timšg_šf
,

14 ** 
Ãt_¦ack
, ** 
Ãt_d–ay
,

15 
chª_width_di¡r_t
 
chª_width_di¡
,

16 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
);

18 
boŞ—n
 
ãasibË_routšg
();

20 
veùÜ_t
** 
®loc_rou‹_¡ruùs
(
subblock_d©a_t
 
subblock_d©a
);

22 
ä“_rou‹_¡ruùs
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
);

24 
s_Œaû
** 
®loc_§ved_routšg
(
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
,

25 
veùÜ_t
** *
§ved_şb_İšs_u£d_loÿÎy_±r
);

27 
ä“_§ved_routšg
(
s_Œaû
** 
be¡_routšg
,

28 
veùÜ_t
** 
§ved_şb_İšs_u£d_loÿÎy
);

30 
§ve_routšg
(
s_Œaû
** 
be¡_routšg
,

31 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
,

32 
veùÜ_t
** 
§ved_şb_İšs_u£d_loÿÎy
);

34 
»¡Üe_routšg
(
s_Œaû
** 
be¡_routšg
,

35 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
,

36 
veùÜ_t
** 
§ved_şb_İšs_u£d_loÿÎy
);

38 
g‘_£rŸl_num
();

40 
´št_rou‹
(* 
Çme
);

	@route_timing.c

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

3 
	~"ut.h
"

4 
	~"v´_ty³s.h
"

5 
	~"glob®s.h
"

6 
	~"rou‹_expÜt.h
"

7 
	~"rou‹_commÚ.h
"

8 
	~"rou‹_Œ“_timšg.h
"

9 
	~"rou‹_timšg.h
"

10 
	~"h—psÜt.h
"

11 
	~"·th_d–ay.h
"

12 
	~"Ãt_d–ay.h
"

17 
g‘_max_pšs_³r_Ãt
();

19 
add_rou‹_Œ“_to_h—p
(
t_¹_node
* 
¹_node
, 
rg‘_node
,

20 
rg‘_ü™iÿl™y
, 
a¡¬_çc
);

22 
timšg_driv’_ex·nd_Ãighbours
(
s_h—p
* 
cu¼’t
, 
š‘
,

23 
b’d_co¡
, 
ü™iÿl™y_çc
, 
rg‘_node
, 

24 
a¡¬_çc
);

26 
g‘_timšg_driv’_ex³ùed_co¡
(
ivex
, 
rg‘_node
,

27 
ü™iÿl™y_çc
, 
R_up¡»am
);

29 
g‘_ex³ùed_£gs_to_rg‘
(
ivex
, 
rg‘_node
, *

30 
num_£gs_Ütho_dœ_±r
);

32 
upd©e_¼_ba£_co¡s
(
š‘
, 
Ïrge¡_ü™iÿl™y
);

34 
timšg_driv’_check_Ãt_d–ays
(** 
Ãt_d–ay
);

39 
boŞ—n
 
	$Œy_timšg_driv’_rou‹
(
rou‹r_İts_t
 
rou‹r_İts
,

40 ** 
Ãt_¦ack
, ** 
Ãt_d–ay
,

41 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
)

47 * 
pš_ü™iÿl™y
;

48 * 
sšk_Üd”
;

49 
t_¹_node
** 
¹_node_of_sšk
;

50 
	`®loc_timšg_driv’_rou‹_¡ruùs
(&
pš_ü™iÿl™y
, &
sšk_Üd”
,

51 &
¹_node_of_sšk
);

55 
š‘
, 
š
;

56 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

57 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

59 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

60 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

61 
Ãt_¦ack
[
š‘
][
š
] = 0.0;

64 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

65 
Ãt_d–ay
[
š‘
][
š
] = 0.0;

70 
T_ü™
 = 1.0;

71 
´es_çc
 = 
rou‹r_İts
.
fœ¡_™”_´es_çc
;

72 
™ry
 = 0;

73 
™ry
 = 1; iŒy <ğ
rou‹r_İts
.
max_rou‹r_™”©iÚs
; ++itry) {

74 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

75 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

76 
boŞ—n
 
is_roubË
 = 
	`timšg_driv’_rou‹_Ãt
(
š‘
, 
´es_çc
,

77 
rou‹r_İts
.
max_ü™iÿl™y
,

78 
rou‹r_İts
.
ü™iÿl™y_exp
,

79 
rou‹r_İts
.
a¡¬_çc
,

80 
rou‹r_İts
.
b’d_co¡
,

81 
Ãt_¦ack
[
š‘
],

82 
pš_ü™iÿl™y
,

83 
sšk_Üd”
,

84 
¹_node_of_sšk
,

85 
T_ü™
, 
Ãt_d–ay
[
š‘
]);

88 ià(!
is_roubË
) {

89 
	`´štf
("Routing failed.\n");

90 
	`ä“_timšg_driv’_rou‹_¡ruùs
(
pš_ü™iÿl™y
, 
sšk_Üd”
,

91 
¹_node_of_sšk
);

92  (
FALSE
);

99 
boŞ—n
 
r_up_loÿl_İšs
;

100 ià(
™ry
 == 1) {

101 
r_up_loÿl_İšs
 = 
FALSE
;

103 
r_up_loÿl_İšs
 = 
TRUE
;

106 
	`»£rve_loÿÎy_u£d_İšs
(
´es_çc
, 
r_up_loÿl_İšs
,

107 
şb_İšs_u£d_loÿÎy
);

110 
boŞ—n
 
sucûss
 = 
	`ãasibË_routšg
();

111 ià(
sucûss
) {

112 
	`´štf
("SucûssfuÎy„ou‹d‡á” %d„outšg i‹¿tiÚs.\n", 
™ry
);

113 
	`ä“_timšg_driv’_rou‹_¡ruùs
(
pš_ü™iÿl™y
, 
sšk_Üd”
,

114 
¹_node_of_sšk
);

115 #ifdeà
DEBUG


116 
	`timšg_driv’_check_Ãt_d–ays
(
Ãt_d–ay
);

118  (
TRUE
);

121 ià(
™ry
 == 1) {

122 
´es_çc
 = 
rou‹r_İts
.
š™Ÿl_´es_çc
;

123 
	`·thfšd”_upd©e_co¡
(
´es_çc
, 0.);

125 
´es_çc
 *ğ
rou‹r_İts
.
´es_çc_muÉ
;

126 
	`·thfšd”_upd©e_co¡
(
´es_çc
, 
rou‹r_İts
.
acc_çc
);

131 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

132 
T_ü™
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

133 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

135 
	`´štf
("T_ü™: %g.\n", 
T_ü™
);

138 
	`´štf
("Routing failed.\n");

139 
	`ä“_timšg_driv’_rou‹_¡ruùs
(
pš_ü™iÿl™y
, 
sšk_Üd”
,

140 
¹_node_of_sšk
);

141  (
FALSE
);

142 
	}
}

146 
	$®loc_timšg_driv’_rou‹_¡ruùs
(** 
pš_ü™iÿl™y_±r
,

147 ** 
sšk_Üd”_±r
,

148 
t_¹_node
*** 
¹_node_of_sšk_±r
)

150 
max_pšs_³r_Ãt
 = 
	`g‘_max_pšs_³r_Ãt
();

153 * 
pš_ü™iÿl™y
 = (*)
	`my_m®loc
((
max_pšs_³r_Ãt
 - 1) * ());

155 *
pš_ü™iÿl™y_±r
 = 
pš_ü™iÿl™y
 - 1;

157 * 
sšk_Üd”
 = (*)
	`my_m®loc
((
max_pšs_³r_Ãt
 - 1) * ());

158 *
sšk_Üd”_±r
 = 
sšk_Üd”
 - 1;

160 
t_¹_node
** 
¹_node_of_sšk
 = (t_¹_node**)
	`my_m®loc
((
max_pšs_³r_Ãt
 - 1) *

161 (
t_¹_node
*));

162 *
¹_node_of_sšk_±r
 = 
¹_node_of_sšk
 - 1;

164 
	`®loc_rou‹_Œ“_timšg_¡ruùs
();

165 
	}
}

168 
	$ä“_timšg_driv’_rou‹_¡ruùs
(* 
pš_ü™iÿl™y
, 

169 *
sšk_Üd”
, 
t_¹_node
** 
¹_node_of_sšk
)

172 
	`ä“
(
pš_ü™iÿl™y
 + 1);

173 
	`ä“
(
sšk_Üd”
 + 1);

174 
	`ä“
(
¹_node_of_sšk
 + 1);

175 
	`ä“_rou‹_Œ“_timšg_¡ruùs
();

176 
	}
}

179 
	$g‘_max_pšs_³r_Ãt
()

182 
max_pšs_³r_Ãt
 = 0;

183 
š‘
 = 0;

184 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

185 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

186 
max_pšs_³r_Ãt
 = 
	`max
(max_pšs_³r_Ãt, 
Ãt
[
š‘
].
num_Ãt_pšs
);

190  (
max_pšs_³r_Ãt
);

191 
	}
}

194 
boŞ—n
 
	$timšg_driv’_rou‹_Ãt
(
š‘
, 
´es_çc
,

195 
max_ü™iÿl™y
, 
ü™iÿl™y_exp
,

196 
a¡¬_çc
, 
b’d_co¡
,

197 * 
Ãt_¦ack
, * 
pš_ü™iÿl™y
,

198 * 
sšk_Üd”
, 
t_¹_node
** 
¹_node_of_sšk
,

199 
T_ü™
, * 
Ãt_d–ay
)

208 
	`·thfšd”_upd©e_Úe_co¡
(
Œaû_h—d
[
š‘
], -1, 
´es_çc
);

209 
	`ä“_Œaûback
(
š‘
);

212 
š
 = 0;

213 
pš_ü™
 = 0.0;

215 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

216 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

218 
pš_ü™
 = 
	`max
(
max_ü™iÿl™y
 - 
Ãt_¦ack
[
š
] / 
T_ü™
, 0.0);

219 
pš_ü™
 = 
	`pow
Õš_ü™, 
ü™iÿl™y_exp
);

220 
pš_ü™
 = 
	`mš
Õš_ü™, 
max_ü™iÿl™y
);

221 
pš_ü™iÿl™y
[
š
] = 
pš_ü™
;

224 
num_sšks
 = 
Ãt
[
š‘
].
num_Ãt_pšs
 - 1;

226 
	`h—psÜt
(
sšk_Üd”
, 
pš_ü™iÿl™y
, 
num_sšks
);

229 
Ïrge¡_ü™iÿl™y
 = 
pš_ü™iÿl™y
[
sšk_Üd”
[1]];

230 
	`upd©e_¼_ba£_co¡s
(
š‘
, 
Ïrge¡_ü™iÿl™y
);

231 
	`m¬k_’ds
(
š‘
);

232 
t_¹_node
* 
¹_roÙ
 = 
	`š™_rou‹_Œ“_to_sourû
(
š‘
);

234 
™¬g‘
 = 0;

235 
™¬g‘
 = 1; irg‘ <ğ
num_sšks
; ++itarget) {

236 
rg‘_pš
 = 
sšk_Üd”
[
™¬g‘
];

237 
rg‘_node
 = 
Ãt_¼_‹rmš®s
[
š‘
][
rg‘_pš
];

240 
rg‘_ü™iÿl™y
 = 
pš_ü™iÿl™y
[
rg‘_pš
];

241 
	`add_rou‹_Œ“_to_h—p
(
¹_roÙ
, 
rg‘_node
, 
rg‘_ü™iÿl™y
,

242 
a¡¬_çc
);

244 
s_h—p
* 
cu¼’t
 = 
	`g‘_h—p_h—d
();

245 ià(
cu¼’t
 =ğ
NULL
) {

246 
	`»£t_·th_co¡s
();

247 
	`ä“_rou‹_Œ“
(
¹_roÙ
);

248  (
FALSE
);

251 
ivex
 = 
cu¼’t
->
šdex
;

252 
ivex
 !ğ
rg‘_node
) {

253 
Şd_tco¡
 = 
¼_node_rou‹_šf
[
ivex
].
·th_co¡
;

254 
Ãw_tco¡
 = 
cu¼’t
->
co¡
;

256 
Şd_back_co¡
 = 0.0;

257 ià(
Şd_tco¡
 > 0.99 * 
HUGE_FLOAT
) {

258 
Şd_back_co¡
 = 
HUGE_FLOAT
;

260 
Şd_back_co¡
 = 
¼_node_rou‹_šf
[
ivex
].
backw¬d_·th_co¡
;

263 
Ãw_back_co¡
 = 
cu¼’t
->
backw¬d_·th_co¡
;

273 ià(
Şd_tco¡
 > 
Ãw_tco¡
 && 
Şd_back_co¡
 > 
Ãw_back_co¡
) {

275 
¼_node_rou‹_šf
[
ivex
].
´ev_node
 = 
cu¼’t
->
u
.prev_node;

276 
¼_node_rou‹_šf
[
ivex
].
´ev_edge
 = 
cu¼’t
->prev_edge;

277 
¼_node_rou‹_šf
[
ivex
].
·th_co¡
 = 
Ãw_tco¡
;

278 
¼_node_rou‹_šf
[
ivex
].
backw¬d_·th_co¡
 = 
Ãw_back_co¡
;

280 ià(
Şd_tco¡
 > 0.99 * 
HUGE_FLOAT
) {

281 
	`add_to_mod_li¡
(&
¼_node_rou‹_šf
[
ivex
].
·th_co¡
);

284 
	`timšg_driv’_ex·nd_Ãighbours
(
cu¼’t
, 
š‘
, 
b’d_co¡
,

285 
rg‘_ü™iÿl™y
, 
rg‘_node
, 
a¡¬_çc
);

288 
	`ä“_h—p_d©a
(
cu¼’t
);

289 
cu¼’t
 = 
	`g‘_h—p_h—d
();

291 ià(
cu¼’t
 =ğ
NULL
) {

292 
	`»£t_·th_co¡s
();

293 
	`ä“_rou‹_Œ“
(
¹_roÙ
);

294  (
FALSE
);

297 
ivex
 = 
cu¼’t
->
šdex
;

307 
¼_node_rou‹_šf
[
ivex
].
rg‘_æag
--;

308 
s_Œaû
* 
Ãw_rou‹_¡¬t_Œ
 = 
	`upd©e_Œaûback
(
cu¼’t
, 
š‘
);

309 
¹_node_of_sšk
[
rg‘_pš
] = 
	`upd©e_rou‹_Œ“
(
cu¼’t
);

310 
	`ä“_h—p_d©a
(
cu¼’t
);

311 
	`·thfšd”_upd©e_Úe_co¡
(
Ãw_rou‹_¡¬t_Œ
, 1, 
´es_çc
);

312 
	`em±y_h—p
();

313 
	`»£t_·th_co¡s
();

317 
	`upd©e_Ãt_d–ays_äom_rou‹_Œ“
(
Ãt_d–ay
, 
¹_node_of_sšk
, 
š‘
);

318 
	`ä“_rou‹_Œ“
(
¹_roÙ
);

319  (
TRUE
);

320 
	}
}

323 
	$add_rou‹_Œ“_to_h—p
(
t_¹_node
* 
¹_node
, 
rg‘_node
,

324 
rg‘_ü™iÿl™y
, 
a¡¬_çc
)

329 
ivex
;

330 
t_¹_node
* 
chd_node
;

331 
t_lšked_¹_edge
* 
lšked_¹_edge
;

332 
tÙ_co¡
, 
backw¬d_·th_co¡
, 
R_up¡»am
;

336 ià(
¹_node
->
»_ex·nd
) {

337 
ivex
 = 
¹_node
->ivex;

338 
backw¬d_·th_co¡
 = 
rg‘_ü™iÿl™y
 * 
¹_node
->
Td–
;

339 
R_up¡»am
 = 
¹_node
->R_upstream;

340 
tÙ_co¡
 = 
backw¬d_·th_co¡
 + 
a¡¬_çc
 * 
g‘_timšg_driv’_ex³ùed_co¡


341 (
ivex
, 
rg‘_node
, 
rg‘_ü™iÿl™y
, 
R_up¡»am
);

342 
	`node_to_h—p
(
ivex
, 
tÙ_co¡
, 
NO_PREVIOUS
, NO_PREVIOUS,

343 
backw¬d_·th_co¡
, 
R_up¡»am
);

346 
lšked_¹_edge
 = 
¹_node
->
u
.
chd_li¡
;

348 
lšked_¹_edge
 !ğ
NULL
) {

349 
chd_node
 = 
lšked_¹_edge
->
chd
;

350 
	`add_rou‹_Œ“_to_h—p
(
chd_node
, 
rg‘_node
, 
rg‘_ü™iÿl™y
,

351 
a¡¬_çc
);

352 
lšked_¹_edge
 =†šked_¹_edge->
Ãxt
;

354 
	}
}

357 
	$timšg_driv’_ex·nd_Ãighbours
(
s_h—p
* 
cu¼’t
, 
š‘
,

358 
b’d_co¡
, 
ü™iÿl™y_çc
, 
rg‘_node
, 

359 
a¡¬_çc
)

364 
icÚn
, 
to_node
, 
num_edges
, 
ivex
, 
isw™ch
, 
rg‘_x
, 
rg‘_y
;

365 
¼_ty³s_t
 
äom_ty³
, 
to_ty³
;

366 
Ãw_tÙ_co¡
, 
Şd_back_pco¡
, 
Ãw_back_pco¡
, 
R_up¡»am
;

367 
Ãw_R_up¡»am
, 
Td–
;

368 
ivex
 = 
cu¼’t
->
šdex
;

369 
Şd_back_pco¡
 = 
cu¼’t
->
backw¬d_·th_co¡
;

370 
R_up¡»am
 = 
cu¼’t
->R_upstream;

371 
num_edges
 = 
¼_node
[
ivex
].num_edges;

372 
rg‘_x
 = 
¼_node
[
rg‘_node
].
xhigh
;

373 
rg‘_y
 = 
¼_node
[
rg‘_node
].
yhigh
;

375 
icÚn
 = 0; icÚÀ< 
num_edges
; iconn++) {

376 
to_node
 = 
¼_node
[
ivex
].
edges
[
icÚn
];

378 ià(
¼_node
[
to_node
].
xhigh
 < 
rou‹_bb
[
š‘
].
xmš
 ||

379 
¼_node
[
to_node
].
xlow
 > 
rou‹_bb
[
š‘
].
xmax
 ||

380 
¼_node
[
to_node
].
yhigh
 < 
rou‹_bb
[
š‘
].
ymš
 ||

381 
¼_node
[
to_node
].
ylow
 > 
rou‹_bb
[
š‘
].
ymax
) {

389 
to_ty³
 = 
¼_node
[
to_node
].
ty³
;

391 ià(
to_ty³
 =ğ
IPIN
 && (
¼_node
[
to_node
].
xhigh
 !ğ
rg‘_x
 ||

392 
¼_node
[
to_node
].
yhigh
 !ğ
rg‘_y
)) {

400 
Ãw_back_pco¡
 = 
Şd_back_pco¡
 + (1. - 
ü™iÿl™y_çc
) *

401 
	`g‘_¼_cÚg_co¡
(
to_node
);

402 
isw™ch
 = 
¼_node
[
ivex
].
sw™ches
[
icÚn
];

404 ià(
sw™ch_šf
[
isw™ch
].
bufã»d
) {

405 
Ãw_R_up¡»am
 = 
sw™ch_šf
[
isw™ch
].
R
;

407 
Ãw_R_up¡»am
 = 
R_up¡»am
 + 
sw™ch_šf
[
isw™ch
].
R
;

410 
Td–
 = 
¼_node
[
to_node
].
C
 * (
Ãw_R_up¡»am
 + 0.5 *„r_node[to_node].
R
);

411 
Td–
 +ğ
sw™ch_šf
[
isw™ch
].Tdel;

412 
Ãw_R_up¡»am
 +ğ
¼_node
[
to_node
].
R
;

413 
Ãw_back_pco¡
 +ğ
ü™iÿl™y_çc
 * 
Td–
;

415 ià(
b’d_co¡
 != 0.) {

416 
äom_ty³
 = 
¼_node
[
ivex
].
ty³
;

417 
to_ty³
 = 
¼_node
[
to_node
].
ty³
;

419 ià((
äom_ty³
 =ğ
CHANX
 && 
to_ty³
 =ğ
CHANY
) ||

420 (
äom_ty³
 =ğ
CHANY
 && 
to_ty³
 =ğ
CHANX
)) {

421 
Ãw_back_pco¡
 +ğ
b’d_co¡
;

425 
Ãw_tÙ_co¡
 = 
Ãw_back_pco¡
 + 
a¡¬_çc
 *

426 
	`g‘_timšg_driv’_ex³ùed_co¡
(
to_node
, 
rg‘_node
,

427 
ü™iÿl™y_çc
, 
Ãw_R_up¡»am
);

428 
	`node_to_h—p
(
to_node
, 
Ãw_tÙ_co¡
, 
ivex
, 
icÚn
, 
Ãw_back_pco¡
,

429 
Ãw_R_up¡»am
);

431 
	}
}

434 
	$g‘_timšg_driv’_ex³ùed_co¡
(
ivex
, 
rg‘_node
,

435 
ü™iÿl™y_çc
, 
R_up¡»am
)

440 
¼_ty³s_t
 
¼_ty³
;

441 
co¡_šdex
, 
Ütho_co¡_šdex
, 
num_£gs_§me_dœ
, 
num_£gs_Ütho_dœ
;

442 
ex³ùed_co¡
, 
cÚg_co¡
, 
Td–
;

443 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

445 ià(
¼_ty³
 =ğ
CHANX
 ||„r_ty³ =ğ
CHANY
) {

446 
num_£gs_§me_dœ
 = 
	`g‘_ex³ùed_£gs_to_rg‘
(
ivex
, 
rg‘_node
,

447 &
num_£gs_Ütho_dœ
);

448 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

449 
Ütho_co¡_šdex
 = 
¼_šdexed_d©a
[
co¡_šdex
].ortho_cost_index;

450 
cÚg_co¡
 = 
num_£gs_§me_dœ
 * 
¼_šdexed_d©a
[
co¡_šdex
].
ba£_co¡
 +

451 
num_£gs_Ütho_dœ
 * 
¼_šdexed_d©a
[
Ütho_co¡_šdex
].
ba£_co¡
;

452 
cÚg_co¡
 +ğ
¼_šdexed_d©a
[
IPIN_COST_INDEX
].
ba£_co¡
 +

453 
¼_šdexed_d©a
[
SINK_COST_INDEX
].
ba£_co¡
;

454 
Td–
 = 
num_£gs_§me_dœ
 * 
¼_šdexed_d©a
[
co¡_šdex
].
T_lš—r
 +

455 
num_£gs_Ütho_dœ
 * 
¼_šdexed_d©a
[
Ütho_co¡_šdex
].
T_lš—r
 +

456 
num_£gs_§me_dœ
 *‚um_segs_same_dir *

457 
¼_šdexed_d©a
[
co¡_šdex
].
T_quad¿tic
 +

458 
num_£gs_Ütho_dœ
 *‚um_segs_ortho_dir *

459 
¼_šdexed_d©a
[
Ütho_co¡_šdex
].
T_quad¿tic
 +

460 
R_up¡»am
 * (
num_£gs_§me_dœ
 * 
¼_šdexed_d©a
[
co¡_šdex
].
C_lßd


461 + 
num_£gs_Ütho_dœ
 * 
¼_šdexed_d©a
[
Ütho_co¡_šdex
].
C_lßd
);

462 
Td–
 +ğ
¼_šdexed_d©a
[
IPIN_COST_INDEX
].
T_lš—r
;

463 
ex³ùed_co¡
 = 
ü™iÿl™y_çc
 * 
Td–
 + (1. - cr™iÿl™y_çcè* 
cÚg_co¡
;

464  (
ex³ùed_co¡
);

465 } ià(
¼_ty³
 =ğ
IPIN
) {

466  (
¼_šdexed_d©a
[
SINK_COST_INDEX
].
ba£_co¡
);

470 
	}
}

476 
	#ROUND_UP
(
x
è(
	`û
 (x - 0.001))

	)

479 
	$g‘_ex³ùed_£gs_to_rg‘
(
ivex
, 
rg‘_node
, *

480 
num_£gs_Ütho_dœ_±r
)

485 
¼_ty³s_t
 
¼_ty³
;

486 
rg‘_x
, 
rg‘_y
, 
num_£gs_§me_dœ
, 
co¡_šdex
, 
Ütho_co¡_šdex
;

487 
no_Ãed_to_·ss_by_şb
;

488 
šv_Ëngth
, 
Ütho_šv_Ëngth
, 
ylow
, 
yhigh
, 
xlow
, 
xhigh
;

489 
rg‘_x
 = 
¼_node
[
rg‘_node
].
xlow
;

490 
rg‘_y
 = 
¼_node
[
rg‘_node
].
ylow
;

491 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

492 
šv_Ëngth
 = 
¼_šdexed_d©a
[
co¡_šdex
].inv_length;

493 
Ütho_co¡_šdex
 = 
¼_šdexed_d©a
[
co¡_šdex
].ortho_cost_index;

494 
Ütho_šv_Ëngth
 = 
¼_šdexed_d©a
[
Ütho_co¡_šdex
].
šv_Ëngth
;

495 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

497 ià(
¼_ty³
 =ğ
CHANX
) {

498 
ylow
 = 
¼_node
[
ivex
].ylow;

499 
xhigh
 = 
¼_node
[
ivex
].xhigh;

500 
xlow
 = 
¼_node
[
ivex
].xlow;

504 ià(
ylow
 > 
rg‘_y
) {

505 *
num_£gs_Ütho_dœ_±r
 = 
	`ROUND_UP
((
ylow
 - 
rg‘_y
 + 1.) *

506 
Ütho_šv_Ëngth
);

507 
no_Ãed_to_·ss_by_şb
 = 1;

508 } ià(
ylow
 < 
rg‘_y
 - 1) {

509 *
num_£gs_Ütho_dœ_±r
 = 
	`ROUND_UP
((
rg‘_y
 - 
ylow
) *

510 
Ütho_šv_Ëngth
);

511 
no_Ãed_to_·ss_by_şb
 = 1;

513 *
num_£gs_Ütho_dœ_±r
 = 0;

514 
no_Ãed_to_·ss_by_şb
 = 0;

519 ià(
xlow
 > 
rg‘_x
 + 
no_Ãed_to_·ss_by_şb
) {

520 
num_£gs_§me_dœ
 = 
	`ROUND_UP
((
xlow
 - 
no_Ãed_to_·ss_by_şb
 -

521 
rg‘_x
è* 
šv_Ëngth
);

522 } ià(
xhigh
 < 
rg‘_x
 - 
no_Ãed_to_·ss_by_şb
) {

523 
num_£gs_§me_dœ
 = 
	`ROUND_UP
((
rg‘_x
 - 
no_Ãed_to_·ss_by_şb
 -

524 
xhigh
è* 
šv_Ëngth
);

526 
num_£gs_§me_dœ
 = 0;

529 
ylow
 = 
¼_node
[
ivex
].ylow;

530 
yhigh
 = 
¼_node
[
ivex
].yhigh;

531 
xlow
 = 
¼_node
[
ivex
].xlow;

535 ià(
xlow
 > 
rg‘_x
) {

536 *
num_£gs_Ütho_dœ_±r
 = 
	`ROUND_UP
((
xlow
 - 
rg‘_x
 + 1.) *

537 
Ütho_šv_Ëngth
);

538 
no_Ãed_to_·ss_by_şb
 = 1;

539 } ià(
xlow
 < 
rg‘_x
 - 1) {

540 *
num_£gs_Ütho_dœ_±r
 = 
	`ROUND_UP
((
rg‘_x
 - 
xlow
) *

541 
Ütho_šv_Ëngth
);

542 
no_Ãed_to_·ss_by_şb
 = 1;

544 *
num_£gs_Ütho_dœ_±r
 = 0;

545 
no_Ãed_to_·ss_by_şb
 = 0;

550 ià(
ylow
 > 
rg‘_y
 + 
no_Ãed_to_·ss_by_şb
) {

551 
num_£gs_§me_dœ
 = 
	`ROUND_UP
((
ylow
 - 
no_Ãed_to_·ss_by_şb
 -

552 
rg‘_y
è* 
šv_Ëngth
);

553 } ià(
yhigh
 < 
rg‘_y
 - 
no_Ãed_to_·ss_by_şb
) {

554 
num_£gs_§me_dœ
 = 
	`ROUND_UP
((
rg‘_y
 - 
no_Ãed_to_·ss_by_şb
 -

555 
yhigh
è* 
šv_Ëngth
);

557 
num_£gs_§me_dœ
 = 0;

561  (
num_£gs_§me_dœ
);

562 
	}
}

565 
	$upd©e_¼_ba£_co¡s
(
š‘
, 
Ïrge¡_ü™iÿl™y
)

569 
çnout
 = 
Ãt
[
š‘
].
num_Ãt_pšs
 - 1.0;

570 
çùÜ
 = 
	`sq¹
(
çnout
);

572 
šdex
 = 0;

573 
šdex
 = 
CHANX_COST_INDEX_START
; index < 
num_¼_šdexed_d©a
; ++index) {

574 ià(
¼_šdexed_d©a
[
šdex
].
T_quad¿tic
 > 0.0) {

575 
¼_šdexed_d©a
[
šdex
].
ba£_co¡
 =

576 
¼_šdexed_d©a
[
šdex
].
§ved_ba£_co¡
 * 
çùÜ
;

578 
¼_šdexed_d©a
[
šdex
].
ba£_co¡
 =

579 
¼_šdexed_d©a
[
šdex
].
§ved_ba£_co¡
;

582 
	}
}

585 
	#ERROR_TOL
 0.0001

	)

587 
	$timšg_driv’_check_Ãt_d–ays
(** 
Ãt_d–ay
)

591 
š‘
, 
š
;

592 ** 
Ãt_d–ay_check
;

593 
lšked_v±r_t
* 
ch_li¡_h—d_Ãt_d–ay_check
;

594 
Ãt_d–ay_check
 = 
	`®loc_Ãt_d–ay
(&
ch_li¡_h—d_Ãt_d–ay_check
);

595 
	`lßd_Ãt_d–ay_äom_routšg
(
Ãt_d–ay_check
);

597 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

598 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

599 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

600 ià(
Ãt_d–ay_check
[
š‘
][
š
] == 0.) {

601 ià(
Ãt_d–ay_check
[
š‘
][
š
] != 0.) {

602 
	`´štf
("Error iniming_driven_check_net_delays:‚et %d…in %d."

604 "ÃˆTd– i %g.\n", 
š‘
, 
š
, 
Ãt_d–ay
[inet][ipin],

605 
Ãt_d–ay_check
[
š‘
][
š
]);

606 
	`ex™
(1);

609 ià(
	`çbs
(1. - 
Ãt_d–ay
[
š‘
][
š
] / 
Ãt_d–ay_check
[inet][ipin])

610 > 
ERROR_TOL
) {

611 
	`´štf
("Error iniming_driven_check_net_delays:‚et %d…in %d."

613 "ÃˆTd– i %g.\n", 
š‘
, 
š
, 
Ãt_d–ay
[inet][ipin],

614 
Ãt_d–ay_check
[
š‘
][
š
]);

615 
	`ex™
(1);

621 
	`ä“_Ãt_d–ay
(
Ãt_d–ay_check
, &
ch_li¡_h—d_Ãt_d–ay_check
);

622 
	`´štf
("Completed‚et Tdel value cross check successfully.\n");

623 
	}
}

	@route_timing.h

1 #iâdeà
ROUTE_TIMING_H


2 
	#ROUTE_TIMING_H


	)

4 
	~"ut.h
"

5 
	~"rou‹_Œ“_timšg.h
"

7 
boŞ—n
 
Œy_timšg_driv’_rou‹
(
rou‹r_İts_t
 
rou‹r_İts
,

8 ** 
Ãt_¦ack
, ** 
Ãt_d–ay
,

9 
veùÜ_t
** 
şb_İšs_u£d_loÿÎy
);

11 
boŞ—n
 
timšg_driv’_rou‹_Ãt
(
š‘
, 
´es_çc
,

12 
max_ü™iÿl™y
, 
ü™iÿl™y_exp
,

13 
a¡¬_çc
, 
b’d_co¡
,

14 * 
Ãt_¦ack
, * 
pš_ü™iÿl™y
,

15 * 
sšk_Üd”
, 
t_¹_node
** 
¹_node_of_sšk
,

16 
T_ü™
, * 
Ãt_d–ay
);

18 
®loc_timšg_driv’_rou‹_¡ruùs
(** 
pš_ü™iÿl™y_±r
,

19 ** 
sšk_Üd”_±r
,

20 
t_¹_node
*** 
¹_node_of_sšk_±r
);

22 
ä“_timšg_driv’_rou‹_¡ruùs
(* 
pš_ü™iÿl™y
,

23 * 
sšk_Üd”
,

24 
t_¹_node
** 
¹_node_of_sšk
);

	@route_tree_timing.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"rou‹_commÚ.h
"

6 
	~"rou‹_Œ“_timšg.h
"

23 
t_¹_node
** 
	g¼_node_to_¹_node
 = 
NULL
;

26 
t_¹_node
* 
	g¹_node_ä“_li¡
 = 
NULL
;

27 
t_lšked_¹_edge
* 
	g¹_edge_ä“_li¡
 = 
NULL
;

33 
t_¹_node
* 
®loc_¹_node
();

35 
ä“_¹_node
(
t_¹_node
* 
¹_node
);

37 
t_lšked_¹_edge
* 
®loc_lšked_¹_edge
();

39 
ä“_lšked_¹_edge
(
t_lšked_¹_edge
* 
¹_edge
);

41 
t_¹_node
* 
add_·th_to_rou‹_Œ“
(
s_h—p
* 
h±r
,_rt_node

42 ** 
sšk_¹_node_±r
);

44 
lßd_Ãw_·th_R_up¡»am
(
t_¹_node
* 
¡¬t_of_Ãw_·th_¹_node
);

46 
t_¹_node
* 
upd©e_unbufã»d_ªû¡Üs_C_down¡»am
(t_rt_node

47 *
¡¬t_of_Ãw_·th_¹_node
);

49 
lßd_¹_subŒ“_d–ay
(
t_¹_node
* 
subŒ“_¹_roÙ
, 
T¬riv®
);

55 
	$®loc_rou‹_Œ“_timšg_¡ruùs
()

60 ià(
¼_node_to_¹_node
 !ğ
NULL
 || 
¹_node_ä“_li¡
 != NULL ||

61 
¹_edge_ä“_li¡
 !ğ
NULL
) {

62 
	`´štf
("Error in‡lloc_route_tree_timing_structs: old structures "

64 
	`ex™
(1);

67 
¼_node_to_¹_node
 = (
t_¹_node
**)
	`my_m®loc
(
num_¼_nodes
 *

68 (
t_¹_node
*));

69 
	}
}

72 
	$ä“_rou‹_Œ“_timšg_¡ruùs
()

76 
t_¹_node
* 
¹_node
, *
Ãxt_node
;

77 
t_lšked_¹_edge
* 
¹_edge
, *
Ãxt_edge
;

78 
	`ä“
(
¼_node_to_¹_node
);

79 
¼_node_to_¹_node
 = 
NULL
;

80 
¹_node
 = 
¹_node_ä“_li¡
;

82 
¹_node
 !ğ
NULL
) {

83 
Ãxt_node
 = 
¹_node
->
u
.
Ãxt
;

84 
	`ä“
(
¹_node
);

85 
¹_node
 = 
Ãxt_node
;

88 
¹_node_ä“_li¡
 = 
NULL
;

89 
¹_edge
 = 
¹_edge_ä“_li¡
;

91 
¹_edge
 !ğ
NULL
) {

92 
Ãxt_edge
 = 
¹_edge
->
Ãxt
;

93 
	`ä“
(
¹_edge
);

94 
¹_edge
 = 
Ãxt_edge
;

97 
¹_edge_ä“_li¡
 = 
NULL
;

98 
	}
}

101 
t_¹_node
* 
	$®loc_¹_node
()

105 
t_¹_node
* 
¹_node
;

106 
¹_node
 = 
¹_node_ä“_li¡
;

108 ià(
¹_node
 !ğ
NULL
) {

109 
¹_node_ä“_li¡
 = 
¹_node
->
u
.
Ãxt
;

111 
¹_node
 = (
t_¹_node
*è
	`my_m®loc
((t_rt_node));

114  (
¹_node
);

115 
	}
}

118 
	$ä“_¹_node
(
t_¹_node
* 
¹_node
)

121 
¹_node
->
u
.
Ãxt
 = 
¹_node_ä“_li¡
;

122 
¹_node_ä“_li¡
 = 
¹_node
;

123 
	}
}

126 
t_lšked_¹_edge
* 
	$®loc_lšked_¹_edge
()

130 
t_lšked_¹_edge
* 
lšked_¹_edge
;

131 
lšked_¹_edge
 = 
¹_edge_ä“_li¡
;

133 ià(
lšked_¹_edge
 !ğ
NULL
) {

134 
¹_edge_ä“_li¡
 = 
lšked_¹_edge
->
Ãxt
;

136 
lšked_¹_edge
 = (
t_lšked_¹_edge
*è
	`my_m®loc
(

137 (
t_lšked_¹_edge
));

140  (
lšked_¹_edge
);

141 
	}
}

144 
	$ä“_lšked_¹_edge
(
t_lšked_¹_edge
* 
¹_edge
)

147 
¹_edge
->
Ãxt
 = 
¹_edge_ä“_li¡
;

148 
¹_edge_ä“_li¡
 = 
¹_edge
;

149 
	}
}

152 
t_¹_node
* 
	$š™_rou‹_Œ“_to_sourû
(
š‘
)

156 
t_¹_node
* 
¹_roÙ
;

157 
ivex
;

158 
¹_roÙ
 = 
	`®loc_¹_node
();

159 
¹_roÙ
->
u
.
chd_li¡
 = 
NULL
;

160 
¹_roÙ
->
·»Á_node
 = 
NULL
;

161 
¹_roÙ
->
·»Á_sw™ch
 = 
OPEN
;

162 
¹_roÙ
->
»_ex·nd
 = 
TRUE
;

163 
ivex
 = 
Ãt_¼_‹rmš®s
[
š‘
][0];

164 
¹_roÙ
->
ivex
 = ivex;

165 
¹_roÙ
->
C_down¡»am
 = 
¼_node
[
ivex
].
C
;

166 
¹_roÙ
->
R_up¡»am
 = 
¼_node
[
ivex
].
R
;

167 
¹_roÙ
->
Td–
 = 0.5 * 
¼_node
[
ivex
].
R
 *„r_node[ivex].
C
;

168 
¼_node_to_¹_node
[
ivex
] = 
¹_roÙ
;

169  (
¹_roÙ
);

170 
	}
}

173 
t_¹_node
* 
	$upd©e_rou‹_Œ“
(
s_h—p
* 
h±r
)

179 
t_¹_node
* 
¡¬t_of_Ãw_·th_¹_node
, *
sšk_¹_node
;

180 
t_¹_node
* 
unbufã»d_subŒ“_¹_roÙ
, *
subŒ“_·»Á_¹_node
;

181 
d–ay_¡¬t
;

182 
isw™ch
;

183 
¡¬t_of_Ãw_·th_¹_node
 = 
	`add_·th_to_rou‹_Œ“
(
h±r
, &
sšk_¹_node
);

184 
	`lßd_Ãw_·th_R_up¡»am
(
¡¬t_of_Ãw_·th_¹_node
);

185 
unbufã»d_subŒ“_¹_roÙ
 = 
	`upd©e_unbufã»d_ªû¡Üs_C_down¡»am
(

186 
¡¬t_of_Ãw_·th_¹_node
);

187 
subŒ“_·»Á_¹_node
 = 
unbufã»d_subŒ“_¹_roÙ
->
·»Á_node
;

189 ià(
subŒ“_·»Á_¹_node
 !ğ
NULL
) {

190 
d–ay_¡¬t
 = 
subŒ“_·»Á_¹_node
->
Td–
;

191 
isw™ch
 = 
unbufã»d_subŒ“_¹_roÙ
->
·»Á_sw™ch
;

192 
d–ay_¡¬t
 +ğ
sw™ch_šf
[
isw™ch
].
R
 *

193 
unbufã»d_subŒ“_¹_roÙ
->
C_down¡»am
;

194 
d–ay_¡¬t
 +ğ
sw™ch_šf
[
isw™ch
].
Td–
;

196 
d–ay_¡¬t
 = 0.;

199 
	`lßd_¹_subŒ“_d–ay
(
unbufã»d_subŒ“_¹_roÙ
, 
d–ay_¡¬t
);

200  (
sšk_¹_node
);

201 
	}
}

204 
t_¹_node
* 
	$add_·th_to_rou‹_Œ“
(
s_h—p
* 
h±r
, 
t_¹_node


205 ** 
sšk_¹_node_±r
)

210 
›dge
, 
isw™ch
;

211 
C_down¡»am
;

212 
t_¹_node
* 
¹_node
, *
down¡»am_¹_node
, *
sšk_¹_node
;

213 
t_lšked_¹_edge
* 
lšked_¹_edge
;

214 
ivex
 = 
h±r
->
šdex
;

216 #ifdeà
DEBUG


217 ià(
¼_node
[
ivex
].
ty³
 !ğ
SINK
) {

218 
	`´štf
("Error in‡dd_path_to_route_tree. Expectedype = SINK (%d).\n",

219 
SINK
);

220 
	`´štf
("GÙy³ = %d.", 
¼_node
[
ivex
].
ty³
);

221 
	`ex™
(1);

225 
sšk_¹_node
 = 
	`®loc_¹_node
();

226 
sšk_¹_node
->
u
.
chd_li¡
 = 
NULL
;

227 
sšk_¹_node
->
ivex
 = ivex;

228 
C_down¡»am
 = 
¼_node
[
ivex
].
C
;

229 
sšk_¹_node
->
C_down¡»am
 = C_downstream;

230 
¼_node_to_¹_node
[
ivex
] = 
sšk_¹_node
;

236 
	#NO_ROUTE_THROUGHS
 1

	)

237 #ifdeà
NO_ROUTE_THROUGHS


238 
sšk_¹_node
->
»_ex·nd
 = 
FALSE
;

241 
»maššg_cÚÃùiÚs_to_sšk
 = 
¼_node_rou‹_šf
[
ivex
].
rg‘_æag
;

242 ià(
»maššg_cÚÃùiÚs_to_sšk
 == 0) {

243 
sšk_¹_node
->
»_ex·nd
 = 
TRUE
;

249 
sšk_¹_node
->
»_ex·nd
 = 
FALSE
;

254 
down¡»am_¹_node
 = 
sšk_¹_node
;

255 
ivex
 = 
h±r
->
u
.
´ev_node
;

256 
›dge
 = 
h±r
->
´ev_edge
;

257 
isw™ch
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

261 
¼_node_rou‹_šf
[
ivex
].
´ev_node
 !ğ
NO_PREVIOUS
) {

262 
lšked_¹_edge
 = 
	`®loc_lšked_¹_edge
();

263 
lšked_¹_edge
->
chd
 = 
down¡»am_¹_node
;

264 
lšked_¹_edge
->
isw™ch
 = iswitch;

265 
lšked_¹_edge
->
Ãxt
 = 
NULL
;

266 
¹_node
 = 
	`®loc_¹_node
();

267 
down¡»am_¹_node
->
·»Á_node
 = 
¹_node
;

268 
down¡»am_¹_node
->
·»Á_sw™ch
 = 
isw™ch
;

269 
¹_node
->
u
.
chd_li¡
 = 
lšked_¹_edge
;

270 
¹_node
->
ivex
 = ivex;

272 ià(
sw™ch_šf
[
isw™ch
].
bufã»d
 =ğ
FALSE
) {

273 
C_down¡»am
 +ğ
¼_node
[
ivex
].
C
;

275 
C_down¡»am
 = 
¼_node
[
ivex
].
C
;

278 
¹_node
->
C_down¡»am
 = C_downstream;

279 
¼_node_to_¹_node
[
ivex
] = 
¹_node
;

280 #ifdeà
NO_ROUTE_THROUGHS


282 ià(
¼_node
[
ivex
].
ty³
 =ğ
IPIN
) {

283 
¹_node
->
»_ex·nd
 = 
FALSE
;

285 
¹_node
->
»_ex·nd
 = 
TRUE
;

290 ià(
»maššg_cÚÃùiÚs_to_sšk
 == 0) {

291 
¹_node
->
»_ex·nd
 = 
TRUE
;

293 
¹_node
->
»_ex·nd
 = 
FALSE
;

295 
»maššg_cÚÃùiÚs_to_sšk
 = 0;

299 
down¡»am_¹_node
 = 
¹_node
;

300 
›dge
 = 
¼_node_rou‹_šf
[
ivex
].
´ev_edge
;

301 
ivex
 = 
¼_node_rou‹_šf
[ivex].
´ev_node
;

302 
isw™ch
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

306 
¹_node
 = 
¼_node_to_¹_node
[
ivex
];

307 
lšked_¹_edge
 = 
	`®loc_lšked_¹_edge
();

308 
lšked_¹_edge
->
chd
 = 
down¡»am_¹_node
;

309 
lšked_¹_edge
->
isw™ch
 = iswitch;

310 
lšked_¹_edge
->
Ãxt
 = 
¹_node
->
u
.
chd_li¡
;

311 
¹_node
->
u
.
chd_li¡
 = 
lšked_¹_edge
;

312 
down¡»am_¹_node
->
·»Á_node
 = 
¹_node
;

313 
down¡»am_¹_node
->
·»Á_sw™ch
 = 
isw™ch
;

314 *
sšk_¹_node_±r
 = 
sšk_¹_node
;

315  (
down¡»am_¹_node
);

316 
	}
}

319 
	$lßd_Ãw_·th_R_up¡»am
(
t_¹_node
* 
¡¬t_of_Ãw_·th_¹_node
)

323 
R_up¡»am
;

324 
ivex
;

325 
isw™ch
;

326 
t_¹_node
* 
¹_node
, *
·»Á_¹_node
;

327 
t_lšked_¹_edge
* 
lšked_¹_edge
;

328 
¹_node
 = 
¡¬t_of_Ãw_·th_¹_node
;

329 
isw™ch
 = 
¹_node
->
·»Á_sw™ch
;

330 
ivex
 = 
¹_node
->ivex;

331 
·»Á_¹_node
 = 
¹_node
->
·»Á_node
;

332 
R_up¡»am
 = 
sw™ch_šf
[
isw™ch
].
R
 + 
¼_node
[
ivex
].R;

334 ià(
sw™ch_šf
[
isw™ch
].
bufã»d
 =ğ
FALSE
) {

335 
R_up¡»am
 +ğ
·»Á_¹_node
->R_upstream;

338 
¹_node
->
R_up¡»am
 = R_upstream;

342 
lšked_¹_edge
 = 
¹_node
->
u
.
chd_li¡
;

344 
lšked_¹_edge
 !ğ
NULL
) {

345 #ifdeà
DEBUG


346 ià(
lšked_¹_edge
->
Ãxt
 !ğ
NULL
) {

347 
	`´štf
("Error in†oad_new_path_R_upstream:‚ew„outing‡ddition is\n"

349 
	`ex™
(1);

353 
¹_node
 = 
lšked_¹_edge
->
chd
;

354 
isw™ch
 = 
lšked_¹_edge
->iswitch;

355 
ivex
 = 
¹_node
->ivex;

357 ià(
sw™ch_šf
[
isw™ch
].
bufã»d
) {

358 
R_up¡»am
 = 
sw™ch_šf
[
isw™ch
].
R
 + 
¼_node
[
ivex
].R;

360 
R_up¡»am
 +ğ
sw™ch_šf
[
isw™ch
].
R
 + 
¼_node
[
ivex
].R;

363 
¹_node
->
R_up¡»am
 = R_upstream;

364 
lšked_¹_edge
 = 
¹_node
->
u
.
chd_li¡
;

366 
	}
}

369 
t_¹_node
* 
	$upd©e_unbufã»d_ªû¡Üs_C_down¡»am
(
t_¹_node


370 *
¡¬t_of_Ãw_·th_¹_node
)

376 
t_¹_node
* 
¹_node
, *
·»Á_¹_node
;

377 
isw™ch
;

378 
C_down¡»am_add™iÚ
;

379 
¹_node
 = 
¡¬t_of_Ãw_·th_¹_node
;

380 
C_down¡»am_add™iÚ
 = 
¹_node
->
C_down¡»am
;

381 
·»Á_¹_node
 = 
¹_node
->
·»Á_node
;

382 
isw™ch
 = 
¹_node
->
·»Á_sw™ch
;

384 
·»Á_¹_node
 !ğ
NULL
 && 
sw™ch_šf
[
isw™ch
].
bufã»d
 =ğ
FALSE
) {

385 
¹_node
 = 
·»Á_¹_node
;

386 
¹_node
->
C_down¡»am
 +ğ
C_down¡»am_add™iÚ
;

387 
·»Á_¹_node
 = 
¹_node
->
·»Á_node
;

388 
isw™ch
 = 
¹_node
->
·»Á_sw™ch
;

391  (
¹_node
);

392 
	}
}

395 
	$lßd_¹_subŒ“_d–ay
(
t_¹_node
* 
subŒ“_¹_roÙ
, 
T¬riv®
)

401 
ivex
;

402 
isw™ch
;

403 
t_¹_node
* 
chd_node
;

404 
t_lšked_¹_edge
* 
lšked_¹_edge
;

405 
Td–
, 
Tchd
;

406 
ivex
 = 
subŒ“_¹_roÙ
->ivex;

410 
Td–
 = 
T¬riv®
 + 0.5 * 
subŒ“_¹_roÙ
->
C_down¡»am
 * 
¼_node
[
ivex
].
R
;

411 
subŒ“_¹_roÙ
->
Td–
 = Tdel;

414 
lšked_¹_edge
 = 
subŒ“_¹_roÙ
->
u
.
chd_li¡
;

416 
lšked_¹_edge
 !ğ
NULL
) {

417 
isw™ch
 = 
lšked_¹_edge
->iswitch;

418 
chd_node
 = 
lšked_¹_edge
->
chd
;

419 
Tchd
 = 
Td–
 + 
sw™ch_šf
[
isw™ch
].
R
 * 
chd_node
->
C_down¡»am
;

420 
Tchd
 +ğ
sw™ch_šf
[
isw™ch
].
Td–
;

421 
	`lßd_¹_subŒ“_d–ay
(
chd_node
, 
Tchd
);

422 
lšked_¹_edge
 =†šked_¹_edge->
Ãxt
;

424 
	}
}

427 
	$ä“_rou‹_Œ“
(
t_¹_node
* 
¹_node
)

431 
t_¹_node
* 
chd_node
;

432 
t_lšked_¹_edge
* 
¹_edge
, *
Ãxt_edge
;

433 
¹_edge
 = 
¹_node
->
u
.
chd_li¡
;

435 
¹_edge
 !ğ
NULL
) {

436 
chd_node
 = 
¹_edge
->
chd
;

437 
	`ä“_rou‹_Œ“
(
chd_node
);

438 
Ãxt_edge
 = 
¹_edge
->
Ãxt
;

439 
	`ä“_lšked_¹_edge
(
¹_edge
);

440 
¹_edge
 = 
Ãxt_edge
;

443 
	`ä“_¹_node
(
¹_node
);

444 
	}
}

447 
	$upd©e_Ãt_d–ays_äom_rou‹_Œ“
(* 
Ãt_d–ay
,

448 
t_¹_node
** 
¹_node_of_sšk
,

449 
š‘
)

453 
isšk
;

454 
t_¹_node
* 
sšk_¹_node
;

455 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

456 
isšk
 = 1; isšk < 
knum_Ãt_pšs
; ++isink) {

457 
sšk_¹_node
 = 
¹_node_of_sšk
[
isšk
];

458 
Ãt_d–ay
[
isšk
] = 
sšk_¹_node
->
Td–
;

460 
	}
}

	@route_tree_timing.h

1 #iâdeà
ROUTE_TREE_TIMING_H


2 
	#ROUTE_TREE_TIMING_H


	)

11 
	ss_lšked_¹_edge
 {

12 
s_¹_node
* 
	mchd
;

13 
	misw™ch
;

14 
s_lšked_¹_edge
* 
	mÃxt
;

17 
s_lšked_¹_edge
 
	tt_lšked_¹_edge
;

41 
	ss_¹_node
 {

43 
t_lšked_¹_edge
* 
	mchd_li¡
;

44 
s_¹_node
* 
	mÃxt
;

45 } 
	mu
;

46 
s_¹_node
* 
	m·»Á_node
;

47 
	m·»Á_sw™ch
;

48 
	m»_ex·nd
;

49 
	mivex
;

50 
	mC_down¡»am
;

51 
	mR_up¡»am
;

52 
	mTd–
;

55 
s_¹_node
 
	tt_¹_node
;

59 
®loc_rou‹_Œ“_timšg_¡ruùs
();

61 
ä“_rou‹_Œ“_timšg_¡ruùs
();

63 
t_¹_node
* 
š™_rou‹_Œ“_to_sourû
(
š‘
);

65 
ä“_rou‹_Œ“
(
t_¹_node
* 
¹_node
);

67 
t_¹_node
* 
upd©e_rou‹_Œ“
(
s_h—p
* 
h±r
);

69 
upd©e_Ãt_d–ays_äom_rou‹_Œ“
(* 
Ãt_d–ay
,

70 
t_¹_node
** 
¹_node_of_sšk
,

71 
š‘
);

	@rr_graph.c

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

3 
	~"ut.h
"

4 
	~"v´_ty³s.h
"

5 
	~"glob®s.h
"

6 
	~"¼_g¿ph_ut.h
"

7 
	~"¼_g¿ph.h
"

8 
	~"¼_g¿ph2.h
"

9 
	~"¼_g¿ph_sbox.h
"

10 
	~"check_¼_g¿ph.h
"

11 
	~"¼_g¿ph_timšg_·¿ms.h
"

12 
	~"¼_g¿ph_šdexed_d©a.h
"

13 
	~<as£¹.h
>

18 
lšked_v±r_t
* 
	g¼_mem_chunk_li¡_h—d
 = 
NULL
;

20 
	gchunk_by‹s_ava
 = 0;

21 * 
	gchunk_Ãxt_ava_mem
 = 
NULL
;

28 *** 
®loc_ªd_lßd_şb_pš_to_Œacks
(
pš_ty³s_t
 
pš_ty³
,

29 
nodes_³r_chª
, 
Fc
, 
boŞ—n
 
³¹urb_sw™ch_·‰”n
);

31 
lßd_unifÜm_sw™ch_·‰”n
(** *
Œacks_cÚÃùed_to_pš
,

32 
num_phys_pšs
, * 
pš_num_Üd”šg
, * 
side_Üd”šg
,

33 
nodes_³r_chª
, 
Fc
, 
¡•_size
);

35 
lßd_³¹urbed_sw™ch_·‰”n
(** *
Œacks_cÚÃùed_to_pš
,

36 
num_phys_pšs
, * 
pš_num_Üd”šg
, * 
side_Üd”šg
,

37 
nodes_³r_chª
, 
Fc
, 
¡•_size
);

39 
check_®l_Œacks_»ach_pšs
(** *
Œacks_cÚÃùed_to_pš
,

40 
nodes_³r_chª
, 
Fc
, 
pš_ty³s_t
 
š_Ü_İš
);

42 
veùÜ_t
** 
®loc_ªd_lßd_Œacks_to_şb_š
(
nodes_³r_chª
,

43 
Fc
, ** *
şb_š_to_Œacks
);

45 ** 
®loc_ªd_lßd_·ds_to_Œacks
(
nodes_³r_chª
, 
Fc_·d
);

47 
veùÜ_t
* 
®loc_ªd_lßd_Œacks_to_·ds
(** 
·ds_to_Œacks
,

48 
nodes_³r_chª
, 
Fc_·d
);

50 
Œack_side
(
şb_side
);

52 
®loc_ªd_lßd_¼_g¿ph
(** 
¼_node_šdiûs
,

53 ** *
şb_İš_to_Œacks
, 
veùÜ_t
** 
Œacks_to_şb_š
,

54 ** 
·ds_to_Œacks
, 
veùÜ_t
* 
Œacks_to_·ds
, 
Fc_ouut
,

55 
Fc_šput
, 
Fc_·d
, 
nodes_³r_chª
, 
rou‹r_ty³s_t


56 
rou‹_ty³
, 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

57 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
);

59 
bud_¼_şb
(** 
¼_node_šdiûs
, 
Fc_ouut
, ** *

60 
şb_İš_to_Œacks
, 
nodes_³r_chª
, 
i
, 
j
,

61 
Td–Ëss_sw™ch
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
,

62 
£gm’t_d‘as_t
* 
£g_d‘as_y
);

64 
bud_¼_·ds
(** 
¼_node_šdiûs
, 
Fc_·d
, 

65 ** 
·ds_to_Œacks
, 
nodes_³r_chª
, 
i
, 
j
, 

66 
Td–Ëss_sw™ch
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

67 *
£g_d‘as_y
);

69 
bud_¼_xchª
(** 
¼_node_šdiûs
, 
rou‹r_ty³s_t


70 
rou‹_ty³
, 
veùÜ_t
** 
Œacks_to_şb_š
, vector_t *

71 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
,

72 
sw™ch_block_t
 
sw™ch_block_ty³
, 
wœe_to_š_sw™ch
,

73 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
,

74 
co¡_šdex_off£t
);

76 
bud_¼_ychª
(** 
¼_node_šdiûs
, 
rou‹r_ty³s_t


77 
rou‹_ty³
, 
veùÜ_t
** 
Œacks_to_şb_š
, vector_t *

78 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
,

79 
sw™ch_block_t
 
sw™ch_block_ty³
, 
wœe_to_š_sw™ch
,

80 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
,

81 
co¡_šdex_off£t
);

83 
®loc_ªd_lßd_edges_ªd_sw™ches
(
ivex
, 
num_edges
,

84 
t_lšked_edge
* 
edge_li¡_h—d
);

86 
®loc_Ãt_¼_‹rmš®s
();

88 
®loc_ªd_lßd_¼_şb_sourû
(** 
¼_node_šdiûs
,

89 
nodes_³r_chª
);

91 
which_io_block
(
iblk
);

103 
	ss_¼_g¿ph_š‹º®_v¬s
 {

104 
	mnodes_³r_chª
;

105 ** 
	m¼_node_šdiûs
;

106 ** 
	m·ds_to_Œacks
;

107 
veùÜ_t
** 
	mŒacks_to_şb_š
;

108 
veùÜ_t
* 
	mŒacks_to_·ds
;

109 *** 
	mşb_İš_to_Œacks
;

110 *** 
	mşb_š_to_Œacks
;

111 
£gm’t_d‘as_t
* 
	m£g_d‘as_x
;

112 
£gm’t_d‘as_t
* 
	m£g_d‘as_y
;

115 
s_¼_g¿ph_š‹º®_v¬s
 
	g¼_g¿ph_š‹º®_v¬s
;

118 ** 
	$g”r_node_t_šdiûs
()

120  (
¼_g¿ph_š‹º®_v¬s
.
¼_node_šdiûs
);

121 
	}
}

123 
	$g‘_nodes_³r_chª
()

125  (
¼_g¿ph_š‹º®_v¬s
.
nodes_³r_chª
);

126 
	}
}

129 
	$bud_¼_g¿ph
(
rou‹r_ty³s_t
 
rou‹_ty³
,

130 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

131 
£gm’t_šfo_t
* 
£gm’t_šf
,

132 
timšg_šfo_t
 
timšg_šf
,

133 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
)

139 
nodes_³r_şb
 = 
num_pš_şass
 + 
max_pšs_³r_şb
;

140 
nodes_³r_·d
 = 4 * 
io_¿tio
;

141 
nodes_³r_chª
 = 0;

142 ià(
rou‹_ty³
 =ğ
GLOBAL
) {

143 
nodes_³r_chª
 = 1;

145 
nodes_³r_chª
 = 
chª_width_x
[0];

148 
£gm’t_d‘as_t
* 
£g_d‘as_x
 = 
	`®loc_ªd_lßd_£g_d‘as
(
nodes_³r_chª
,

149 
£gm’t_šf
,

150 
d‘_routšg_¬ch
.
num_£gm’t
,

151 
num_grid_cŞumns
);

152 
£gm’t_d‘as_t
* 
£g_d‘as_y
 = 
	`®loc_ªd_lßd_£g_d‘as
(
nodes_³r_chª
,

153 
£gm’t_šf
,

154 
d‘_routšg_¬ch
.
num_£gm’t
,

155 
num_grid_rows
);

156 #ifdeà
DEBUG


157 
	`dump_£g_d‘as
(
£g_d‘as_x
, 
nodes_³r_chª
, "x.echo");

158 
	`dump_£g_d‘as
(
£g_d‘as_y
, 
nodes_³r_chª
, "y.echo");

173 ** 
¼_node_šdiûs
 = 
	`®loc_ªd_lßd_¼_node_šdiûs
(
nodes_³r_şb
,

174 
nodes_³r_·d
,

175 
nodes_³r_chª
,

176 
£g_d‘as_x
,

177 
£g_d‘as_y
);

178 
num_¼_nodes
 = 
¼_node_šdiûs
[
num_grid_cŞumns
 + 1][
num_grid_rows
 + 1];

180 
Fc_ouut
, 
Fc_šput
, 
Fc_·d
;

181 ià(
d‘_routšg_¬ch
.
Fc_ty³
 =ğ
ABSOLUTE
) {

182 
Fc_ouut
 = 
	`mš
(
d‘_routšg_¬ch
.Fc_ouut, 
nodes_³r_chª
);

183 
Fc_šput
 = 
	`mš
(
d‘_routšg_¬ch
.Fc_šput, 
nodes_³r_chª
);

184 
Fc_·d
 = 
	`mš
(
d‘_routšg_¬ch
.Fc_·d, 
nodes_³r_chª
);

188 
Fc_ouut
 = 
	`û
(
nodes_³r_chª
 * 
d‘_routšg_¬ch
.Fc_output - 0.005);

190 
Fc_ouut
 = 
	`max
(1, Fc_output);

191 
Fc_šput
 = 
	`nšt
(
nodes_³r_chª
 * 
d‘_routšg_¬ch
.Fc_input);

192 
Fc_šput
 = 
	`max
(1, Fc_input);

193 
Fc_·d
 = 
	`nšt
(
nodes_³r_chª
 * 
d‘_routšg_¬ch
.Fc_pad);

194 
Fc_·d
 = 
	`max
(1, Fc_pad);

197 
	`®loc_ªd_lßd_sw™ch_block_cÚn
(
nodes_³r_chª
,

198 
d‘_routšg_¬ch
.
sw™ch_block_ty³
);

204 *** 
şb_İš_to_Œacks
 = 
	`®loc_ªd_lßd_şb_pš_to_Œacks
(
DRIVER
,

205 
nodes_³r_chª
,

206 
Fc_ouut
,

207 
FALSE
);

212 
Fc_¿tio
;

213 ià(
Fc_šput
 > 
Fc_ouut
) {

214 
Fc_¿tio
 = ()
Fc_šput
 / ()
Fc_ouut
;

216 
Fc_¿tio
 = ()
Fc_ouut
 / ()
Fc_šput
;

219 
boŞ—n
 
³¹urb_š_sw™ch_·‰”n
;

220 ià(
Fc_šput
 <ğ
nodes_³r_chª
 - 2 && 
	`çbs
(
Fc_¿tio
 - 
	`nšt
(Fc_ratio)) <

221 0.5 / ()
nodes_³r_chª
) {

222 
³¹urb_š_sw™ch_·‰”n
 = 
TRUE
;

224 
³¹urb_š_sw™ch_·‰”n
 = 
FALSE
;

227 *** 
şb_š_to_Œacks
 = 
	`®loc_ªd_lßd_şb_pš_to_Œacks
(
RECEIVER
,

228 
nodes_³r_chª
,

229 
Fc_šput
,

230 
³¹urb_š_sw™ch_·‰”n
);

232 
veùÜ_t
** 
Œacks_to_şb_š
 = 
	`®loc_ªd_lßd_Œacks_to_şb_š
(
nodes_³r_chª
,

233 
Fc_šput
,

234 
şb_š_to_Œacks
);

236 ** 
·ds_to_Œacks
 = 
	`®loc_ªd_lßd_·ds_to_Œacks
(
nodes_³r_chª
, 
Fc_·d
);

238 
veùÜ_t
* 
Œacks_to_·ds
 = 
	`®loc_ªd_lßd_Œacks_to_·ds
(
·ds_to_Œacks
,

239 
nodes_³r_chª
,

240 
Fc_·d
);

242 
¼_edge_dÚe
 = (
boŞ—n
*)
	`my_ÿÎoc
(
num_¼_nodes
, (boolean));

243 
	`®loc_ªd_lßd_¼_g¿ph
(
¼_node_šdiûs
, 
şb_İš_to_Œacks
,

244 
Œacks_to_şb_š
, 
·ds_to_Œacks
,

245 
Œacks_to_·ds
, 
Fc_ouut
,

246 
Fc_šput
, 
Fc_·d
, 
nodes_³r_chª
,

247 
rou‹_ty³
, 
d‘_routšg_¬ch
,

248 
£g_d‘as_x
, 
£g_d‘as_y
);

249 
	`add_¼_g¿ph_C_äom_sw™ches
(
timšg_šf
.
C_š_cblock
);

250 
	`®loc_ªd_lßd_¼_šdexed_d©a
(
£gm’t_šf
, 
d‘_routšg_¬ch
.
num_£gm’t
,

251 
¼_node_šdiûs
, 
nodes_³r_chª
, 
d‘_routšg_¬ch
.
wœe_to_š_sw™ch
,

252 
rou‹r_ba£_co¡_ty³
);

254 
	`check_¼_g¿ph
(
rou‹_ty³
, 
d‘_routšg_¬ch
.
num_sw™ch
);

255 
¼_g¿ph_š‹º®_v¬s
.
şb_İš_to_Œacks
 = clb_opin_to_tracks;

256 
¼_g¿ph_š‹º®_v¬s
.
şb_š_to_Œacks
 = clb_ipin_to_tracks;

257 
¼_g¿ph_š‹º®_v¬s
.
Œacks_to_şb_š
 =racks_to_clb_ipin;

258 
¼_g¿ph_š‹º®_v¬s
.
Œacks_to_·ds
 =racks_to_pads;

259 
¼_g¿ph_š‹º®_v¬s
.
·ds_to_Œacks
 =…ads_to_tracks;

260 
¼_g¿ph_š‹º®_v¬s
.
nodes_³r_chª
 =‚odes_per_chan;

261 
¼_g¿ph_š‹º®_v¬s
.
£g_d‘as_x
 = seg_details_x;

262 
¼_g¿ph_š‹º®_v¬s
.
£g_d‘as_y
 = seg_details_y;

263 
¼_g¿ph_š‹º®_v¬s
.
¼_node_šdiûs
 =„r_node_indices;

264 
	}
}

267 
	$ä“_¼_g¿ph_š‹º®s
(
rou‹r_ty³s_t
 
rou‹_ty³
,

268 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

269 
£gm’t_šfo_t
* 
£gm’t_šf
,

270 
timšg_šfo_t
 
timšg_šf
,

271 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
)

277 
nodes_³r_chª
;

278 ** 
¼_node_šdiûs
;

279 ** 
·ds_to_Œacks
;

280 
veùÜ_t
** 
Œacks_to_şb_š
, *
Œacks_to_·ds
;

281 ** *
şb_İš_to_Œacks
, *** 
şb_š_to_Œacks
;

282 
£gm’t_d‘as_t
* 
£g_d‘as_x
, *
£g_d‘as_y
;

283 
şb_İš_to_Œacks
 = 
¼_g¿ph_š‹º®_v¬s
.clb_opin_to_tracks;

284 
şb_š_to_Œacks
 = 
¼_g¿ph_š‹º®_v¬s
.clb_ipin_to_tracks;

285 
Œacks_to_şb_š
 = 
¼_g¿ph_š‹º®_v¬s
.tracks_to_clb_ipin;

286 
Œacks_to_·ds
 = 
¼_g¿ph_š‹º®_v¬s
.tracks_to_pads;

287 
·ds_to_Œacks
 = 
¼_g¿ph_š‹º®_v¬s
.pads_to_tracks;

288 
nodes_³r_chª
 = 
¼_g¿ph_š‹º®_v¬s
.nodes_per_chan;

289 
£g_d‘as_x
 = 
¼_g¿ph_š‹º®_v¬s
.seg_details_x;

290 
£g_d‘as_y
 = 
¼_g¿ph_š‹º®_v¬s
.seg_details_y;

291 
¼_node_šdiûs
 = 
¼_g¿ph_š‹º®_v¬s
.rr_node_indices;

292 
	`ä“
(
¼_edge_dÚe
);

293 
	`ä“_m©rix3
(
şb_İš_to_Œacks
, 0, 
max_pšs_³r_şb
 - 1, 0, 3, 0, ());

294 
	`ä“_m©rix3
(
şb_š_to_Œacks
, 0, 
max_pšs_³r_şb
 - 1, 0, 3, 0, ());

295 
	`ä“_ivec_m©rix
(
Œacks_to_şb_š
, 0, 
nodes_³r_chª
 - 1, 0, 3);

296 
	`ä“_ivec_veùÜ
(
Œacks_to_·ds
, 0, 
nodes_³r_chª
 - 1);

297 
	`ä“_m©rix
(
·ds_to_Œacks
, 0, 
io_¿tio
 - 1, 0, ());

298 
	`ä“_sw™ch_block_cÚn
(
nodes_³r_chª
);

299 
	`ä“_edge_li¡_h¬d
(&
ä“_edge_li¡_h—d
);

300 
	`ä“_£g_d‘as
(
£g_d‘as_x
, 
nodes_³r_chª
);

301 
	`ä“_£g_d‘as
(
£g_d‘as_y
, 
nodes_³r_chª
);

302 
	`ä“_¼_node_šdiûs
(
¼_node_šdiûs
);

303 
	}
}

306 
	$®loc_ªd_lßd_¼_g¿ph
(** 
¼_node_šdiûs
,

307 *** 
şb_İš_to_Œacks
,

308 
veùÜ_t
** 
Œacks_to_şb_š
,

309 ** 
·ds_to_Œacks
,

310 
veùÜ_t
* 
Œacks_to_·ds
,

311 
Fc_ouut
, 
Fc_šput
, 
Fc_·d
,

312 
nodes_³r_chª
,

313 
rou‹r_ty³s_t
 
rou‹_ty³
,

314 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

315 
£gm’t_d‘as_t
* 
£g_d‘as_x
,

316 
£gm’t_d‘as_t
* 
£g_d‘as_y
)

320 
i
, 
j
;

321 
sw™ch_block_t
 
sw™ch_block_ty³
;

322 
Td–Ëss_sw™ch
, 
wœe_to_š_sw™ch
, 
num_£gm’t
;

327 ià(
¼_mem_chunk_li¡_h—d
 !ğ
NULL
) {

328 
	`´štf
("Error in‡lloc_and_load_rr_graph:„r_mem_chunk_list_head = %p.\n",

329 
¼_mem_chunk_li¡_h—d
);

330 
	`´štf
("Expected NULL. It‡ppears‡n old„r_graph has‚ot been freed.\n");

331 
	`ex™
(1);

334 
	`®loc_Ãt_¼_‹rmš®s
();

335 
	`lßd_Ãt_¼_‹rmš®s
(
¼_node_šdiûs
, 
nodes_³r_chª
);

336 
	`®loc_ªd_lßd_¼_şb_sourû
(
¼_node_šdiûs
, 
nodes_³r_chª
);

337 
¼_node
 = (
¼_node_t
*è
	`my_m®loc
(
num_¼_nodes
 * (rr_node_t));

338 
sw™ch_block_ty³
 = 
d‘_routšg_¬ch
.switch_block_type;

339 
Td–Ëss_sw™ch
 = 
d‘_routšg_¬ch
.Tdelless_switch;

340 
wœe_to_š_sw™ch
 = 
d‘_routšg_¬ch
.wire_to_ipin_switch;

341 
num_£gm’t
 = 
d‘_routšg_¬ch
.num_segment;

343 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; ++i) {

344 
j
 = 0; j <ğ
num_grid_rows
 + 1; ++j) {

345 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

347 
	`bud_¼_şb
(
¼_node_šdiûs
, 
Fc_ouut
, 
şb_İš_to_Œacks
,

348 
nodes_³r_chª
, 
i
, 
j
, 
Td–Ëss_sw™ch
, 
£g_d‘as_x
,

349 
£g_d‘as_y
);

351 
	`bud_¼_xchª
(
¼_node_šdiûs
, 
rou‹_ty³
, 
Œacks_to_şb_š
,

352 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
, 
sw™ch_block_ty³
,

353 
wœe_to_š_sw™ch
, 
£g_d‘as_x
, 
£g_d‘as_y
,

354 
CHANX_COST_INDEX_START
);

356 
	`bud_¼_ychª
(
¼_node_šdiûs
, 
rou‹_ty³
, 
Œacks_to_şb_š
,

357 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
, 
sw™ch_block_ty³
,

358 
wœe_to_š_sw™ch
, 
£g_d‘as_x
, 
£g_d‘as_y
,

359 
CHANX_COST_INDEX_START
 + 
num_£gm’t
);

361 } ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

362 
	`bud_¼_·ds
(
¼_node_šdiûs
, 
Fc_·d
, 
·ds_to_Œacks
,

363 
nodes_³r_chª
, 
i
, 
j
, 
Td–Ëss_sw™ch
, 
£g_d‘as_x
,

364 
£g_d‘as_y
);

366 ià(
j
 == 0)

367 
	`bud_¼_xchª
(
¼_node_šdiûs
, 
rou‹_ty³
, 
Œacks_to_şb_š
,

368 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
, 
sw™ch_block_ty³
,

369 
wœe_to_š_sw™ch
, 
£g_d‘as_x
, 
£g_d‘as_y
,

370 
CHANX_COST_INDEX_START
);

372 ià(
i
 == 0)

373 
	`bud_¼_ychª
(
¼_node_šdiûs
, 
rou‹_ty³
, 
Œacks_to_şb_š
,

374 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
, 
sw™ch_block_ty³
,

375 
wœe_to_š_sw™ch
, 
£g_d‘as_x
, 
£g_d‘as_y
,

376 
CHANX_COST_INDEX_START
 + 
num_£gm’t
);

377 } ià(
bš_grids
[
i
][
j
].
grid_ty³
 !ğ
EMPTY_TYPE
) {

378 
	`´štf
("Error in‡lloc_and_load_rr_graph.\n"

379 "Block‡ˆ(%d, %dèha unknowÀty³ (%d).\n", 
i
, 
j
,

380 
bš_grids
[
i
][
j
].
grid_ty³
);

381 
	`ex™
(1);

385 
	}
}

388 
	$ä“_¼_g¿ph
()

395 ià(
¼_mem_chunk_li¡_h—d
 =ğ
NULL
) {

399 
	`ä“_chunk_memÜy
(
¼_mem_chunk_li¡_h—d
);

400 
¼_mem_chunk_li¡_h—d
 = 
NULL
;

401 
chunk_by‹s_ava
 = 0;

402 
chunk_Ãxt_ava_mem
 = 
NULL
;

406 
	`ä“
(
Ãt_¼_‹rmš®s
);

407 
	`ä“
(
¼_node
);

408 
	`ä“
(
¼_šdexed_d©a
);

409 
	`ä“_m©rix
(
¼_şb_sourû
, 0, 
num_blocks
 - 1, 0, ());

410 
Ãt_¼_‹rmš®s
 = 
NULL
;

411 
¼_node
 = 
NULL
;

412 
¼_šdexed_d©a
 = 
NULL
;

413 
¼_şb_sourû
 = 
NULL
;

414 
	}
}

417 
	$®loc_Ãt_¼_‹rmš®s
()

419 
Ãt_¼_‹rmš®s
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

421 
š‘
;

422 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

423 
Ãt_¼_‹rmš®s
[
š‘
] = (*)
	`my_chunk_m®loc
(
Ãt
[š‘].
num_Ãt_pšs
 *

425 &
¼_mem_chunk_li¡_h—d
,

426 &
chunk_by‹s_ava
,

427 &
chunk_Ãxt_ava_mem
);

429 
	}
}

432 
	$lßd_Ãt_¼_‹rmš®s
(** 
¼_node_šdiûs
,

433 
nodes_³r_chª
)

439 
š‘
, 
š
, 
ivex
, 
iblk
, 
i
, 
j
, 
blk_pš
, 
işass
;

440 
¼_ty³s_t
 
¼_ty³
;

442 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

443 
¼_ty³
 = 
SOURCE
;

444 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

445 
š
 = 0; ipš < 
knum_Ãt_pšs
; ++ipin) {

446 
iblk
 = 
Ãt
[
š‘
].
node_blocks
[
š
];

447 
i
 = 
blocks
[
iblk
].
x
;

448 
j
 = 
blocks
[
iblk
].
y
;

450 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

451 
blk_pš
 = 
Ãt
[
š‘
].
node_block_pšs
[
š
];

452 
işass
 = 
şb_pš_şass
[
blk_pš
];

454 
işass
 = 
	`which_io_block
(
iblk
);

457 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
¼_ty³
, 
işass
, 
nodes_³r_chª
,

458 
¼_node_šdiûs
);

459 
Ãt_¼_‹rmš®s
[
š‘
][
š
] = 
ivex
;

460 
¼_ty³
 = 
SINK
;

463 
	}
}

465 
	$®loc_ªd_lßd_¼_şb_sourû
(** 
¼_node_šdiûs
,

466 
nodes_³r_chª
)

473 
iblk
, 
i
, 
j
, 
işass
, 
ivex
;

474 
¼_ty³s_t
 
¼_ty³
;

475 
¼_şb_sourû
 = (**è
	`®loc_m©rix
(0, 
num_blocks
 - 1, 0, 
num_pš_şass
 - 1,

478 
iblk
 = 0; iblk < 
num_blocks
; iblk++) {

479 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

480 ià(
blocks
[
iblk
].
block_ty³
 =ğ
B_CLB_TYPE
) {

481 
i
 = 
blocks
[
iblk
].
x
;

482 
j
 = 
blocks
[
iblk
].
y
;

484 ià(
şass_šf
[
işass
].
ty³
 =ğ
DRIVER
) {

485 
¼_ty³
 = 
SOURCE
;

487 
¼_ty³
 = 
SINK
;

490 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
¼_ty³
, 
işass
, 
nodes_³r_chª
,

491 
¼_node_šdiûs
);

492 
¼_şb_sourû
[
iblk
][
işass
] = 
ivex
;

494 
¼_şb_sourû
[
iblk
][
işass
] = 
OPEN
;

498 
	}
}

502 
	$which_io_block
(
iblk
)

506 
ad
, 
‹¡_blk
;

507 
ifound
 = -1;

508 
i
 = 
blocks
[
iblk
].
x
;

509 
j
 = 
blocks
[
iblk
].
y
;

511 ià(
blocks
[
iblk
].
block_ty³
 !ğ
INPAD_TYPE


512 && 
blocks
[
iblk
].
block_ty³
 !ğ
OUTPAD_TYPE
) {

513 
	`´štf
("E¼Ü iÀwhich_io_block: block %d i nÙ‡ÀIO_TYPE blocks.\n", 
iblk
);

514 
	`ex™
(1);

517 cÚ¡ 
kio_grid_ÿ·c™y
 = 
bš_grids
[
i
][
j
].
m_ÿ·c™y
;

518 
ad
 = 0; i·d < 
kio_grid_ÿ·c™y
; ++ipad) {

519 
‹¡_blk
 = 
bš_grids
[
i
][
j
].
š_blocks
[
ad
];

520 ià(
‹¡_blk
 =ğ
iblk
) {

521 
ifound
 = 
ad
;

526 ià(
ifound
 < 0) {

527 
	`´štf
("Error in which_io_block: blocks %d‚ot found in clb‡rray.\n",

528 
iblk
);

529 
	`ex™
(1);

532  (
ifound
);

533 
	}
}

536 
	$bud_¼_şb
(** 
¼_node_šdiûs
, 
Fc_ouut
, ** *

537 
şb_İš_to_Œacks
, 
nodes_³r_chª
, 
i
, 
j
, 

538 
Td–Ëss_sw™ch
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

539 *
£g_d‘as_y
)

544 
š
, 
işass
, 
ivex
, 
pš_num
, 
to_node
, 
num_edges
;

545 
t_lšked_edge
* 
edge_li¡_h—d
;

549 
işass
 = 0; işas < 
num_pš_şass
; iclass++) {

550 ià(
şass_šf
[
işass
].
ty³
 =ğ
DRIVER
) {

551 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
SOURCE
, 
işass
, 
nodes_³r_chª
,

552 
¼_node_šdiûs
);

553 
num_edges
 = 
şass_šf
[
işass
].
num_pšs
;

554 
¼_node
[
ivex
].
num_edges
 =‚um_edges;

555 
¼_node
[
ivex
].
edges
 = (*è
	`my_chunk_m®loc
(
num_edges
 *

556 (), &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
,

557 &
chunk_Ãxt_ava_mem
);

558 
¼_node
[
ivex
].
sw™ches
 = (*è
	`my_chunk_m®loc
(
num_edges
 *

559 (), &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
,

560 &
chunk_Ãxt_ava_mem
);

562 
š
 = 0; ipš < 
şass_šf
[
işass
].
num_pšs
; ipin++) {

563 
pš_num
 = 
şass_šf
[
işass
].
pšli¡
[
š
];

564 
to_node
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
OPIN
, 
pš_num
, 
nodes_³r_chª
,

565 
¼_node_šdiûs
);

566 
¼_node
[
ivex
].
edges
[
š
] = 
to_node
;

567 
¼_node
[
ivex
].
sw™ches
[
š
] = 
Td–Ëss_sw™ch
;

570 
¼_node
[
ivex
].
ÿ·c™y
 = 
şass_šf
[
işass
].
num_pšs
;

571 
¼_node
[
ivex
].
co¡_šdex
 = 
SOURCE_COST_INDEX
;

572 
¼_node
[
ivex
].
ty³
 = 
SOURCE
;

574 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
SINK
, 
işass
, 
nodes_³r_chª
,

575 
¼_node_šdiûs
);

581 
¼_node
[
ivex
].
num_edges
 = 0;

582 
¼_node
[
ivex
].
edges
 = 
NULL
;

583 
¼_node
[
ivex
].
sw™ches
 = 
NULL
;

584 
¼_node
[
ivex
].
ÿ·c™y
 = 
şass_šf
[
işass
].
num_pšs
;

585 
¼_node
[
ivex
].
co¡_šdex
 = 
SINK_COST_INDEX
;

586 
¼_node
[
ivex
].
ty³
 = 
SINK
;

590 
¼_node
[
ivex
].
m_u§ge
 = 0;

591 
¼_node
[
ivex
].
xlow
 = 
i
;

592 
¼_node
[
ivex
].
xhigh
 = 
i
;

593 
¼_node
[
ivex
].
ylow
 = 
j
;

594 
¼_node
[
ivex
].
yhigh
 = 
j
;

595 
¼_node
[
ivex
].
R
 = 0;

596 
¼_node
[
ivex
].
C
 = 0;

597 
¼_node
[
ivex
].
±c_num
 = 
işass
;

602 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++) {

603 
işass
 = 
şb_pš_şass
[
š
];

605 ià(
şass_šf
[
işass
].
ty³
 =ğ
DRIVER
) {

606 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
OPIN
, 
š
, 
nodes_³r_chª
,

607 
¼_node_šdiûs
);

608 
edge_li¡_h—d
 = 
NULL
;

609 
num_edges
 = 
	`g‘_şb_İš_cÚÃùiÚs
(
şb_İš_to_Œacks
, 
š
, 
i
, 
j
,

610 
Fc_ouut
, 
£g_d‘as_x
, 
£g_d‘as_y
, &
edge_li¡_h—d
,

611 
nodes_³r_chª
, 
¼_node_šdiûs
);

612 
	`®loc_ªd_lßd_edges_ªd_sw™ches
(
ivex
, 
num_edges
, 
edge_li¡_h—d
);

613 
¼_node
[
ivex
].
co¡_šdex
 = 
OPIN_COST_INDEX
;

614 
¼_node
[
ivex
].
ty³
 = 
OPIN
;

616 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
IPIN
, 
š
, 
nodes_³r_chª
,

617 
¼_node_šdiûs
);

618 
¼_node
[
ivex
].
num_edges
 = 1;

619 
¼_node
[
ivex
].
edges
 = (*è
	`my_chunk_m®loc
((),

620 &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
, &
chunk_Ãxt_ava_mem
);

621 
¼_node
[
ivex
].
sw™ches
 = (*è
	`my_chunk_m®loc
((),

622 &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
, &
chunk_Ãxt_ava_mem
);

623 
to_node
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
SINK
, 
işass
, 
nodes_³r_chª
,

624 
¼_node_šdiûs
);

625 
¼_node
[
ivex
].
edges
[0] = 
to_node
;

626 
¼_node
[
ivex
].
sw™ches
[0] = 
Td–Ëss_sw™ch
;

627 
¼_node
[
ivex
].
co¡_šdex
 = 
IPIN_COST_INDEX
;

628 
¼_node
[
ivex
].
ty³
 = 
IPIN
;

632 
¼_node
[
ivex
].
ÿ·c™y
 = 1;

633 
¼_node
[
ivex
].
m_u§ge
 = 0;

634 
¼_node
[
ivex
].
xlow
 = 
i
;

635 
¼_node
[
ivex
].
xhigh
 = 
i
;

636 
¼_node
[
ivex
].
ylow
 = 
j
;

637 
¼_node
[
ivex
].
yhigh
 = 
j
;

638 
¼_node
[
ivex
].
C
 = 0;

639 
¼_node
[
ivex
].
R
 = 0;

640 
¼_node
[
ivex
].
±c_num
 = 
š
;

642 
	}
}

645 
	$bud_¼_·ds
(** 
¼_node_šdiûs
, 
Fc_·d
, 

646 ** 
·ds_to_Œacks
, 
nodes_³r_chª
, 
i
, 
j
, 

647 
Td–Ëss_sw™ch
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

648 *
£g_d‘as_y
)

654 
s_node
, 
p_node
, 
ad
, 
oİ
;

655 
ivex
, 
num_edges
;

656 
t_lšked_edge
* 
edge_li¡_h—d
;

662 
ad
 = 0; i·d < 
io_¿tio
; ipad++) {

664 
s_node
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
SOURCE
, 
ad
, 
nodes_³r_chª
,

665 
¼_node_šdiûs
);

666 
¼_node
[
s_node
].
num_edges
 = 1;

667 
p_node
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
OPIN
, 
ad
, 
nodes_³r_chª
,

668 
¼_node_šdiûs
);

669 
¼_node
[
s_node
].
edges
 = (*è
	`my_chunk_m®loc
((),

670 &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
, &
chunk_Ãxt_ava_mem
);

671 
¼_node
[
s_node
].
edges
[0] = 
p_node
;

672 
¼_node
[
s_node
].
sw™ches
 = (*è
	`my_chunk_m®loc
((),

673 &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
, &
chunk_Ãxt_ava_mem
);

674 
¼_node
[
s_node
].
sw™ches
[0] = 
Td–Ëss_sw™ch
;

675 
¼_node
[
s_node
].
co¡_šdex
 = 
SOURCE_COST_INDEX
;

676 
¼_node
[
s_node
].
ty³
 = 
SOURCE
;

678 
edge_li¡_h—d
 = 
NULL
;

679 
num_edges
 = 
	`g‘_·d_İš_cÚÃùiÚs
(
·ds_to_Œacks
, 
ad
, 
i
, 
j
,

680 
Fc_·d
, 
£g_d‘as_x
, 
£g_d‘as_y
, &
edge_li¡_h—d
,

681 
nodes_³r_chª
, 
¼_node_šdiûs
);

682 
	`®loc_ªd_lßd_edges_ªd_sw™ches
(
p_node
, 
num_edges
, 
edge_li¡_h—d
);

683 
¼_node
[
p_node
].
co¡_šdex
 = 
OPIN_COST_INDEX
;

684 
¼_node
[
p_node
].
ty³
 = 
OPIN
;

686 
ivex
 = 
s_node
;

688 
oİ
 = 1; iloop <= 2; iloop++) {

689 
¼_node
[
ivex
].
m_u§ge
 = 0;

690 
¼_node
[
ivex
].
ÿ·c™y
 = 1;

691 
¼_node
[
ivex
].
xlow
 = 
i
;

692 
¼_node
[
ivex
].
xhigh
 = 
i
;

693 
¼_node
[
ivex
].
ylow
 = 
j
;

694 
¼_node
[
ivex
].
yhigh
 = 
j
;

695 
¼_node
[
ivex
].
R
 = 0.;

696 
¼_node
[
ivex
].
C
 = 0.;

697 
¼_node
[
ivex
].
±c_num
 = 
ad
;

698 
ivex
 = 
p_node
;

702 
s_node
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
SINK
, 
ad
, 
nodes_³r_chª
,

703 
¼_node_šdiûs
);

704 
¼_node
[
s_node
].
num_edges
 = 0;

705 
¼_node
[
s_node
].
edges
 = 
NULL
;

706 
¼_node
[
s_node
].
sw™ches
 = 
NULL
;

707 
¼_node
[
s_node
].
co¡_šdex
 = 
SINK_COST_INDEX
;

708 
¼_node
[
s_node
].
ty³
 = 
SINK
;

710 
p_node
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
IPIN
, 
ad
, 
nodes_³r_chª
,

711 
¼_node_šdiûs
);

712 
¼_node
[
p_node
].
num_edges
 = 1;

713 
¼_node
[
p_node
].
edges
 = (*è
	`my_chunk_m®loc
((),

714 &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
, &
chunk_Ãxt_ava_mem
);

715 
¼_node
[
p_node
].
edges
[0] = 
s_node
;

716 
¼_node
[
p_node
].
sw™ches
 = (*è
	`my_chunk_m®loc
((),

717 &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
, &
chunk_Ãxt_ava_mem
);

718 
¼_node
[
p_node
].
sw™ches
[0] = 
Td–Ëss_sw™ch
;

719 
¼_node
[
p_node
].
co¡_šdex
 = 
IPIN_COST_INDEX
;

720 
¼_node
[
p_node
].
ty³
 = 
IPIN
;

722 
ivex
 = 
s_node
;

724 
oİ
 = 1; iloop <= 2; iloop++) {

725 
¼_node
[
ivex
].
m_u§ge
 = 0;

726 
¼_node
[
ivex
].
ÿ·c™y
 = 1;

727 
¼_node
[
ivex
].
xlow
 = 
i
;

728 
¼_node
[
ivex
].
xhigh
 = 
i
;

729 
¼_node
[
ivex
].
ylow
 = 
j
;

730 
¼_node
[
ivex
].
yhigh
 = 
j
;

731 
¼_node
[
ivex
].
R
 = 0.;

732 
¼_node
[
ivex
].
C
 = 0.;

733 
¼_node
[
ivex
].
±c_num
 = 
ad
;

734 
ivex
 = 
p_node
;

737 
	}
}

740 
	$bud_¼_xchª
(** 
¼_node_šdiûs
, 
rou‹r_ty³s_t


741 
rou‹_ty³
, 
veùÜ_t
** 
Œacks_to_şb_š
, vector_t *

742 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
,

743 
sw™ch_block_t
 
sw™ch_block_ty³
, 
wœe_to_š_sw™ch
,

744 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
,

745 
co¡_šdex_off£t
)

749 
™¿ck
, 
num_edges
, 
ivex
, 
i¡¬t
, 
›nd
, 
Ëngth
, 
£g_šdex
;

750 
t_lšked_edge
* 
edge_li¡_h—d
;

752 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

753 
i¡¬t
 = 
	`g‘_şo£¡_£g_¡¬t
(
£g_d‘as_x
, 
™¿ck
, 
i
, 
j
);

755 ià(
i¡¬t
 !ğ
i
) {

759 
›nd
 = 
	`g‘_£g_’d
(
£g_d‘as_x
, 
™¿ck
, 
i¡¬t
, 
j
, 
num_grid_cŞumns
);

760 
edge_li¡_h—d
 = 
NULL
;

764 ià(
j
 == 0) {

765 
num_edges
 = 
	`g‘_xŒack_to_şb_š_edges
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
, 
TOP
,

766 &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

767 
¼_node_šdiûs
, 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

768 
num_edges
 +ğ
	`g‘_xŒack_to_·d_edges
(
i¡¬t
, 
›nd
, 
j
, j, 
™¿ck
,

769 &
edge_li¡_h—d
, 
Œacks_to_·ds
, 
nodes_³r_chª
,

770 
¼_node_šdiûs
, 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

772 
num_edges
 +ğ
	`g‘_xŒack_to_yŒacks
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
, j + 1,

773 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

774 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

775 } ià(
j
 =ğ
num_grid_rows
) {

776 
num_edges
 = 
	`g‘_xŒack_to_şb_š_edges
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
,

777 
BOTTOM
, &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

778 
¼_node_šdiûs
, 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

779 
num_edges
 +ğ
	`g‘_xŒack_to_·d_edges
(
i¡¬t
, 
›nd
, 
j
, j + 1, 
™¿ck
,

780 &
edge_li¡_h—d
, 
Œacks_to_·ds
, 
nodes_³r_chª
,

781 
¼_node_šdiûs
, 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

783 
num_edges
 +ğ
	`g‘_xŒack_to_yŒacks
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
, j,

784 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

785 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

787 
num_edges
 = 
	`g‘_xŒack_to_şb_š_edges
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
,

788 
BOTTOM
, &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

789 
¼_node_šdiûs
, 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

790 
num_edges
 +ğ
	`g‘_xŒack_to_şb_š_edges
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
,

791 
TOP
, &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

792 
¼_node_šdiûs
, 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

794 
num_edges
 +ğ
	`g‘_xŒack_to_yŒacks
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
, j + 1,

795 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

796 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

797 
num_edges
 +ğ
	`g‘_xŒack_to_yŒacks
(
i¡¬t
, 
›nd
, 
j
, 
™¿ck
, j,

798 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

799 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

802 ià(
i¡¬t
 != 1) {

803 
num_edges
 +ğ
	`g‘_xŒack_to_xŒack
(
i¡¬t
, 
j
, 
™¿ck
, istart - 1,

804 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

805 
£g_d‘as_x
, 
sw™ch_block_ty³
);

808 ià(
›nd
 !ğ
num_grid_cŞumns
) {

809 
num_edges
 +ğ
	`g‘_xŒack_to_xŒack
(
›nd
, 
j
, 
™¿ck
, iend + 1,

810 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

811 
£g_d‘as_x
, 
sw™ch_block_ty³
);

814 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
CHANX
, 
™¿ck
, 
nodes_³r_chª
,

815 
¼_node_šdiûs
);

816 
	`®loc_ªd_lßd_edges_ªd_sw™ches
(
ivex
, 
num_edges
, 
edge_li¡_h—d
);

818 
£g_šdex
 = 
£g_d‘as_x
[
™¿ck
].
šdex
;

819 
¼_node
[
ivex
].
co¡_šdex
 = 
co¡_šdex_off£t
 + 
£g_šdex
;

820 
¼_node
[
ivex
].
m_u§ge
 = 0;

822 ià(
rou‹_ty³
 =ğ
DETAILED
) {

823 
¼_node
[
ivex
].
ÿ·c™y
 = 1;

825 
¼_node
[
ivex
].
ÿ·c™y
 = 
chª_width_x
[
j
];

828 
¼_node
[
ivex
].
xlow
 = 
i¡¬t
;

829 
¼_node
[
ivex
].
xhigh
 = 
›nd
;

830 
¼_node
[
ivex
].
ylow
 = 
j
;

831 
¼_node
[
ivex
].
yhigh
 = 
j
;

832 
Ëngth
 = 
›nd
 - 
i¡¬t
 + 1;

833 
¼_node
[
ivex
].
R
 = 
Ëngth
 * 
£g_d‘as_x
[
™¿ck
].
Rm‘®
;

834 
¼_node
[
ivex
].
C
 = 
Ëngth
 * 
£g_d‘as_y
[
™¿ck
].
Cm‘®
;

835 
¼_node
[
ivex
].
±c_num
 = 
™¿ck
;

836 
¼_node
[
ivex
].
ty³
 = 
CHANX
;

838 
	}
}

841 
	$bud_¼_ychª
(** 
¼_node_šdiûs
, 
rou‹r_ty³s_t


842 
rou‹_ty³
, 
veùÜ_t
** 
Œacks_to_şb_š
, vector_t *

843 
Œacks_to_·ds
, 
i
, 
j
, 
nodes_³r_chª
,

844 
sw™ch_block_t
 
sw™ch_block_ty³
, 
wœe_to_š_sw™ch
,

845 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
,

846 
co¡_šdex_off£t
)

850 
™¿ck
, 
num_edges
, 
ivex
, 
j¡¬t
, 
j’d
, 
Ëngth
, 
£g_šdex
;

851 
t_lšked_edge
* 
edge_li¡_h—d
;

853 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

854 
j¡¬t
 = 
	`g‘_şo£¡_£g_¡¬t
(
£g_d‘as_y
, 
™¿ck
, 
j
, 
i
);

856 ià(
j¡¬t
 !ğ
j
) {

860 
j’d
 = 
	`g‘_£g_’d
(
£g_d‘as_y
, 
™¿ck
, 
j¡¬t
, 
i
, 
num_grid_rows
);

861 
edge_li¡_h—d
 = 
NULL
;

865 ià(
i
 == 0) {

866 
num_edges
 = 
	`g‘_yŒack_to_şb_š_edges
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
,

867 
RIGHT
, &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

868 
¼_node_šdiûs
, 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

869 
num_edges
 +ğ
	`g‘_yŒack_to_·d_edges
(
j¡¬t
, 
j’d
, 
i
, i, 
™¿ck
,

870 &
edge_li¡_h—d
, 
Œacks_to_·ds
, 
nodes_³r_chª
,

871 
¼_node_šdiûs
, 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

873 
num_edges
 +ğ
	`g‘_yŒack_to_xŒacks
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
, i + 1,

874 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

875 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

876 } ià(
i
 =ğ
num_grid_cŞumns
) {

877 
num_edges
 = 
	`g‘_yŒack_to_şb_š_edges
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
,

878 
LEFT
, &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

879 
¼_node_šdiûs
, 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

880 
num_edges
 +ğ
	`g‘_yŒack_to_·d_edges
(
j¡¬t
, 
j’d
, 
i
, i + 1, 
™¿ck
,

881 &
edge_li¡_h—d
, 
Œacks_to_·ds
, 
nodes_³r_chª
,

882 
¼_node_šdiûs
, 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

884 
num_edges
 +ğ
	`g‘_yŒack_to_xŒacks
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
, i,

885 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

886 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

888 
num_edges
 = 
	`g‘_yŒack_to_şb_š_edges
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
,

889 
LEFT
, &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

890 
¼_node_šdiûs
, 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

891 
num_edges
 +ğ
	`g‘_yŒack_to_şb_š_edges
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
,

892 
RIGHT
, &
edge_li¡_h—d
, 
Œacks_to_şb_š
, 
nodes_³r_chª
,

893 
¼_node_šdiûs
, 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

895 
num_edges
 +ğ
	`g‘_yŒack_to_xŒacks
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
, i + 1,

896 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

897 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

898 
num_edges
 +ğ
	`g‘_yŒack_to_xŒacks
(
j¡¬t
, 
j’d
, 
i
, 
™¿ck
, i,

899 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

900 
£g_d‘as_x
, 
£g_d‘as_y
, 
sw™ch_block_ty³
);

903 ià(
j¡¬t
 != 1) {

904 
num_edges
 +ğ
	`g‘_yŒack_to_yŒack
(
i
, 
j¡¬t
, 
™¿ck
, jstart - 1,

905 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

906 
£g_d‘as_y
, 
sw™ch_block_ty³
);

909 ià(
j’d
 !ğ
num_grid_rows
) {

910 
num_edges
 +ğ
	`g‘_yŒack_to_yŒack
(
i
, 
j’d
, 
™¿ck
, jend + 1,

911 &
edge_li¡_h—d
, 
nodes_³r_chª
, 
¼_node_šdiûs
,

912 
£g_d‘as_y
, 
sw™ch_block_ty³
);

915 
ivex
 = 
	`g”r_node_t_šdex
(
i
, 
j
, 
CHANY
, 
™¿ck
, 
nodes_³r_chª
,

916 
¼_node_šdiûs
);

917 
	`®loc_ªd_lßd_edges_ªd_sw™ches
(
ivex
, 
num_edges
, 
edge_li¡_h—d
);

919 
£g_šdex
 = 
£g_d‘as_y
[
™¿ck
].
šdex
;

920 
¼_node
[
ivex
].
co¡_šdex
 = 
co¡_šdex_off£t
 + 
£g_šdex
;

921 
¼_node
[
ivex
].
m_u§ge
 = 0;

923 ià(
rou‹_ty³
 =ğ
DETAILED
) {

924 
¼_node
[
ivex
].
ÿ·c™y
 = 1;

926 
¼_node
[
ivex
].
ÿ·c™y
 = 
chª_width_y
[
i
];

929 
¼_node
[
ivex
].
xlow
 = 
i
;

930 
¼_node
[
ivex
].
xhigh
 = 
i
;

931 
¼_node
[
ivex
].
ylow
 = 
j¡¬t
;

932 
¼_node
[
ivex
].
yhigh
 = 
j’d
;

933 
Ëngth
 = 
j’d
 - 
j¡¬t
 + 1;

934 
¼_node
[
ivex
].
R
 = 
Ëngth
 * 
£g_d‘as_y
[
™¿ck
].
Rm‘®
;

935 
¼_node
[
ivex
].
C
 = 
Ëngth
 * 
£g_d‘as_y
[
™¿ck
].
Cm‘®
;

936 
¼_node
[
ivex
].
±c_num
 = 
™¿ck
;

937 
¼_node
[
ivex
].
ty³
 = 
CHANY
;

939 
	}
}

942 
	$®loc_ªd_lßd_edges_ªd_sw™ches
(
ivex
, 
num_edges
,

943 
t_lšked_edge
* 
edge_li¡_h—d
)

951 
t_lšked_edge
* 
li¡_±r
, *
Ãxt_±r
;

952 
i
, 
to_node
;

953 
¼_node
[
ivex
].
num_edges
 =‚um_edges;

954 
¼_node
[
ivex
].
edges
 = (*è
	`my_chunk_m®loc
(
num_edges
 * (),

955 &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
, &
chunk_Ãxt_ava_mem
);

956 
¼_node
[
ivex
].
sw™ches
 = (*è
	`my_chunk_m®loc
(
num_edges
 *

957 (), &
¼_mem_chunk_li¡_h—d
, &
chunk_by‹s_ava
,

958 &
chunk_Ãxt_ava_mem
);

961 
li¡_±r
 = 
edge_li¡_h—d
;

962 
i
 = 0;

964 
li¡_±r
 !ğ
NULL
) {

965 
to_node
 = 
li¡_±r
->
edge
;

966 
¼_node
[
ivex
].
edges
[
i
] = 
to_node
;

967 
¼_edge_dÚe
[
to_node
] = 
FALSE
;

968 
¼_node
[
ivex
].
sw™ches
[
i
] = 
li¡_±r
->
isw™ch
;

969 
Ãxt_±r
 = 
li¡_±r
->
Ãxt
;

971 
	`ä“_lšked_edge_soá
(
li¡_±r
, &
ä“_edge_li¡_h—d
);

972 
li¡_±r
 = 
Ãxt_±r
;

973 
i
++;

975 
	}
}

978 *** 
	$®loc_ªd_lßd_şb_pš_to_Œacks
(
pš_ty³s_t
 
pš_ty³
,

979 
nodes_³r_chª
, 
Fc
, 
boŞ—n
 
³¹urb_sw™ch_·‰”n
)

986 * 
num_dœ
;

987 ** 
dœ_li¡
;

989 
i
, 
j
, 
iside
, 
š
, 
işass
, 
num_phys_pšs
, 
pšdex
;

990 * 
num_dÚe_³r_dœ
, *
pš_num_Üd”šg
, *
side_Üd”šg
;

991 ** *
Œacks_cÚÃùed_to_pš
;

992 
¡•_size
;

998 
Œacks_cÚÃùed_to_pš
 = (***è
	`®loc_m©rix3
(0, 
max_pšs_³r_şb
 - 1, 0, 3,

999 0, 
Fc
 - 1, ());

1001 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++)

1002 
iside
 = 0; iside <= 3; iside++) {

1003 
Œacks_cÚÃùed_to_pš
[
š
][
iside
][0] = 
OPEN
;

1006 
num_dœ
 = (*è
	`my_ÿÎoc
(4, ());

1007 
dœ_li¡
 = (**è
	`®loc_m©rix
(0, 3, 0, 
max_pšs_³r_şb
 - 1, ());

1011 
i
 = 0; i < 4; i++)

1012 
j
 = 0; j < 
max_pšs_³r_şb
; j++) {

1013 
dœ_li¡
[
i
][
j
] = -1;

1016 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++) {

1017 
işass
 = 
şb_pš_şass
[
š
];

1019 ià(
şass_šf
[
işass
].
ty³
 !ğ
pš_ty³
) {

1026 ià(
is_glob®_şb_pš
[
š
]) {

1030 
iside
 = 0; iside <= 3; iside++) {

1031 ià(
pšloc
[
iside
][
š
] == 1) {

1032 
dœ_li¡
[
iside
][
num_dœ
[iside]] = 
š
;

1033 
num_dœ
[
iside
]++;

1038 
num_phys_pšs
 = 0;

1040 
iside
 = 0; iside < 4; iside++) {

1041 
num_phys_pšs
 +ğ
num_dœ
[
iside
];

1044 
num_dÚe_³r_dœ
 = (*è
	`my_ÿÎoc
(4, ());

1045 
pš_num_Üd”šg
 = (*è
	`my_m®loc
(
num_phys_pšs
 * ());

1046 
side_Üd”šg
 = (*è
	`my_m®loc
(
num_phys_pšs
 * ());

1054 
iside
 = -1;

1055 
š
 = 0;

1056 
pšdex
 = 0;

1058 
š
 < 
num_phys_pšs
) {

1059 
iside
 = (iside + 1);

1061 ià(
iside
 > 3) {

1062 
pšdex
++;

1063 
iside
 = 0;

1066 ià(
num_dÚe_³r_dœ
[
iside
] >ğ
num_dœ
[iside]) {

1070 
pš_num_Üd”šg
[
š
] = 
dœ_li¡
[
iside
][
pšdex
];

1071 
side_Üd”šg
[
š
] = 
iside
;

1072 
num_dÚe_³r_dœ
[
iside
]++;

1073 
š
++;

1076 
¡•_size
 = (è
nodes_³r_chª
 / ()(
Fc
 * 
num_phys_pšs
);

1078 ià(
¡•_size
 > 1.) {

1079 ià(
pš_ty³
 =ğ
DRIVER
) {

1080 
	`´štf
("Warning: someracks‡re‚ever driven by clb outputs.\n");

1082 
	`´štf
("Warning: someracks cannot„each‡ny inputs.\n");

1086 ià(
³¹urb_sw™ch_·‰”n
) {

1087 
	`lßd_³¹urbed_sw™ch_·‰”n
(
Œacks_cÚÃùed_to_pš
, 
num_phys_pšs
,

1088 
pš_num_Üd”šg
, 
side_Üd”šg
, 
nodes_³r_chª
, 
Fc
, 
¡•_size
);

1089 
	`check_®l_Œacks_»ach_pšs
(
Œacks_cÚÃùed_to_pš
, 
nodes_³r_chª
, 
Fc
,

1090 
RECEIVER
);

1092 
	`lßd_unifÜm_sw™ch_·‰”n
(
Œacks_cÚÃùed_to_pš
, 
num_phys_pšs
,

1093 
pš_num_Üd”šg
, 
side_Üd”šg
, 
nodes_³r_chª
, 
Fc
, 
¡•_size
);

1097 
	`ä“
(
num_dœ
);

1098 
	`ä“_m©rix
(
dœ_li¡
, 0, 3, 0, ());

1099 
	`ä“
(
num_dÚe_³r_dœ
);

1100 
	`ä“
(
pš_num_Üd”šg
);

1101 
	`ä“
(
side_Üd”šg
);

1102  (
Œacks_cÚÃùed_to_pš
);

1103 
	}
}

1106 
	$lßd_unifÜm_sw™ch_·‰”n
(** *
Œacks_cÚÃùed_to_pš
,

1107 
num_phys_pšs
, * 
pš_num_Üd”šg
, * 
side_Üd”šg
,

1108 
nodes_³r_chª
, 
Fc
, 
¡•_size
)

1114 
i
, 
j
, 
š
, 
iside
, 
™¿ck
;

1115 
f_Œack
;

1117 
i
 = 0; i < 
num_phys_pšs
; i++) {

1118 
š
 = 
pš_num_Üd”šg
[
i
];

1119 
iside
 = 
side_Üd”šg
[
i
];

1121 
j
 = 0; j < 
Fc
; j++) {

1122 
f_Œack
 = 
i
 * 
¡•_size
 + 
j
 * (è
nodes_³r_chª
 / (è
Fc
;

1123 
™¿ck
 = (è
f_Œack
;

1125 
™¿ck
 = 
	`mš
(™¿ck, 
nodes_³r_chª
 - 1);

1126 
Œacks_cÚÃùed_to_pš
[
š
][
iside
][
j
] = 
™¿ck
;

1129 
	}
}

1132 
	$lßd_³¹urbed_sw™ch_·‰”n
(** *
Œacks_cÚÃùed_to_pš
,

1133 
num_phys_pšs
, * 
pš_num_Üd”šg
, * 
side_Üd”šg
,

1134 
nodes_³r_chª
, 
Fc
, 
¡•_size
)

1146 
i
, 
j
, 
š
, 
iside
, 
™¿ck
, 
ih®f
, 
icÚn
;

1147 
Fc_d’£
, 
Fc_¥¬£
, 
Fc_h®f
[2];

1148 
f_Œack
, 
¥acšg_d’£
, 
¥acšg_¥¬£
, 
¥acšg
[2];

1149 
Fc_d’£
 = 
Fc
 / 2 + 1;

1150 
Fc_¥¬£
 = 
Fc
 - 
Fc_d’£
;

1151 
¥acšg_d’£
 = ()
nodes_³r_chª
 / ()(2 * 
Fc_d’£
);

1152 
¥acšg_¥¬£
 = ()
nodes_³r_chª
 / ()(2 * 
Fc_¥¬£
);

1154 
i
 = 0; i < 
num_phys_pšs
; i++) {

1155 
š
 = 
pš_num_Üd”šg
[
i
];

1156 
iside
 = 
side_Üd”šg
[
i
];

1158 
¥acšg
[
i
 % 2] = 
¥acšg_d’£
;

1159 
Fc_h®f
[
i
 % 2] = 
Fc_d’£
;

1160 
¥acšg
[(
i
 + 1è% 2] = 
¥acšg_¥¬£
;

1161 
Fc_h®f
[(
i
 + 1è% 2] = 
Fc_¥¬£
;

1162 
f_Œack
 = 
i
 * 
¡•_size
;

1163 
icÚn
 = 0;

1165 
ih®f
 = 0; ihalf < 2; ihalf++) {

1166 
j
 = 0; j < 
Fc_h®f
[
ih®f
]; j++) {

1167 
™¿ck
 = (è
f_Œack
;

1169 
™¿ck
 = iŒack % 
nodes_³r_chª
;

1170 
Œacks_cÚÃùed_to_pš
[
š
][
iside
][
icÚn
] = 
™¿ck
;

1171 
f_Œack
 +ğ
¥acšg
[
ih®f
];

1172 
icÚn
++;

1176 
	}
}

1179 
	$check_®l_Œacks_»ach_pšs
(** *
Œacks_cÚÃùed_to_pš
,

1180 
nodes_³r_chª
, 
Fc
, 
pš_ty³s_t
 
š_Ü_İš
)

1183 
icÚn
, 
iside
, 
™¿ck
, 
š
;

1184 * 
num_cÚns_to_Œack
;

1185 
num_cÚns_to_Œack
 = (*è
	`my_ÿÎoc
(
nodes_³r_chª
, ());

1187 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++) {

1188 
iside
 = 0; iside <= 3; iside++) {

1189 ià(
Œacks_cÚÃùed_to_pš
[
š
][
iside
][0] !ğ
OPEN
) {

1190 
icÚn
 = 0; icÚÀ< 
Fc
; iconn++) {

1191 
™¿ck
 = 
Œacks_cÚÃùed_to_pš
[
š
][
iside
][
icÚn
];

1192 
num_cÚns_to_Œack
[
™¿ck
]++;

1198 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

1199 ià(
num_cÚns_to_Œack
[
™¿ck
] <= 0) {

1200 
	`´štf
("Warning (check_all_tracks_reach_pins):rack %d does‚ot \n"

1201 "\tcÚÃùØªy CLB_TYPE ", 
™¿ck
);

1203 ià(
š_Ü_İš
 =ğ
DRIVER
) {

1204 
	`´štf
("OPINs.\n");

1206 
	`´štf
("IPINs.\n");

1211 
	`ä“
(
num_cÚns_to_Œack
);

1212 
	}
}

1215 
veùÜ_t
** 
	$®loc_ªd_lßd_Œacks_to_şb_š
(
nodes_³r_chª
,

1216 
Fc
,

1217 *** 
şb_š_to_Œacks
)

1223 
š
, 
iside
, 
™¿ck
, 
icÚn
, 
ioff
, 
Œ_side
;

1238 
veùÜ_t
** 
Œacks_to_şb_š
;

1240 
Œacks_to_şb_š
 = (
veùÜ_t
**è
	`®loc_m©rix
(0, 
nodes_³r_chª
 - 1, 0,

1241 3, (
veùÜ_t
));

1243 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++)

1244 
iside
 = 0; iside <= 3; iside++) {

1245 
Œacks_to_şb_š
[
™¿ck
][
iside
].
ÃËm
 = 0;

1250 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++) {

1251 
iside
 = 0; iside <= 3; iside++) {

1252 ià(
şb_š_to_Œacks
[
š
][
iside
][0] =ğ
OPEN
) {

1256 
Œ_side
 = 
	`Œack_side
(
iside
);

1258 
icÚn
 = 0; icÚÀ< 
Fc
; iconn++) {

1259 
™¿ck
 = 
şb_š_to_Œacks
[
š
][
iside
][
icÚn
];

1260 
Œacks_to_şb_š
[
™¿ck
][
Œ_side
].
ÃËm
++;

1267 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

1268 
iside
 = 0; iside <= 3; iside++) {

1269 ià(
Œacks_to_şb_š
[
™¿ck
][
iside
].
ÃËm
 != 0) {

1270 
Œacks_to_şb_š
[
™¿ck
][
iside
].
li¡
 = (*è
	`my_m®loc
(

1271 
Œacks_to_şb_š
[
™¿ck
][
iside
].
ÃËm
 * ());

1272 
Œacks_to_şb_š
[
™¿ck
][
iside
].
ÃËm
 = 0;

1274 
Œacks_to_şb_š
[
™¿ck
][
iside
].
li¡
 = 
NULL
;

1281 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++) {

1282 
iside
 = 0; iside <= 3; iside++) {

1283 ià(
şb_š_to_Œacks
[
š
][
iside
][0] =ğ
OPEN
) {

1287 
Œ_side
 = 
	`Œack_side
(
iside
);

1289 
icÚn
 = 0; icÚÀ< 
Fc
; iconn++) {

1290 
™¿ck
 = 
şb_š_to_Œacks
[
š
][
iside
][
icÚn
];

1291 
ioff
 = 
Œacks_to_şb_š
[
™¿ck
][
Œ_side
].
ÃËm
;

1292 
Œacks_to_şb_š
[
™¿ck
][
Œ_side
].
li¡
[
ioff
] = 
š
;

1293 
Œacks_to_şb_š
[
™¿ck
][
Œ_side
].
ÃËm
++;

1298  (
Œacks_to_şb_š
);

1299 
	}
}

1302 
	$Œack_side
(
şb_side
)

1307 
şb_side
) {

1308 
TOP
:

1309  (
BOTTOM
);

1311 
BOTTOM
:

1312  (
TOP
);

1314 
LEFT
:

1315  (
RIGHT
);

1317 
RIGHT
:

1318  (
LEFT
);

1321 
	`´štf
("E¼Ü: uÃx³ùed clb_sid(%dèš¿ck_side.\n", 
şb_side
);

1322 
	`ex™
(1);

1324 
	}
}

1327 ** 
	$®loc_ªd_lßd_·ds_to_Œacks
(
nodes_³r_chª
, 
Fc_·d
)

1332 ** 
·ds_to_Œacks
;

1333 
¡•_size
;

1334 
ad
, 
icÚn
, 
™¿ck
;

1335 
·ds_to_Œacks
 = (**è
	`®loc_m©rix
(0, 
io_¿tio
 - 1, 0, 
Fc_·d
 - 1, ());

1336 
¡•_size
 = (è
nodes_³r_chª
 / ()(
Fc_·d
 * 
io_¿tio
);

1338 
ad
 = 0; i·d < 
io_¿tio
; ipad++) {

1339 
icÚn
 = 0; icÚÀ< 
Fc_·d
; iconn++) {

1340 
™¿ck
 = ()(
ad
 * 
¡•_size
 + 
icÚn
 * (è
nodes_³r_chª
 /

1341 (è
Fc_·d
);

1343 
™¿ck
 = 
	`mš
(™¿ck, 
nodes_³r_chª
 - 1);

1344 
·ds_to_Œacks
[
ad
][
icÚn
] = 
™¿ck
;

1348  (
·ds_to_Œacks
);

1349 
	}
}

1352 
veùÜ_t
* 
	$®loc_ªd_lßd_Œacks_to_·ds
(** 
·ds_to_Œacks
,

1353 
nodes_³r_chª
, 
Fc_·d
) {

1360 
™¿ck
, 
ad
, 
i
, 
icÚn
, 
ioff
;

1361 
veùÜ_t
* 
Œacks_to_·ds
;

1363 
Œacks_to_·ds
 = (
veùÜ_t
*è
	`my_m®loc
(
nodes_³r_chª
* (

1364 
veùÜ_t
));

1368 
i
 = 0; i < 
nodes_³r_chª
; i++) {

1369 
Œacks_to_·ds
[
i
].
ÃËm
 = 0;

1372 
ad
 = 0; i·d < 
io_¿tio
; ipad++) {

1373 
icÚn
 = 0; icÚÀ< 
Fc_·d
; iconn++) {

1374 
™¿ck
 = 
·ds_to_Œacks
[
ad
][
icÚn
];

1375 
Œacks_to_·ds
[
™¿ck
].
ÃËm
++;

1379 
i
 = 0; i < 
nodes_³r_chª
; i++) {

1380 ià(
Œacks_to_·ds
[
i
].
ÃËm
 != 0) {

1381 
Œacks_to_·ds
[
i
].
li¡
 = (*è
	`my_m®loc
Ñ¿cks_to_·ds[i].
ÃËm
 *

1383 
Œacks_to_·ds
[
i
].
ÃËm
 = 0;

1385 
Œacks_to_·ds
[
i
].
li¡
 = 
NULL
;

1391 
ad
 = 0; i·d < 
io_¿tio
; ipad++) {

1392 
icÚn
 = 0; icÚÀ< 
Fc_·d
; iconn++) {

1393 
™¿ck
 = 
·ds_to_Œacks
[
ad
][
icÚn
];

1394 
ioff
 = 
Œacks_to_·ds
[
™¿ck
].
ÃËm
;

1395 
Œacks_to_·ds
[
™¿ck
].
li¡
[
ioff
] = 
ad
;

1396 
Œacks_to_·ds
[
™¿ck
].
ÃËm
++;

1400  (
Œacks_to_·ds
);

1401 
	}
}

1404 
	$dump_¼_g¿ph
(* 
fe_Çme
)

1409 
FILE
* 
å
 = 
	`my_fİ’
(
fe_Çme
, "w");

1411 
ivex
, 
šdex
;

1412 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

1413 
	`´š¼_node_t
(
å
, 
ivex
);

1414 
	`årštf
(
å
, "\n");

1417 
	`årštf
(
å
, "\n\n%d„r_šdexed_d©¨’Œ›s.\n\n", 
num_¼_šdexed_d©a
);

1419 
šdex
 = 0; index < 
num_¼_šdexed_d©a
; index++) {

1420 
	`´š¼_šdexed_d©a_t
(
å
, 
šdex
);

1421 
	`årštf
(
å
, "\n");

1424 
	`fşo£
(
å
);

1425 
	}
}

1428 
	$´š¼_node_t
(
FILE
* 
å
, 
ivex
)

1431 * 
Çme_ty³
[] = {"SOURCE", "SINK", "IPIN", "OPIN", "CHANX",

1434 
¼_ty³s_t
 
¼_ty³
;

1435 
icÚn
;

1436 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

1438 ià(
¼_node
[
ivex
].
xlow
 =ğ¼_node[ivex].
xhigh
 &&„r_node[ivex].
ylow
 ==

1439 
¼_node
[
ivex
].
yhigh
) {

1440 
	`årštf
(
å
, "Node: %d. % (%d, %dè Ptc_num: %d\n", 
ivex
,

1441 
Çme_ty³
[
¼_ty³
], 
¼_node
[
ivex
].
xlow
,„r_node[ivex].
ylow
,

1442 
¼_node
[
ivex
].
±c_num
);

1444 
	`årštf
(
å
, "Node: %d. % (%d, %dètØ(%d, %dè Ptc_num: %d\n", 
ivex
,

1445 
Çme_ty³
[
¼_ty³
], 
¼_node
[
ivex
].
xlow
,„r_node[ivex].
ylow
,

1446 
¼_node
[
ivex
].
xhigh
,„r_node[ivex].
yhigh
,

1447 
¼_node
[
ivex
].
±c_num
);

1450 
	`årštf
(
å
, "%4dƒdge(s):", 
¼_node
[
ivex
].
num_edges
);

1452 
icÚn
 = 0; icÚÀ< 
¼_node
[
ivex
].
num_edges
; iconn++) {

1453 
	`årštf
(
å
, " %d", 
¼_node
[
ivex
].
edges
[
icÚn
]);

1456 
	`årštf
(
å
, "\nSwitchypes:");

1458 
icÚn
 = 0; icÚÀ< 
¼_node
[
ivex
].
num_edges
; iconn++) {

1459 
	`årštf
(
å
, " %d", 
¼_node
[
ivex
].
sw™ches
[
icÚn
]);

1462 
	`årštf
(
å
, "\n");

1463 
	`årštf
(
å
, "Occ: %d C­ac™y: %d.\n", 
¼_node
[
ivex
].
m_u§ge
,

1464 
¼_node
[
ivex
].
ÿ·c™y
);

1465 
	`årštf
(
å
, "R: %g C: %g\n", 
¼_node
[
ivex
].
R
,„r_node[ivex].
C
);

1466 
	`årštf
(
å
, "Co¡_šdex: %d\n", 
¼_node
[
ivex
].
co¡_šdex
);

1467 
	}
}

1470 
	$´š¼_šdexed_d©a_t
(
FILE
* 
å
, 
šdex
)

1473 
	`årštf
(
å
, "Index: %d\n", 
šdex
);

1474 
	`årštf
(
å
, "ortho_cost_index: %d base_cost: %g saved_base_cost: %g\n",

1475 
¼_šdexed_d©a
[
šdex
].
Ütho_co¡_šdex
,

1476 
¼_šdexed_d©a
[
šdex
].
ba£_co¡
,

1477 
¼_šdexed_d©a
[
šdex
].
§ved_ba£_co¡
);

1478 
	`årštf
(
å
, "Seg_index: %d inv_length: %g\n",

1479 
¼_šdexed_d©a
[
šdex
].
£g_šdex
,„r_šdexed_d©a[šdex].
šv_Ëngth
);

1480 
	`årštf
(
å
, "T_linear: %g T_quadratic: %g C_load: %g\n",

1481 
¼_šdexed_d©a
[
šdex
].
T_lš—r
,„r_šdexed_d©a[šdex].
T_quad¿tic
,

1482 
¼_šdexed_d©a
[
šdex
].
C_lßd
);

1483 
	}
}

	@rr_graph.h

1 #iâdeà
RR_GRAPH_H


2 
	#RR_GRAPH_H


	)

4 
	~"v´_ty³s.h
"

6 
bud_¼_g¿ph
(
rou‹r_ty³s_t
 
rou‹_ty³
,

7 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

8 
£gm’t_šfo_t
* 
£gm’t_šf
,

9 
timšg_šfo_t
 
timšg_šf
,

10 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
);

12 
ä“_¼_g¿ph_š‹º®s
(
rou‹r_ty³s_t
 
rou‹_ty³
,

13 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

14 
£gm’t_šfo_t
* 
£gm’t_šf
,

15 
timšg_šfo_t
 
timšg_šf
,

16 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
);

18 
ä“_¼_g¿ph
();

20 
dump_¼_g¿ph
(* 
fe_Çme
);

22 
´š¼_node_t
(
FILE
* 
å
, 
ivex
);

24 
´š¼_šdexed_d©a_t
(
FILE
* 
å
, 
šdex
);

26 
lßd_Ãt_¼_‹rmš®s
(** 
¼_node_šdiûs
,

27 
nodes_³r_chª
);

29 ** 
g”r_node_t_šdiûs
();

31 
g‘_nodes_³r_chª
();

	@rr_graph2.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"¼_g¿ph2.h
"

6 
	~"¼_g¿ph_sbox.h
"

7 
	~<as£¹.h
>

17 
boŞ—n
* 
	g¼_edge_dÚe
;

22 
t_lšked_edge
* 
	gä“_edge_li¡_h—d
 = 
NULL
;

31 *** 
	gchªx_¼_šdiûs
;

32 *** 
	gchªy_¼_šdiûs
;

38 
lßd_chªx_¼_šdiûs
(
£gm’t_d‘as_t
* 
£g_d‘as_x
, 

39 
nodes_³r_chª
, 
¡¬t_šdex
, 
i
, 
j
);

41 
lßd_chªy_¼_šdiûs
(
£gm’t_d‘as_t
* 
£g_d‘as_y
, 

42 
nodes_³r_chª
, 
¡¬t_šdex
, 
i
, 
j
);

44 
g‘_sw™ch_ty³
(
boŞ—n
 
is_äom_sbox
, boŞ—À
is_to_sbox
,

45 
äom_node_sw™ch
, 
to_node_sw™ch
, 
sw™ch_ty³s
[2]);

49 
£gm’t_d‘as_t
* 
	$®loc_ªd_lßd_£g_d‘as
(
nodes_³r_chª
,

50 
£gm’t_šfo_t
 *
£gm’t_šf
,

51 
num_£g_ty³s
,

52 
max_Ën
)

62 
Œacks_Ëá
, 
i
, 
Ãxt_Œack
, 
Á¿cks
, 
™¿ck
, 
Ëngth
, 
j
, 
šdex
;

63 
wœe_sw™ch
, 
İš_sw™ch
, 
num_cb
, 
num_sb
;

64 
äac_Ëá
, 
¡¬t_¡•
, 
sb_¡•
, 
cb_¡•
;

65 
cb_off_¡•
, 
sb_off_¡•
;

66 
boŞ—n
 
lÚglše
;

67 
£gm’t_d‘as_t
* 
£g_d‘as
 = (£gm’t_d‘as_t*)
	`my_m®loc
(
nodes_³r_chª
 * 

68 (
£gm’t_d‘as_t
));

69 
Œacks_Ëá
 = 
nodes_³r_chª
;

70 
Ãxt_Œack
 = 0;

71 
äac_Ëá
 = 1.;

73 
i
 = 0; i < 
num_£g_ty³s
; i++) {

74 ià(
äac_Ëá
 <= 0.) {

75 
Á¿cks
 = 0;

77 
Á¿cks
 = 
	`nšt
(
£gm’t_šf
[
i
].
äequ’cy
 / 
äac_Ëá
 * 
Œacks_Ëá
);

80 
äac_Ëá
 -ğ
£gm’t_šf
[
i
].
äequ’cy
;

81 
Œacks_Ëá
 -ğ
Á¿cks
;

83 ià(
Á¿cks
 == 0) {

87 
lÚglše
 = 
£gm’t_šf
[
i
].longline;

89 ià(!
lÚglše
) {

90 
Ëngth
 = 
	`mš
(
£gm’t_šf
[
i
].Ëngth, 
max_Ën
);

91 
¡¬t_¡•
 = (è
Ëngth
 / (è
Á¿cks
;

93 
Ëngth
 = 
max_Ën
;

94 
¡¬t_¡•
 = 0.;

97 
num_cb
 = 
	`nšt
(
Ëngth
 * 
£gm’t_šf
[
i
].
äac_cb
);

98 
num_sb
 = 
	`nšt
((
Ëngth
 + 1.è* 
£gm’t_šf
[
i
].
äac_sb
);

102 ià(!
lÚglše
) {

103 ià(
num_cb
 > 1) {

104 
cb_¡•
 = ()(
Ëngth
 - 1è/ ()(
num_cb
 - 1);

106 
cb_¡•
 = 0.;

114 ià(
num_cb
 > 0) {

115 
cb_¡•
 = (è
Ëngth
 / (è
num_cb
;

117 
cb_¡•
 = 0.;

123 ià(!
lÚglše
) {

124 ià(
num_sb
 > 1) {

125 
sb_¡•
 = (è
Ëngth
 / ()(
num_sb
 - 1);

127 
sb_¡•
 = 0.;

130 ià(
num_sb
 > 0) {

131 
sb_¡•
 = ()(
Ëngth
 + 1è/ (è
num_sb
;

133 
sb_¡•
 = 0;

137 ià(!
lÚglše
) {

138 
cb_off_¡•
 = 0.;

139 
sb_off_¡•
 = 0.;

141 
cb_off_¡•
 = 
cb_¡•
 / (è
Á¿cks
;

142 
sb_off_¡•
 = 
sb_¡•
 / (è
Á¿cks
;

145 
wœe_sw™ch
 = 
£gm’t_šf
[
i
].wire_switch;

146 
İš_sw™ch
 = 
£gm’t_šf
[
i
].opin_switch;

148 
™¿ck
 = 0; iŒack < 
Á¿cks
; itrack++) {

149 
£g_d‘as
[
Ãxt_Œack
].
Ëngth
 =†ength;

150 
£g_d‘as
[
Ãxt_Œack
].
lÚglše
 =†ongline;

151 
£g_d‘as
[
Ãxt_Œack
].
¡¬t
 = 
	`nšt
(
™¿ck
 * 
¡¬t_¡•
è% 
Ëngth
 + 1;

152 
£g_d‘as
[
Ãxt_Œack
].
cb
 = (
boŞ—n
*è
	`my_ÿÎoc
(
Ëngth
,

153 (
boŞ—n
));

154 
£g_d‘as
[
Ãxt_Œack
].
sb
 = (
boŞ—n
*è
	`my_ÿÎoc
((
Ëngth
 + 1),

155 (
boŞ—n
));

157 
j
 = 0; j < 
num_cb
; j++) {

158 
šdex
 = 
	`nšt
(
j
 * 
cb_¡•
 + 
™¿ck
 * 
cb_off_¡•
è% 
Ëngth
;

159 
£g_d‘as
[
Ãxt_Œack
].
cb
[
šdex
] = 
TRUE
;

162 
j
 = 0; j < 
num_sb
; j++) {

163 
šdex
 = 
	`nšt
(
j
 * 
sb_¡•
 + 
™¿ck
 * 
sb_off_¡•
è% (
Ëngth
 + 1);

164 
£g_d‘as
[
Ãxt_Œack
].
sb
[
šdex
] = 
TRUE
;

167 
£g_d‘as
[
Ãxt_Œack
].
Rm‘®
 = 
£gm’t_šf
[
i
].Rmetal;

168 
£g_d‘as
[
Ãxt_Œack
].
Cm‘®
 = 
£gm’t_šf
[
i
].Cmetal;

169 
£g_d‘as
[
Ãxt_Œack
].
wœe_sw™ch
 = wire_switch;

170 
£g_d‘as
[
Ãxt_Œack
].
İš_sw™ch
 = opin_switch;

171 
£g_d‘as
[
Ãxt_Œack
].
šdex
 = 
i
;

172 
Ãxt_Œack
++;

176 
	`as£¹
(
Œacks_Ëá
 == 0);

177 
	`as£¹
(
Ãxt_Œack
 =ğ
nodes_³r_chª
);

178  (
£g_d‘as
);

179 
	}
}

182 
	$ä“_£g_d‘as
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
nodes_³r_chª
)

185 
i
;

187 
i
 = 0; i < 
nodes_³r_chª
; i++) {

188 
	`ä“
(
£g_d‘as
[
i
].
cb
);

189 
	`ä“
(
£g_d‘as
[
i
].
sb
);

192 
	`ä“
(
£g_d‘as
);

193 
	}
}

196 
	$dump_£g_d‘as
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
nodes_³r_chª
, 

197 *
âame
)

201 
FILE
* 
å
 = 
	`my_fİ’
(
âame
, "w");

203 
i
, 
j
;

204 
i
 = 0; i < 
nodes_³r_chª
; i++) {

205 
	`årštf
(
å
, "T¿ck: %d.\n", 
i
);

206 
	`årštf
(
å
, "Length: %d, Start: %d, Long†ine: %d wire_switch: %d "

207 "İš_sw™ch: %d.\n", 
£g_d‘as
[
i
].
Ëngth
, seg_d‘as[i].
¡¬t
,

208 
£g_d‘as
[
i
].
lÚglše
, seg_d‘as[i].
wœe_sw™ch
,

209 
£g_d‘as
[
i
].
İš_sw™ch
);

210 
	`årštf
(
å
, "Rm‘®: %g Cm‘®: %g\n", 
£g_d‘as
[
i
].
Rm‘®
,

211 
£g_d‘as
[
i
].
Cm‘®
);

212 
	`årštf
(
å
, "cb†ist: ");

214 
j
 = 0; j < 
£g_d‘as
[
i
].
Ëngth
; j++) {

215 
	`årštf
(
å
, "%d ", 
£g_d‘as
[
i
].
cb
[
j
]);

218 
	`årštf
(
å
, "\nsb†ist: ");

220 
j
 = 0; j <ğ
£g_d‘as
[
i
].
Ëngth
; j++) {

221 
	`årštf
(
å
, "%d ", 
£g_d‘as
[
i
].
sb
[
j
]);

224 
	`årštf
(
å
, "\n\n");

227 
	`fşo£
(
å
);

228 
	}
}

231 
	$g‘_şo£¡_£g_¡¬t
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
™¿ck
, 
£g_num
,

232 
chª_num
)

236 
şo£¡_¡¬t
, 
Ëngth
, 
¡¬t
;

238 ià(
£g_d‘as
[
™¿ck
].
lÚglše
) {

239 
şo£¡_¡¬t
 = 1;

241 
Ëngth
 = 
£g_d‘as
[
™¿ck
].length;

242 
¡¬t
 = 
£g_d‘as
[
™¿ck
].start;

245 
şo£¡_¡¬t
 = 
£g_num
 - (£g_num + 
chª_num
 - 
¡¬t
 + 
Ëngth
) %†ength;

246 
şo£¡_¡¬t
 = 
	`max
(closest_start, 1);

249  (
şo£¡_¡¬t
);

250 
	}
}

253 
	$g‘_şb_İš_cÚÃùiÚs
(** *
şb_İš_to_Œacks
, 
š
, 
i
, 

254 
j
, 
Fc_ouut
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

255 *
£g_d‘as_y
, 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
, 

256 ** 
¼_node_šdiûs
)

261 
iside
, 
num_cÚn
, 
icÚn
, 
™¿ck
, 
Œ_j
, 
Œ_i
, 
to_node
;

262 
¼_ty³s_t
 
to_¼_ty³
;

263 
boŞ—n
 
cbox_exi¡s
;

264 
t_lšked_edge
* 
edge_li¡_h—d
;

265 
£gm’t_d‘as_t
* 
£g_d‘as
;

266 
edge_li¡_h—d
 = *
edge_li¡_±r
;

267 
num_cÚn
 = 0;

269 
iside
 = 0; iside <= 3; iside++) {

270 ià(
şb_İš_to_Œacks
[
š
][
iside
][0] !ğ
OPEN
) {

274 ià(
iside
 =ğ
BOTTOM
) {

275 
Œ_j
 = 
j
 - 1;

277 
Œ_j
 = 
j
;

280 ià(
iside
 =ğ
LEFT
) {

281 
Œ_i
 = 
i
 - 1;

283 
Œ_i
 = 
i
;

286 ià(
iside
 =ğ
LEFT
 || isid=ğ
RIGHT
) {

287 
to_¼_ty³
 = 
CHANY
;

288 
£g_d‘as
 = 
£g_d‘as_y
;

290 
to_¼_ty³
 = 
CHANX
;

291 
£g_d‘as
 = 
£g_d‘as_x
;

294 
icÚn
 = 0; icÚÀ< 
Fc_ouut
; iconn++) {

295 
™¿ck
 = 
şb_İš_to_Œacks
[
š
][
iside
][
icÚn
];

297 ià(
to_¼_ty³
 =ğ
CHANX
) {

298 
cbox_exi¡s
 = 
	`is_cbox
(
Œ_i
, 
Œ_j
, 
™¿ck
, 
£g_d‘as
);

300 
cbox_exi¡s
 = 
	`is_cbox
(
Œ_j
, 
Œ_i
, 
™¿ck
, 
£g_d‘as
);

303 ià(
cbox_exi¡s
) {

304 
to_node
 = 
	`g”r_node_t_šdex
(
Œ_i
, 
Œ_j
, 
to_¼_ty³
, 
™¿ck
,

305 
nodes_³r_chª
, 
¼_node_šdiûs
);

306 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

307 
£g_d‘as
[
™¿ck
].
İš_sw™ch
, &
ä“_edge_li¡_h—d
);

308 
num_cÚn
++;

314 ià(
num_cÚn
 == 0) {

315 
	`´štf
("Error: clb output…in %d‡t (%d,%d) does‚ot connecto‡ny "

316 "Œacks.\n", 
š
, 
i
, 
j
);

317 
	`ex™
(1);

320 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

321  (
num_cÚn
);

322 
	}
}

325 
	$g‘_·d_İš_cÚÃùiÚs
(** 
·ds_to_Œacks
, 
ad
, 
i
, 
j
,

326 
Fc_·d
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
,

327 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
, 

328 ** 
¼_node_šdiûs
)

332 
chª_i
, 
chª_j
, 
icÚn
, 
™¿ck
, 
num_cÚn
, 
to_node
;

333 
¼_ty³s_t
 
chª_ty³
;

334 
boŞ—n
 
cbox_exi¡s
;

335 
t_lšked_edge
* 
edge_li¡_h—d
;

336 
£gm’t_d‘as_t
* 
£g_d‘as
;

340 ià(
j
 == 0) {

341 
chª_i
 = 
i
;

342 
chª_j
 = 
j
;

343 
chª_ty³
 = 
CHANX
;

344 
£g_d‘as
 = 
£g_d‘as_x
;

345 } ià(
j
 =ğ
num_grid_rows
 + 1) {

346 
chª_i
 = 
i
;

347 
chª_j
 = 
j
 - 1;

348 
chª_ty³
 = 
CHANX
;

349 
£g_d‘as
 = 
£g_d‘as_x
;

350 } ià(
i
 == 0) {

351 
chª_i
 = 
i
;

352 
chª_j
 = 
j
;

353 
chª_ty³
 = 
CHANY
;

354 
£g_d‘as
 = 
£g_d‘as_y
;

355 } ià(
i
 =ğ
num_grid_cŞumns
 + 1) {

356 
chª_i
 = 
i
 - 1;

357 
chª_j
 = 
j
;

358 
chª_ty³
 = 
CHANY
;

359 
£g_d‘as
 = 
£g_d‘as_y
;

361 
	`´štf
("Error in get_pad_opin_connections:„equested IO_TYPE blocks‡t "

362 "(%d,%dèdÛ nÙƒxi¡.\n", 
i
, 
j
);

363 
	`ex™
(1);

366 
edge_li¡_h—d
 = *
edge_li¡_±r
;

367 
num_cÚn
 = 0;

369 
icÚn
 = 0; icÚÀ< 
Fc_·d
; iconn++) {

370 
™¿ck
 = 
·ds_to_Œacks
[
ad
][
icÚn
];

372 ià(
chª_ty³
 =ğ
CHANX
) {

373 
cbox_exi¡s
 = 
	`is_cbox
(
chª_i
, 
chª_j
, 
™¿ck
, 
£g_d‘as
);

375 
cbox_exi¡s
 = 
	`is_cbox
(
chª_j
, 
chª_i
, 
™¿ck
, 
£g_d‘as
);

378 ià(
cbox_exi¡s
) {

379 
to_node
 = 
	`g”r_node_t_šdex
(
chª_i
, 
chª_j
, 
chª_ty³
, 
™¿ck
,

380 
nodes_³r_chª
, 
¼_node_šdiûs
);

381 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

382 
£g_d‘as
[
™¿ck
].
İš_sw™ch
, &
ä“_edge_li¡_h—d
);

383 
num_cÚn
++;

387 ià(
num_cÚn
 == 0) {

388 
	`´štf
("Error: INPAD_TYPE %d‡t (%d,%d) does‚ot connecto‡ny "

389 "Œacks.\n", 
ad
, 
i
, 
j
);

390 
	`ex™
(1);

393 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

394  (
num_cÚn
);

395 
	}
}

398 
boŞ—n
 
	$is_cbox
(
£g_num
, 
chª_num
, 
™¿ck
, 
£gm’t_d‘as_t


399 *
£g_d‘as
)

403 
£g_off£t
, 
¡¬t
, 
Ëngth
;

404 
Ëngth
 = 
£g_d‘as
[
™¿ck
].length;

405 
¡¬t
 = 
£g_d‘as
[
™¿ck
].start;

406 
£g_off£t
 = (
£g_num
 + 
chª_num
 - 
¡¬t
 + 
Ëngth
) %†ength;

407  (
£g_d‘as
[
™¿ck
].
cb
[
£g_off£t
]);

408 
	}
}

411 ** 
	$®loc_ªd_lßd_¼_node_šdiûs
(
nodes_³r_şb
,

412 
nodes_³r_·d
, 
nodes_³r_chª
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
,

413 
£gm’t_d‘as_t
* 
£g_d‘as_y
)

420 
šdex
, 
i
, 
j
;

421 ** 
¼_node_šdiûs
;

422 
¼_node_šdiûs
 = (**è
	`®loc_m©rix
(0, 
num_grid_cŞumns
 + 1, 0, 
num_grid_rows
 + 1, ());

423 
chªx_¼_šdiûs
 = (***è
	`®loc_m©rix3
(1, 
num_grid_cŞumns
, 0, 
num_grid_rows
, 0,

424 
nodes_³r_chª
 - 1, ());

425 
chªy_¼_šdiûs
 = (***è
	`®loc_m©rix3
(0, 
num_grid_cŞumns
, 1, 
num_grid_rows
, 0,

426 
nodes_³r_chª
 - 1, ());

427 
šdex
 = 0;

429 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; i++) {

430 
j
 = 0; j <ğ
num_grid_rows
 + 1; j++) {

431 
¼_node_šdiûs
[
i
][
j
] = 
šdex
;

433 ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
B_CLB_TYPE
) {

434 
šdex
 +ğ
nodes_³r_şb
;

435 
šdex
 = 
	`lßd_chªx_¼_šdiûs
(
£g_d‘as_x
, 
nodes_³r_chª
, index,

436 
i
, 
j
);

437 
šdex
 = 
	`lßd_chªy_¼_šdiûs
(
£g_d‘as_y
, 
nodes_³r_chª
, index,

438 
i
, 
j
);

439 } ià(
bš_grids
[
i
][
j
].
grid_ty³
 =ğ
IO_TYPE
) {

440 
šdex
 +ğ
nodes_³r_·d
;

441 ià(
j
 == 0)

442 
šdex
 = 
	`lßd_chªx_¼_šdiûs
(
£g_d‘as_x
, 
nodes_³r_chª
,

443 
šdex
, 
i
, 
j
);

445 ià(
i
 == 0)

446 
šdex
 = 
	`lßd_chªy_¼_šdiûs
(
£g_d‘as_y
, 
nodes_³r_chª
,

447 
šdex
, 
i
, 
j
);

448 } ià(
bš_grids
[
i
][
j
].
grid_ty³
 !ğ
EMPTY_TYPE
) {

449 
	`´štf
("Error in‡lloc_and_load_rr_node_indices. Unexpected clb"

451 
	`ex™
(1);

456  (
¼_node_šdiûs
);

457 
	}
}

460 
	$ä“_¼_node_šdiûs
(** 
¼_node_šdiûs
)

464 
	`ä“_m©rix
(
¼_node_šdiûs
, 0, 
num_grid_cŞumns
 + 1, 0, ());

465 
	`ä“_m©rix3
(
chªx_¼_šdiûs
, 1, 
num_grid_cŞumns
, 0, 
num_grid_rows
, 0, ());

466 
	`ä“_m©rix3
(
chªy_¼_šdiûs
, 0, 
num_grid_cŞumns
, 1, 
num_grid_rows
, 0, ());

467 
	}
}

470 
	$lßd_chªx_¼_šdiûs
(
£gm’t_d‘as_t
* 
£g_d‘as_x
, 

471 
nodes_³r_chª
, 
¡¬t_šdex
, 
i
, 
j
)

476 
¼_šdex
, 
i¡¬t
, 
›nd
, 
i£g
, 
™¿ck
;

477 
¼_šdex
 = 
¡¬t_šdex
;

479 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

480 
i¡¬t
 = 
	`g‘_şo£¡_£g_¡¬t
(
£g_d‘as_x
, 
™¿ck
, 
i
, 
j
);

484 ià(
i¡¬t
 !ğ
i
) {

488 
›nd
 = 
	`g‘_£g_’d
(
£g_d‘as_x
, 
™¿ck
, 
i¡¬t
, 
j
, 
num_grid_cŞumns
);

490 
i£g
 = 
i¡¬t
; i£g <ğ
›nd
; iseg++) {

491 
chªx_¼_šdiûs
[
i£g
][
j
][
™¿ck
] = 
¼_šdex
;

494 
¼_šdex
++;

497  (
¼_šdex
);

498 
	}
}

501 
	$lßd_chªy_¼_šdiûs
(
£gm’t_d‘as_t
* 
£g_d‘as_y
, 

502 
nodes_³r_chª
, 
¡¬t_šdex
, 
i
, 
j
)

507 
¼_šdex
, 
j¡¬t
, 
j’d
, 
j£g
, 
™¿ck
;

508 
¼_šdex
 = 
¡¬t_šdex
;

510 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

511 
j¡¬t
 = 
	`g‘_şo£¡_£g_¡¬t
(
£g_d‘as_y
, 
™¿ck
, 
j
, 
i
);

515 ià(
j¡¬t
 !ğ
j
) {

519 
j’d
 = 
	`g‘_£g_’d
(
£g_d‘as_y
, 
™¿ck
, 
j¡¬t
, 
i
, 
num_grid_rows
);

521 
j£g
 = 
j¡¬t
; j£g <ğ
j’d
; jseg++) {

522 
chªy_¼_šdiûs
[
i
][
j£g
][
™¿ck
] = 
¼_šdex
;

525 
¼_šdex
++;

528  (
¼_šdex
);

529 
	}
}

549 
	$g”r_node_t_šdex
(
i
, 
j
, 
¼_ty³s_t
 
¼_ty³
, 
ioff
,

550 
nodes_³r_chª
, ** 
¼_node_šdiûs
)

552 
	`as£¹
(
ioff
 >= 0);

553 
	`as£¹
(
i
 >ğ0 && i < 
num_grid_cŞumns
 + 2);

554 
	`as£¹
(
j
 >ğ0 && j < 
num_grid_rows
 + 2);

555 
šdex
 = 
¼_node_šdiûs
[
i
][
j
];

557 
işass
 = 0;

558 
bš_grids
[
i
][
j
].
grid_ty³
) {

559 
B_CLB_TYPE
:

560 
¼_ty³
) {

561 
SOURCE
:

562 
	`as£¹
(
ioff
 < 
num_pš_şass
);

563 
	`as£¹
(
şass_šf
[
ioff
].
ty³
 =ğ
DRIVER
);

564 
šdex
 +ğ
ioff
;

565  (
šdex
);

567 
SINK
:

568 
	`as£¹
(
ioff
 < 
num_pš_şass
);

569 
	`as£¹
(
şass_šf
[
ioff
].
ty³
 =ğ
RECEIVER
);

570 
šdex
 +ğ
ioff
;

571  (
šdex
);

573 
OPIN
:

574 
	`as£¹
(
ioff
 < 
max_pšs_³r_şb
);

575 
işass
 = 
şb_pš_şass
[
ioff
];

576 
	`as£¹
(
şass_šf
[
işass
].
ty³
 =ğ
DRIVER
);

577 
šdex
 +ğ
num_pš_şass
 + 
ioff
;

578  (
šdex
);

580 
IPIN
:

581 
	`as£¹
(
ioff
 < 
max_pšs_³r_şb
);

582 
işass
 = 
şb_pš_şass
[
ioff
];

583 
	`as£¹
(
şass_šf
[
işass
].
ty³
 =ğ
RECEIVER
);

584 
šdex
 +ğ
num_pš_şass
 + 
ioff
;

585  (
šdex
);

587 
CHANX
:

588 
	`as£¹
(
ioff
 < 
nodes_³r_chª
);

589 
šdex
 = 
chªx_¼_šdiûs
[
i
][
j
][
ioff
];

590  (
šdex
);

592 
CHANY
:

593 
	`as£¹
(
ioff
 < 
nodes_³r_chª
);

594 
šdex
 = 
chªy_¼_šdiûs
[
i
][
j
][
ioff
];

595  (
šdex
);

598 
	`´štf
("Error: Bad„r_node…assedo gerr_node_t_index.\n"

599 "Reque¡ fÜy³ %d‚umb” %d‡ˆ(%d, %d).\n", 
¼_ty³
,

600 
ioff
, 
i
, 
j
);

601 
	`ex™
(1);

606 
IO_TYPE
:

607 
¼_ty³
) {

608 
SOURCE
:

609 
	`as£¹
(
ioff
 < 
io_¿tio
);

610 
šdex
 +ğ4 * 
ioff
;

611  (
šdex
);

613 
SINK
:

614 
	`as£¹
(
ioff
 < 
io_¿tio
);

615 
šdex
 +ğ4 * 
ioff
 + 1;

616  (
šdex
);

618 
OPIN
:

619 
	`as£¹
(
ioff
 < 
io_¿tio
);

620 
šdex
 +ğ4 * 
ioff
 + 2;

621  (
šdex
);

623 
IPIN
:

624 
	`as£¹
(
ioff
 < 
io_¿tio
);

625 
šdex
 +ğ4 * 
ioff
 + 3;

626  (
šdex
);

628 
CHANX
:

629 
	`as£¹
(
ioff
 < 
nodes_³r_chª
);

630 
	`as£¹
(
j
 == 0);

631 
šdex
 = 
chªx_¼_šdiûs
[
i
][
j
][
ioff
];

632  (
šdex
);

634 
CHANY
:

635 
	`as£¹
(
ioff
 < 
nodes_³r_chª
);

636 
	`as£¹
(
i
 == 0);

637 
šdex
 = 
chªy_¼_šdiûs
[
i
][
j
][
ioff
];

638  (
šdex
);

641 
	`´štf
("Error: Bad„r_node…assedo gerr_node_t_index.\n"

642 "Reque¡ fÜy³ %d‚umb” %d‡ˆ(%d, %d).\n", 
¼_ty³
,

643 
ioff
, 
i
, 
j
);

644 
	`ex™
(1);

650 
	`´štf
("Error in gerr_node_t_index: unexpected blocksype (%d)‡t "

651 "(%d, %d).\Är_ty³: %d.\n", 
bš_grids
[
i
][
j
].
grid_ty³
,

652 
i
, 
j
, 
¼_ty³
);

653 
	`ex™
(1);

655 
	}
}

658 
	$g‘_£g_’d
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
™¿ck
, 
£g_¡¬t
, 

659 
chª_num
, 
max_’d
)

665 
£g_’d
, 
Ëngth
, 
nÜm_¡¬t
;

666 
Ëngth
 = 
£g_d‘as
[
™¿ck
].length;

668 ià(
£g_¡¬t
 != 1) {

669 
£g_’d
 = 
	`mš
(
£g_¡¬t
 + 
Ëngth
 - 1, 
max_’d
);

670 } ià(
£g_d‘as
[
™¿ck
].
lÚglše
) {

671 
£g_’d
 = 
max_’d
;

673 
nÜm_¡¬t
 = 
£g_d‘as
[
™¿ck
].
¡¬t
;

674 
£g_’d
 = 
Ëngth
 - (Ëngth + 1 + 
chª_num
 - 
nÜm_¡¬t
) %†ength;

677  (
£g_’d
);

678 
	}
}

681 
	$g‘_xŒack_to_şb_š_edges
(
Œ_i¡¬t
, 
Œ_›nd
, 
Œ_j
,

682 
™¿ck
, 
iside
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


683 ** 
Œacks_to_şb_š
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

684 
£gm’t_d‘as_t
* 
£g_d‘as_x
, 
wœe_to_š_sw™ch
)

689 
şb_j
, 
icÚn
, 
num_cÚn
, 
max_cÚn
, 
i
, 
š
, 
to_node
;

690 
t_lšked_edge
* 
edge_li¡_h—d
;

694 ià(
iside
 =ğ
BOTTOM
) {

695 
şb_j
 = 
Œ_j
;

696 } ià(
iside
 =ğ
TOP
) {

697 
şb_j
 = 
Œ_j
 + 1;

699 
	`´štf
("Error in get_xtrack_to_clb_ipin_edges: Unknown iside: %d.\n",

700 
iside
);

701 
	`ex™
(1);

704 
edge_li¡_h—d
 = *
edge_li¡_±r
;

705 
num_cÚn
 = 0;

706 
max_cÚn
 = 
Œacks_to_şb_š
[
™¿ck
][
iside
].
ÃËm
;

708 
i
 = 
Œ_i¡¬t
; i <ğ
Œ_›nd
; i++) {

709 ià(
	`is_cbox
(
i
, 
Œ_j
, 
™¿ck
, 
£g_d‘as_x
)) {

710 
icÚn
 = 0; icÚÀ< 
max_cÚn
; iconn++) {

711 
š
 = 
Œacks_to_şb_š
[
™¿ck
][
iside
].
li¡
[
icÚn
];

712 
to_node
 = 
	`g”r_node_t_šdex
(
i
, 
şb_j
, 
IPIN
, 
š
, 
nodes_³r_chª
,

713 
¼_node_šdiûs
);

714 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

715 
wœe_to_š_sw™ch
, &
ä“_edge_li¡_h—d
);

718 
num_cÚn
 +ğ
max_cÚn
;

722 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

723  (
num_cÚn
);

724 
	}
}

727 
	$g‘_yŒack_to_şb_š_edges
(
Œ_j¡¬t
, 
Œ_j’d
, 
Œ_i
,

728 
™¿ck
, 
iside
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


729 ** 
Œacks_to_şb_š
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

730 
£gm’t_d‘as_t
* 
£g_d‘as_y
, 
wœe_to_š_sw™ch
)

735 
şb_i
, 
icÚn
, 
num_cÚn
, 
max_cÚn
, 
j
, 
š
, 
to_node
;

736 
t_lšked_edge
* 
edge_li¡_h—d
;

740 ià(
iside
 =ğ
LEFT
) {

741 
şb_i
 = 
Œ_i
;

742 } ià(
iside
 =ğ
RIGHT
) {

743 
şb_i
 = 
Œ_i
 + 1;

745 
	`´štf
("Error in get_ytrack_to_clb_ipin_edges: Unknown iside: %d.\n",

746 
iside
);

747 
	`ex™
(1);

750 
edge_li¡_h—d
 = *
edge_li¡_±r
;

751 
num_cÚn
 = 0;

752 
max_cÚn
 = 
Œacks_to_şb_š
[
™¿ck
][
iside
].
ÃËm
;

754 
j
 = 
Œ_j¡¬t
; j <ğ
Œ_j’d
; j++) {

755 ià(
	`is_cbox
(
j
, 
Œ_i
, 
™¿ck
, 
£g_d‘as_y
)) {

756 
icÚn
 = 0; icÚÀ< 
max_cÚn
; iconn++) {

757 
š
 = 
Œacks_to_şb_š
[
™¿ck
][
iside
].
li¡
[
icÚn
];

758 
to_node
 = 
	`g”r_node_t_šdex
(
şb_i
, 
j
, 
IPIN
, 
š
, 
nodes_³r_chª
,

759 
¼_node_šdiûs
);

760 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

761 
wœe_to_š_sw™ch
, &
ä“_edge_li¡_h—d
);

764 
num_cÚn
 +ğ
max_cÚn
;

768 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

769  (
num_cÚn
);

770 
	}
}

773 
	$g‘_xŒack_to_·d_edges
(
Œ_i¡¬t
, 
Œ_›nd
, 
Œ_j
, 
·d_j
,

774 
™¿ck
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


775 *
Œacks_to_·ds
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

776 
£gm’t_d‘as_t
* 
£g_d‘as_x
, 
wœe_to_š_sw™ch
)

781 
icÚn
, 
ad
, 
to_node
, 
num_cÚn
, 
max_cÚn
, 
i
;

782 
t_lšked_edge
* 
edge_li¡_h—d
;

783 
edge_li¡_h—d
 = *
edge_li¡_±r
;

784 
num_cÚn
 = 0;

785 
max_cÚn
 = 
Œacks_to_·ds
[
™¿ck
].
ÃËm
;

787 
i
 = 
Œ_i¡¬t
; i <ğ
Œ_›nd
; i++) {

788 ià(
	`is_cbox
(
i
, 
Œ_j
, 
™¿ck
, 
£g_d‘as_x
)) {

789 
icÚn
 = 0; icÚÀ< 
max_cÚn
; iconn++) {

790 
ad
 = 
Œacks_to_·ds
[
™¿ck
].
li¡
[
icÚn
];

791 
to_node
 = 
	`g”r_node_t_šdex
(
i
, 
·d_j
, 
IPIN
, 
ad
, 
nodes_³r_chª
,

792 
¼_node_šdiûs
);

793 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

794 
wœe_to_š_sw™ch
, &
ä“_edge_li¡_h—d
);

797 
num_cÚn
 +ğ
max_cÚn
;

801 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

802  (
num_cÚn
);

803 
	}
}

806 
	$g‘_yŒack_to_·d_edges
(
Œ_j¡¬t
, 
Œ_j’d
, 
Œ_i
, 
·d_i
,

807 
™¿ck
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


808 *
Œacks_to_·ds
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

809 
£gm’t_d‘as_t
* 
£g_d‘as_y
, 
wœe_to_š_sw™ch
)

815 
icÚn
, 
ad
, 
to_node
, 
num_cÚn
, 
max_cÚn
, 
j
;

816 
t_lšked_edge
* 
edge_li¡_h—d
;

817 
edge_li¡_h—d
 = *
edge_li¡_±r
;

818 
num_cÚn
 = 0;

819 
max_cÚn
 = 
Œacks_to_·ds
[
™¿ck
].
ÃËm
;

821 
j
 = 
Œ_j¡¬t
; j <ğ
Œ_j’d
; j++) {

822 ià(
	`is_cbox
(
j
, 
Œ_i
, 
™¿ck
, 
£g_d‘as_y
)) {

823 
icÚn
 = 0; icÚÀ< 
Œacks_to_·ds
[
™¿ck
].
ÃËm
; iconn++) {

824 
ad
 = 
Œacks_to_·ds
[
™¿ck
].
li¡
[
icÚn
];

825 
to_node
 = 
	`g”r_node_t_šdex
(
·d_i
, 
j
, 
IPIN
, 
ad
, 
nodes_³r_chª
,

826 
¼_node_šdiûs
);

827 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

828 
wœe_to_š_sw™ch
, &
ä“_edge_li¡_h—d
);

831 
num_cÚn
 +ğ
max_cÚn
;

835 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

836  (
num_cÚn
);

837 
	}
}

840 
	$g‘_xŒack_to_yŒacks
(
äom_i¡¬t
, 
äom_›nd
, 
äom_j
, 

841 
äom_Œack
, 
to_j
, 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
,

842 ** 
¼_node_šdiûs
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

843 *
£g_d‘as_y
, 
sw™ch_block_t
 
sw™ch_block_ty³
)

861 
num_cÚn
, 
to_node
, 
i
, 
to_Œack
, 
icÚn
;

862 
äom_node_sw™ch
, 
to_node_sw™ch
;

863 
sw™ch_ty³s
[2];

864 
boŞ—n
 
is_x_sbox
, 
is_y_sbox
, 
ycÚn_to_above
;

865 
t_lšked_edge
* 
edge_li¡_h—d
;

866 
veùÜ_t
 
cÚn_Œacks
;

867 
num_cÚn
 = 0;

868 
edge_li¡_h—d
 = *
edge_li¡_±r
;

870 ià(
to_j
 <ğ
äom_j
) {

871 
ycÚn_to_above
 = 
TRUE
;

873 
ycÚn_to_above
 = 
FALSE
;

878 
äom_node_sw™ch
 = 
£g_d‘as_x
[
äom_Œack
].
wœe_sw™ch
;

888 
i
 = 
äom_i¡¬t
; i <ğ
äom_›nd
; i++) {

890 
is_x_sbox
 = 
	`is_sbox
(
i
, 
äom_j
, 
äom_Œack
, 
£g_d‘as_x
, 
FALSE
);

891 
cÚn_Œacks
 = 
	`g‘_sw™ch_box_Œacks
(
i
, 
äom_j
, 
äom_Œack
, 
CHANX
, i - 1,

892 
to_j
, 
CHANY
, 
sw™ch_block_ty³
, 
nodes_³r_chª
);

896 
icÚn
 = 0; icÚÀ< 
cÚn_Œacks
.
ÃËm
; iconn++) {

897 
to_Œack
 = 
cÚn_Œacks
.
li¡
[
icÚn
];

898 
is_y_sbox
 = 
	`is_sbox
(
to_j
, 
i
 - 1, 
to_Œack
, 
£g_d‘as_y
, 
ycÚn_to_above
);

899 
to_node_sw™ch
 = 
£g_d‘as_y
[
to_Œack
].
wœe_sw™ch
;

900 
	`g‘_sw™ch_ty³
(
is_x_sbox
, 
is_y_sbox
, 
äom_node_sw™ch
, 
to_node_sw™ch
,

901 
sw™ch_ty³s
);

903 ià(
sw™ch_ty³s
[0] !ğ
OPEN
) {

904 
to_node
 = 
	`g”r_node_t_šdex
(
i
 - 1, 
to_j
, 
CHANY
, 
to_Œack
,

905 
nodes_³r_chª
, 
¼_node_šdiûs
);

907 ià(!
¼_edge_dÚe
[
to_node
]) {

908 
num_cÚn
++;

909 
¼_edge_dÚe
[
to_node
] = 
TRUE
;

910 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

911 
sw™ch_ty³s
[0], &
ä“_edge_li¡_h—d
);

913 ià(
sw™ch_ty³s
[1] !ğ
OPEN
) {

914 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

915 
sw™ch_ty³s
[1], &
ä“_edge_li¡_h—d
);

916 
num_cÚn
++;

923 
is_x_sbox
 = 
	`is_sbox
(
i
, 
äom_j
, 
äom_Œack
, 
£g_d‘as_x
, 
TRUE
);

924 
cÚn_Œacks
 = 
	`g‘_sw™ch_box_Œacks
(
i
, 
äom_j
, 
äom_Œack
, 
CHANX
, i,

925 
to_j
, 
CHANY
, 
sw™ch_block_ty³
, 
nodes_³r_chª
);

929 
icÚn
 = 0; icÚÀ< 
cÚn_Œacks
.
ÃËm
; iconn++) {

930 
to_Œack
 = 
cÚn_Œacks
.
li¡
[
icÚn
];

931 
is_y_sbox
 = 
	`is_sbox
(
to_j
, 
i
, 
to_Œack
, 
£g_d‘as_y
, 
ycÚn_to_above
);

932 
to_node_sw™ch
 = 
£g_d‘as_y
[
to_Œack
].
wœe_sw™ch
;

933 
	`g‘_sw™ch_ty³
(
is_x_sbox
, 
is_y_sbox
, 
äom_node_sw™ch
, 
to_node_sw™ch
,

934 
sw™ch_ty³s
);

936 ià(
sw™ch_ty³s
[0] !ğ
OPEN
) {

937 
to_node
 = 
	`g”r_node_t_šdex
(
i
, 
to_j
, 
CHANY
, 
to_Œack
,

938 
nodes_³r_chª
, 
¼_node_šdiûs
);

940 ià(!
¼_edge_dÚe
[
to_node
]) {

941 
num_cÚn
++;

942 
¼_edge_dÚe
[
to_node
] = 
TRUE
;

943 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

944 
sw™ch_ty³s
[0], &
ä“_edge_li¡_h—d
);

946 ià(
sw™ch_ty³s
[1] !ğ
OPEN
) {

947 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

948 
sw™ch_ty³s
[1], &
ä“_edge_li¡_h—d
);

949 
num_cÚn
++;

956 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

957  (
num_cÚn
);

958 
	}
}

961 
	$g‘_yŒack_to_xŒacks
(
äom_j¡¬t
, 
äom_j’d
, 
äom_i
, 

962 
äom_Œack
, 
to_i
, 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
,

963 ** 
¼_node_šdiûs
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

964 *
£g_d‘as_y
, 
sw™ch_block_t
 
sw™ch_block_ty³
)

982 
num_cÚn
, 
to_node
, 
j
, 
to_Œack
, 
icÚn
;

983 
äom_node_sw™ch
, 
to_node_sw™ch
;

984 
sw™ch_ty³s
[2];

985 
boŞ—n
 
is_x_sbox
, 
is_y_sbox
, 
xcÚn_to_right
;

986 
t_lšked_edge
* 
edge_li¡_h—d
;

987 
veùÜ_t
 
cÚn_Œacks
;

988 
num_cÚn
 = 0;

989 
edge_li¡_h—d
 = *
edge_li¡_±r
;

991 ià(
to_i
 <ğ
äom_i
) {

992 
xcÚn_to_right
 = 
TRUE
;

994 
xcÚn_to_right
 = 
FALSE
;

999 
äom_node_sw™ch
 = 
£g_d‘as_y
[
äom_Œack
].
wœe_sw™ch
;

1009 
j
 = 
äom_j¡¬t
; j <ğ
äom_j’d
; j++) {

1011 
is_y_sbox
 = 
	`is_sbox
(
j
, 
äom_i
, 
äom_Œack
, 
£g_d‘as_y
, 
FALSE
);

1012 
cÚn_Œacks
 = 
	`g‘_sw™ch_box_Œacks
(
äom_i
, 
j
, 
äom_Œack
, 
CHANY
, 
to_i
,

1013 
j
 - 1, 
CHANX
, 
sw™ch_block_ty³
, 
nodes_³r_chª
);

1017 
icÚn
 = 0; icÚÀ< 
cÚn_Œacks
.
ÃËm
; iconn++) {

1018 
to_Œack
 = 
cÚn_Œacks
.
li¡
[
icÚn
];

1019 
is_x_sbox
 = 
	`is_sbox
(
to_i
, 
j
 - 1, 
to_Œack
, 
£g_d‘as_x
, 
xcÚn_to_right
);

1020 
to_node_sw™ch
 = 
£g_d‘as_x
[
to_Œack
].
wœe_sw™ch
;

1021 
	`g‘_sw™ch_ty³
(
is_y_sbox
, 
is_x_sbox
, 
äom_node_sw™ch
, 
to_node_sw™ch
,

1022 
sw™ch_ty³s
);

1024 ià(
sw™ch_ty³s
[0] !ğ
OPEN
) {

1025 
to_node
 = 
	`g”r_node_t_šdex
(
to_i
, 
j
 - 1, 
CHANX
, 
to_Œack
,

1026 
nodes_³r_chª
, 
¼_node_šdiûs
);

1028 ià(!
¼_edge_dÚe
[
to_node
]) {

1029 
num_cÚn
++;

1030 
¼_edge_dÚe
[
to_node
] = 
TRUE
;

1031 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

1032 
sw™ch_ty³s
[0], &
ä“_edge_li¡_h—d
);

1034 ià(
sw™ch_ty³s
[1] !ğ
OPEN
) {

1035 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

1036 
sw™ch_ty³s
[1], &
ä“_edge_li¡_h—d
);

1037 
num_cÚn
++;

1044 
is_y_sbox
 = 
	`is_sbox
(
j
, 
äom_i
, 
äom_Œack
, 
£g_d‘as_y
, 
TRUE
);

1045 
cÚn_Œacks
 = 
	`g‘_sw™ch_box_Œacks
(
äom_i
, 
j
, 
äom_Œack
, 
CHANY
, 
to_i
,

1046 
j
, 
CHANX
, 
sw™ch_block_ty³
, 
nodes_³r_chª
);

1050 
icÚn
 = 0; icÚÀ< 
cÚn_Œacks
.
ÃËm
; iconn++) {

1051 
to_Œack
 = 
cÚn_Œacks
.
li¡
[
icÚn
];

1052 
is_x_sbox
 = 
	`is_sbox
(
to_i
, 
j
, 
to_Œack
, 
£g_d‘as_x
, 
xcÚn_to_right
);

1053 
to_node_sw™ch
 = 
£g_d‘as_x
[
to_Œack
].
wœe_sw™ch
;

1054 
	`g‘_sw™ch_ty³
(
is_y_sbox
, 
is_x_sbox
, 
äom_node_sw™ch
, 
to_node_sw™ch
,

1055 
sw™ch_ty³s
);

1057 ià(
sw™ch_ty³s
[0] !ğ
OPEN
) {

1058 
to_node
 = 
	`g”r_node_t_šdex
(
to_i
, 
j
, 
CHANX
, 
to_Œack
,

1059 
nodes_³r_chª
, 
¼_node_šdiûs
);

1061 ià(!
¼_edge_dÚe
[
to_node
]) {

1062 
num_cÚn
++;

1063 
¼_edge_dÚe
[
to_node
] = 
TRUE
;

1064 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

1065 
sw™ch_ty³s
[0], &
ä“_edge_li¡_h—d
);

1067 ià(
sw™ch_ty³s
[1] !ğ
OPEN
) {

1068 
edge_li¡_h—d
 = 
	`š£¹_š_edge_li¡
Ódge_li¡_h—d, 
to_node
,

1069 
sw™ch_ty³s
[1], &
ä“_edge_li¡_h—d
);

1070 
num_cÚn
++;

1077 *
edge_li¡_±r
 = 
edge_li¡_h—d
;

1078  (
num_cÚn
);

1079 
	}
}

1082 
	$g‘_xŒack_to_xŒack
(
äom_i
, 
j
, 
äom_Œack
, 
to_i
,

1083 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
, 

1084 ** 
¼_node_šdiûs
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
,

1085 
sw™ch_block_t
 
sw™ch_block_ty³
)

1090 
boŞ—n
 
is_äom_sbox
, 
is_to_sbox
, 
äom_gÛs_right
, 
to_gÛs_right
;

1091 
to_Œack
, 
to_node
, 
icÚn
, 
num_cÚn
;

1092 
äom_node_sw™ch
, 
to_node_sw™ch
;

1093 
sw™ch_ty³s
[2];

1094 
veùÜ_t
 
cÚn_Œacks
;

1096 ià(
äom_i
 < 
to_i
) {

1097 
äom_gÛs_right
 = 
TRUE
;

1098 
to_gÛs_right
 = 
FALSE
;

1100 
äom_gÛs_right
 = 
FALSE
;

1101 
to_gÛs_right
 = 
TRUE
;

1104 
num_cÚn
 = 0;

1105 
äom_node_sw™ch
 = 
£g_d‘as_x
[
äom_Œack
].
wœe_sw™ch
;

1106 
is_äom_sbox
 = 
	`is_sbox
(
äom_i
, 
j
, 
äom_Œack
, 
£g_d‘as_x
, 
äom_gÛs_right
);

1107 
cÚn_Œacks
 = 
	`g‘_sw™ch_box_Œacks
(
äom_i
, 
j
, 
äom_Œack
, 
CHANX
, 
to_i
,

1108 
j
, 
CHANX
, 
sw™ch_block_ty³
, 
nodes_³r_chª
);

1112 
icÚn
 = 0; icÚÀ< 
cÚn_Œacks
.
ÃËm
; iconn++) {

1113 
to_Œack
 = 
cÚn_Œacks
.
li¡
[
icÚn
];

1114 
is_to_sbox
 = 
	`is_sbox
(
to_i
, 
j
, 
to_Œack
, 
£g_d‘as_x
, 
to_gÛs_right
);

1115 
to_node_sw™ch
 = 
£g_d‘as_x
[
to_Œack
].
wœe_sw™ch
;

1116 
	`g‘_sw™ch_ty³
(
is_äom_sbox
, 
is_to_sbox
, 
äom_node_sw™ch
,

1117 
to_node_sw™ch
, 
sw™ch_ty³s
);

1119 ià(
sw™ch_ty³s
[0] !ğ
OPEN
) {

1120 
to_node
 = 
	`g”r_node_t_šdex
(
to_i
, 
j
, 
CHANX
, 
to_Œack
, 
nodes_³r_chª
,

1121 
¼_node_šdiûs
);

1123 *
edge_li¡_±r
 = 
	`š£¹_š_edge_li¡
(*edge_li¡_±r, 
to_node
,

1124 
sw™ch_ty³s
[0], &
ä“_edge_li¡_h—d
);

1125 
num_cÚn
++;

1127 ià(
sw™ch_ty³s
[1] !ğ
OPEN
) {

1128 *
edge_li¡_±r
 = 
	`š£¹_š_edge_li¡
(*edge_li¡_±r, 
to_node
,

1129 
sw™ch_ty³s
[1], &
ä“_edge_li¡_h—d
);

1130 
num_cÚn
++;

1135  (
num_cÚn
);

1136 
	}
}

1139 
	$g‘_yŒack_to_yŒack
(
i
, 
äom_j
, 
äom_Œack
, 
to_j
,

1140 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
, 

1141 ** 
¼_node_šdiûs
, 
£gm’t_d‘as_t
* 
£g_d‘as_y
,

1142 
sw™ch_block_t
 
sw™ch_block_ty³
)

1147 
boŞ—n
 
is_äom_sbox
, 
is_to_sbox
, 
äom_gÛs_up
, 
to_gÛs_up
;

1148 
to_Œack
, 
to_node
, 
icÚn
, 
num_cÚn
;

1149 
äom_node_sw™ch
, 
to_node_sw™ch
;

1150 
sw™ch_ty³s
[2];

1151 
veùÜ_t
 
cÚn_Œacks
;

1153 ià(
äom_j
 < 
to_j
) {

1154 
äom_gÛs_up
 = 
TRUE
;

1155 
to_gÛs_up
 = 
FALSE
;

1157 
äom_gÛs_up
 = 
FALSE
;

1158 
to_gÛs_up
 = 
TRUE
;

1161 
num_cÚn
 = 0;

1162 
äom_node_sw™ch
 = 
£g_d‘as_y
[
äom_Œack
].
wœe_sw™ch
;

1163 
is_äom_sbox
 = 
	`is_sbox
(
äom_j
, 
i
, 
äom_Œack
, 
£g_d‘as_y
, 
äom_gÛs_up
);

1164 
cÚn_Œacks
 = 
	`g‘_sw™ch_box_Œacks
(
i
, 
äom_j
, 
äom_Œack
, 
CHANY
, i, 
to_j
,

1165 
CHANY
, 
sw™ch_block_ty³
, 
nodes_³r_chª
);

1169 
icÚn
 = 0; icÚÀ< 
cÚn_Œacks
.
ÃËm
; iconn++) {

1170 
to_Œack
 = 
cÚn_Œacks
.
li¡
[
icÚn
];

1171 
is_to_sbox
 = 
	`is_sbox
(
to_j
, 
i
, 
to_Œack
, 
£g_d‘as_y
, 
to_gÛs_up
);

1172 
to_node_sw™ch
 = 
£g_d‘as_y
[
to_Œack
].
wœe_sw™ch
;

1173 
	`g‘_sw™ch_ty³
(
is_äom_sbox
, 
is_to_sbox
, 
äom_node_sw™ch
,

1174 
to_node_sw™ch
, 
sw™ch_ty³s
);

1176 ià(
sw™ch_ty³s
[0] !ğ
OPEN
) {

1177 
to_node
 = 
	`g”r_node_t_šdex
(
i
, 
to_j
, 
CHANY
, 
to_Œack
, 
nodes_³r_chª
,

1178 
¼_node_šdiûs
);

1180 *
edge_li¡_±r
 = 
	`š£¹_š_edge_li¡
(*edge_li¡_±r, 
to_node
,

1181 
sw™ch_ty³s
[0], &
ä“_edge_li¡_h—d
);

1182 
num_cÚn
++;

1184 ià(
sw™ch_ty³s
[1] !ğ
OPEN
) {

1185 *
edge_li¡_±r
 = 
	`š£¹_š_edge_li¡
(*edge_li¡_±r, 
to_node
,

1186 
sw™ch_ty³s
[1], &
ä“_edge_li¡_h—d
);

1187 
num_cÚn
++;

1192  (
num_cÚn
);

1193 
	}
}

1196 
boŞ—n
 
	$is_sbox
(
£g_num
, 
chª_num
, 
™¿ck
, 
£gm’t_d‘as_t


1197 *
£g_d‘as
, 
boŞ—n
 
above_Ü_right
)

1203 
£g_off£t
, 
¡¬t
, 
Ëngth
;

1204 
boŞ—n
 
lÚglše
;

1205 
Ëngth
 = 
£g_d‘as
[
™¿ck
].length;

1206 
¡¬t
 = 
£g_d‘as
[
™¿ck
].start;

1207 
lÚglše
 = 
£g_d‘as
[
™¿ck
].longline;

1211 ià(!
lÚglše
) {

1212 
£g_off£t
 = (
£g_num
 + 
chª_num
 - 
¡¬t
 + 
Ëngth
) %†ength;

1213 
£g_off£t
 +ğ
above_Ü_right
;

1215 
£g_off£t
 = (
£g_num
 + 
chª_num
 - 
¡¬t
 + 
above_Ü_right
è% (
Ëngth
 + 1);

1218  (
£g_d‘as
[
™¿ck
].
sb
[
£g_off£t
]);

1219 
	}
}

1222 
	$g‘_sw™ch_ty³
(
boŞ—n
 
is_äom_sbox
, boŞ—À
is_to_sbox
,

1223 
äom_node_sw™ch
, 
to_node_sw™ch
, 
sw™ch_ty³s
[2])

1233 
sw™ch_ty³s
[0] = 
OPEN
;

1234 
sw™ch_ty³s
[1] = 
OPEN
;

1236 ià(!
is_äom_sbox
 && !
is_to_sbox
) {

1237 
sw™ch_ty³s
[0] = 
OPEN
;

1238 } ià(
is_äom_sbox
 && !
is_to_sbox
) {

1239 
sw™ch_ty³s
[0] = 
to_node_sw™ch
;

1240 } ià(!
is_äom_sbox
 && 
is_to_sbox
) {

1245 ià(
sw™ch_šf
[
äom_node_sw™ch
].
bufã»d
 =ğ
FALSE
) {

1246 
sw™ch_ty³s
[0] = 
äom_node_sw™ch
;

1251 ià(
äom_node_sw™ch
 =ğ
to_node_sw™ch
) {

1252 
sw™ch_ty³s
[0] = 
to_node_sw™ch
;

1254 ià(
sw™ch_šf
[
to_node_sw™ch
].
bufã»d
) {

1255 
sw™ch_ty³s
[0] = 
to_node_sw™ch
;

1257 ià(
sw™ch_šf
[
äom_node_sw™ch
].
bufã»d
 =ğ
FALSE
) {

1260 
sw™ch_ty³s
[1] = 
äom_node_sw™ch
;

1263 ià(
sw™ch_šf
[
äom_node_sw™ch
].
bufã»d
) {

1264 
sw™ch_ty³s
[0] = 
to_node_sw™ch
;

1269 ià(
sw™ch_šf
[
to_node_sw™ch
].
R
 <

1270 
sw™ch_šf
[
äom_node_sw™ch
].
R
) {

1271 
sw™ch_ty³s
[0] = 
to_node_sw™ch
;

1272 } ià(
sw™ch_šf
[
äom_node_sw™ch
].
R
 <

1273 
sw™ch_šf
[
to_node_sw™ch
].
R
) {

1274 
sw™ch_ty³s
[0] = 
äom_node_sw™ch
;

1280 ià(
to_node_sw™ch
 < 
äom_node_sw™ch
) {

1281 
sw™ch_ty³s
[0] = 
to_node_sw™ch
;

1283 
sw™ch_ty³s
[0] = 
äom_node_sw™ch
;

1290 
	}
}

	@rr_graph2.h

1 #iâdeà
RR_GRAPH2_H


2 
	#RR_GRAPH2_H


	)

4 
	~"v´_ty³s.h
"

5 
	~"¼_g¿ph_ut.h
"

9 
boŞ—n
* 
¼_edge_dÚe
;

14 
t_lšked_edge
* 
ä“_edge_li¡_h—d
;

19 ** 
®loc_ªd_lßd_¼_node_šdiûs
(
nodes_³r_şb
,

20 
nodes_³r_·d
, 
nodes_³r_chª
,

21 
£gm’t_d‘as_t
* 
£g_d‘as_x
,

22 
£gm’t_d‘as_t
* 
£g_d‘as_y
);

24 
ä“_¼_node_šdiûs
(** 
¼_node_šdiûs
);

26 
g”r_node_t_šdex
(
i_š
, 
j_š
, 
¼_ty³s_t
 
¼_ty³
, 
ioff
,

27 
nodes_³r_chª
, ** 
¼_node_šdiûs
);

29 
ä“_£g_d‘as
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
nodes_³r_chª
);

31 
£gm’t_d‘as_t
* 
®loc_ªd_lßd_£g_d‘as
(
nodes_³r_chª
,

32 
£gm’t_šfo_t
* 
£gm’t_šf
,

33 
num_£g_ty³s
, 
max_Ën
);

35 
dump_£g_d‘as
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
nodes_³r_chª
, * 
âame
);

37 
g‘_şo£¡_£g_¡¬t
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
™¿ck
, 
£g_num
,

38 
chª_num
);

40 
g‘_£g_’d
(
£gm’t_d‘as_t
* 
£g_d‘as
, 
™¿ck
, 
£g_¡¬t
, 

41 
chª_num
, 
max_’d
);

43 
boŞ—n
 
is_cbox
(
£g_num
, 
chª_num
, 
™¿ck
, 
£gm’t_d‘as_t


44 *
£g_d‘as
);

46 
boŞ—n
 
is_sbox
(
£g_num
, 
chª_num
, 
™¿ck
, 
£gm’t_d‘as_t


47 *
£g_d‘as
, 
boŞ—n
 
above_Ü_right
);

50 
g‘_şb_İš_cÚÃùiÚs
(*** 
şb_İš_to_Œacks
, 
š
,

51 
i
, 
j
, 
Fc_ouut
,

52 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
,

53 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
,

54 ** 
¼_node_šdiûs
);

56 
g‘_·d_İš_cÚÃùiÚs
(** 
·ds_to_Œacks
, 
ad
, 
i
, 
j
,

57 
Fc_·d
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segm’t_d‘as_t* 
£g_d‘as_y
,

58 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
, 

59 ** 
¼_node_šdiûs
);

61 
g‘_xŒack_to_şb_š_edges
(
Œ_i¡¬t
, 
Œ_›nd
, 
Œ_j
,

62 
™¿ck
, 
iside
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


63 ** 
Œacks_to_şb_š
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

64 
£gm’t_d‘as_t
* 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

66 
g‘_yŒack_to_şb_š_edges
(
Œ_j¡¬t
, 
Œ_j’d
, 
Œ_i
,

67 
™¿ck
, 
iside
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


68 ** 
Œacks_to_şb_š
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

69 
£gm’t_d‘as_t
* 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

71 
g‘_xŒack_to_·d_edges
(
Œ_i¡¬t
, 
Œ_›nd
, 
Œ_j
, 
·d_j
,

72 
™¿ck
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


73 *
Œacks_to_·ds
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

74 
£gm’t_d‘as_t
* 
£g_d‘as_x
, 
wœe_to_š_sw™ch
);

76 
g‘_yŒack_to_·d_edges
(
Œ_j¡¬t
, 
Œ_j’d
, 
Œ_i
, 
·d_i
,

77 
™¿ck
, 
t_lšked_edge
** 
edge_li¡_±r
, 
veùÜ_t


78 *
Œacks_to_·ds
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

79 
£gm’t_d‘as_t
* 
£g_d‘as_y
, 
wœe_to_š_sw™ch
);

81 
g‘_xŒack_to_yŒacks
(
äom_i¡¬t
, 
äom_›nd
, 
äom_j
, 

82 
äom_Œack
, 
to_j
, 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
,

83 ** 
¼_node_šdiûs
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

84 *
£g_d‘as_y
, 
sw™ch_block_t
 
sw™ch_block_ty³
);

86 
g‘_yŒack_to_xŒacks
(
äom_j¡¬t
, 
äom_j’d
, 
äom_i
, 

87 
äom_Œack
, 
to_i
, 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
,

88 ** 
¼_node_šdiûs
, 
£gm’t_d‘as_t
* 
£g_d‘as_x
, segment_details_t

89 *
£g_d‘as_y
, 
sw™ch_block_t
 
sw™ch_block_ty³
);

91 
g‘_xŒack_to_xŒack
(
äom_i
, 
j
, 
äom_Œack
, 
to_i
,

92 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

93 
£gm’t_d‘as_t
* 
£g_d‘as_x
, 
sw™ch_block_t


94 
sw™ch_block_ty³
);

96 
g‘_yŒack_to_yŒack
(
i
, 
äom_j
, 
äom_Œack
, 
to_j
,

97 
t_lšked_edge
** 
edge_li¡_±r
, 
nodes_³r_chª
, ** 
¼_node_šdiûs
,

98 
£gm’t_d‘as_t
* 
£g_d‘as_y
, 
sw™ch_block_t


99 
sw™ch_block_ty³
);

	@rr_graph_area.c

1 
	~<m©h.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~<as£¹.h
>

5 
	~"glob®s.h
"

6 
	~"¼_g¿ph_ut.h
"

7 
	~"¼_g¿ph_¬—.h
"

12 
g‘_cblock_Œªs
(* 
num_šputs_to_cblock
, 

13 
max_šputs_to_cblock
, 
Œªs_cblock_to_lblock_buf
,

14 
Œªs_¤am_b™
);

16 * 
®loc_ªd_lßd_unsh¬abË_sw™ch_Œªs
(
num_sw™ch
,

17 
Œªs_¤am_b™
, 
R_mšW_nmos
);

19 * 
®loc_ªd_lßd_sh¬abË_sw™ch_Œªs
(
num_sw™ch
,

20 
Œªs_¤am_b™
, 
R_mšW_nmos
, 
R_mšW_pmos
);

22 
Œªs_³r_buf
(
Rbuf
, 
R_mšW_nmos
, 
R_mšW_pmos
);

24 
Œªs_³r_mux
(
num_šputs
, 
Œªs_¤am_b™
);

26 
Œªs_³r_R
(
RŒªs
, 
R_mšW_Œªs
);

32 
	$couÁ_routšg_Œªsi¡Üs
(
num_sw™ch
, 
R_mšW_nmos
,

33 
R_mšW_pmos
)

66 * 
num_šputs_to_cblock
;

68 
boŞ—n
* 
cblock_couÁed
;

69 * 
sh¬ed_bufãr_Œªs
;

70 * 
unsh¬abË_sw™ch_Œªs
, *
sh¬abË_sw™ch_Œªs
;

71 
¼_ty³s_t
 
äom_¼_ty³
, 
to_¼_ty³
;

72 
äom_node
, 
to_node
, 
›dge
, 
num_edges
, 
maxËn
;

73 
isw™ch
, 
i
, 
j
, 
i£g
, 
max_šputs_to_cblock
;

74 
šput_cblock_Œªs
, 
sh¬ed_İš_bufãr_Œªs
;

75 cÚ¡ 
Œªs_¤am_b™
 = 6.;

83 
Á¿ns_sh¬šg
, 
Á¿ns_no_sh¬šg
;

87 
Œªs_Œack_to_cblock_buf
;

88 
Œªs_cblock_to_lblock_buf
;

89 
Á¿ns_sh¬šg
 = 0.;

90 
Á¿ns_no_sh¬šg
 = 0.;

91 
max_šputs_to_cblock
 = 0;

95 
Œªs_Œack_to_cblock_buf
 = 
	`Œªs_³r_buf
(
R_mšW_nmos
 / 4., R_minW_nmos,

96 
R_mšW_pmos
);

97 
Œªs_cblock_to_lblock_buf
 = 
	`Œªs_³r_buf
(
R_mšW_nmos
 / 4., R_minW_nmos,

98 
R_mšW_pmos
);

101 
num_šputs_to_cblock
 = (*è
	`my_ÿÎoc
(
num_¼_nodes
, ());

102 
maxËn
 = 
	`max
(
num_grid_cŞumns
, 
num_grid_rows
) + 1;

103 
cblock_couÁed
 = (
boŞ—n
*è
	`my_ÿÎoc
(
maxËn
, (boolean));

104 
sh¬ed_bufãr_Œªs
 = (*è
	`my_ÿÎoc
(
maxËn
, ());

105 
unsh¬abË_sw™ch_Œªs
 = 
	`®loc_ªd_lßd_unsh¬abË_sw™ch_Œªs
(
num_sw™ch
,

106 
Œªs_¤am_b™
, 
R_mšW_nmos
);

107 
sh¬abË_sw™ch_Œªs
 = 
	`®loc_ªd_lßd_sh¬abË_sw™ch_Œªs
(
num_sw™ch
,

108 
Œªs_¤am_b™
, 
R_mšW_nmos
, 
R_mšW_pmos
);

110 
äom_node
 = 0; from_nod< 
num_¼_nodes
; from_node++) {

111 
äom_¼_ty³
 = 
¼_node
[
äom_node
].
ty³
;

113 
äom_¼_ty³
) {

114 
CHANX
:

115 
CHANY
:

116 
num_edges
 = 
¼_node
[
äom_node
].num_edges;

118 
›dge
 = 0; iedg< 
num_edges
; iedge++) {

119 
to_node
 = 
¼_node
[
äom_node
].
edges
[
›dge
];

120 
to_¼_ty³
 = 
¼_node
[
to_node
].
ty³
;

122 
to_¼_ty³
) {

123 
CHANX
:

124 
CHANY
:

125 
isw™ch
 = 
¼_node
[
äom_node
].
sw™ches
[
›dge
];

127 ià(
sw™ch_šf
[
isw™ch
].
bufã»d
) {

128 
i£g
 = 
	`£g_šdex_of_sblock
(
äom_node
, 
to_node
);

129 
sh¬ed_bufãr_Œªs
[
i£g
] = 
	`max
(shared_buffer_trans[iseg],

130 
sh¬abË_sw™ch_Œªs
[
isw™ch
]);

131 
Á¿ns_no_sh¬šg
 +ğ
unsh¬abË_sw™ch_Œªs
[
isw™ch
] +

132 
sh¬abË_sw™ch_Œªs
[
isw™ch
];

133 
Á¿ns_sh¬šg
 +ğ
unsh¬abË_sw™ch_Œªs
[
isw™ch
];

134 } ià(
äom_node
 < 
to_node
) {

137 
Á¿ns_no_sh¬šg
 +ğ
unsh¬abË_sw™ch_Œªs
[
isw™ch
];

138 
Á¿ns_sh¬šg
 +ğ
unsh¬abË_sw™ch_Œªs
[
isw™ch
];

143 
IPIN
:

144 
num_šputs_to_cblock
[
to_node
]++;

145 
max_šputs_to_cblock
 = 
	`max
(max_inputs_to_cblock,

146 
num_šputs_to_cblock
[
to_node
]);

147 
i£g
 = 
	`£g_šdex_of_cblock
(
äom_¼_ty³
, 
to_node
);

149 ià(
cblock_couÁed
[
i£g
] =ğ
FALSE
) {

150 
cblock_couÁed
[
i£g
] = 
TRUE
;

151 
Á¿ns_sh¬šg
 +ğ
Œªs_Œack_to_cblock_buf
;

152 
Á¿ns_no_sh¬šg
 +ğ
Œªs_Œack_to_cblock_buf
;

158 
	`´štf
("Error in count_routing_transistors: Unexpected \n"

160 
äom_node
, 
äom_¼_ty³
, 
to_node
, 
to_¼_ty³
);

161 
	`ex™
(1);

168 ià(
äom_¼_ty³
 =ğ
CHANX
) {

169 
i
 = 
¼_node
[
äom_node
].
xlow
 - 1; i <ğ¼_node[äom_node].
xhigh
; i++) {

170 
Á¿ns_sh¬šg
 +ğ
sh¬ed_bufãr_Œªs
[
i
];

171 
sh¬ed_bufãr_Œªs
[
i
] = 0.;

174 
i
 = 
¼_node
[
äom_node
].
xlow
; i <ğ¼_node[äom_node].
xhigh
; i++) {

175 
cblock_couÁed
[
i
] = 
FALSE
;

178 
j
 = 
¼_node
[
äom_node
].
ylow
 - 1; j <ğ¼_node[äom_node].
yhigh
; j++) {

179 
Á¿ns_sh¬šg
 +ğ
sh¬ed_bufãr_Œªs
[
j
];

180 
sh¬ed_bufãr_Œªs
[
j
] = 0.;

183 
j
 = 
¼_node
[
äom_node
].
ylow
; j <ğ¼_node[äom_node].
yhigh
; j++) {

184 
cblock_couÁed
[
j
] = 
FALSE
;

190 
OPIN
:

191 
num_edges
 = 
¼_node
[
äom_node
].num_edges;

192 
sh¬ed_İš_bufãr_Œªs
 = 0.;

194 
›dge
 = 0; iedg< 
num_edges
; iedge++) {

195 
isw™ch
 = 
¼_node
[
äom_node
].
sw™ches
[
›dge
];

196 
Á¿ns_no_sh¬šg
 +ğ
unsh¬abË_sw™ch_Œªs
[
isw™ch
] +

197 
sh¬abË_sw™ch_Œªs
[
isw™ch
];

198 
Á¿ns_sh¬šg
 +ğ
unsh¬abË_sw™ch_Œªs
[
isw™ch
];

199 
sh¬ed_İš_bufãr_Œªs
 = 
	`max
(shared_opin_buffer_trans,

200 
sh¬abË_sw™ch_Œªs
[
isw™ch
]);

203 
Á¿ns_sh¬šg
 +ğ
sh¬ed_İš_bufãr_Œªs
;

211 
	`ä“
(
cblock_couÁed
);

212 
	`ä“
(
sh¬ed_bufãr_Œªs
);

213 
	`ä“
(
unsh¬abË_sw™ch_Œªs
);

214 
	`ä“
(
sh¬abË_sw™ch_Œªs
);

216 
šput_cblock_Œªs
 = 
	`g‘_cblock_Œªs
(
num_šputs_to_cblock
,

217 
max_šputs_to_cblock
, 
Œªs_cblock_to_lblock_buf
, 
Œªs_¤am_b™
);

218 
	`ä“
(
num_šputs_to_cblock
);

219 
Á¿ns_sh¬šg
 +ğ
šput_cblock_Œªs
;

220 
Á¿ns_no_sh¬šg
 +ğ
šput_cblock_Œªs
;

221 
	`´štf
("\nRouting‡rea (in minimum widthransistor‡reas):\n");

222 
	`´štf
("Assuming‚o buffer sharing (pessimistic). Total: %#g Per clb: "

223 "%#g\n", 
Á¿ns_no_sh¬šg
,‚Œªs_no_sh¬šg / ()(
num_grid_cŞumns
 * 
num_grid_rows
));

224 
	`´štf
("Assuming buffer sharing (slightly optimistic). Total: %#g Per clb: "

225 "%#g\n\n", 
Á¿ns_sh¬šg
,‚Œªs_sh¬šg / ()(
num_grid_cŞumns
 * 
num_grid_rows
));

226 
	}
}

229 
	$g‘_cblock_Œªs
(* 
num_šputs_to_cblock
, 

230 
max_šputs_to_cblock
, 
Œªs_cblock_to_lblock_buf
,

231 
Œªs_¤am_b™
)

237 * 
Œªs_³r_cblock
;

238 
Œªs_couÁ
;

239 
i
, 
num_šputs
;

240 
Œªs_³r_cblock
 = (*è
	`my_m®loc
((
max_šputs_to_cblock
 + 1) *

242 
Œªs_³r_cblock
[0] = 0.;

248 
i
 = 1; i <ğ
max_šputs_to_cblock
; i++)

249 
Œªs_³r_cblock
[
i
] = 
	`Œªs_³r_mux
(i, 
Œªs_¤am_b™
) +

250 
Œªs_cblock_to_lblock_buf
;

252 
Œªs_couÁ
 = 0.;

254 
i
 = 0; i < 
num_¼_nodes
; i++) {

255 
num_šputs
 = 
num_šputs_to_cblock
[
i
];

256 
Œªs_couÁ
 +ğ
Œªs_³r_cblock
[
num_šputs
];

259 
	`ä“
(
Œªs_³r_cblock
);

260  (
Œªs_couÁ
);

261 
	}
}

264 * 
	$®loc_ªd_lßd_unsh¬abË_sw™ch_Œªs
(
num_sw™ch
,

265 
Œªs_¤am_b™
, 
R_mšW_nmos
)

271 * 
unsh¬abË_sw™ch_Œªs
, 
R·ss
;

272 
i
;

273 
unsh¬abË_sw™ch_Œªs
 = (*è
	`my_m®loc
(
num_sw™ch
 * ());

275 
i
 = 0; i < 
num_sw™ch
; i++) {

276 ià(
sw™ch_šf
[
i
].
bufã»d
 =ğ
FALSE
) {

277 
R·ss
 = 
sw™ch_šf
[
i
].
R
;

279 
R·ss
 = 
sw™ch_šf
[
i
].
R
 / 2.;

282 
unsh¬abË_sw™ch_Œªs
[
i
] = 
	`Œªs_³r_R
(
R·ss
, 
R_mšW_nmos
) +

283 
Œªs_¤am_b™
;

286  (
unsh¬abË_sw™ch_Œªs
);

287 
	}
}

290 * 
	$®loc_ªd_lßd_sh¬abË_sw™ch_Œªs
(
num_sw™ch
,

291 
Œªs_¤am_b™
, 
R_mšW_nmos
, 
R_mšW_pmos
)

298 * 
sh¬abË_sw™ch_Œªs
, 
Rbuf
;

299 
i
;

300 
sh¬abË_sw™ch_Œªs
 = (*è
	`my_m®loc
(
num_sw™ch
 * ());

302 
i
 = 0; i < 
num_sw™ch
; i++) {

303 ià(
sw™ch_šf
[
i
].
bufã»d
 =ğ
FALSE
) {

304 
sh¬abË_sw™ch_Œªs
[
i
] = 0.;

306 
Rbuf
 = 
sw™ch_šf
[
i
].
R
 / 2.;

307 
sh¬abË_sw™ch_Œªs
[
i
] = 
	`Œªs_³r_buf
(
Rbuf
, 
R_mšW_nmos
,

308 
R_mšW_pmos
);

312  (
sh¬abË_sw™ch_Œªs
);

313 
	}
}

316 
	$Œªs_³r_buf
(
Rbuf
, 
R_mšW_nmos
, 
R_mšW_pmos
)

321 
num_¡age
, 
i¡age
;

322 
Œªs_couÁ
, 
¡age_¿tio
, 
R¡age
;

324 ià(
Rbuf
 > 0.6 * 
R_mšW_nmos
 || Rbuf <= 0.) {

325 
Œªs_couÁ
 = 
	`Œªs_³r_R
(
Rbuf
, 
R_mšW_nmos
) +rans_per_R(Rbuf,

326 
R_mšW_pmos
);

330 
num_¡age
 = 
	`nšt
(
	`log10
(
R_mšW_nmos
 / 
Rbuf
) /†og10(4.));

331 
num_¡age
 = 
	`max
(num_stage, 1);

332 
¡age_¿tio
 = 
	`pow
(
R_mšW_nmos
 / 
Rbuf
, 1. / (è
num_¡age
);

333 
R¡age
 = 
R_mšW_nmos
;

334 
Œªs_couÁ
 = 0.;

336 
i¡age
 = 0; i¡ag<ğ
num_¡age
; istage++) {

337 
Œªs_couÁ
 +ğ
	`Œªs_³r_R
(
R¡age
, 
R_mšW_nmos
) +rans_per_R(Rstage,

338 
R_mšW_pmos
);

339 
R¡age
 /ğ
¡age_¿tio
;

343  (
Œªs_couÁ
);

344 
	}
}

347 
	$Œªs_³r_mux
(
num_šputs
, 
Œªs_¤am_b™
)

352 
Æev–s
;

353 
Á¿ns
;

358 ià(
num_šputs
 <= 1) {

362 
Æev–s
 = 
	`û
(
	`log10
(
num_šputs
) /†og10(2.) - 0.00001);

363 
Á¿ns
 = 
Œªs_¤am_b™
 * 
Æev–s
 + 2 * 
num_šputs
 - 2;

364  (
Á¿ns
);

365 
	}
}

368 
	$Œªs_³r_R
(
RŒªs
, 
R_mšW_Œªs
)

373 
Œªs_¬—
;

375 ià(
RŒªs
 <= 0.) {

379 ià(
RŒªs
 >ğ
R_mšW_Œªs
) {

388 
Œªs_¬—
 = 0.5 * 
R_mšW_Œªs
 / 
RŒªs
 + 0.5;

389  (
Œªs_¬—
);

390 
	}
}

	@rr_graph_area.h

1 #iâdeà
RR_GRAPH_AREA_H


2 
	#RR_GRAPH_AREA_H


	)

4 
couÁ_routšg_Œªsi¡Üs
(
num_sw™ch
, 
R_mšW_nmos
,

5 
R_mšW_pmos
);

	@rr_graph_indexed_data.c

1 
	~<m©h.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"¼_g¿ph2.h
"

6 
	~"¼_g¿ph_šdexed_d©a.h
"

11 
lßd_¼_šdexed_d©a_ba£_co¡s
(
nodes_³r_chª
, **

12 
¼_node_šdiûs
, 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
, 

13 
wœe_to_š_sw™ch
);

15 
g‘_d–ay_nÜm®iz©iÚ_çc
(
nodes_³r_chª
, **

16 
¼_node_šdiûs
);

18 
g‘_av”age_İš_d–ay
(** 
¼_node_šdiûs
, 

19 
nodes_³r_chª
);

21 
lßd_¼_šdexed_d©a_T_v®ues
(
šdex_¡¬t
, 

22 
num_šdiûs_to_lßd
, 
¼_ty³s_t
 
¼_ty³
, 
nodes_³r_chª
,

23 ** 
¼_node_šdiûs
, 
£gm’t_šfo_t
* 
£gm’t_šf
);

30 
	$®loc_ªd_lßd_¼_šdexed_d©a
(
£gm’t_šfo_t
* 
£gm’t_šf
,

31 
num_£gm’t
, ** 
¼_node_šdiûs
, 
nodes_³r_chª
,

32 
wœe_to_š_sw™ch
, 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
)

46 
i£g
, 
Ëngth
, 
i
, 
šdex
;

47 
num_¼_šdexed_d©a
 = 
CHANX_COST_INDEX_START
 + 2 * 
num_£gm’t
;

48 
¼_šdexed_d©a
 = (
¼_šdexed_d©a_t
*è
	`my_m®loc
(
num_¼_šdexed_d©a
 *

49 (
¼_šdexed_d©a_t
));

56 
i
 = 
SOURCE_COST_INDEX
; i <ğ
IPIN_COST_INDEX
; i++) {

57 
¼_šdexed_d©a
[
i
].
Ütho_co¡_šdex
 = 
OPEN
;

58 
¼_šdexed_d©a
[
i
].
£g_šdex
 = 
OPEN
;

59 
¼_šdexed_d©a
[
i
].
šv_Ëngth
 = 
OPEN
;

60 
¼_šdexed_d©a
[
i
].
T_lš—r
 = 
OPEN
;

61 
¼_šdexed_d©a
[
i
].
T_quad¿tic
 = 
OPEN
;

62 
¼_šdexed_d©a
[
i
].
C_lßd
 = 
OPEN
;

65 
¼_šdexed_d©a
[
IPIN_COST_INDEX
].
T_lš—r
 =

66 
sw™ch_šf
[
wœe_to_š_sw™ch
].
Td–
;

70 
i£g
 = 0; i£g < 
num_£gm’t
; iseg++) {

71 
šdex
 = 
CHANX_COST_INDEX_START
 + 
i£g
;

72 
¼_šdexed_d©a
[
šdex
].
Ütho_co¡_šdex
 = index + 
num_£gm’t
;

74 ià(
£gm’t_šf
[
i£g
].
lÚglše
) {

75 
Ëngth
 = 
num_grid_cŞumns
;

77 
Ëngth
 = 
	`mš
(
£gm’t_šf
[
i£g
].Ëngth, 
num_grid_cŞumns
);

80 
¼_šdexed_d©a
[
šdex
].
šv_Ëngth
 = 1. / 
Ëngth
;

81 
¼_šdexed_d©a
[
šdex
].
£g_šdex
 = 
i£g
;

84 
	`lßd_¼_šdexed_d©a_T_v®ues
(
CHANX_COST_INDEX_START
, 
num_£gm’t
, 
CHANX
,

85 
nodes_³r_chª
, 
¼_node_šdiûs
, 
£gm’t_šf
);

89 
i£g
 = 0; i£g < 
num_£gm’t
; iseg++) {

90 
šdex
 = 
CHANX_COST_INDEX_START
 + 
num_£gm’t
 + 
i£g
;

91 
¼_šdexed_d©a
[
šdex
].
Ütho_co¡_šdex
 = index - 
num_£gm’t
;

93 ià(
£gm’t_šf
[
i£g
].
lÚglše
) {

94 
Ëngth
 = 
num_grid_rows
;

96 
Ëngth
 = 
	`mš
(
£gm’t_šf
[
i£g
].Ëngth, 
num_grid_rows
);

99 
¼_šdexed_d©a
[
šdex
].
šv_Ëngth
 = 1. / 
Ëngth
;

100 
¼_šdexed_d©a
[
šdex
].
£g_šdex
 = 
i£g
;

103 
	`lßd_¼_šdexed_d©a_T_v®ues
(
CHANX_COST_INDEX_START
 + 
num_£gm’t
,

104 
num_£gm’t
, 
CHANY
, 
nodes_³r_chª
, 
¼_node_šdiûs
, 
£gm’t_šf
);

105 
	`lßd_¼_šdexed_d©a_ba£_co¡s
(
nodes_³r_chª
, 
¼_node_šdiûs
,

106 
rou‹r_ba£_co¡_ty³
, 
wœe_to_š_sw™ch
);

107 
	}
}

110 
	$lßd_¼_šdexed_d©a_ba£_co¡s
(
nodes_³r_chª
, **

111 
¼_node_šdiûs
, 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
,

112 
wœe_to_š_sw™ch
)

116 
d–ay_nÜm®iz©iÚ_çc
;

117 
šdex
;

119 ià(
rou‹r_ba£_co¡_ty³
 =ğ
DELAY_NORMALIZED
) {

120 
d–ay_nÜm®iz©iÚ_çc
 = 
	`g‘_d–ay_nÜm®iz©iÚ_çc
(
nodes_³r_chª
,

121 
¼_node_šdiûs
);

123 
d–ay_nÜm®iz©iÚ_çc
 = 1.;

126 ià(
rou‹r_ba£_co¡_ty³
 =ğ
DEMAND_ONLY
 ||„ou‹r_ba£_co¡_ty³ =ğ
DELAY_NORMALIZED
) {

127 
¼_šdexed_d©a
[
SOURCE_COST_INDEX
].
ba£_co¡
 = 
d–ay_nÜm®iz©iÚ_çc
;

128 
¼_šdexed_d©a
[
SINK_COST_INDEX
].
ba£_co¡
 = 0.;

129 
¼_šdexed_d©a
[
OPIN_COST_INDEX
].
ba£_co¡
 = 
d–ay_nÜm®iz©iÚ_çc
;

130 #iâdeà
SPEC


131 
¼_šdexed_d©a
[
IPIN_COST_INDEX
].
ba£_co¡
 = 0.95 * 
d–ay_nÜm®iz©iÚ_çc
;

133 
¼_šdexed_d©a
[
IPIN_COST_INDEX
].
ba£_co¡
 = 
d–ay_nÜm®iz©iÚ_çc
;

135 } ià(
rou‹r_ba£_co¡_ty³
 =ğ
INTRINSIC_DELAY
) {

136 
¼_šdexed_d©a
[
SOURCE_COST_INDEX
].
ba£_co¡
 = 0.;

137 
¼_šdexed_d©a
[
SINK_COST_INDEX
].
ba£_co¡
 = 0.;

138 
¼_šdexed_d©a
[
OPIN_COST_INDEX
].
ba£_co¡
 = 
	`g‘_av”age_İš_d–ay
(

139 
¼_node_šdiûs
, 
nodes_³r_chª
);

140 
¼_šdexed_d©a
[
IPIN_COST_INDEX
].
ba£_co¡
 =

141 
sw™ch_šf
[
wœe_to_š_sw™ch
].
Td–
;

146 
šdex
 = 
CHANX_COST_INDEX_START
; index < 
num_¼_šdexed_d©a
; index++) {

147 ià(
rou‹r_ba£_co¡_ty³
 =ğ
INTRINSIC_DELAY
)

148 
¼_šdexed_d©a
[
šdex
].
ba£_co¡
 =„r_šdexed_d©a[šdex].
T_lš—r
 +

149 
¼_šdexed_d©a
[
šdex
].
T_quad¿tic
;

154 
¼_šdexed_d©a
[
šdex
].
ba£_co¡
 = 
d–ay_nÜm®iz©iÚ_çc
;

167 
šdex
 = 0; index < 
num_¼_šdexed_d©a
; index++) {

168 
¼_šdexed_d©a
[
šdex
].
§ved_ba£_co¡
 =„r_šdexed_d©a[šdex].
ba£_co¡
;

170 
	}
}

173 
	$g‘_d–ay_nÜm®iz©iÚ_çc
(
nodes_³r_chª
, **

174 
¼_node_šdiûs
)

177 cÚ¡ 
şb_di¡
 = 3;

178 
ivex
, 
™¿ck
, 
co¡_šdex
;

179 
Td–
, 
d–ay_sum
, 
äac_num_£g
;

180 
d–ay_sum
 = 0.;

182 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

183 
ivex
 = 
	`g”r_node_t_šdex
((
num_grid_cŞumns
 + 1è/ 2, (
num_grid_rows
 + 1è/ 2, 
CHANX
, 
™¿ck
,

184 
nodes_³r_chª
, 
¼_node_šdiûs
);

185 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

186 
äac_num_£g
 = 
şb_di¡
 * 
¼_šdexed_d©a
[
co¡_šdex
].
šv_Ëngth
;

187 
Td–
 = 
äac_num_£g
 * 
¼_šdexed_d©a
[
co¡_šdex
].
T_lš—r
 +

188 
äac_num_£g
 * f¿c_num_£g * 
¼_šdexed_d©a
[
co¡_šdex
].
T_quad¿tic
;

189 
d–ay_sum
 +ğ
Td–
 / (è
şb_di¡
;

192 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

193 
ivex
 = 
	`g”r_node_t_šdex
((
num_grid_cŞumns
 + 1è/ 2, (
num_grid_rows
 + 1è/ 2, 
CHANY
, 
™¿ck
,

194 
nodes_³r_chª
, 
¼_node_šdiûs
);

195 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

196 
äac_num_£g
 = 
şb_di¡
 * 
¼_šdexed_d©a
[
co¡_šdex
].
šv_Ëngth
;

197 
Td–
 = 
äac_num_£g
 * 
¼_šdexed_d©a
[
co¡_šdex
].
T_lš—r
 +

198 
äac_num_£g
 * f¿c_num_£g * 
¼_šdexed_d©a
[
co¡_šdex
].
T_quad¿tic
;

199 
d–ay_sum
 +ğ
Td–
 / (è
şb_di¡
;

202  (
d–ay_sum
 / (2. * 
nodes_³r_chª
));

203 
	}
}

206 
	$g‘_av”age_İš_d–ay
(** 
¼_node_šdiûs
, 

207 
nodes_³r_chª
)

210 
ivex
, 
š
, 
işass
, 
›dge
, 
num_edges
, 
to_sw™ch
, 
to_node
, 
num_cÚn
;

211 
Clßd
, 
Td–
;

212 
Td–
 = 0.;

213 
num_cÚn
 = 0;

215 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++) {

216 
işass
 = 
şb_pš_şass
[
š
];

218 ià(
şass_šf
[
işass
].
ty³
 =ğ
DRIVER
) {

219 
ivex
 = 
	`g”r_node_t_šdex
((
num_grid_cŞumns
 + 1è/ 2, (
num_grid_rows
 + 1è/ 2, 
OPIN
, 
š
,

220 
nodes_³r_chª
, 
¼_node_šdiûs
);

221 
num_edges
 = 
¼_node
[
ivex
].num_edges;

223 
›dge
 = 0; iedg< 
num_edges
; iedge++) {

224 
to_node
 = 
¼_node
[
ivex
].
edges
[
›dge
];

225 
to_sw™ch
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

226 
Clßd
 = 
¼_node
[
to_node
].
C
;

227 
Td–
 +ğ
Clßd
 * 
sw™ch_šf
[
to_sw™ch
].
R
 + switch_inf[to_switch].Tdel;

228 
num_cÚn
++;

233 
Td–
 /ğ(è
num_cÚn
;

234  (
Td–
);

235 
	}
}

238 
	$lßd_¼_šdexed_d©a_T_v®ues
(
šdex_¡¬t
, 

239 
num_šdiûs_to_lßd
, 
¼_ty³s_t
 
¼_ty³
, 
nodes_³r_chª
,

240 ** 
¼_node_šdiûs
, 
£gm’t_šfo_t
* 
£gm’t_šf
)

247 
™¿ck
, 
i£g
, 
ivex
, 
co¡_šdex
, 
isw™ch
;

248 * 
C_tÙ®
, *
R_tÙ®
;

249 * 
num_nodes_of_šdex
;

250 
Rnode
, 
Cnode
, 
Rsw
, 
Tsw
;

251 
num_nodes_of_šdex
 = (*è
	`my_ÿÎoc
(
num_¼_šdexed_d©a
, ());

252 
C_tÙ®
 = (*è
	`my_ÿÎoc
(
num_¼_šdexed_d©a
, ());

253 
R_tÙ®
 = (*è
	`my_ÿÎoc
(
num_¼_šdexed_d©a
, ());

258 
™¿ck
 = 0; iŒack < 
nodes_³r_chª
; itrack++) {

259 
ivex
 = 
	`g”r_node_t_šdex
((
num_grid_cŞumns
 + 1è/ 2, (
num_grid_rows
 + 1è/ 2, 
¼_ty³
, 
™¿ck
,

260 
nodes_³r_chª
, 
¼_node_šdiûs
);

261 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

262 
num_nodes_of_šdex
[
co¡_šdex
]++;

263 
C_tÙ®
[
co¡_šdex
] +ğ
¼_node
[
ivex
].
C
;

264 
R_tÙ®
[
co¡_šdex
] +ğ
¼_node
[
ivex
].
R
;

267 
co¡_šdex
 = 
šdex_¡¬t
; co¡_šdex < index_¡¬ˆ+ 
num_šdiûs_to_lßd
;

268 
co¡_šdex
++) {

269 ià(
num_nodes_of_šdex
[
co¡_šdex
] == 0) {

270 
¼_šdexed_d©a
[
co¡_šdex
].
T_lš—r
 = 
OPEN
;

271 
¼_šdexed_d©a
[
co¡_šdex
].
T_quad¿tic
 = 
OPEN
;

272 
¼_šdexed_d©a
[
co¡_šdex
].
C_lßd
 = 
OPEN
;

274 
Rnode
 = 
R_tÙ®
[
co¡_šdex
] / 
num_nodes_of_šdex
[cost_index];

275 
Cnode
 = 
C_tÙ®
[
co¡_šdex
] / 
num_nodes_of_šdex
[cost_index];

276 
i£g
 = 
¼_šdexed_d©a
[
co¡_šdex
].
£g_šdex
;

277 
isw™ch
 = 
£gm’t_šf
[
i£g
].
wœe_sw™ch
;

278 
Rsw
 = 
sw™ch_šf
[
isw™ch
].
R
;

279 
Tsw
 = 
sw™ch_šf
[
isw™ch
].
Td–
;

281 ià(
sw™ch_šf
[
isw™ch
].
bufã»d
) {

282 
¼_šdexed_d©a
[
co¡_šdex
].
T_lš—r
 = 
Tsw
 + 
Rsw
 * 
Cnode
 + 0.5 *

283 
Rnode
 * 
Cnode
;

284 
¼_šdexed_d©a
[
co¡_šdex
].
T_quad¿tic
 = 0.;

285 
¼_šdexed_d©a
[
co¡_šdex
].
C_lßd
 = 0.;

287 
¼_šdexed_d©a
[
co¡_šdex
].
C_lßd
 = 
Cnode
;

289 
¼_šdexed_d©a
[
co¡_šdex
].
T_lš—r
 = 
Tsw
 + 0.5 * 
Rsw
 * 
Cnode
;

290 
¼_šdexed_d©a
[
co¡_šdex
].
T_quad¿tic
 = (
Rsw
 + 
Rnode
è* 0.5 * 
Cnode
;

295 
	`ä“
(
num_nodes_of_šdex
);

296 
	`ä“
(
C_tÙ®
);

297 
	`ä“
(
R_tÙ®
);

298 
	}
}

	@rr_graph_indexed_data.h

1 #iâdeà
RR_GRAPH_INDEXED_DATA_H


2 
	#RR_GRAPH_INDEXED_DATA_H


	)

4 
	~"v´_ty³s.h
"

6 
®loc_ªd_lßd_¼_šdexed_d©a
(
£gm’t_šfo_t
* 
£gm’t_šf
,

7 
num_£gm’t
, ** 
¼_node_šdiûs
,

8 
nodes_³r_chª
, 
wœe_to_š_sw™ch
,

9 
rou‹r_ba£_co¡_t
 
rou‹r_ba£_co¡_ty³
);

	@rr_graph_sbox.c

1 
	~"ut.h
"

2 
	~"v´_ty³s.h
"

3 
	~"¼_g¿ph_sbox.h
"

26 
veùÜ_t
*** 
	gsw™ch_block_cÚn
;

30 
g‘_sim¶e_sw™ch_block_Œack
(
side_ty³s_t
 
äom_side
, side_types_t

31 
to_side
, 
äom_Œack
, 
sw™ch_block_t


32 
sw™ch_block_ty³
, 
nodes_³r_chª
);

34 
side_ty³s_t
 
g‘_sbox_side
(
g‘_i
, 
g‘_j
, 
¼_ty³s_t
 
g‘_ty³
,

35 
comp_i
, 
comp_j
);

41 
	$®loc_ªd_lßd_sw™ch_block_cÚn
(
nodes_³r_chª
,

42 
sw™ch_block_t
 
sw™ch_block_ty³
)

46 
side_ty³s_t
 
äom_side
, 
to_side
;

47 
äom_Œack
, 
to_Œack
;

48 
sw™ch_block_cÚn
 = (
veùÜ_t
***è
	`®loc_m©rix3
(0, 3, 0, 3, 0,

49 
nodes_³r_chª
 - 1, (
veùÜ_t
));

51 
äom_side
 = 0; from_side <= 3; from_side++) {

52 
to_side
 = 0;o_side <= 3;o_side++) {

53 
äom_Œack
 = 0; from_Œack < 
nodes_³r_chª
; from_track++) {

54 ià(
äom_side
 !ğ
to_side
) {

55 
sw™ch_block_cÚn
[
äom_side
][
to_side
][
äom_Œack
].
ÃËm
 = 1;

56 
sw™ch_block_cÚn
[
äom_side
][
to_side
][
äom_Œack
].
li¡
 =

57 (*è
	`my_m®loc
(());

58 
to_Œack
 = 
	`g‘_sim¶e_sw™ch_block_Œack
(
äom_side
, 
to_side
,

59 
äom_Œack
, 
sw™ch_block_ty³
, 
nodes_³r_chª
);

60 
sw™ch_block_cÚn
[
äom_side
][
to_side
][
äom_Œack
].
li¡
[0] =

61 
to_Œack
;

63 
sw™ch_block_cÚn
[
äom_side
][
to_side
][
äom_Œack
].
ÃËm
 = 0;

64 
sw™ch_block_cÚn
[
äom_side
][
to_side
][
äom_Œack
].
li¡
 = 
NULL
;

69 
	}
}

72 
	$ä“_sw™ch_block_cÚn
(
nodes_³r_chª
)

75 
	`ä“_ivec_m©rix3
(
sw™ch_block_cÚn
, 0, 3, 0, 3, 0, 
nodes_³r_chª
 - 1);

76 
	}
}

79 
	#SBOX_ERROR
 -1

	)

81 
	$g‘_sim¶e_sw™ch_block_Œack
(
side_ty³s_t
 
äom_side
, side_types_t

82 
to_side
, 
äom_Œack
, 
sw™ch_block_t


83 
sw™ch_block_ty³
, 
nodes_³r_chª
)

87 
to_Œack
;

88 
to_Œack
 = 
SBOX_ERROR
;

90 ià(
sw™ch_block_ty³
 =ğ
SUBSET
) {

91 
to_Œack
 = 
äom_Œack
;

94 ià(
sw™ch_block_ty³
 =ğ
WILTON
) {

95 ià(
äom_side
 =ğ
LEFT
) {

96 ià(
to_side
 =ğ
RIGHT
) {

97 
to_Œack
 = 
äom_Œack
;

98 } ià(
to_side
 =ğ
TOP
) {

99 
to_Œack
 = (
nodes_³r_chª
 - 
äom_Œack
) %‚odes_per_chan;

100 } ià(
to_side
 =ğ
BOTTOM
) {

101 
to_Œack
 = (
nodes_³r_chª
 + 
äom_Œack
 - 1) %‚odes_per_chan;

103 } ià(
äom_side
 =ğ
RIGHT
) {

104 ià(
to_side
 =ğ
LEFT
) {

105 
to_Œack
 = 
äom_Œack
;

106 } ià(
to_side
 =ğ
TOP
) {

107 
to_Œack
 = (
nodes_³r_chª
 + 
äom_Œack
 - 1) %‚odes_per_chan;

108 } ià(
to_side
 =ğ
BOTTOM
) {

109 
to_Œack
 = (2 * 
nodes_³r_chª
 - 2 - 
äom_Œack
) %‚odes_per_chan;

111 } ià(
äom_side
 =ğ
BOTTOM
) {

112 ià(
to_side
 =ğ
TOP
) {

113 
to_Œack
 = 
äom_Œack
;

114 } ià(
to_side
 =ğ
LEFT
) {

115 
to_Œack
 = (
äom_Œack
 + 1è% 
nodes_³r_chª
;

116 } ià(
to_side
 =ğ
RIGHT
) {

117 
to_Œack
 = (2 * 
nodes_³r_chª
 - 2 - 
äom_Œack
) %‚odes_per_chan;

119 } ià(
äom_side
 =ğ
TOP
) {

120 ià(
to_side
 =ğ
BOTTOM
) {

121 
to_Œack
 = 
äom_Œack
;

122 } ià(
to_side
 =ğ
LEFT
) {

123 
to_Œack
 = (
nodes_³r_chª
 - 
äom_Œack
) %‚odes_per_chan;

124 } ià(
to_side
 =ğ
RIGHT
) {

125 
to_Œack
 = (
äom_Œack
 + 1è% 
nodes_³r_chª
;

129 ià(
sw™ch_block_ty³
 =ğ
UNIVERSAL
) {

130 ià(
äom_side
 =ğ
LEFT
) {

131 ià(
to_side
 =ğ
RIGHT
) {

132 
to_Œack
 = 
äom_Œack
;

133 } ià(
to_side
 =ğ
TOP
) {

134 
to_Œack
 = 
nodes_³r_chª
 - 1 - 
äom_Œack
;

135 } ià(
to_side
 =ğ
BOTTOM
) {

136 
to_Œack
 = 
äom_Œack
;

138 } ià(
äom_side
 =ğ
RIGHT
) {

139 ià(
to_side
 =ğ
LEFT
) {

140 
to_Œack
 = 
äom_Œack
;

141 } ià(
to_side
 =ğ
TOP
) {

142 
to_Œack
 = 
äom_Œack
;

143 } ià(
to_side
 =ğ
BOTTOM
) {

144 
to_Œack
 = 
nodes_³r_chª
 - 1 - 
äom_Œack
;

146 } ià(
äom_side
 =ğ
BOTTOM
) {

147 ià(
to_side
 =ğ
TOP
) {

148 
to_Œack
 = 
äom_Œack
;

149 } ià(
to_side
 =ğ
LEFT
) {

150 
to_Œack
 = 
äom_Œack
;

151 } ià(
to_side
 =ğ
RIGHT
) {

152 
to_Œack
 = 
nodes_³r_chª
 - 1 - 
äom_Œack
;

154 } ià(
äom_side
 =ğ
TOP
) {

155 ià(
to_side
 =ğ
BOTTOM
) {

156 
to_Œack
 = 
äom_Œack
;

157 } ià(
to_side
 =ğ
LEFT
) {

158 
to_Œack
 = 
nodes_³r_chª
 - 1 - 
äom_Œack
;

159 } ià(
to_side
 =ğ
RIGHT
) {

160 
to_Œack
 = 
äom_Œack
;

165 ià(
to_Œack
 =ğ
SBOX_ERROR
) {

166 
	`´štf
("Error in get_simple_switch_block_track. Unexpected connection.\n"

167 "äom_side: %do_side: %d sw™ch_block_ty³: %d.\n", 
äom_side
,

168 
to_side
, 
sw™ch_block_ty³
);

169 
	`ex™
(1);

172  (
to_Œack
);

173 
	}
}

176 
veùÜ_t
 
	$g‘_sw™ch_box_Œacks
(
äom_i
, 
äom_j
, 
äom_Œack
,

177 
¼_ty³s_t
 
äom_ty³
, 
to_i
, 
to_j
,„r_ty³s_ˆ
to_ty³
,

178 
sw™ch_block_t
 
sw™ch_block_ty³
, 
nodes_³r_chª
) {

183 
side_ty³s_t
 
äom_side
, 
to_side
;

185 
äom_side
 = 
	`g‘_sbox_side
(
äom_i
, 
äom_j
, 
äom_ty³
, 
to_i
, 
to_j
);

186 
to_side
 = 
	`g‘_sbox_side
(
to_i
, 
to_j
, 
to_ty³
, 
äom_i
, 
äom_j
);

188  (
sw™ch_block_cÚn
[
äom_side
][
to_side
][
äom_Œack
]);

189 
	}
}

192 
side_ty³s_t
 
	$g‘_sbox_side
(
g‘_i
, 
g‘_j
, 
¼_ty³s_t
 
g‘_ty³
,

193 
comp_i
, 
comp_j
)

197 
side_ty³s_t
 
side
;

199 ià(
g‘_ty³
 =ğ
CHANX
) {

200 ià(
g‘_i
 > 
comp_i
) {

201 
side
 = 
RIGHT
;

203 
side
 = 
LEFT
;

205 } ià(
g‘_ty³
 =ğ
CHANY
) {

206 ià(
g‘_j
 > 
comp_j
) {

207 
side
 = 
TOP
;

209 
side
 = 
BOTTOM
;

212 
	`´štf
("E¼Ü iÀg‘_sbox_side. UÃx³ùed g‘_ty³: %d.\n", 
g‘_ty³
);

213 
	`ex™
(1);

216  (
side
);

217 
	}
}

	@rr_graph_sbox.h

1 #iâdeà
RR_GRAPH_SBOX_H


2 
	#RR_GRAPH_SBOX_H


	)

4 
	~"v´_ty³s.h
"

6 
veùÜ_t
 
g‘_sw™ch_box_Œacks
(
äom_i
, 
äom_j
, 
äom_Œack
,

7 
¼_ty³s_t
 
äom_ty³
,

8 
to_i
, 
to_j
, 
¼_ty³s_t
 
to_ty³
,

9 
sw™ch_block_t
 
sw™ch_block_ty³
,

10 
nodes_³r_chª
);

12 
ä“_sw™ch_block_cÚn
(
nodes_³r_chª
);

14 
®loc_ªd_lßd_sw™ch_block_cÚn
(
nodes_³r_chª
,

15 
sw™ch_block_t
 
sw™ch_block_ty³
);

	@rr_graph_timing_params.c

1 
	~"ut.h
"

2 
	~"v´_ty³s.h
"

3 
	~"glob®s.h
"

4 
	~"¼_g¿ph.h
"

5 
	~"¼_g¿ph_ut.h
"

6 
	~"¼_g¿ph2.h
"

7 
	~"¼_g¿ph_timšg_·¿ms.h
"

14 
	$add_¼_g¿ph_C_äom_sw™ches
(
C_š_cblock
)

27 
ivex
, 
›dge
, 
sw™ch_šdex
, 
to_node
, 
maxËn
;

28 
icblock
, 
isblock
, 
i£g_low
, 
i£g_high
;

29 
Cš
, 
Cout
;

30 
¼_ty³s_t
 
äom_¼_ty³
, 
to_¼_ty³
;

31 
boŞ—n
* 
cblock_couÁed
;

32 * 
bufãr_Cš
;

33 
boŞ—n
 
bufã»d
;

34 
maxËn
 = 
	`max
(
num_grid_cŞumns
, 
num_grid_rows
) + 1;

35 
cblock_couÁed
 = (
boŞ—n
*è
	`my_ÿÎoc
(
maxËn
, (boolean));

36 
bufãr_Cš
 = (*è
	`my_ÿÎoc
(
maxËn
, ());

38 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

39 
äom_¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

41 ià(
äom_¼_ty³
 =ğ
CHANX
 || from_¼_ty³ =ğ
CHANY
) {

42 
›dge
 = 0; iedg< 
¼_node
[
ivex
].
num_edges
; iedge++) {

43 
to_node
 = 
¼_node
[
ivex
].
edges
[
›dge
];

44 
to_¼_ty³
 = 
¼_node
[
to_node
].
ty³
;

46 ià(
to_¼_ty³
 =ğ
CHANX
 ||o_¼_ty³ =ğ
CHANY
) {

47 
sw™ch_šdex
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

48 
Cš
 = 
sw™ch_šf
[
sw™ch_šdex
].Cin;

49 
Cout
 = 
sw™ch_šf
[
sw™ch_šdex
].Cout;

50 
bufã»d
 = 
sw™ch_šf
[
sw™ch_šdex
].buffered;

69 ià(!
bufã»d
 && 
ivex
 < 
to_node
) {

70 
¼_node
[
ivex
].
C
 +ğ
Cš
;

71 
¼_node
[
to_node
].
C
 +ğ
Cout
;

72 } ià(
bufã»d
) {

73 
¼_node
[
to_node
].
C
 +ğ
Cout
;

74 
isblock
 = 
	`£g_šdex_of_sblock
(
ivex
, 
to_node
);

75 
bufãr_Cš
[
isblock
] = 
	`max
(bufãr_Cš[isblock], 
Cš
);

78 ià(
to_¼_ty³
 =ğ
IPIN
) {

83 
icblock
 = 
	`£g_šdex_of_cblock
(
äom_¼_ty³
, 
to_node
);

85 ià(
cblock_couÁed
[
icblock
] =ğ
FALSE
) {

86 
¼_node
[
ivex
].
C
 +ğ
C_š_cblock
;

87 
cblock_couÁed
[
icblock
] = 
TRUE
;

105 ià(
äom_¼_ty³
 =ğ
CHANX
) {

106 
i£g_low
 = 
¼_node
[
ivex
].
xlow
;

107 
i£g_high
 = 
¼_node
[
ivex
].
xhigh
;

109 
i£g_low
 = 
¼_node
[
ivex
].
ylow
;

110 
i£g_high
 = 
¼_node
[
ivex
].
yhigh
;

113 
icblock
 = 
i£g_low
; icblock <ğ
i£g_high
; icblock++) {

114 
cblock_couÁed
[
icblock
] = 
FALSE
;

117 
isblock
 = 
i£g_low
 - 1; isblock <ğ
i£g_high
; isblock++) {

118 
¼_node
[
ivex
].
C
 +ğ
bufãr_Cš
[
isblock
];

119 
bufãr_Cš
[
isblock
] = 0.;

122 ià(
äom_¼_ty³
 =ğ
OPIN
) {

123 
›dge
 = 0; iedg< 
¼_node
[
ivex
].
num_edges
; iedge++) {

124 
sw™ch_šdex
 = 
¼_node
[
ivex
].
sw™ches
[
›dge
];

125 
Cout
 = 
sw™ch_šf
[
sw™ch_šdex
].Cout;

126 
to_node
 = 
¼_node
[
ivex
].
edges
[
›dge
];

127 
¼_node
[
to_node
].
C
 +ğ
Cout
;

132 
	`ä“
(
cblock_couÁed
);

133 
	`ä“
(
bufãr_Cš
);

134 
	}
}

	@rr_graph_timing_params.h

1 #iâdeà
RR_GRAPH_TIMING_PARAMS


2 
	#RR_GRAPH_TIMING_PARAMS


	)

4 
add_¼_g¿ph_C_äom_sw™ches
(
C_š_cblock
);

	@rr_graph_util.c

1 
	~"ut.h
"

2 
	~"v´_ty³s.h
"

3 
	~"glob®s.h
"

4 
	~"¼_g¿ph_ut.h
"

10 
t_lšked_edge
* 
	$š£¹_š_edge_li¡
(
t_lšked_edge
* 
h—d
, 
edge
, 
isw™ch
,

11 
t_lšked_edge
** 
ä“_li¡_h—d_±r
)

13 
t_lšked_edge
* 
lšked_edge
;

15 ià(*
ä“_li¡_h—d_±r
 !ğ
NULL
) {

16 
lšked_edge
 = *
ä“_li¡_h—d_±r
;

17 *
ä“_li¡_h—d_±r
 = 
lšked_edge
->
Ãxt
;

19 
lšked_edge
 = (
t_lšked_edge
*)
	`my_m®loc
((t_linked_edge));

22 
lšked_edge
->
edge
 =ƒdge;

23 
lšked_edge
->
isw™ch
 = iswitch;

24 
lšked_edge
->
Ãxt
 = 
h—d
;

25  (
lšked_edge
);

26 
	}
}

29 
	$ä“_edge_li¡_h¬d
(
t_lšked_edge
** 
edge_li¡_h—d_±r
)

33 
t_lšked_edge
* 
lšked_edge
, *
Ãxt_lšked_edge
;

34 
lšked_edge
 = *
edge_li¡_h—d_±r
;

36 
lšked_edge
 !ğ
NULL
) {

37 
Ãxt_lšked_edge
 = 
lšked_edge
->
Ãxt
;

38 
	`ä“
(
lšked_edge
);

39 
lšked_edge
 = 
Ãxt_lšked_edge
;

42 *
edge_li¡_h—d_±r
 = 
NULL
;

43 
	}
}

46 
	$ä“_lšked_edge_soá
(
t_lšked_edge
* 
edge_±r
,_linked_edge

47 ** 
ä“_li¡_h—d_±r
)

52 
edge_±r
->
Ãxt
 = *
ä“_li¡_h—d_±r
;

53 *
ä“_li¡_h—d_±r
 = 
edge_±r
;

54 
	}
}

57 
	$£g_šdex_of_cblock
(
¼_ty³s_t
 
äom_¼_ty³
, 
to_node
)

61 ià(
äom_¼_ty³
 =ğ
CHANX
) {

62  (
¼_node
[
to_node
].
xlow
);

64  (
¼_node
[
to_node
].
ylow
);

66 
	}
}

69 
	$£g_šdex_of_sblock
(
äom_node
, 
to_node
)

77 
¼_ty³s_t
 
äom_¼_ty³
, 
to_¼_ty³
;

78 
äom_¼_ty³
 = 
¼_node
[
äom_node
].
ty³
;

79 
to_¼_ty³
 = 
¼_node
[
to_node
].
ty³
;

81 ià(
äom_¼_ty³
 =ğ
CHANX
) {

82 ià(
to_¼_ty³
 =ğ
CHANY
) {

83  (
¼_node
[
to_node
].
xlow
);

84 } ià(
to_¼_ty³
 =ğ
CHANX
) {

85 ià(
¼_node
[
to_node
].
xlow
 >„r_node[
äom_node
].xlow) {

86  (
¼_node
[
äom_node
].
xhigh
);

88  (
¼_node
[
to_node
].
xhigh
);

91 
	`´štf
("Error in seg_index_of_sblock:o_node %d is ofype %d.\n",

92 
to_node
, 
to_¼_ty³
);

93 
	`ex™
(1);

96 ià(
äom_¼_ty³
 =ğ
CHANY
) {

97 ià(
to_¼_ty³
 =ğ
CHANX
) {

98  (
¼_node
[
to_node
].
ylow
);

99 } ià(
to_¼_ty³
 =ğ
CHANY
) {

100 ià(
¼_node
[
to_node
].
ylow
 >„r_node[
äom_node
].ylow) {

101  (
¼_node
[
äom_node
].
yhigh
);

103  (
¼_node
[
to_node
].
yhigh
);

106 
	`´štf
("Error in seg_index_of_sblock:o_node %d is ofype %d.\n",

107 
to_node
, 
to_¼_ty³
);

108 
	`ex™
(1);

112 
	`´štf
("Error in seg_index_of_sblock: from_node %d is ofype %d.\n",

113 
äom_node
, 
äom_¼_ty³
);

114 
	`ex™
(1);

116 
	}
}

	@rr_graph_util.h

1 #iâdeà
RR_GRAPH_UTIL_INCLUDED


2 
	#RR_GRAPH_UTIL_INCLUDED
 1

	)

4 
	~"v´_ty³s.h
"

6 
	ss_lšked_edge
 {

7 
	medge
;

8 
	misw™ch
;

9 
s_lšked_edge
* 
	mÃxt
;

11 
s_lšked_edge
 
	tt_lšked_edge
;

14 
t_lšked_edge
* 
š£¹_š_edge_li¡
Ñ_lšked_edge* 
h—d
, 
edge
, 

15 
isw™ch
, 
t_lšked_edge
** 
ä“_li¡_h—d_±r
);

17 
ä“_edge_li¡_h¬d
(
t_lšked_edge
** 
edge_li¡_h—d_±r
);

19 
ä“_lšked_edge_soá
(
t_lšked_edge
* 
edge_±r
,_linked_edge

20 ** 
ä“_li¡_h—d_±r
);

22 
£g_šdex_of_cblock
(
¼_ty³s_t
 
äom_¼_ty³
, 
to_node
);

24 
£g_šdex_of_sblock
(
äom_node
, 
to_node
);

	@segment_stats.c

1 
	~<¡dio.h
>

2 
	~"ut.h
"

3 
	~"v´_ty³s.h
"

4 
	~"glob®s.h
"

5 
	~"£gm’t_¡©s.h
"

10 
	#LONGLINE
 0

	)

17 
	$g‘_£gm’t_u§ge_¡©s
(
num_£gm’t
, 
£gm’t_šfo_t
* 
£gm’t_šf
)

24 
ivex
, 
Ëngth
, 
£g_ty³
, 
max_£gm’t_Ëngth
, 
co¡_šdex
;

25 * 
£g_occ_by_Ëngth
, *
£g_ÿp_by_Ëngth
;

26 * 
£g_occ_by_ty³
, *
£g_ÿp_by_ty³
;

27 
utiz©iÚ
;

28 
max_£gm’t_Ëngth
 = 0;

30 
£g_ty³
 = 0; seg_ty³ < 
num_£gm’t
; seg_type++) {

31 ià(
£gm’t_šf
[
£g_ty³
].
lÚglše
 =ğ
FALSE
)

32 
max_£gm’t_Ëngth
 = 
	`max
(max_segment_length,

33 
£gm’t_šf
[
£g_ty³
].
Ëngth
);

36 
£g_occ_by_Ëngth
 = (*è
	`my_ÿÎoc
((
max_£gm’t_Ëngth
 + 1),

38 
£g_ÿp_by_Ëngth
 = (*è
	`my_ÿÎoc
((
max_£gm’t_Ëngth
 + 1),

40 
£g_occ_by_ty³
 = (*è
	`my_ÿÎoc
(
num_£gm’t
, ());

41 
£g_ÿp_by_ty³
 = (*è
	`my_ÿÎoc
(
num_£gm’t
, ());

43 
ivex
 = 0; ivex < 
num_¼_nodes
; ivex++) {

44 ià(
¼_node
[
ivex
].
ty³
 =ğ
CHANX
 ||„r_node[ivex].ty³ =ğ
CHANY
) {

45 
co¡_šdex
 = 
¼_node
[
ivex
].cost_index;

46 
£g_ty³
 = 
¼_šdexed_d©a
[
co¡_šdex
].
£g_šdex
;

48 ià(!
£gm’t_šf
[
£g_ty³
].
lÚglše
) {

49 
Ëngth
 = 
£gm’t_šf
[
£g_ty³
].length;

51 
Ëngth
 = 
LONGLINE
;

54 
£g_occ_by_Ëngth
[
Ëngth
] +ğ
¼_node
[
ivex
].
m_u§ge
;

55 
£g_ÿp_by_Ëngth
[
Ëngth
] +ğ
¼_node
[
ivex
].
ÿ·c™y
;

56 
£g_occ_by_ty³
[
£g_ty³
] +ğ
¼_node
[
ivex
].
m_u§ge
;

57 
£g_ÿp_by_ty³
[
£g_ty³
] +ğ
¼_node
[
ivex
].
ÿ·c™y
;

61 
	`´štf
("\nSegment usage byype (index):\n");

62 
	`´štf
("Segmentype Fractional utilization\n");

63 
	`´štf
("------------ ----------------------\n");

65 
£g_ty³
 = 0; seg_ty³ < 
num_£gm’t
; seg_type++) {

66 ià(
£g_ÿp_by_ty³
[
£g_ty³
] != 0) {

67 
utiz©iÚ
 = (è
£g_occ_by_ty³
[
£g_ty³
] /

68 (è
£g_ÿp_by_ty³
[
£g_ty³
];

69 
	`´štf
("%8d %5.3g\n", 
£g_ty³
, 
utiz©iÚ
);

73 
	`´štf
("\nSegment usage by†ength:\n");

74 
	`´štf
("Segment†ength Fractional utilization\n");

75 
	`´štf
("-------------- ----------------------\n");

77 
Ëngth
 = 1;†’gth <ğ
max_£gm’t_Ëngth
;†ength++) {

78 ià(
£g_ÿp_by_Ëngth
[
Ëngth
] != 0) {

79 
utiz©iÚ
 = (è
£g_occ_by_Ëngth
[
Ëngth
] /

80 (è
£g_ÿp_by_Ëngth
[
Ëngth
];

81 
	`´štf
("%9d %5.3g\n", 
Ëngth
, 
utiz©iÚ
);

85 ià(
£g_ÿp_by_Ëngth
[
LONGLINE
] != 0) {

86 
utiz©iÚ
 = (è
£g_occ_by_Ëngth
[
LONGLINE
] /

87 (è
£g_ÿp_by_Ëngth
[
LONGLINE
];

88 
	`´štf
("†Úglš %5.3g\n", 
utiz©iÚ
);

91 
	`ä“
(
£g_occ_by_Ëngth
);

92 
	`ä“
(
£g_ÿp_by_Ëngth
);

93 
	`ä“
(
£g_occ_by_ty³
);

94 
	`ä“
(
£g_ÿp_by_ty³
);

95 
	}
}

	@segment_stats.h

1 #iâdeà
SEGMENT_STATS_H


2 
	#SEGMENT_STATS_H


	)

4 
	~"v´_ty³s.h
"

6 
g‘_£gm’t_u§ge_¡©s
(
num_£gm’t
, 
£gm’t_šfo_t
* 
£gm’t_šf
);

	@stats.c

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

3 
	~"ut.h
"

4 
	~"v´_ty³s.h
"

5 
	~"glob®s.h
"

6 
	~"¼_g¿ph_¬—.h
"

7 
	~"£gm’t_¡©s.h
"

8 
	~"¡©s.h
"

9 
	~"Ãt_d–ay.h
"

10 
	~"·th_d–ay.h
"

15 
lßd_chªÃl_occu·nc›s
(** 
chªx_occ
, ** 
chªy_occ
);

17 
g‘_num_b’ds_ªd_Ëngth
(
š‘
, * 
b’ds
, * 
Ëngth
, 

18 *
£gm’ts
);

20 
g‘_Ëngth_ªd_b’ds_¡©s
();

22 
gechªÃl_Š–_occu·ncy_¡©s
();

29 
	$routšg_¡©s
(
boŞ—n
 
fuÎ_¡©s
, 
rou‹r_ty³s_t
 
rou‹_ty³
,

30 
num_sw™ch
, 
£gm’t_šfo_t
* 
£gm’t_šf
, 
num_£gm’t
,

31 
R_mšW_nmos
, 
R_mšW_pmos
, 
boŞ—n
 
timšg_ª®ysis_’abËd
,

32 ** 
Ãt_¦ack
, ** 
Ãt_d–ay
)

36 
T_ü™
;

37 
	`g‘_Ëngth_ªd_b’ds_¡©s
();

38 
	`gechªÃl_Š–_occu·ncy_¡©s
();

40 ià(
rou‹_ty³
 =ğ
DETAILED
) {

41 
	`couÁ_routšg_Œªsi¡Üs
(
num_sw™ch
, 
R_mšW_nmos
, 
R_mšW_pmos
);

42 
	`g‘_£gm’t_u§ge_¡©s
(
num_£gm’t
, 
£gm’t_šf
);

44 ià(
timšg_ª®ysis_’abËd
) {

45 
	`lßd_Ãt_d–ay_äom_routšg
(
Ãt_d–ay
);

46 #ifdeà
PRINT_NET_DELAYS


47 
	`´št_Ãt_d–ay
(
Ãt_d–ay
, "net_delay.echo");

49 
	`lßd_timšg_g¿ph_Ãt_d–ays
(
Ãt_d–ay
);

50 
T_ü™
 = 
	`ÿlc_®l_v”‹xs_¬r_»q_time
(0);

51 
	`compu‹_Ãt_¦acks
(
Ãt_¦ack
);

53 #ifdeà
PRINT_TIMING_GRAPH


54 
	`´št_timšg_g¿ph
("timing_graph.echo");

56 #ifdeà
PRINT_NET_SLACKS


57 
	`´št_Ãt_¦ack
("Ãt_¦ack.echo", 
Ãt_¦ack
);

59 
	`´štf
("\n");

60 
	`´št_ü™iÿl_·th
("critical_path.echo");

61 
	`´štf
("Cr™iÿÈP©h: %g (s)\n", 
T_ü™
);

65 ià(
fuÎ_¡©s
 =ğ
TRUE
) {

66 
	`´št_wœ–’_´ob_di¡
();

68 
	}
}

71 
	$g‘_Ëngth_ªd_b’ds_¡©s
()

75 
š‘
, 
b’ds
, 
tÙ®_b’ds
, 
max_b’ds
;

76 
Ëngth
, 
tÙ®_Ëngth
, 
max_Ëngth
;

77 
£gm’ts
, 
tÙ®_£gm’ts
, 
max_£gm’ts
;

78 
av_b’ds
, 
av_Ëngth
, 
av_£gm’ts
;

79 
max_b’ds
 = 0;

80 
tÙ®_b’ds
 = 0;

81 
max_Ëngth
 = 0;

82 
tÙ®_Ëngth
 = 0;

83 
max_£gm’ts
 = 0;

84 
tÙ®_£gm’ts
 = 0;

86 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

87 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

88 
	`g‘_num_b’ds_ªd_Ëngth
(
š‘
, &
b’ds
, &
Ëngth
, &
£gm’ts
);

89 
tÙ®_b’ds
 +ğ
b’ds
;

90 
max_b’ds
 = 
	`max
(
b’ds
, max_bends);

91 
tÙ®_Ëngth
 +ğ
Ëngth
;

92 
max_Ëngth
 = 
	`max
(
Ëngth
, max_length);

93 
tÙ®_£gm’ts
 +ğ
£gm’ts
;

94 
max_£gm’ts
 = 
	`max
(
£gm’ts
, max_segments);

98 
av_b’ds
 = (è
tÙ®_b’ds
 / ()(
num_Ãts
 - 
num_glob®s
);

99 
	`´štf
("\nAverage‚umber of bends…er‚et: %#g Maximum # of bends: %d\n\n",

100 
av_b’ds
, 
max_b’ds
);

101 
av_Ëngth
 = (è
tÙ®_Ëngth
 / ()(
num_Ãts
 - 
num_glob®s
);

102 
	`´štf
("Wirelength„esults (all in units of 1 clb segments):\n");

103 
	`´štf
("\tTÙ® wœ–’gth: %d Av”agÃˆËngth: %#g\n", 
tÙ®_Ëngth
,

104 
av_Ëngth
);

105 
	`´štf
("\tMaximum‚‘†’gth: %d\n\n", 
max_Ëngth
);

106 
av_£gm’ts
 = (è
tÙ®_£gm’ts
 / ()(
num_Ãts
 - 
num_glob®s
);

107 
	`´štf
("Wirelength„esults inerms of…hysical segments:\n");

108 
	`´štf
("\tTotal wiring segments used: %d Av. wire segments…er‚et: "

109 "%#g\n", 
tÙ®_£gm’ts
, 
av_£gm’ts
);

110 
	`´štf
("\tMaximum segm’t u£d by‡‚‘: %d\n\n", 
max_£gm’ts
);

111 
	}
}

114 
	$gechªÃl_Š–_occu·ncy_¡©s
()

117 
i
, 
j
, 
max_occ
, 
tÙ®_x
, 
tÙ®_y
;

118 
av_occ
;

119 ** 
chªx_occ
;

120 ** 
chªy_occ
;

121 
chªx_occ
 = (**è
	`®loc_m©rix
(1, 
num_grid_cŞumns
, 0, 
num_grid_rows
, ());

122 
chªy_occ
 = (**è
	`®loc_m©rix
(0, 
num_grid_cŞumns
, 1, 
num_grid_rows
, ());

123 
	`lßd_chªÃl_occu·nc›s
(
chªx_occ
, 
chªy_occ
);

124 
	`´štf
("\nX - Directed channels:\n\n");

125 
	`´štf
("j\tmax m_usage\tav_occ\t\tcapacity\n");

126 
tÙ®_x
 = 0;

128 
j
 = 0; j <ğ
num_grid_rows
; j++) {

129 
tÙ®_x
 +ğ
chª_width_x
[
j
];

130 
av_occ
 = 0.;

131 
max_occ
 = -1;

133 
i
 = 1; i <ğ
num_grid_cŞumns
; i++) {

134 
max_occ
 = 
	`max
(
chªx_occ
[
i
][
j
], max_occ);

135 
av_occ
 +ğ
chªx_occ
[
i
][
j
];

138 
av_occ
 /ğ
num_grid_cŞumns
;

139 
	`´štf
("%d\t%d\t%-#9g\t%d\n", 
j
, 
max_occ
, 
av_occ
, 
chª_width_x
[j]);

142 
	`´štf
("\nY - Directed channels:\n\n");

143 
	`´štf
("i\tmax m_usage\tav_occ\t\tcapacity\n");

144 
tÙ®_y
 = 0;

146 
i
 = 0; i <ğ
num_grid_cŞumns
; i++) {

147 
tÙ®_y
 +ğ
chª_width_y
[
i
];

148 
av_occ
 = 0.;

149 
max_occ
 = -1;

151 
j
 = 1; j <ğ
num_grid_rows
; j++) {

152 
max_occ
 = 
	`max
(
chªy_occ
[
i
][
j
], max_occ);

153 
av_occ
 +ğ
chªy_occ
[
i
][
j
];

156 
av_occ
 /ğ
num_grid_rows
;

157 
	`´štf
("%d\t%d\t%-#9g\t%d\n", 
i
, 
max_occ
, 
av_occ
, 
chª_width_y
[i]);

160 
	`´štf
("\nTotal Tracks in X-direction: %d in Y-direction: %d\n\n",

161 
tÙ®_x
, 
tÙ®_y
);

162 
	`ä“_m©rix
(
chªx_occ
, 1, 
num_grid_cŞumns
, 0, ());

163 
	`ä“_m©rix
(
chªy_occ
, 0, 
num_grid_cŞumns
, 1, ());

164 
	}
}

167 
	$lßd_chªÃl_occu·nc›s
(** 
chªx_occ
, ** 
chªy_occ
)

171 
i
, 
j
, 
ivex
, 
š‘
;

172 
s_Œaû
* 
Œ
;

173 
¼_ty³s_t
 
¼_ty³
;

177 
i
 = 1; i <ğ
num_grid_cŞumns
; i++)

178 
j
 = 0; j <ğ
num_grid_rows
; j++) {

179 
chªx_occ
[
i
][
j
] = 0;

182 
i
 = 0; i <ğ
num_grid_cŞumns
; i++)

183 
j
 = 1; j <ğ
num_grid_rows
; j++) {

184 
chªy_occ
[
i
][
j
] = 0;

189 
š‘
 = 0; iÃˆ< 
num_Ãts
; inet++) {

190 ià(
is_glob®
[
š‘
]) {

194 
Œ
 = 
Œaû_h—d
[
š‘
];

196 
Œ
 !ğ
NULL
) {

197 
ivex
 = 
Œ
->
šdex
;

198 
¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

200 ià(
¼_ty³
 =ğ
SINK
) {

201 
Œ
 =±r->
Ãxt
;

203 ià(
Œ
 =ğ
NULL
) {

206 } ià(
¼_ty³
 =ğ
CHANX
) {

207 
j
 = 
¼_node
[
ivex
].
ylow
;

209 
i
 = 
¼_node
[
ivex
].
xlow
; i <ğ¼_node[ivex].
xhigh
; i++) {

210 
chªx_occ
[
i
][
j
]++;

212 } ià(
¼_ty³
 =ğ
CHANY
) {

213 
i
 = 
¼_node
[
ivex
].
xlow
;

215 
j
 = 
¼_node
[
ivex
].
ylow
; j <ğ¼_node[ivex].
yhigh
; j++) {

216 
chªy_occ
[
i
][
j
]++;

220 
Œ
 =±r->
Ãxt
;

223 
	}
}

226 
	$g‘_num_b’ds_ªd_Ëngth
(
š‘
, * 
b’ds_±r
, * 
Ën_±r
,

227 * 
£gm’ts_±r
)

231 
s_Œaû
* 
Œ
, *
´ev±r
;

232 
ivex
;

233 
¼_ty³s_t
 
cu¼_ty³
, 
´ev_ty³
;

234 
b’ds
, 
Ëngth
, 
£gm’ts
;

235 
b’ds
 = 0;

236 
Ëngth
 = 0;

237 
£gm’ts
 = 0;

238 
´ev±r
 = 
Œaû_h—d
[
š‘
];

240 ià(
´ev±r
 =ğ
NULL
) {

241 
	`´štf
("Error in get_num_bends_and_length:‚et #%d has‚oraceback.\n",

242 
š‘
);

243 
	`ex™
(1);

246 
ivex
 = 
´ev±r
->
šdex
;

247 
´ev_ty³
 = 
¼_node
[
ivex
].
ty³
;

248 
Œ
 = 
´ev±r
->
Ãxt
;

250 
Œ
 !ğ
NULL
) {

251 
ivex
 = 
Œ
->
šdex
;

252 
cu¼_ty³
 = 
¼_node
[
ivex
].
ty³
;

254 ià(
cu¼_ty³
 =ğ
SINK
) {

255 
Œ
 =±r->
Ãxt
;

257 ià(
Œ
 =ğ
NULL
) {

261 
cu¼_ty³
 = 
¼_node
[
Œ
->
šdex
].
ty³
;

262 } ià(
cu¼_ty³
 =ğ
CHANX
 || cu¼_ty³ =ğ
CHANY
) {

263 
£gm’ts
++;

264 
Ëngth
 +ğ1 + 
¼_node
[
ivex
].
xhigh
 -„r_node[ivex].
xlow
 +

265 
¼_node
[
ivex
].
yhigh
 -„r_node[ivex].
ylow
;

267 ià(
cu¼_ty³
 !ğ
´ev_ty³
 && (´ev_ty³ =ğ
CHANX
 ||…rev_type ==

268 
CHANY
)) {

269 
b’ds
++;

273 
´ev_ty³
 = 
cu¼_ty³
;

274 
Œ
 =±r->
Ãxt
;

277 *
b’ds_±r
 = 
b’ds
;

278 *
Ën_±r
 = 
Ëngth
;

279 *
£gm’ts_±r
 = 
£gm’ts
;

280 
	}
}

283 
	$´št_wœ–’_´ob_di¡
()

288 * 
´ob_di¡
;

289 
nÜm_çc
, 
two_pošt_Ëngth
;

290 
š‘
, 
b’ds
, 
Ëngth
, 
£gm’ts
, 
šdex
;

291 
av_Ëngth
;

292 
´ob_di¡
 = (*è
	`my_ÿÎoc
(
num_grid_cŞumns
 + 
num_grid_rows
 + 3, ());

293 
nÜm_çc
 = 0.;

295 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

296 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

297 
	`g‘_num_b’ds_ªd_Ëngth
(
š‘
, &
b’ds
, &
Ëngth
, &
£gm’ts
);

301 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

302 
two_pošt_Ëngth
 = (è
Ëngth
 / ()(
knum_Ãt_pšs
 - 1);

303 
šdex
 = (è
two_pošt_Ëngth
;

304 
´ob_di¡
[
šdex
] +ğ(
knum_Ãt_pšs
 - 1.0è* (1 - 
two_pošt_Ëngth


305 + 
šdex
);

306 
šdex
++;

307 
´ob_di¡
[
šdex
] +ğ(
knum_Ãt_pšs
 - 1.0) * (1 - index +

308 
two_pošt_Ëngth
);

309 
nÜm_çc
 +ğ
knum_Ãt_pšs
 - 1.0;

314 
	`´štf
("\nProbability distribution of 2-pin‚et†engths:\n\n");

315 
	`´štf
("Length…(Lenth)\n");

316 
av_Ëngth
 = 0;

318 
šdex
 = 0; index < 
num_grid_cŞumns
 + 
num_grid_rows
 + 3; index++) {

319 
´ob_di¡
[
šdex
] /ğ
nÜm_çc
;

320 
	`´štf
("%6d %10.6f\n", 
šdex
, 
´ob_di¡
[index]);

321 
av_Ëngth
 +ğ
´ob_di¡
[
šdex
] * index;

324 
	`´štf
("\nExpected value of 2-pin‚et†ength (R) is: %g\n",

325 
av_Ëngth
);

326 
	`ä“
((*è
´ob_di¡
);

327 
	}
}

330 
	$´št_Ïmbda
()

335 
block_num
, 
š
;

336 
num_šputs_u£d
 = 0;

337 
işass
, 
š‘
;

338 
Ïmbda
;

340 
block_num
 = 0; block_num < 
num_blocks
; ++block_num) {

341 ià(
blocks
[
block_num
].
block_ty³
 =ğ
B_CLB_TYPE
) {

342 
š
 = 0; ipš < 
max_pšs_³r_şb
; ipin++) {

343 
işass
 = 
şb_pš_şass
[
š
];

345 ià(
şass_šf
[
işass
].
ty³
 =ğ
RECEIVER
) {

346 
š‘
 = 
blocks
[
block_num
].
Ãts
[
š
];

348 ià(
š‘
 !ğ
OPEN
)

349 ià(
is_glob®
[
š‘
] =ğ
FALSE
) {

350 
num_šputs_u£d
++;

357 
Ïmbda
 = (è
num_šputs_u£d
 / (è
num_şbs
;

358 
	`´štf
("Av”agÏmbd¨(špuˆpš u£d…” clbèis: %g\n", 
Ïmbda
);

359 
	}
}

	@stats.h

1 #iâdeà
STATS_H


2 
	#STATS_H


	)

4 
	~"v´_ty³s.h
"

6 
routšg_¡©s
(
boŞ—n
 
fuÎ_¡©s
, 
rou‹r_ty³s_t
 
rou‹_ty³
,

7 
num_sw™ch
, 
£gm’t_šfo_t
* 
£gm’t_šf
, 
num_£gm’t
,

8 
R_mšW_nmos
, 
R_mšW_pmos
, 
boŞ—n
 
timšg_ª®ysis_’abËd
,

9 ** 
Ãt_¦ack
, ** 
Ãt_d–ay
);

11 
´št_wœ–’_´ob_di¡
();

13 
´št_Ïmbda
();

	@test_h.c

6 
	~"ut.h
"

7 
	~"v´_ty³s.h
"

8 
	~"glob®s.h
"

9 
	~"check_rou‹.h
"

10 
	~"d¿w.h
"

11 
	~"g¿phics.h
"

12 
	~"hash.h
"

13 
	~"h—psÜt.h
"

14 
	~"¶aû.h
"

15 
	~"¶aû_ªd_rou‹.h
"

16 
	~"»ad_¬ch.h
"

17 
	~"»ad_Ãi¡.h
"

18 
	~"´št_Ãi¡.h
"

19 
	~"check_Ãi¡.h
"

20 
	~"»ad_¶aû.h
"

21 
	~"rou‹_expÜt.h
"

22 
	~"rou‹_commÚ.h
"

23 
	~"rou‹_b»adth_fœ¡.h
"

24 
	~"rou‹_Œ“_timšg.h
"

25 
	~"rou‹_timšg.h
"

26 
	~"¼_g¿ph.h
"

27 
	~"¼_g¿ph_ut.h
"

28 
	~"¼_g¿ph2.h
"

29 
	~"¼_g¿ph_sbox.h
"

30 
	~"¼_g¿ph_timšg_·¿ms.h
"

31 
	~"¼_g¿ph_šdexed_d©a.h
"

32 
	~"¼_g¿ph_¬—.h
"

33 
	~"check_¼_g¿ph.h
"

34 
	~"¡©s.h
"

35 
	~"£gm’t_¡©s.h
"

36 
	~"Ãt_d–ay.h
"

37 
	~"·th_d–ay.h
"

38 
	~"·th_d–ay2.h
"

39 
	~"v´_uts.h
"

40 
	~"timšg_¶aû_lookup.h
"

41 
	~"timšg_¶aû.h
"

	@timing_place.c

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

3 
	~"ut.h
"

4 
	~"glob®s.h
"

5 
	~"·th_d–ay.h
"

6 
	~"·th_d–ay2.h
"

7 
	~"Ãt_d–ay.h
"

8 
	~"timšg_¶aû_lookup.h
"

9 
	~"timšg_¶aû.h
"

14 ** 
	gtimšg_¶aû_ü™
;

18 ** 
	gsubÃt_loÿl_ü™_weight
;

21 
lšked_v±r_t
* 
	gtimšg_¶aû_ü™_chunk_li¡_h—d
;

22 
lšked_v±r_t
* 
	gÃt_d–ay_chunk_li¡_h—d
;

26 ** 
®loc_®l_Ãts_ü™
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
);

32 ** 
®loc_®l_Ãts_loÿl_ü™_weight
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
);

34 
ä“_ü™
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
);

37 ** 
	$®loc_®l_Ãts_ü™
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
)

42 *
chunk_li¡_h—d_±r
 = 
NULL
;

44 
chunk_by‹s_ava
 = 0;

45 * 
chunk_Ãxt_ava_mem
 = 
NULL
;

48 ** 
loÿl_ü™
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

50 
š‘
 = -1;

51 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

52 * 
tmp_±r
 = (*)
	`my_chunk_m®loc
((
Ãt
[
š‘
].
num_Ãt_pšs
-1)

54 
chunk_li¡_h—d_±r
,

55 &
chunk_by‹s_ava
,

56 &
chunk_Ãxt_ava_mem
);

57 
loÿl_ü™
[
š‘
] = 
tmp_±r
 - 1;

60  
loÿl_ü™
;

61 
	}
}

64 ** 
	$®loc_®l_Ãts_loÿl_ü™_weight
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
)

68 *
chunk_li¡_h—d_±r
 = 
NULL
;

70 
chunk_by‹s_ava
 = 0;

71 * 
chunk_Ãxt_ava_mem
 = 
NULL
;

74 ** 
loÿl_ü™_weight
 = (**)
	`my_m®loc
(
num_Ãts
 * (*));

76 
š‘
 = -1;

77 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

78 * 
tmp_±r
 = (*)
	`my_chunk_m®loc
((
Ãt
[
š‘
].
num_Ãt_pšs
-1)

80 
chunk_li¡_h—d_±r
,

81 &
chunk_by‹s_ava
,

82 &
chunk_Ãxt_ava_mem
);

83 
loÿl_ü™_weight
[
š‘
] = 
tmp_±r
 - 1;

86  
loÿl_ü™_weight
;

87 
	}
}

89 
	$ä“_ü™
(
lšked_v±r_t
** 
chunk_li¡_h—d_±r
)

91 
	`ä“_chunk_memÜy
(*
chunk_li¡_h—d_±r
);

92 *
chunk_li¡_h—d_±r
 = 
NULL
;

93 
	}
}

96 
	$´št_sšk_d–ays
(* 
âame
)

98 
FILE
* 
å
 = 
	`my_fİ’
(
âame
, "w");

99 
ev–
 = -1;

100 
ev–
 = 
num_Šode_Ëv–s
 - 1; ilevel >= 0; --ilevel) {

101 
num_©_Ëv–
 = 
Šodes_©_Ëv–
[
ev–
].
ÃËm
;

103 
i
 = -1;

104 
i
 = 0; i < 
num_©_Ëv–
; ++i) {

105 
ivex
 = 
Šodes_©_Ëv–
[
ev–
].
li¡
[
i
];

106 
num_out_edges
 = 
v”‹xes
[
ivex
].num_out_edges;

107 ià(
num_out_edges
 == 0) {

108 
	`årštf
(
å
, "%g\n", 
v”‹xes
[
ivex
].
¬r_time
);

113 
	`fşo£
(
å
);

114 
	}
}

123 
	$lßd_ü™iÿl™›s
(** 
Ãt_¦ack
,

124 
ü™_d–ay
,

125 
ü™_expÚ’t
)

127 
š‘
 = -1;

128 
š‘
 = 0; iÃˆ< 
num_Ãts
; ++inet) {

129 ià(
š‘
 =ğ
OPEN
 || 
TRUE
 =ğ
is_glob®
[inet]) {

133 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
š‘
].
num_Ãt_pšs
;

134 
š
 = 0;

135 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

139 
pš_ü™
 = 
	`max
(1 - 
Ãt_¦ack
[
š‘
][
š
] / 
ü™_d–ay
,

141 
timšg_¶aû_ü™
[
š‘
][
š
] = 
	`pow
(
pš_ü™
,

142 
ü™_expÚ’t
);

145 
	}
}

148 
	$®loc_d–ay_lookup_m©rixes_ªd_ü™iÿl™›s
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

149 
subblock_d©a_t
 
subblock_d©a
,

150 
chª_width_di¡r_t
 
chª_width_di¡
,

151 
timšg_šfo_t
 
timšg_šf
,

152 
rou‹r_İts_t
 
rou‹r_İts
,

153 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

154 
£gm’t_šfo_t
* 
£gm’t_šf
,

155 *** 
Ãt_d–ay
)

159 (*
Ãt_d–ay
èğ
	`®loc_Ãt_d–ay
(&
Ãt_d–ay_chunk_li¡_h—d
);

164 
	`®loc_ªd_compu‹_d–ay_lookup_m©rixes
(
rou‹r_İts
,

165 
d‘_routšg_¬ch
,

166 
£gm’t_šf
,

167 
timšg_šf
,

168 
chª_width_di¡
,

169 
subblock_d©a
);

172 ià(
¶aûr_İts_±r
->
¶aû_®gÜ™hm
 =ğ
NEW_TIMING_DRIVEN_PLACE
) {

173 
subÃt_loÿl_ü™_weight
 =

174 
	`®loc_®l_Ãts_loÿl_ü™_weight
(&
timšg_¶aû_ü™_chunk_li¡_h—d
);

176 
timšg_¶aû_ü™
 =

177 
	`®loc_®l_Ãts_ü™
(&
timšg_¶aû_ü™_chunk_li¡_h—d
);

179 
	}
}

182 
	$ä“_lookups_ªd_ü™iÿl™›s
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

183 *** 
Ãt_d–ay
,

184 *** 
Ãt_¦ack
)

186 ià(
NEW_TIMING_DRIVEN_PLACE
 =ğ
¶aûr_İts_±r
->
¶aû_®gÜ™hm
) {

187 
	`ä“
(
subÃt_loÿl_ü™_weight
);

189 
	`ä“
(
timšg_¶aû_ü™
);

191 
	`ä“_ü™
(&
timšg_¶aû_ü™_chunk_li¡_h—d
);

193 
	`ä“_timšg_g¿ph
(*
Ãt_¦ack
);

195 
	`ä“_Ãt_d–ay
(*
Ãt_d–ay
,

196 &
Ãt_d–ay_chunk_li¡_h—d
);

199 
	`ä“
(
äÚt_ü™_·th_through_pš
);

200 
äÚt_ü™_·th_through_pš
 = 
NULL
;

202 
	`ä“
(
behšd_ü™_·th_through_pš
);

203 
behšd_ü™_·th_through_pš
 = 
NULL
;

205 
	}
}

	@timing_place.h

1 #iâdeà
TIMING_PLACE_H


2 
	#TIMING_PLACE_H


	)

4 
	~"v´_ty³s.h
"

10 
®loc_d–ay_lookup_m©rixes_ªd_ü™iÿl™›s
(

11 cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

12 
subblock_d©a_t
 
subblock_d©a
,

13 
chª_width_di¡r_t
 
chª_width_di¡
,

14 
timšg_šfo_t
 
timšg_šf
,

15 
rou‹r_İts_t
 
rou‹r_İts
,

16 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

17 
£gm’t_šfo_t
* 
£gm’t_šf
,

18 *** 
Ãt_d–ay
);

22 
lßd_ü™iÿl™›s
(** 
Ãt_¦ack
,

23 
ü™_d–ay
,

24 
ü™_expÚ’t
);

26 
ä“_lookups_ªd_ü™iÿl™›s
(cÚ¡ 
¶aûr_İts_t
* 
¶aûr_İts_±r
,

27 *** 
Ãt_d–ay
,

28 *** 
Ãt_¦ack
);

30 
´št_sšk_d–ays
(* 
âame
);

32 ** 
timšg_¶aû_ü™
;

	@timing_place_lookup.c

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

3 
	~<¡ršg.h
>

5 
	~"v´_ty³s.h
"

6 
	~"glob®s.h
"

7 
	~"rou‹_commÚ.h
"

8 
	~"¶aû_ªd_rou‹.h
"

9 
	~"rou‹_Œ“_timšg.h
"

10 
	~"rou‹_timšg.h
"

11 
	~"timšg_¶aû_lookup.h
"

12 
	~"¼_g¿ph.h
"

13 
	~"rou‹_expÜt.h
"

33 
	#NET_COUNT
 1

	)

37 
	#NET_USED
 0

	)

39 
	#NET_USED_SOURCE_BLOCK
 0

	)

40 
	#NET_USED_SINK_BLOCK
 1

	)

41 
	#SOURCE_BLOCK
 0

	)

42 
	#SINK_BLOCK
 1

	)

44 
	#BLOCK_COUNT
 2

	)

51 
	#DEBUG_TIMING_PLACE_LOOKUP


	)

53 
	#DUMPFILE
 "lookup_dump.echo"

	)

62 ** 
	gd–_š·d_to_şb
;

63 ** 
	gd–_şb_to_şb
;

64 ** 
	gd–_şb_to_ouad
;

65 ** 
	gd–_š·d_to_ouad
;

73 ** 
	gÃt_d–ay
;

74 ** 
	gÃt_¦ack
;

75 * 
	gpš_ü™iÿl™y
;

76 * 
	gsšk_Üd”
;

77 
t_¹_node
** 
	g¹_node_of_sšk
;

79 
veùÜ_t
** 
	gşb_İšs_u£d_loÿÎy
;

81 
FILE
* 
	glookup_dump
;

86 
®loc_Ãt
();

88 
®loc_block
();

90 
®loc_ªd_assign_š‹º®_¡ruùu»s
(
Ãt_t
** 
Üigš®_Ãt
,

91 
block_t
** 
Üigš®_block
,

92 * 
Üigš®_num_Ãts
,

93 * 
Üigš®_num_blocks
);

95 
ä“_ªd_»£t_š‹º®_¡ruùu»s
(
Ãt_t
* 
Üigš®_Ãt
,

96 
block_t
* 
Üigš®_block
,

97 
Üigš®_num_Ãts
,

98 
Üigš®_num_blocks
);

100 
£tup_chª_width
(
rou‹r_İts_t
 
rou‹r_İts
,

101 
chª_width_di¡r_t
 
chª_width_di¡
);

103 
®loc_routšg_¡ruùs
(
rou‹r_İts_t
 
rou‹r_İts
,

104 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

105 
£gm’t_šfo_t
* 
£gm’t_šf
,

106 
timšg_šfo_t
 
timšg_šf
, 
subblock_d©a_t
 
subblock_d©a
);

108 
ä“_routšg_¡ruùs
(
rou‹r_İts_t
 
rou‹r_İts
,

109 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

110 
£gm’t_šfo_t
* 
£gm’t_šf
,

111 
timšg_šfo_t
 
timšg_šf


114 
assign_loÿtiÚs
(
block_ty³s_t
 
sourû_ty³
,

115 
sourû_x_loc
,

116 
sourû_y_loc
,

117 
sourû_z_loc
,

118 
block_ty³s_t
 
sšk_ty³
,

119 
sšk_x_loc
,

120 
sšk_y_loc
,

121 
sšk_z_loc
);

123 
assign_blocks_ªd_rou‹_Ãt
(
block_ty³s_t
 
sourû_ty³
,

124 
sourû_x_loc
,

125 
sourû_y_loc
,

126 
block_ty³s_t
 
sšk_ty³
,

127 
sšk_x_loc
,

128 
sšk_y_loc
,

129 
rou‹r_İts_t
 
rou‹r_İts
);

130 
®loc_d–_¬¿ys
();

132 
ä“_d–_¬¿ys
();

134 
g’”ic_compu‹_m©rix
(** *
m©rix_±r
,

135 
block_ty³s_t
 
sourû_ty³
,

136 
block_ty³s_t
 
sšk_ty³
, 
sourû_x
,

137 
sourû_y
, 
¡¬t_x
,

138 
’d_x
, 
¡¬t_y
, 
’d_y
,

139 
rou‹r_İts_t
 
rou‹r_İts
,

140 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

141 
£gm’t_šfo_t
* 
£gm’t_šf
,

142 
timšg_šfo_t
 
timšg_šf
);

144 
compu‹_d–_şb_to_şb
(
rou‹r_İts_t
 
rou‹r_İts
,

145 
lÚge¡_Ëngth
);

147 
compu‹_d–_š·d_to_şb
(
rou‹r_İts_t
 
rou‹r_İts
,

148 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

149 
£gm’t_šfo_t
* 
£gm’t_šf
,

150 
timšg_šfo_t
 
timšg_šf
);

152 
compu‹_d–_şb_to_ouad
(
rou‹r_İts_t
 
rou‹r_İts
);

154 
compu‹_d–_š·d_to_ouad
(
rou‹r_İts_t
 
rou‹r_İts
);

156 
compu‹_d–_¬¿ys
(
rou‹r_İts_t
 
rou‹r_İts
,

157 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

158 
£gm’t_šfo_t
* 
£gm’t_šf
,

159 
timšg_šfo_t
 
timšg_šf
, 
lÚge¡_Ëngth
);

161 
g‘_fœ¡_pš
(
pš_ty³s_t
 
pšty³
);

163 
g‘_lÚge¡_£gm’t_Ëngth
(
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

164 
£gm’t_šfo_t
* 
£gm’t_šf
);

165 
š™_occ
();

167 #ifdeà
PRINT_ARRAYS


168 
´št_¬¿y
(** 
¬¿y_to_´št
, 
x1
, 
x2
, 
y1
, 
y2
);

171 
	$g‘_fœ¡_pš
(
pš_ty³s_t
 
pšty³
)

175 
cu¼pš
 = 0;

176 
i
 = -1;

177 
i
 = 0; i < 
num_pš_şass
; ++i) {

178 ià(
şass_šf
[
i
].
ty³
 =ğ
pšty³
 && !
is_glob®_şb_pš
[
cu¼pš
]) {

179 (
şass_šf
[
i
].
pšli¡
[0]);

181 
cu¼pš
 +ğ
şass_šf
[
i
].
num_pšs
;

185 
	`ex™
(0);

186 
	}
}

189 
	$g‘_lÚge¡_£gm’t_Ëngth
(
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

190 
£gm’t_šfo_t
* 
£gm’t_šf
)

192 
Ëngth
 = 0;

193 
i
 = -1;

194 
i
 = 0; i < 
d‘_routšg_¬ch
.
num_£gm’t
; i++) {

195 ià(
£gm’t_šf
[
i
].
Ëngth
 >†ength) {

196 
Ëngth
 = 
£gm’t_šf
[
i
].length;

200  
Ëngth
;

201 
	}
}

204 
	$®loc_Ãt
()

206 
Ãt
 = (
Ãt_t
*)
	`my_m®loc
(
num_Ãts
 * (net_t));

208 
i
 = -1;

209 
i
 = 0; i < 
NET_COUNT
; ++i) {

210 
Ën
 = 
	`¡¾’
("TEMP_NET");

211 
Ãt
[
i
].
Çme
 = (*)
	`my_m®loc
((
Ën
 + 1) * ());

212 
	`¡rıy
(
Ãt
[
NET_USED
].
Çme
, "TEMP_NET");

213 
Ãt
[
i
].
num_Ãt_pšs
 = 
BLOCK_COUNT
;

214 
Ãt
[
i
].
node_blocks
 = (*)
	`my_m®loc
(
BLOCK_COUNT
 * ());

215 
Ãt
[
i
].
node_blocks
[
NET_USED_SOURCE_BLOCK
] = NET_USED_SOURCE_BLOCK;

216 
Ãt
[
i
].
node_blocks
[
NET_USED_SINK_BLOCK
] = NET_USED_SINK_BLOCK;

217 
Ãt
[
i
].
node_block_pšs
 = (*)
	`my_m®loc
(
BLOCK_COUNT
 * ());

220 
	}
}

223 
	$®loc_block
()

228 
blocks
 = (
block_t
*)
	`my_m®loc
(
num_blocks
 * (block_t));

230 
iblk
 = -1;

231 
iblk
 = 0; iblk < 
BLOCK_COUNT
; ++iblk) {

232 
Ën
 = 
	`¡¾’
("TEMP_BLOCK");

233 
blocks
[
iblk
].
Çme
 = (*)
	`my_m®loc
((
Ën
 + 1) * ());

234 
	`¡rıy
(
blocks
[
iblk
].
Çme
, "TEMP_BLOCK");

235 
blocks
[
iblk
].
Ãts
 = (*)
	`my_m®loc
(
max_pšs_³r_şb
 * ());

236 
blocks
[
iblk
].
Ãts
[0] = 0;

238 
š
 = 0;

239 
š
 = 1; ipš < 
max_pšs_³r_şb
; ++ipin) {

240 
blocks
[
iblk
].
Ãts
[
š
] = 
OPEN
;

243 
	}
}

245 
	$š™_occ
()

247 
i
, 
j
;

248 
i
 = 0; i <ğ
num_grid_cŞumns
 + 1; i++) {

249 
j
 = 0; j <ğ
num_grid_rows
 + 1; j++) {

250 
bš_grids
[
i
][
j
].
m_u§ge
 = 0;

253 
	}
}

255 
	$®loc_ªd_assign_š‹º®_¡ruùu»s
(
Ãt_t
** 
Üigš®_Ãt
,

256 
block_t
** 
Üigš®_block
,

257 * 
Üigš®_num_Ãts
,

258 * 
Üigš®_num_blocks
)

261 *
Üigš®_Ãt
 = 
Ãt
;

262 *
Üigš®_num_Ãts
 = 
num_Ãts
;

263 
num_Ãts
 = 
NET_COUNT
;

265 
	`®loc_Ãt
();

267 *
Üigš®_block
 = 
blocks
;

268 *
Üigš®_num_blocks
 = 
num_blocks
;

269 
num_blocks
 = 
BLOCK_COUNT
;

271 
	`®loc_block
();

273 
Ãt_d–ay
 = (**)
	`®loc_m©rix
(0,

274 
NET_COUNT
 - 1,

276 
BLOCK_COUNT
 - 1,

278 
Ãt_¦ack
 = (**)
	`®loc_m©rix
(0,

279 
NET_COUNT
 - 1,

281 
BLOCK_COUNT
 - 1,

283 
	`š™_occ
();

284 
	}
}

287 
	$ä“_ªd_»£t_š‹º®_¡ruùu»s
(
Ãt_t
* 
Üigš®_Ãt
,

288 
block_t
* 
Üigš®_block
,

289 
Üigš®_num_Ãts
,

290 
Üigš®_num_blocks
)

294 
i
;

297 
i
 = 0; i < 
NET_COUNT
; ++i) {

298 
	`ä“
(
Ãt
[
i
].
Çme
);

299 
	`ä“
(
Ãt
[
i
].
node_blocks
);

300 
	`ä“
(
Ãt
[
i
].
node_block_pšs
);

303 
	`ä“
(
Ãt
);

304 
Ãt
 = 
Üigš®_Ãt
;

306 
i
 = 0; i < 
BLOCK_COUNT
; ++i) {

307 
	`ä“
(
blocks
[
i
].
Çme
);

308 
	`ä“
(
blocks
[
i
].
Ãts
);

311 
	`ä“
(
blocks
);

312 
blocks
 = 
Üigš®_block
;

313 
num_Ãts
 = 
Üigš®_num_Ãts
;

314 
num_blocks
 = 
Üigš®_num_blocks
;

315 
	`ä“_m©rix
(
Ãt_d–ay
, 0, 
NET_COUNT
 - 1, 1, ());

316 
	`ä“_m©rix
(
Ãt_¦ack
, 0, 
NET_COUNT
 - 1, 1, ());

317 
	}
}

320 
	$£tup_chª_width
(
rou‹r_İts_t
 
rou‹r_İts
,

321 
chª_width_di¡r_t
 
chª_width_di¡
)

325 
width_çc
 = 0;

327 ià(
rou‹r_İts
.
fixed_chªÃl_width
 =ğ
NO_FIXED_CHANNEL_WIDTH
) {

328 
width_çc
 = 4 * 
max_pšs_³r_şb
;

333 
width_çc
 = 
rou‹r_İts
.
fixed_chªÃl_width
;

336 
	`š™_chªÃl_t
(
width_çc
, 
chª_width_di¡
);

337 
	}
}

339 
	$®loc_routšg_¡ruùs
(
rou‹r_İts_t
 
rou‹r_İts
,

340 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

341 
£gm’t_šfo_t
* 
£gm’t_šf
,

342 
timšg_šfo_t
 
timšg_šf
,

343 
subblock_d©a_t
 
subblock_d©a
)

347 
	`assign_loÿtiÚs
(
B_CLB_TYPE
, 1, 1, 0,

348 
B_CLB_TYPE
, 
num_grid_cŞumns
, 
num_grid_rows
, 0);

350 
şb_İšs_u£d_loÿÎy
 = 
	`®loc_rou‹_¡ruùs
(
subblock_d©a
);

351 
	`ä“_¼_g¿ph
();

352 
	`bud_¼_g¿ph
(
rou‹r_İts
.
rou‹_ty³
,

353 
d‘_routšg_¬ch
, 
£gm’t_šf
,

354 
timšg_šf
,

355 
rou‹r_İts
.
rou‹r_ba£_co¡_ty³
);

357 
	`®loc_ªd_lßd_¼_node_rou‹_¡ruùs
();

358 
	`®loc_timšg_driv’_rou‹_¡ruùs
(&
pš_ü™iÿl™y
,

359 &
sšk_Üd”
,

360 &
¹_node_of_sšk
);

361 
bb_çùÜ
 = 
num_grid_cŞumns
 + 
num_grid_rows
;

362 
	`š™_rou‹_¡ruùs
(
bb_çùÜ
);

363 
	}
}

365 
	$ä“_routšg_¡ruùs
(
rou‹r_İts_t
 
rou‹r_İts
,

366 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

367 
£gm’t_šfo_t
* 
£gm’t_šf
,

368 
timšg_šfo_t
 
timšg_šf


371 
	`ä“_¼_g¿ph_š‹º®s
(
rou‹r_İts
.
rou‹_ty³
, 
d‘_routšg_¬ch
, 
£gm’t_šf
,

372 
timšg_šf
, 
rou‹r_İts
.
rou‹r_ba£_co¡_ty³
);

373 
	`ä“_¼_g¿ph
();

374 
	`ä“_¼_node_rou‹_¡ruùs
();

375 
	`ä“_rou‹_¡ruùs
(
şb_İšs_u£d_loÿÎy
);

376 
	`ä“_Œaû_¡ruùs
();

377 
	`ä“_timšg_driv’_rou‹_¡ruùs
(
pš_ü™iÿl™y
, 
sšk_Üd”
, 
¹_node_of_sšk
);

378 
	}
}

380 
	$assign_loÿtiÚs
(
block_ty³s_t
 
sourû_ty³
,

381 
sourû_x_loc
,

382 
sourû_y_loc
,

383 
sourû_z_loc
,

384 
block_ty³s_t
 
sšk_ty³
,

385 
sšk_x_loc
,

386 
sšk_y_loc
,

387 
sšk_z_loc
)

390 
blocks
[
SOURCE_BLOCK
].
block_ty³
 = 
sourû_ty³
;

391 
blocks
[
SOURCE_BLOCK
].
x
 = 
sourû_x_loc
;

392 
blocks
[
SOURCE_BLOCK
].
y
 = 
sourû_y_loc
;

393 
blocks
[
SOURCE_BLOCK
].
z
 = 
sourû_z_loc
;

395 
blocks
[
SINK_BLOCK
].
block_ty³
 = 
sšk_ty³
;

396 
blocks
[
SINK_BLOCK
].
x
 = 
sšk_x_loc
;

397 
blocks
[
SINK_BLOCK
].
y
 = 
sšk_y_loc
;

398 
blocks
[
SINK_BLOCK
].
z
 = 
sšk_z_loc
;

401 ià(
sourû_ty³
 =ğ
B_CLB_TYPE
) {

402 
Ãt
[
NET_USED
].
node_block_pšs
[
NET_USED_SOURCE_BLOCK
] = 
	`g‘_fœ¡_pš
(
DRIVER
);

403 
bš_grids
[
sourû_x_loc
][
sourû_y_loc
].
š_blocks
[
sourû_z_loc
] = 
SOURCE_BLOCK
;

404 
bš_grids
[
sourû_x_loc
][
sourû_y_loc
].
m_u§ge
 += 1;

406 
Ãt
[
NET_USED
].
node_block_pšs
[
NET_USED_SOURCE_BLOCK
] = 
OPEN
;

408 
bš_grids
[
sourû_x_loc
][
sourû_y_loc
].
š_blocks
[
sourû_z_loc
] = 
SOURCE_BLOCK
;

409 
bš_grids
[
sourû_x_loc
][
sourû_y_loc
].
m_u§ge
 += 1;

412 ià(
sšk_ty³
 =ğ
B_CLB_TYPE
) {

413 
Ãt
[
NET_USED
].
node_block_pšs
[
NET_USED_SINK_BLOCK
] = 
	`g‘_fœ¡_pš
(
RECEIVER
);

414 
bš_grids
[
sšk_x_loc
][
sšk_y_loc
].
š_blocks
[
sourû_z_loc
] = 
SINK_BLOCK
;

415 
bš_grids
[
sšk_x_loc
][
sšk_y_loc
].
m_u§ge
 += 1;

417 
Ãt
[
NET_USED
].
node_block_pšs
[
NET_USED_SINK_BLOCK
] = 
OPEN
;

419 
bš_grids
[
sšk_x_loc
][
sšk_y_loc
].
š_blocks
[
sšk_z_loc
] = 
SINK_BLOCK
;

420 
bš_grids
[
sšk_x_loc
][
sšk_y_loc
].
m_u§ge
 += 1;

422 
	}
}

427 
	$assign_blocks_ªd_rou‹_Ãt
(
block_ty³s_t
 
sourû_ty³
,

428 
sourû_x_loc
,

429 
sourû_y_loc
,

430 
block_ty³s_t
 
sšk_ty³
,

431 
sšk_x_loc
,

432 
sšk_y_loc
,

433 
rou‹r_İts_t
 
rou‹r_İts
)

437 
sourû_z_loc
 = 0;

438 
sšk_z_loc
 = 0;

439 
	`assign_loÿtiÚs
(
sourû_ty³
,

440 
sourû_x_loc
,

441 
sourû_y_loc
,

442 
sourû_z_loc
,

443 
sšk_ty³
,

444 
sšk_x_loc
,

445 
sšk_y_loc
,

446 
sšk_z_loc
);

448 ** 
¼_node_šdiûs
 = 
	`g”r_node_t_šdiûs
();

449 
nodes_³r_chª
 = 
	`g‘_nodes_³r_chª
();

450 
	`lßd_Ãt_¼_‹rmš®s
(
¼_node_šdiûs
,

451 
nodes_³r_chª
);

452 
T_ü™
 = 1.0;

453 
´es_çc
 = 0.0;

455 cÚ¡ 
knum_Ãt_pšs
 = 
Ãt
[
NET_USED
].
num_Ãt_pšs
;

456 
š
 = 0;

457 
š
 = 1; ipš < 
knum_Ãt_pšs
; ++ipin) {

458 
Ãt_¦ack
[
NET_USED
][
š
] = 0;

461 
boŞ—n
 
is_rou‹abË
 = 
	`timšg_driv’_rou‹_Ãt
(
NET_USED
,

462 
´es_çc
,

463 
rou‹r_İts
.
max_ü™iÿl™y
,

464 
rou‹r_İts
.
ü™iÿl™y_exp
,

465 
rou‹r_İts
.
a¡¬_çc
,

466 
rou‹r_İts
.
b’d_co¡
,

467 
Ãt_¦ack
[
NET_USED
],

468 
pš_ü™iÿl™y
,

469 
sšk_Üd”
,

470 
¹_node_of_sšk
,

471 
T_ü™
,

472 
Ãt_d–ay
[
NET_USED
]);

473 
Ãt_d–ay_v®ue
 = 
Ãt_d–ay
[
NET_USED
][
NET_USED_SINK_BLOCK
];

474 
bš_grids
[
sourû_x_loc
][
sourû_y_loc
].
m_u§ge
 = 0;

475 
bš_grids
[
sšk_x_loc
][
sšk_y_loc
].
m_u§ge
 = 0;

476  
Ãt_d–ay_v®ue
;

477 
	}
}

480 
	$®loc_d–_¬¿ys
()

482 
d–_şb_to_şb
 = (**)
	`®loc_m©rix
(0,

483 
num_grid_cŞumns
 - 1,

485 
num_grid_rows
 - 1,

487 
d–_š·d_to_şb
 = (**)
	`®loc_m©rix
(0,

488 
num_grid_cŞumns
,

490 
num_grid_rows
,

492 
d–_şb_to_ouad
 = (**)
	`®loc_m©rix
(0,

493 
num_grid_cŞumns
,

495 
num_grid_rows
,

497 
d–_š·d_to_ouad
 = (**)
	`®loc_m©rix
(0,

498 
num_grid_cŞumns
 + 1,

500 
num_grid_rows
 + 1,

504 
id_x
 = -1;

505 
id_y
 = -1;

506 
id_x
 = 0; id_x <ğ
num_grid_cŞumns
; ++id_x) {

507 
id_y
 = 0; id_y <ğ
num_grid_rows
; ++id_y) {

508 
d–_š·d_to_şb
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

512 
id_x
 = 0; id_x <ğ
num_grid_cŞumns
 - 1; ++id_x) {

513 
id_y
 = 0; id_y <ğ
num_grid_rows
 - 1; ++id_y) {

514 
d–_şb_to_şb
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

518 
id_x
 = 0; id_x <ğ
num_grid_cŞumns
; ++id_x) {

519 
id_y
 = 0; id_y <ğ
num_grid_rows
; ++id_y) {

520 
d–_şb_to_ouad
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

524 
id_x
 = 0; id_x <ğ
num_grid_cŞumns
 + 1; ++id_x) {

525 
id_y
 = 0; id_y <ğ
num_grid_rows
 + 1; ++id_y) {

526 
d–_š·d_to_ouad
[
id_x
][
id_y
] = 
IMPOSSIBLE
;

529 
	}
}

532 
	$ä“_d–_¬¿ys
()

534 
	`ä“_m©rix
(
d–_š·d_to_şb
,

536 
num_grid_cŞumns
,

539 
	`ä“_m©rix
(
d–_şb_to_şb
,

541 
num_grid_cŞumns
 - 1,

544 
	`ä“_m©rix
(
d–_şb_to_ouad
,

546 
num_grid_cŞumns
,

549 
	`ä“_m©rix
(
d–_š·d_to_ouad
,

551 
num_grid_cŞumns
 + 1,

554 
	}
}

556 
	$g’”ic_compu‹_m©rix
(*** 
m©rix_±r
,

557 
block_ty³s_t
 
sourû_ty³
,

558 
block_ty³s_t
 
sšk_ty³
,

559 
sourû_x
,

560 
sourû_y
,

561 
¡¬t_x
,

562 
’d_x
,

563 
¡¬t_y
,

564 
’d_y
,

565 
rou‹r_İts_t
 
rou‹r_İts
,

566 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

567 
£gm’t_šfo_t
* 
£gm’t_šf
,

568 
timšg_šfo_t
 
timšg_šf
)

570 
d–_x
 = 0;

571 
d–_y
 = 0;

572 
sšk_x
 = 0;

573 
sšk_y
 = 0;

574 
sšk_x
 = 
¡¬t_x
; sšk_x <ğ
’d_x
; ++sink_x) {

575 
sšk_y
 = 
¡¬t_y
; sšk_y <ğ
’d_y
; ++sink_y) {

576 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

577 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

579 ià(
d–_x
 =ğ0 && 
d–_y
 == 0) {

584 (*
m©rix_±r
)[
d–_x
][
d–_y
] =

585 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

586 
sourû_x
,

587 
sourû_y
,

588 
sšk_ty³
,

589 
sšk_x
,

590 
sšk_y
,

591 
rou‹r_İts
);

594 
	}
}

603 
	$compu‹_d–_şb_to_şb
(
rou‹r_İts_t
 
rou‹r_İts
,

604 
lÚge¡_Ëngth
)

606 
block_ty³s_t
 
sourû_ty³
 = 
B_CLB_TYPE
;

607 
block_ty³s_t
 
sšk_ty³
 = 
B_CLB_TYPE
;

609 
¡¬t_x
 = 0;

610 ià(
lÚge¡_Ëngth
 < 0.5 * (
num_grid_cŞumns
)) {

611 
¡¬t_x
 = 
lÚge¡_Ëngth
;

613 
¡¬t_x
 = ()(0.5 * 
num_grid_cŞumns
);

615 cÚ¡ 
’d_x
 = 
num_grid_cŞumns
;

617 
¡¬t_y
 = 0;

618 ià(
lÚge¡_Ëngth
 < 0.5 * (
num_grid_rows
)) {

619 
¡¬t_y
 = 
lÚge¡_Ëngth
;

621 
¡¬t_y
 = ()(0.5 * 
num_grid_rows
);

623 cÚ¡ 
’d_y
 = 
num_grid_rows
;

626 
d–_x
 = 0;

627 
d–_y
 = 0;

628 
sšk_x
 = 0;

629 
sšk_y
 = 0;

630 
sourû_x
 = 
¡¬t_x
;

631 
sourû_y
 = 
¡¬t_y
;

632 
sšk_x
 = 
¡¬t_x
; sšk_x <ğ
’d_x
 - 1; ++sink_x) {

633 
sšk_y
 = 
¡¬t_y
; sšk_y <ğ
’d_y
 - 1; ++sink_y) {

634 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

635 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

636 ià(
d–_x
 =ğ0 && 
d–_y
 == 0) {

637 
d–_şb_to_şb
[
d–_x
][
d–_y
] = 0.0;

641 
d–_şb_to_şb
[
d–_x
][
d–_y
] =

642 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

643 
sourû_x
,

644 
sourû_y
,

645 
sšk_ty³
,

646 
sšk_x
,

647 
sšk_y
,

648 
rou‹r_İts
);

652 
sšk_x
 = 
’d_x
 - 1;

653 
sšk_y
 = 
’d_y
 - 1;

654 
sourû_x
 = 
¡¬t_x
 - 1; source_x >= 1; --source_x) {

655 
sourû_y
 = 
¡¬t_y
; sourû_y <ğ
’d_y
 - 1; ++source_y) {

656 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

657 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

658 
d–_şb_to_şb
[
d–_x
][
d–_y
] =

659 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

660 
sourû_x
,

661 
sourû_y
,

662 
sšk_ty³
,

663 
sšk_x
,

664 
sšk_y
,

665 
rou‹r_İts
);

669 
sourû_x
 = 1; sourû_x <ğ
’d_x
 - 1; ++source_x) {

670 
sourû_y
 = 1; sourû_y < 
¡¬t_y
; ++source_y) {

671 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

672 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

673 
d–_şb_to_şb
[
d–_x
][
d–_y
] =

674 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

675 
sourû_x
,

676 
sourû_y
,

677 
sšk_ty³
,

678 
sšk_x
,

679 
sšk_y
,

680 
rou‹r_İts
);

685 
sšk_x
 = 
’d_x
;

686 
sšk_y
 = 
’d_y
;

687 
sourû_x
 = 1;

688 
sourû_y
 = 1; sourû_y <ğ
’d_y
; ++source_y) {

689 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

690 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

691 
d–_şb_to_şb
[
d–_x
][
d–_y
] =

692 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

693 
sourû_x
,

694 
sourû_y
,

695 
sšk_ty³
,

696 
sšk_x
,

697 
sšk_y
,

698 
rou‹r_İts
);

701 
sšk_x
 = 
’d_x
;

702 
sšk_y
 = 
’d_y
;

703 
sourû_y
 = 1;

704 
sourû_x
 = 1; sourû_x <ğ
’d_x
; ++source_x) {

705 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

706 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

707 
d–_şb_to_şb
[
d–_x
][
d–_y
] =

708 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

709 
sourû_x
,

710 
sourû_y
,

711 
sšk_ty³
,

712 
sšk_x
,

713 
sšk_y
,

714 
rou‹r_İts
);

716 
	}
}

719 
	$compu‹_d–_š·d_to_şb
(
rou‹r_İts_t
 
rou‹r_İts
,

720 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

721 
£gm’t_šfo_t
* 
£gm’t_šf
,

722 
timšg_šfo_t
 
timšg_šf
)

724 
block_ty³s_t
 
sourû_ty³
 = 
INPAD_TYPE
;

725 
block_ty³s_t
 
sšk_ty³
 = 
B_CLB_TYPE
;

726 
d–_š·d_to_şb
[0][0] = 
IMPOSSIBLE
;

727 
d–_š·d_to_şb
[
num_grid_cŞumns
][
num_grid_rows
] = 
IMPOSSIBLE
;

728 
sourû_x
 = 0;

729 
sourû_y
 = 1;

730 
¡¬t_x
 = 1;

731 
’d_x
 = 
num_grid_cŞumns
;

732 
¡¬t_y
 = 1;

733 
’d_y
 = 
num_grid_rows
;

734 
	`g’”ic_compu‹_m©rix
(&
d–_š·d_to_şb
,

735 
sourû_ty³
,

736 
sšk_ty³
,

737 
sourû_x
,

738 
sourû_y
,

739 
¡¬t_x
,

740 
’d_x
,

741 
¡¬t_y
,

742 
’d_y
,

743 
rou‹r_İts
,

744 
d‘_routšg_¬ch
,

745 
£gm’t_šf
,

746 
timšg_šf
);

747 
sourû_x
 = 1;

748 
sourû_y
 = 0;

749 
¡¬t_x
 = 1;

750 
’d_x
 = 1;

751 
¡¬t_y
 = 1;

752 
’d_y
 = 
num_grid_rows
;

753 
	`g’”ic_compu‹_m©rix
(&
d–_š·d_to_şb
,

754 
sourû_ty³
,

755 
sšk_ty³
,

756 
sourû_x
,

757 
sourû_y
,

758 
¡¬t_x
,

759 
’d_x
,

760 
¡¬t_y
,

761 
’d_y
,

762 
rou‹r_İts
,

763 
d‘_routšg_¬ch
,

764 
£gm’t_šf
,

765 
timšg_šf
);

766 
¡¬t_x
 = 1;

767 
’d_x
 = 
num_grid_cŞumns
;

768 
¡¬t_y
 = 
num_grid_rows
;

769 
’d_y
 = 
num_grid_rows
;

770 
	`g’”ic_compu‹_m©rix
(&
d–_š·d_to_şb
,

771 
sourû_ty³
,

772 
sšk_ty³
,

773 
sourû_x
,

774 
sourû_y
,

775 
¡¬t_x
,

776 
’d_x
,

777 
¡¬t_y
,

778 
’d_y
,

779 
rou‹r_İts
,

780 
d‘_routšg_¬ch
,

781 
£gm’t_šf
,

782 
timšg_šf
);

783 
	}
}

786 
	$compu‹_d–_şb_to_ouad
(
rou‹r_İts_t
 
rou‹r_İts
)

788 
block_ty³s_t
 
sourû_ty³
 = 
B_CLB_TYPE
;

789 
block_ty³s_t
 
sšk_ty³
 = 
OUTPAD_TYPE
;

790 
d–_şb_to_ouad
[0][0] = 
IMPOSSIBLE
;

791 
d–_şb_to_ouad
[
num_grid_cŞumns
][
num_grid_rows
] = 
IMPOSSIBLE
;

793 
sšk_x
 = 0;

794 
sšk_y
 = 1;

795 
sourû_x
 = 0;

796 
sourû_y
 = 0;

797 
d–_x
 = 0;

798 
d–_y
 = 0;

799 
sourû_x
 = 1; sourû_x <ğ
num_grid_cŞumns
; ++source_x) {

800 
sourû_y
 = 1; sourû_y <ğ
num_grid_rows
; ++source_y) {

801 
d–_x
 = 
	`abs
(
sourû_x
 - 
sšk_x
);

802 
d–_y
 = 
	`abs
(
sourû_y
 - 
sšk_y
);

803 
d–_şb_to_ouad
[
d–_x
][
d–_y
] =

804 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

805 
sourû_x
,

806 
sourû_y
,

807 
sšk_ty³
,

808 
sšk_x
,

809 
sšk_y
,

810 
rou‹r_İts
);

814 
sšk_x
 = 1;

815 
sšk_y
 = 0;

816 
sourû_x
 = 1;

817 
d–_x
 = 
	`abs
(
sourû_x
 - 
sšk_x
);

818 
sourû_y
 = 1; sourû_y <ğ
num_grid_rows
; ++source_y) {

819 
d–_y
 = 
	`abs
(
sourû_y
 - 
sšk_y
);

820 
d–_şb_to_ouad
[
d–_x
][
d–_y
] =

821 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

822 
sourû_x
,

823 
sourû_y
,

824 
sšk_ty³
,

825 
sšk_x
,

826 
sšk_y
,

827 
rou‹r_İts
);

830 
sšk_x
 = 1;

831 
sšk_y
 = 0;

832 
sourû_y
 = 
num_grid_rows
;

833 
d–_y
 = 
	`abs
(
sourû_y
 - 
sšk_y
);

834 
sourû_x
 = 2; sourû_x <ğ
num_grid_cŞumns
; ++source_x) {

835 
d–_x
 = 
	`abs
(
sourû_x
 - 
sšk_x
);

836 
d–_şb_to_ouad
[
d–_x
][
d–_y
] =

837 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

838 
sourû_x
,

839 
sourû_y
,

840 
sšk_ty³
,

841 
sšk_x
,

842 
sšk_y
,

843 
rou‹r_İts
);

845 
	}
}

848 
	$compu‹_d–_š·d_to_ouad
(
rou‹r_İts_t
 
rou‹r_İts
)

850 
block_ty³s_t
 
sourû_ty³
 = 
INPAD_TYPE
;

851 
block_ty³s_t
 
sšk_ty³
 = 
OUTPAD_TYPE
;

853 
d–_š·d_to_ouad
[0][0] = 0;

854 
d–_š·d_to_ouad
[
num_grid_cŞumns
 + 1][
num_grid_rows
 + 1] = 
IMPOSSIBLE
;

855 
d–_š·d_to_ouad
[0][
num_grid_rows
] = 
IMPOSSIBLE
;

856 
d–_š·d_to_ouad
[
num_grid_cŞumns
][0] = 
IMPOSSIBLE
;

857 
d–_š·d_to_ouad
[
num_grid_cŞumns
][
num_grid_rows
 + 1] = 
IMPOSSIBLE
;

858 
d–_š·d_to_ouad
[
num_grid_cŞumns
 + 1][
num_grid_rows
] = 
IMPOSSIBLE
;

860 
sourû_x
 = 0;

861 
sourû_y
 = 1;

862 
sšk_x
 = 0;

863 
sšk_y
 = 0;

864 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

865 
d–_y
 = 0;

866 
sšk_y
 = 2; sšk_y <ğ
num_grid_rows
; ++sink_y) {

867 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

868 
d–_š·d_to_ouad
[
d–_x
][
d–_y
] =

869 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

870 
sourû_x
,

871 
sourû_y
,

872 
sšk_ty³
,

873 
sšk_x
,

874 
sšk_y
,

875 
rou‹r_İts
);

878 
sourû_x
 = 0;

879 
sourû_y
 = 1;

880 
sšk_x
 = 
num_grid_cŞumns
 + 1;

881 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

882 
sšk_y
 = 1; sšk_y <ğ
num_grid_rows
; ++sink_y) {

883 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

884 
d–_š·d_to_ouad
[
d–_x
][
d–_y
] =

885 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

886 
sourû_x
,

887 
sourû_y
,

888 
sšk_ty³
,

889 
sšk_x
,

890 
sšk_y
,

891 
rou‹r_İts
);

894 
sourû_x
 = 1;

895 
sourû_y
 = 0;

896 
sšk_y
 = 0;

897 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

898 
sšk_x
 = 2; sšk_x <ğ
num_grid_cŞumns
; ++sink_x) {

899 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

900 
d–_š·d_to_ouad
[
d–_x
][
d–_y
] =

901 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

902 
sourû_x
,

903 
sourû_y
,

904 
sšk_ty³
,

905 
sšk_x
,

906 
sšk_y
,

907 
rou‹r_İts
);

910 
sourû_x
 = 1;

911 
sourû_y
 = 0;

912 
sšk_y
 = 
num_grid_rows
 + 1;

913 
d–_y
 = 
	`abs
(
sšk_y
 - 
sourû_y
);

914 
sšk_x
 = 1; sšk_x <ğ
num_grid_cŞumns
; ++sink_x) {

915 
d–_x
 = 
	`abs
(
sšk_x
 - 
sourû_x
);

916 
d–_š·d_to_ouad
[
d–_x
][
d–_y
] =

917 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

918 
sourû_x
,

919 
sourû_y
,

920 
sšk_ty³
,

921 
sšk_x
,

922 
sšk_y
,

923 
rou‹r_İts
);

926 
sourû_x
 = 0;

927 
sšk_y
 = 
num_grid_rows
 + 1;

928 
sourû_y
 = 1; sourû_y <ğ
num_grid_rows
; ++source_y) {

929 
sšk_x
 = 1; sšk_x <ğ
num_grid_cŞumns
; ++sink_x) {

930 
d–_y
 = 
	`abs
(
sourû_y
 - 
sšk_y
);

931 
d–_x
 = 
	`abs
(
sourû_x
 - 
sšk_x
);

932 
d–_š·d_to_ouad
[
d–_x
][
d–_y
] =

933 
	`assign_blocks_ªd_rou‹_Ãt
(
sourû_ty³
,

934 
sourû_x
,

935 
sourû_y
,

936 
sšk_ty³
,

937 
sšk_x
,

938 
sšk_y
,

939 
rou‹r_İts
);

942 
	}
}

944 #ifdeà
PRINT_ARRAYS


945 
	$´št_¬¿y
(** 
¬¿y_to_´št
,

946 
x1
,

947 
x2
,

948 
y1
,

949 
y2
)

951 
idx_x
, 
idx_y
;

952 
	`årštf
(
lookup_dump
, "\nPrinting Array \n\n");

954 
idx_y
 = 
y2
; idx_y >ğ
y1
; idx_y --) {

955 
idx_x
 = 
x1
; idx_x <ğ
x2
; idx_x ++) {

956 
	`årštf
(
lookup_dump
, " %9.2e", 
¬¿y_to_´št
[
idx_x
][
idx_y
]);

959 
	`årštf
(
lookup_dump
, "\n");

962 
	`årštf
(
lookup_dump
, "\n\n");

963 
	}
}

967 
	$compu‹_d–_¬¿ys
(
rou‹r_İts_t
 
rou‹r_İts
,

968 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

969 
£gm’t_šfo_t
* 
£gm’t_šf
,

970 
timšg_šfo_t
 
timšg_šf
, 
lÚge¡_Ëngth
)

972 
	`compu‹_d–_şb_to_şb
(
rou‹r_İts
,

973 
lÚge¡_Ëngth
);

974 
	`´štf
("Computing delta_clb_to_clb†ookup matrix OK!\n");

976 
	`compu‹_d–_š·d_to_şb
(
rou‹r_İts
,

977 
d‘_routšg_¬ch
,

978 
£gm’t_šf
,

979 
timšg_šf
);

980 
	`´štf
("Computing delta_inpad_to_clb†ookup matrix OK!\n");

982 
	`compu‹_d–_şb_to_ouad
(
rou‹r_İts
);

983 
	`´štf
("Computing delta_clb_to_outpad†ookup matrix OK!\n");

985 
	`compu‹_d–_š·d_to_ouad
(
rou‹r_İts
);

986 
	`´štf
("Computing delta_inpad_to_outpad†ookup matrix OK!\n");

988 #ifdeà
PRINT_ARRAYS


989 
lookup_dump
 = 
	`my_fİ’
(
DUMPFILE
, "w");

991 
	`årštf
(
lookup_dump
, "\n\nprinting delta_clb_to_clb\n");

992 
	`´št_¬¿y
(
d–_şb_to_şb
, 0 , 
num_grid_cŞumns
 - 1, 0, 
num_grid_rows
 - 1);

994 
	`årštf
(
lookup_dump
, "\n\nprinting delta_inpad_to_clb\n");

995 
	`´št_¬¿y
(
d–_š·d_to_şb
, 0, 
num_grid_cŞumns
, 0, 
num_grid_rows
);

997 
	`årštf
(
lookup_dump
, "\n\nprinting delta_clb_to_outpad\n");

998 
	`´št_¬¿y
(
d–_şb_to_ouad
, 0, 
num_grid_cŞumns
, 0, 
num_grid_rows
);

1000 
	`årštf
(
lookup_dump
, "\n\nprinting delta_inpad_to_outpad\n");

1001 
	`´št_¬¿y
(
d–_š·d_to_ouad
, 0, 
num_grid_cŞumns
 + 1, 0, 
num_grid_rows
 + 1);

1003 
	`fşo£
(
lookup_dump
);

1005 
	}
}

1013 
	$®loc_ªd_compu‹_d–ay_lookup_m©rixes
(
rou‹r_İts_t
 
rou‹r_İts
,

1014 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

1015 
£gm’t_šfo_t
* 
£gm’t_šf
,

1016 
timšg_šfo_t
 
timšg_šf
,

1017 
chª_width_di¡r_t
 
chª_width_di¡
,

1018 
subblock_d©a_t
 
subblock_d©a
)

1024 
Ãt_t
* 
Üigš®_Ãt
 = 
NULL
;

1026 
block_t
* 
Üigš®_block
 = 
NULL
;

1028 
Üigš®_num_Ãts
;

1029 
Üigš®_num_blocks
;

1030 
	`®loc_ªd_assign_š‹º®_¡ruùu»s
(&
Üigš®_Ãt
,

1031 &
Üigš®_block
,

1032 &
Üigš®_num_Ãts
,

1033 &
Üigš®_num_blocks
);

1035 
	`£tup_chª_width
(
rou‹r_İts
,

1036 
chª_width_di¡
);

1038 
	`®loc_routšg_¡ruùs
(
rou‹r_İts
,

1039 
d‘_routšg_¬ch
,

1040 
£gm’t_šf
,

1041 
timšg_šf
,

1042 
subblock_d©a
);

1044 
lÚge¡_Ëngth
;

1045 
lÚge¡_Ëngth
 = 
	`g‘_lÚge¡_£gm’t_Ëngth
(
d‘_routšg_¬ch
,

1046 
£gm’t_šf
);

1050 
	`®loc_d–_¬¿ys
();

1051 
	`compu‹_d–_¬¿ys
(
rou‹r_İts
,

1052 
d‘_routšg_¬ch
,

1053 
£gm’t_šf
,

1054 
timšg_šf
,

1055 
lÚge¡_Ëngth
);

1058 
	`ä“_routšg_¡ruùs
(
rou‹r_İts
,

1059 
d‘_routšg_¬ch
,

1060 
£gm’t_šf
,

1061 
timšg_šf
);

1062 
	`ä“_ªd_»£t_š‹º®_¡ruùu»s
(
Üigš®_Ãt
,

1063 
Üigš®_block
,

1064 
Üigš®_num_Ãts
,

1065 
Üigš®_num_blocks
);

1066 
	}
}

1069 
	$ä“_¶aû_lookup_¡ruùs
()

1071 
	`ä“_d–_¬¿ys
();

1072 
	}
}

	@timing_place_lookup.h

1 #iâdeà
TIMING_PLACE_LOOKUP_H


2 
	#TIMING_PLACE_LOOKUP_H


	)

4 
	~"v´_ty³s.h
"

7 
	#IMPOSSIBLE
 -1

	)

9 
®loc_ªd_compu‹_d–ay_lookup_m©rixes
(
rou‹r_İts_t
 
rou‹r_İts
,

10 
d‘a_routšg_¬ch_t
 
d‘_routšg_¬ch
,

11 
£gm’t_šfo_t
* 
£gm’t_šf
,

12 
timšg_šfo_t
 
timšg_šf
,

13 
chª_width_di¡r_t
 
chª_width_di¡
,

14 
subblock_d©a_t
 
subblock_d©a
);

16 
ä“_¶aû_lookup_¡ruùs
();

18 ** 
d–_š·d_to_şb
;

19 ** 
d–_şb_to_şb
;

20 ** 
d–_şb_to_ouad
;

21 ** 
d–_š·d_to_ouad
;

	@util.c

1 
	~<¡ršg.h
>

2 
	~<as£¹.h
>

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

5 
	~"ut.h
"

6 
	~<¡ddef.h
>

8 
	~"v´_ty³s.h
"

16 
	glš’um
;

20 
	$lim™_v®ue
(
cur
,

21 
max
,

22 cÚ¡ * 
Çme
)

24 ià(
cur
 > 
max
) {

25 
	`´štf
(
WARNTAG
 "%s is being†imited from [%d]o [%d]\n",

26 
Çme
, 
cur
, 
max
);

27  
max
;

30  
cur
;

31 
	}
}

35 * 
	$my_¡ºıy
(* 
de¡
,

36 cÚ¡ * 
¤c
,

37 
size
)

40 
Ën
 = 
	`¡¾’
(
¤c
);

43 ià(
size
 <ğ
Ën
) {

44 
Ën
 = (
size
 - 1);

48 
	`memıy
(
de¡
, 
¤c
, 
Ën
);

51 
de¡
[
Ën
] = '\0';

53  
de¡
;

54 
	}
}

56 
FILE
* 
	$my_fİ’
(cÚ¡ * 
âame
,

57 cÚ¡ * 
æag
)

59 
FILE
* 
å
 = 
NULL
;

62 ià((
å
 = 
	`fİ’
(
âame
, 
æag
)è!ğ
NULL
) {

66 
	`´štf
("E¼Ü o³nšg f% fÜ % acûss.\n", 
âame
, 
æag
);

69 
	`´štf
("Pleaseƒnter‡nother filename.\n");

72  (
å
);

73 
	}
}

75 * 
	$my_¡rdup
(cÚ¡ * 
¡r
)

77 
L’
 = 1 + 
	`¡¾’
(
¡r
);

78 * 
D¡
 = (*)
	`my_m®loc
(
L’
 * ());

79 
	`memıy
(
D¡
, 
¡r
, 
L’
);

81  
D¡
;

82 
	}
}

84 
	$my_©oi
(cÚ¡ * 
¡r
)

89 ià(
¡r
[0] < '0' || str[0] > '9') {

90 ià(!(
¡r
[0] == '-' && str[1] >= '0' && str[1] <= '9')) {

91 
	`´štf
(
ERRTAG
 "ex³ùed‚umb” in¡—d oà'%s'.\n", 
¡r
);

92 
	`ex™
(1);

97  (
	`©oi
(
¡r
));

98 
	}
}

101 * 
	$my_ÿÎoc
(
size_t
 
ÃËm
,

102 
size_t
 
size
)

104 * 
»t
;

105 ià((
»t
 = 
	`ÿÎoc
(
ÃËm
, 
size
)è=ğ
NULL
) {

106 
	`årštf
(
¡d”r
, "Error: Unableo calloc memory. Aborting.\n");

107 
	`ex™
(1);

110  (
»t
);

111 
	}
}

114 * 
	$my_m®loc
(
size_t
 
size
)

116 * 
»t
;

117 ià((
»t
 = 
	`m®loc
(
size
)è=ğ
NULL
) {

118 
	`årštf
(
¡d”r
, "Error: Unableo malloc memory. Aborting.\n");

119 
	`abÜt
();

120 
	`ex™
(1);

123  (
»t
);

124 
	}
}

126 * 
	$my_»®loc
(* 
±r
,

127 
size_t
 
size
)

129 * 
»t
 = 
NULL
;

130 ià(
size
 <= 0) {

131 
	`´štf
("reallocating of size <= 0.\n");

133 ià((
»t
 = 
	`»®loc
(
±r
, 
size
)è=ğ
NULL
) {

134 
	`årštf
(
¡d”r
, "Error: Unableo„ealloc memory. Aborting.\n"

135 "±¸ğ%p, sizğ%u.\n", 
±r
, 
size
);

137 ià(
±r
 =ğ
NULL
) {

138 
	`´štf
(
ERRTAG
 "my_realloc:…tr == NULL. Aborting.\n");

141 
	`ex™
(1);

143  (
»t
);

144 
	}
}

160 * 
	$my_chunk_m®loc
(
size_t
 
size
,

161 
lšked_v±r_t
** 
chunk_±r_h—d
,

162 * 
mem_ava_±r
,

163 ** 
Ãxt_mem_loc_±r
)

170 
	tAlign
;

172 
	#CHUNK_SIZE
 32768

	)

173 
	#FRAGMENT_THRESHOLD
 100

	)

175 * 
tmp_±r
 = 
NULL
;

176 
®igÃd_size
;

178 
	`as£¹
(*
mem_ava_±r
 >= 0);

179 ià((
size_t
)(*
mem_ava_±r
è< 
size
) {

181 ià(
size
 > 
CHUNK_SIZE
) {

183 
tmp_±r
 = (*)
	`my_m®loc
(
size
);

191 ià(
chunk_±r_h—d
 !ğ
NULL
) {

192 *
chunk_±r_h—d
 = 
	`š£¹_š_v±r_li¡
(*chunk_±r_h—d, 
tmp_±r
);

195  
tmp_±r
;

198 ià(*
mem_ava_±r
 < 
FRAGMENT_THRESHOLD
) {

200 *
Ãxt_mem_loc_±r
 = (*)
	`my_m®loc
(
CHUNK_SIZE
);

201 *
mem_ava_±r
 = 
CHUNK_SIZE
;

203 ià(
chunk_±r_h—d
 !ğ
NULL
)

204 *
chunk_±r_h—d
 = 
	`š£¹_š_v±r_li¡
(*chunk_ptr_head,

205 *
Ãxt_mem_loc_±r
);

210 
tmp_±r
 = (*)
	`my_m®loc
(
size
);

211 ià(
chunk_±r_h—d
 !ğ
NULL
) {

212 *
chunk_±r_h—d
 = 
	`š£¹_š_v±r_li¡
(*chunk_ptr_head,

213 
tmp_±r
);

216  
tmp_±r
;

222 ià(
size
 % (
Align
) == 0) {

223 
®igÃd_size
 = 
size
;

225 
®igÃd_size
 = 
size
 + (
Align
) - size % (Align);

228 
tmp_±r
 = *
Ãxt_mem_loc_±r
;

229 *
Ãxt_mem_loc_±r
 +ğ
®igÃd_size
;

230 *
mem_ava_±r
 -ğ
®igÃd_size
;

231  (
tmp_±r
);

232 
	}
}

234 
	$ä“_chunk_memÜy
(
lšked_v±r_t
* 
chunk_±r_h—d
)

237 
lšked_v±r_t
* 
cu¼_±r
, *
´ev_±r
;

238 
cu¼_±r
 = 
chunk_±r_h—d
;

240 
cu¼_±r
 !ğ
NULL
) {

241 
	`ä“
(
cu¼_±r
->
d©a_v±r
);

242 
´ev_±r
 = 
cu¼_±r
;

243 
cu¼_±r
 = cu¼_±r->
Ãxt
;

244 
	`ä“
(
´ev_±r
);

246 
	}
}

250 
lšked_v±r_t
* 
	$š£¹_š_v±r_li¡
(
lšked_v±r_t
* 
h—d
,

251 * 
v±r_to_add
)

253 
lšked_v±r_t
* 
lšked_v±r
 =

254 (
lšked_v±r_t
*)
	`my_m®loc
((
s_lšked_v±r
));

256 
lšked_v±r
->
d©a_v±r
 = 
v±r_to_add
;

257 
lšked_v±r
->
Ãxt
 = 
h—d
;

258  
lšked_v±r
;

259 
	}
}

265 
t_lšked_št
* 
	$š£¹_š_št_li¡
(
t_lšked_št
* 
h—d
,

266 
d©a
,

267 
t_lšked_št
** 
ä“_li¡_h—d_±r
)

269 
t_lšked_št
* 
lšked_št
 = 
NULL
;

270 ià(*
ä“_li¡_h—d_±r
 !ğ
NULL
) {

271 
lšked_št
 = *
ä“_li¡_h—d_±r
;

272 *
ä“_li¡_h—d_±r
 = 
lšked_št
->
Ãxt
;

274 
lšked_št
 = (
t_lšked_št
*è
	`my_m®loc
((t_linked_int));

277 
lšked_št
->
d©a
 = data;

278 
lšked_št
->
Ãxt
 = 
h—d
;

279  
lšked_št
;

280 
	}
}

284 
	$ä“_št_li¡
(
t_lšked_št
** 
št_li¡_h—d_±r
)

286 
t_lšked_št
* 
lšked_št
, *
Ãxt_lšked_št
;

287 
lšked_št
 = *
št_li¡_h—d_±r
;

289 
lšked_št
 !ğ
NULL
) {

290 
Ãxt_lšked_št
 = 
lšked_št
->
Ãxt
;

291 
	`ä“
(
lšked_št
);

292 
lšked_št
 = 
Ãxt_lšked_št
;

295 *
št_li¡_h—d_±r
 = 
NULL
;

296 
	}
}

302 
	$®loc_iveùÜ_ªd_cİy_št_li¡
(
t_lšked_št
** 
li¡_h—d_±r
,

303 
num_™ems
,

304 
veùÜ_t
* 
ivec
,

305 
t_lšked_št
** 
ä“_li¡_h—d_±r
)

307 
i
, *
li¡
;

308 
t_lšked_št
* 
li¡_h—d
 = *
li¡_h—d_±r
;

309 
t_lšked_št
* 
lšked_št
;

310 ià(
num_™ems
 == 0) {

312 
ivec
->
ÃËm
 = 0;

313 
ivec
->
li¡
 = 
NULL
;

314 ià(
li¡_h—d
 !ğ
NULL
) {

315 
	`´štf
("Error in‡lloc_ivector_and_copy_int_list:\n Copied %d "

317 
num_™ems
, 
li¡_h—d
);

318 
	`ex™
(1);

324 
ivec
->
ÃËm
 = 
num_™ems
;

325 
li¡
 = (*)
	`my_m®loc
(
num_™ems
 * ());

326 
ivec
->
li¡
 =†ist;

327 
lšked_št
 = 
li¡_h—d
;

329 
i
 = 0; i < 
num_™ems
 - 1; i++) {

330 
li¡
[
i
] = 
lšked_št
->
d©a
;

331 
lšked_št
 =†šked_št->
Ãxt
;

334 
li¡
[
num_™ems
 - 1] = 
lšked_št
->
d©a
;

335 ià(
lšked_št
->
Ãxt
 !ğ
NULL
) {

336 
	`´štf
("Error in‡lloc_ivector_and_copy_int_list:\n Copied %dƒlements, "

338 
num_™ems
, 
li¡_h—d
);

339 
	`ex™
(1);

342 
lšked_št
->
Ãxt
 = *
ä“_li¡_h—d_±r
;

343 *
ä“_li¡_h—d_±r
 = 
li¡_h—d
;

344 *
li¡_h—d_±r
 = 
NULL
;

345 
	}
}

347 
	gcÚt
;

349 * 
	$my_fg‘s
(* 
buf
,

350 
max_size
,

351 
FILE
* 
å
)

356 
cÚt
 = 0;

357 
lš’um
++;

359 * 
v®
 = 
	`fg‘s
(
buf
, 
max_size
, 
å
);

360 ià(
v®
 =ğ
NULL
) {

361  (
v®
);

366 
i
;

367 
i
 = 0; i < 
max_size
; i++) {

368 ià(
buf
[
i
] == '\n') {

372 ià(
buf
[
i
] == '\0') {

373 
	`´štf
("Error on†ine %d --†ine isoo†ong for input buffer.\n",

374 
lš’um
);

375 
	`´štf
("All†ines must be‡t most %d characters†ong.\n",

376 
BUFSIZE
 - 2);

377 
	`´štf
("The…roblem could‡lso be caused by‡ missing‚ewline.\n");

378 
	`ex™
(1);

382 
i
 = 0; i < 
max_size
 && 
buf
[i] != '\0'; i++) {

383 ià(
buf
[
i
] == '#') {

384 
buf
[
i
] = '\0';

389 ià(
i
 < 2) {

390  (
v®
);

393 ià(
buf
[
i
 - 1] == '\n' && buf[i - 2] == '\\') {

394 
cÚt
 = 1;

395 
buf
[
i
 - 2] = '\n';

396 
buf
[
i
 - 1] = '\0';

399  (
v®
);

400 
	}
}

410 * 
	$my_¡¹ok
(* 
±r
,

411 * 
tok’s
,

412 
FILE
* 
å
,

413 * 
buf
)

415 * 
v®
 = 
	`¡¹ok
(
±r
, 
tok’s
);

417 ià(
v®
 !ğ
NULL
 || 
cÚt
 == 0) {

418  (
v®
);

422 ià(
	`my_fg‘s
(
buf
, 
BUFSIZE
, 
å
è=ğ
NULL
) {

423  (
NULL
);

426 
v®
 = 
	`¡¹ok
(
buf
, 
tok’s
);

428 
	}
}

431 
	$ä“_ivec_veùÜ
(
veùÜ_t
* 
ivec_veùÜ
,

432 
mš_row
,

433 
max_row
)

436 
i
;

437 
i
 = 
mš_row
; i <ğ
max_row
; i++)

438 ià(
ivec_veùÜ
[
i
].
ÃËm
 != 0) {

439 
	`ä“
(
ivec_veùÜ
[
i
].
li¡
);

442 
	`ä“
(
ivec_veùÜ
 + 
mš_row
);

443 
	}
}

446 
	$ä“_ivec_m©rix
(
veùÜ_t
** 
ivec_m©rix
,

447 
mš_row
,

448 
max_row
,

449 
mš_cŞ
,

450 
max_cŞ
)

453 
i
, 
j
;

455 
i
 = 
mš_row
; i <ğ
max_row
; i++) {

456 
j
 = 
mš_cŞ
; j <ğ
max_cŞ
; j++) {

457 ià(
ivec_m©rix
[
i
][
j
].
ÃËm
 != 0) {

458 
	`ä“
(
ivec_m©rix
[
i
][
j
].
li¡
);

463 
	`ä“_m©rix
(
ivec_m©rix
, 
mš_row
, 
max_row
, 
mš_cŞ
, (
veùÜ_t
));

464 
	}
}

467 
	$ä“_ivec_m©rix3
(
veùÜ_t
** *
ivec_m©rix3
,

468 
mš_row
,

469 
max_row
,

470 
mš_cŞ
,

471 
max_cŞ
,

472 
ndmš
,

473 
ndmax
)

476 
i
, 
j
, 
k
;

477 
i
 = 
mš_row
; i <ğ
max_row
; i++) {

478 
j
 = 
mš_cŞ
; j <ğ
max_cŞ
; j++) {

479 
k
 = 
ndmš
; k <ğ
ndmax
; k++) {

480 ià(
ivec_m©rix3
[
i
][
j
][
k
].
ÃËm
 != 0) {

481 
	`ä“
(
ivec_m©rix3
[
i
][
j
][
k
].
li¡
);

487 
	`ä“_m©rix3
(
ivec_m©rix3
, 
mš_row
, 
max_row
, 
mš_cŞ
, 
max_cŞ
, 
ndmš
,

488 (
veùÜ_t
));

489 
	}
}

495 ** 
	$®loc_m©rix
(
mš_row
,

496 
max_row
,

497 
mš_cŞ
,

498 
max_cŞ
,

499 
size_t
 
–em_size
)

501 ** 
ıŒ
 = (**)
	`my_m®loc
((
max_row
 - 
mš_row
 + 1) * (*));

502 
ıŒ
 -ğ
mš_row
;

505 
i
 = 0;

506 
i
 = 
mš_row
; i <ğ
max_row
; ++i) {

507 
ıŒ
[
i
] = (*)
	`my_m®loc
((
max_cŞ
 - 
mš_cŞ
 + 1è* 
–em_size
);

508 
ıŒ
[
i
] -ğ
mš_cŞ
 * 
–em_size
 / ();

511  ((**)
ıŒ
);

512 
	}
}

518 
	$ä“_m©rix
(* 
v±r
,

519 
mš_row
,

520 
max_row
,

521 
mš_cŞ
,

522 
size_t
 
–size
)

524 ** 
ıŒ
 = (**)
v±r
;

526 
i
;

527 
i
 = 
mš_row
; i <ğ
max_row
; i++) {

528 
	`ä“
(
ıŒ
[
i
] + 
mš_cŞ
 * 
–size
 / ());

531 
	`ä“
(
ıŒ
 + 
mš_row
);

532 
	}
}

539 *** 
	$®loc_m©rix3
(
mš_row
,

540 
max_row
,

541 
mš_cŞ
,

542 
max_cŞ
,

543 
ndmš
,

544 
ndmax
,

545 
size_t
 
–size
)

547 
i
, 
j
;

548 *** 
ıŒ
 = (***)
	`my_m®loc
((
max_row
 - 
mš_row
 + 1) * (**));

549 
ıŒ
 -ğ
mš_row
;

551 
i
 = 
mš_row
; i <ğ
max_row
; i++) {

552 
ıŒ
[
i
] = (**)
	`my_m®loc
((
max_cŞ
 - 
mš_cŞ
 + 1) * (*));

553 
ıŒ
[
i
] -ğ
mš_cŞ
;

555 
j
 = 
mš_cŞ
; j <ğ
max_cŞ
; j++) {

556 
ıŒ
[
i
][
j
] = (*)
	`my_m®loc
((
ndmax
 - 
ndmš
 + 1è* 
–size
);

557 
ıŒ
[
i
][
j
] -ğ
ndmš
 * 
–size
 / ();

561  ((***)
ıŒ
);

562 
	}
}

564 
	$´št_št_m©rix3
(** *
v±r
,

565 
mš_row
,

566 
max_row
,

567 
mš_cŞ
,

568 
max_cŞ
,

569 
ndmš
,

570 
ndmax
,

571 * 
fe
)

573 
FILE
* 
outfe
 = 
	`my_fİ’
(
fe
, "w");

575 
i
, 
j
, 
k
;

576 
k
 = 
mš_row
; k <ğ
max_row
; ++k) {

577 
	`årštf
(
outfe
, "PÏÃ %d\n", 
k
);

579 
j
 = 
mš_cŞ
; j <ğ
max_cŞ
; ++j) {

580 
i
 = 
ndmš
; i <ğ
ndmax
; ++i) {

581 
	`årštf
(
outfe
, "%d ", 
v±r
[
k
][
j
][
i
]);

584 
	`årštf
(
outfe
, "\n");

587 
	`årštf
(
outfe
, "\n");

590 
	`fşo£
(
outfe
);

591 
	}
}

593 
	$ä“_m©rix3
(* 
v±r
,

594 
mš_row
,

595 
max_row
,

596 
mš_cŞ
,

597 
max_cŞ
,

598 
ndmš
,

599 
size_t
 
–size
)

601 
i
, 
j
;

602 *** 
ıŒ
 = (***)
v±r
;

604 
i
 = 
mš_row
; i <ğ
max_row
; i++) {

605 
j
 = 
mš_cŞ
; j <ğ
max_cŞ
; j++) {

606 
	`ä“
(
ıŒ
[
i
][
j
] + 
ndmš
 * 
–size
 / ());

609 
	`ä“
(
ıŒ
[
i
] + 
mš_cŞ
);

612 
	`ä“
(
ıŒ
 + 
mš_row
);

613 
	}
}

620 **** 
	$®loc_m©rix4
(
mš_row
,

621 
max_row
,

622 
mš_cŞ
,

623 
max_cŞ
,

624 
ndmš
,

625 
ndmax
,

626 
Ãmš
,

627 
Ãmax
,

628 
size_t
 
–size
)

630 
i
, 
j
, 
k
;

631 **** 
ıŒ
 = (****)
	`my_m®loc
((
max_row
 - 
mš_row
 + 1) * (***));

632 
ıŒ
 -ğ
mš_row
;

634 
i
 = 
mš_row
; i <ğ
max_row
; i++) {

635 
ıŒ
[
i
] = (***)
	`my_m®loc
((
max_cŞ
 - 
mš_cŞ
 + 1) * (**));

636 
ıŒ
[
i
] -ğ
mš_cŞ
;

638 
j
 = 
mš_cŞ
; j <ğ
max_cŞ
; j++) {

639 
ıŒ
[
i
][
j
] = (**)
	`my_m®loc
((
ndmax
 - 
ndmš
 + 1) *

641 
ıŒ
[
i
][
j
] -ğ
ndmš
;

643 
k
 = 
ndmš
; k <ğ
ndmax
; k++) {

644 
ıŒ
[
i
][
j
][
k
] = (*)
	`my_m®loc
((
Ãmax
 - 
Ãmš
 + 1) *

645 
–size
);

646 
ıŒ
[
i
][
j
][
k
] -ğ
Ãmš
 * 
–size
 / ();

651  ((****)
ıŒ
);

652 
	}
}

654 
	$ä“_m©rix4
(* 
v±r
,

655 
mš_row
,

656 
max_row
,

657 
mš_cŞ
,

658 
max_cŞ
,

659 
ndmš
,

660 
ndmax
,

661 
Ãmš
,

662 
size_t
 
–size
)

664 **** 
ıŒ
 = (****)
v±r
;

666 
i
, 
j
, 
k
;

667 
i
 = 
mš_row
; i <ğ
max_row
; i++) {

668 
j
 = 
mš_cŞ
; j <ğ
max_cŞ
; j++) {

669 
k
 = 
ndmš
; k <ğ
ndmax
; k++) {

670 
	`ä“
(
ıŒ
[
i
][
j
][
k
] + 
Ãmš
 * 
–size
 / ());

673 
	`ä“
(
ıŒ
[
i
][
j
] + 
ndmš
 * 
–size
 / ());

676 
	`ä“
(
ıŒ
[
i
] + 
mš_cŞ
);

679 
	`ä“
(
ıŒ
 + 
mš_row
);

680 
	}
}

684 
	#IA
 1103515245u

	)

685 
	#IC
 12345u

	)

686 
	#IM
 2147483648u

	)

687 
	#CHECK_RAND


	)

689 
	gcu¼’t_¿ndom
 = 0;

690 
	gcu¼’t_¿nd
[
NUM_OF_THREADS
];

692 
	$my_¤ªdom
(
£ed
)

694 
cu¼’t_¿ndom
 = ()
£ed
;

696 
a
;

697 
a
 = 0;‡ < 
NUM_OF_THREADS
; ++a) {

698 
cu¼’t_¿nd
[
a
] = ()
£ed
;

700 
	}
}

704 
	$my_œªd
(
imax
)

706 
cu¼’t_¿ndom
 = cu¼’t_¿ndom * 
IA
 + 
IC
;

707 
iv®
 = 
cu¼’t_¿ndom
 & (
IM
 - 1);

708 
iv®
 = ()(()iv® * ()(
imax
 + 0.999è/ ()
IM
);

710 #ifdeà
CHECK_RAND


711 ià((
iv®
 < 0è|| (iv® > 
imax
)) {

712 
	`´štf
("Bad value in my_irand, imax = %d ival = %d\n",

713 
imax
, 
iv®
);

714 
	`ex™
(1);

718  
iv®
;

719 
	}
}

722 
	$my_œªd_·¿Î–
(
imax
, 
myid
)

724 
cu¼’t_¿nd
[
myid
] = cu¼’t_¿nd[myid] * 
IA
 + 
IC
;

725 
iv®
 = 
cu¼’t_¿nd
[
myid
] & (
IM
 - 1);

726 
iv®
 = ()(()iv® * ()(
imax
 + 0.999è/ ()
IM
);

728 #ifdeà
CHECK_RAND


729 ià((
iv®
 < 0è|| (iv® > 
imax
)) {

730 
	`´štf
("Bad v®uš my_œªd, imax = %d iv® = %d\n", 
imax
,

731 
iv®
);

732 
	`ex™
(1);

736  
iv®
;

737 
	}
}

740 
	$my_äªd
()

742 
cu¼’t_¿ndom
 = cu¼’t_¿ndom * 
IA
 + 
IC
;

743 
iv®
 = 
cu¼’t_¿ndom
 & (
IM
 - 1);

744 
fv®
 = ()
iv®
 / ()
IM
;

746 #ifdeà
CHECK_RAND


747 ià((
fv®
 < 0) || (fval > 1.)) {

748 
	`´štf
("Bad v®uš my_äªd, fv® = %g\n", 
fv®
);

749 
	`ex™
(1);

753  
fv®
;

754 
	}
}

757 
	$my_äªd_·¿Î–
(
¿ndom
)

759 
cu¼’t_¿nd
[
¿ndom
] = cu¼’t_¿nd[¿ndom] * 
IA
 + 
IC
;

760 
iv®
 = 
cu¼’t_¿nd
[
¿ndom
] & (
IM
 - 1);

761 
fv®
 = ()
iv®
 / ()
IM
;

763 #ifdeà
CHECK_RAND


764 ià((
fv®
 < 0) || (fval > 1.)) {

765 
	`´štf
("Bad v®uš my_äªd, fv® = %g\n", 
fv®
);

766 
	`ex™
(1);

770  
fv®
;

771 
	}
}

	@util.h

1 #iâdeà
UTIL_H


2 
	#UTIL_H


	)

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<m©h.h
>

9 
lš’um
;

14 #iâdeà
TRUE


15 ’um {
	mFALSE
 = 0, 
	mTRUE
} 
	tboŞ—n
;

17 
	tboŞ—n
;

21 
	#IN


	)

22 
	#OUT


	)

23 
	#INOUT


	)

26 
	#ERRTAG
 "ERROR:\t"

	)

27 
	#WARNTAG
 "WARN:\t"

	)

29 
	#BUFSIZE
 300

	)

31 
	#max
(
a
,
b
è((×è> (b))? (aè: (b))

	)

32 
	#mš
(
a
,
b
è(×è> (b)? (bè: (a))

	)

34 
	#nšt
(
a
è(()
	`æoÜ
× + 0.5))

	)

36 
lim™_v®ue
(
cur
,

37 
max
,

38 cÚ¡ * 
Çme
);

41 
	ss_lšked_v±r
 {

42 * 
	md©a_v±r
;

43 
s_lšked_v±r
* 
	mÃxt
;

44 } 
	tlšked_v±r_t
;

46 
	ss_lšked_št
 {

47 
	md©a
;

48 
s_lšked_št
* 
	mÃxt
;

49 } 
	tt_lšked_št
;

53 
	ss_ivec
 {

54 
	mÃËm
;

55 * 
	mli¡
;

56 } 
	tveùÜ_t
;

59 * 
my_ÿÎoc
(
size_t
 
ÃËm
,

60 
size_t
 
size
);

62 * 
my_m®loc
(
size_t
 
size
);

64 * 
my_»®loc
(* 
±r
,

65 
size_t
 
size
);

67 * 
my_chunk_m®loc
(
size_t
 
size
,

68 
lšked_v±r_t
** 
chunk_±r_h—d
,

69 * 
mem_ava_±r
,

70 ** 
Ãxt_mem_loc_±r
);

72 
ä“_chunk_memÜy
(
lšked_v±r_t
* 
chunk_±r_h—d
);

76 
ä“_ivec_veùÜ
(
veùÜ_t
* 
ivec_veùÜ
,

77 
Ämš
,

78 
Ämax
);

80 
ä“_ivec_m©rix
(
veùÜ_t
** 
ivec_m©rix
,

81 
Ämš
,

82 
Ämax
,

83 
ncmš
,

84 
ncmax
);

86 
ä“_ivec_m©rix3
(
veùÜ_t
*** 
ivec_m©rix3
,

87 
Ämš
,

88 
Ämax
,

89 
ncmš
,

90 
ncmax
,

91 
ndmš
,

92 
ndmax
);

94 ** 
®loc_m©rix
(
Ämš
,

95 
Ämax
,

96 
ncmš
,

97 
ncmax
,

98 
size_t
 
–size
);

100 *** 
®loc_m©rix3
(
Ämš
,

101 
Ämax
,

102 
ncmš
,

103 
ncmax
,

104 
ndmš
,

105 
ndmax
,

106 
size_t
 
–size
);

108 **** 
®loc_m©rix4
(
Ämš
,

109 
Ämax
,

110 
ncmš
,

111 
ncmax
,

112 
ndmš
,

113 
ndmax
,

114 
Ãmš
,

115 
Ãmax
,

116 
size_t
 
–size
);

118 
ä“_m©rix
(* 
v±r
,

119 
Ämš
,

120 
Ämax
,

121 
ncmš
,

122 
size_t
 
–size
);

124 
ä“_m©rix3
(* 
v±r
,

125 
Ämš
,

126 
Ämax
,

127 
ncmš
,

128 
ncmax
,

129 
ndmš
,

130 
size_t
 
–size
);

132 
ä“_m©rix4
(* 
v±r
,

133 
Ämš
,

134 
Ämax
,

135 
ncmš
,

136 
ncmax
,

137 
ndmš
,

138 
ndmax
,

139 
Ãmš
,

140 
size_t
 
–size
);

142 
´št_št_m©rix3
(** *
v±r
,

143 
Ämš
,

144 
Ämax
,

145 
ncmš
,

146 
ncmax
,

147 
ndmš
,

148 
ndmax
,

149 * 
fe
);

151 
lšked_v±r_t
* 
š£¹_š_v±r_li¡
Öšked_v±r_t* 
h—d
,

152 * 
v±r_to_add
);

154 
t_lšked_št
* 
š£¹_š_št_li¡
Ñ_lšked_št* 
h—d
,

155 
d©a
,

156 
t_lšked_št
** 
ä“_li¡_h—d_±r
);

158 
ä“_št_li¡
(
t_lšked_št
** 
št_li¡_h—d_±r
);

160 
®loc_iveùÜ_ªd_cİy_št_li¡
(
t_lšked_št
** 
li¡_h—d_±r
,

161 
num_™ems
,

162 
veùÜ_t
* 
ivec
,

163 
t_lšked_št
** 
ä“_li¡_h—d_±r
);

167 
FILE
* 
my_fİ’
(cÚ¡ * 
âame
,

168 cÚ¡ * 
æag
);

170 * 
my_¡¹ok
(* 
±r
,

171 * 
tok’s
,

172 
FILE
* 
å
,

173 * 
buf
);

175 * 
my_fg‘s
(* 
buf
,

176 
max_size
,

177 
FILE
* 
å
);

179 
my_©oi
(cÚ¡ * 
¡r
);

181 * 
my_¡rdup
(cÚ¡ * 
¡r
);

183 * 
my_¡ºıy
(* 
de¡
,

184 cÚ¡ * 
¤c
,

185 
size
);

188 
my_¤ªdom
(
£ed
);

190 
my_œªd
(
imax
);

192 
my_œªd_·¿Î–
(
imax
, 
myid
);

194 
my_äªd
();

196 
my_äªd_·¿Î–
();

	@vpr_types.h

2 #iâdeà
VPR_TYPES_H


3 
	#VPR_TYPES_H


	)

5 
	~"ut.h
"

8 #ifdeà
SPEC


9 
	#NO_GRAPHICS


	)

10 
	#NDEBUG


	)

13 
	#TOKENS
 " \t\n"

	)

17 
	#NUM_OF_THREADS
 4

	)

19 
	#NUM_OF_SUB_REGIONS
 4

	)

21 
	#EMPTY
 -1

	)

24 
	ee_block_ty³s
 {

25 
	mB_CLB_TYPE
 = 0,

26 
	mIO_TYPE
,

27 
	mEMPTY_TYPE
,

28 
	mOUTPAD_TYPE
,

29 
	mINPAD_TYPE


30 } 
	tblock_ty³s_t
;

32 
	ee_grid_ty³s
 {

33 
	mG_CLB_TYPE
,

34 
	mG_IO_TYPE
,

35 
	mG_EMPTY_TYPE


36 } 
	tgrid_ty³s_t
;

49 
	mT_comb
;

50 
	mT_£q_š
;

51 
	mT_£q_out
;

52 } 
	tT_subblock_t
;

71 
	ss_timšg_šf
 {

72 
boŞ—n
 
	mtimšg_ª®ysis_’abËd
;

73 
	mC_š_cblock
;

74 
	mT_š_cblock
;

76 
	mT_sblk_İš_to_sblk_š
;

77 
	mT_şb_š_to_sblk_š
;

78 
	mT_sblk_İš_to_şb_İš
;

80 
	mT_ad
;

81 
	mT_İad
;

82 
T_subblock_t
* 
	mT_subblock
;

83 } 
	ttimšg_šfo_t
;

87 
	ee_pš_ty³
 {

88 
	mOPEN
 = -1,

89 
	mDRIVER
 = 0,

90 
	mRECEIVER
 = 1

91 } 
	tpš_ty³s_t
;

93 
	ee_side
 {

94 
	mTOP
 = 0,

95 
	mBOTTOM
 = 1,

96 
	mLEFT
 = 2,

97 
	mRIGHT
 = 3

98 } 
	tside_ty³s_t
;

100 
	#MINOR
 0

	)

101 
	#MAJOR
 1

	)

103 
	#HUGE_FLOAT
 1.e30

	)

107 
	#MAX_CHANNEL_WIDTH
 8000

	)

108 
	#MAX_SHORT
 32767

	)

111 
	esched_ty³
 {

112 
	mAUTO_SCHED
,

113 
	mUSER_SCHED


114 } 
	tsched_ty³s_t
;

117 
	epic_ty³
 {

118 
	mNO_PICTURE
,

119 
	mPLACEMENT
,

120 
	mROUTING


127 
	e¶aû_cÚg_ty³s
 {

128 
	mLINEAR_CONG
,

129 
	mNONLINEAR_CONG


130 } 
	t¶aû_cÚg_ty³s_t
;

132 
	ee_İ”©iÚ
 {

133 
	mPLACE_AND_ROUTE
,

134 
	mPLACE_ONLY
,

135 
	mROUTE_ONLY
,

136 
	mTIMING_ANALYSIS_ONLY


137 } 
	tİ”©iÚ_ty³s_t
;

139 
	epäeq
 {

140 
	mPLACE_NEVER
,

141 
	mPLACE_ONCE
,

142 
	mPLACE_ALWAYS


143 } 
	t¶aû_äeq_t
;

147 
	ee_·d_loc_ty³
 {

148 
	mFREE
,

149 
	mRANDOM
,

150 
	mUSER


151 } 
	t·d_loc_t
;

163 
	ss_Ãt
 {

164 * 
	mÇme
;

165 
	mnum_Ãt_pšs
;

166 * 
	mnode_blocks
;

167 * 
	mnode_block_pšs
;

168 } 
	tÃt_t
;

176 
	ss_block
 {

177 * 
	mÇme
;

178 
block_ty³s_t
 
	mblock_ty³
;

179 * 
	mÃts
;

180 
	mx
;

181 
	my
;

182 
	mz
;

183 } 
	tblock_t
;

191 
	ss_şb
 {

192 
block_ty³s_t
 
	mgrid_ty³
;

193 
	mm_ÿ·c™y
;

194 
	mm_u§ge
;

195 
	mm_off£t
;

197 * 
	mš_blocks
;

198 } 
	tgrid_te_t
;

204 
	ss_bb
 {

205 
	mxmš
;

206 
	mxmax
;

207 
	mymš
;

208 
	mymax
;

209 } 
	tbbox_t
;

211 
	ee_¡©
 {

212 
	mUNIFORM
,

213 
	mGAUSSIAN
,

214 
	mPULSE
,

215 
	mDELTA


220 
	st_chª
 {

221 
e_¡©
 
	mty³
;

222 
	m³ak
;

223 
	mwidth
;

224 
	mx³ak
;

225 
	mdc
;

226 } 
	tchªÃl_t
;

233 
	ss_chª_width_di¡r
 {

234 
	mchª_width_io
;

235 
chªÃl_t
 
	mchª_x_di¡
;

236 
chªÃl_t
 
	mchª_y_di¡
;

237 } 
	tchª_width_di¡r_t
;

242 
	ss_pš_şass
 {

243 
e_pš_ty³
 
	mty³
;

244 
	mnum_pšs
;

245 * 
	mpšli¡
;

246 } 
	tpš_şass_t
;

251 
	ss_¶aû_»giÚ_t
 {

252 
	mÿ·c™y
;

253 
	mšv_ÿ·c™y
;

254 
	moccu·ncy
;

255 
	mco¡
;

256 } 
	t¶aû_»giÚ_t
;

269 
	ss_subblock_t
 {

270 * 
	mÇme
;

271 
	mouut
;

272 
	mşock
;

273 * 
	mšputs
;

274 } 
	tsubblock_t
;

292 
subblock_t
** 
	msubblock_šf
;

293 
	mmax_subblocks_³r_block
;

294 * 
	mnum_subblocks_³r_block
;

295 
	msubblock_lut_size
;

296 
	mnum_ff
;

297 
	mnum_cÚ¡_g’
;

298 
lšked_v±r_t
* 
	mchunk_h—d_±r
;

299 } 
	tsubblock_d©a_t
;

306 
	ss_ªÃ®šg_sched
 {

307 
sched_ty³s_t
 
	mty³
;

308 
	mšÃr_num
;

309 
	mš™_t
;

310 
	m®pha_t
;

311 
	mex™_t
;

312 } 
	tªÃ®šg_sched_t
;

319 
	ee_¶aû_®gÜ™hm
 {

320 
	mBOUNDING_BOX_PLACE
 = 0,

321 
	mNET_TIMING_DRIVEN_PLACE
,

322 
	mPATH_TIMING_DRIVEN_PLACE
,

324 
	mNEW_TIMING_DRIVEN_PLACE


325 } 
	t¶aû_®gÜ™hm_t
;

356 
	ss_¶aûr_İts
 {

357 
¶aû_®gÜ™hm_t
 
	m¶aû_®gÜ™hm
;

358 
	mtimšg_Œadeoff
;

359 
	mblock_di¡
;

360 
¶aû_cÚg_ty³s_t
 
	m¶aû_co¡_ty³
;

361 
	m¶aû_co¡_exp
;

362 
	m¶aû_chª_width
;

363 
e_·d_loc_ty³
 
	m·d_loc_ty³
;

364 * 
	m·d_loc_fe
;

365 
päeq
 
	m¶aû_äeq
;

366 
	mnum_»giÚs
;

367 
	m»compu‹_ü™_™”
;

368 
boŞ—n
 
	m’abË_timšg_computiÚs
;

369 
	mšÃr_loİ_»compu‹_divid”
;

370 
	mtd_¶aû_exp_fœ¡
;

371 
	mtd_¶aû_exp_Ï¡
;

373 
boŞ—n
 
	m¶aû_·¿Î–
;

375 
	mm_´ob
;

376 } 
	t¶aûr_İts_t
;

378 
	ss_¶aûr_co¡s
 {

379 
	mm_bb_co¡
;

380 
	mm_timšg_co¡
;

381 
	mm_d–ay_co¡
;

382 
	mm_tÙ®_co¡
;

384 
	mm_šv”£_´ev_bb_co¡
;

385 
	mm_šv”£_´ev_timšg_co¡
;

387 
	mm_av_co¡
;

388 
	mm_av_bb_co¡
;

389 
	mm_av_timšg_co¡
;

390 
	mm_av_d–ay_co¡
;

392 
	mm_Ãw_bb_co¡
;

393 
	mm_Ãw_timšg_co¡
;

394 
	mm_Ãw_d–ay_co¡
;

395 } 
	t¶aûr_co¡s_t
;

397 
	ss_¶aûr_·¿s
 {

398 
boŞ—n
 
	mm_fixed_pšs
;

399 
	mm_width_çùÜ
;

401 
	mm_num_cÚÃùiÚs
;

402 
	mm_¶aû_d–ay_v®ue
;

404 
	mm_max_d–ay
;

405 
	mm_ü™_expÚ’t
;

408 
	mm_ou‹r_ü™_™”_couÁ
;

409 
	mm_move_lim™
;

410 
	mm_šÃr_ü™_™”_couÁ
;

411 
	mm_šÃr_»compu‹_lim™
;

413 
	mm_¿nge_lim™
;

414 
	mm_fš®_¾im
;

415 
	mm_šv”£_d–_¾im
;

417 
	mm_‹m³r
;

419 
	mm_tÙ®_™”
;

420 
	mm_sucûss_sum
;

421 
	mm_sucûss_¿tio
;

423 
	mm_sum_of_squ¬es
;

424 
	mm_¡d_dev
;

425 } 
	t¶aûr_·¿s_t
;

429 
	ee_rou‹_ty³
 {

430 
	mGLOBAL
,

431 
	mDETAILED


432 } 
	trou‹r_ty³s_t
;

434 
	ee_rou‹r_®gÜ™hm
 {

435 
	mBREADTH_FIRST
,

436 
	mTIMING_DRIVEN


437 } 
	trou‹r_®gÜ™hm_t
;

439 
	ee_rou‹r_ba£_co¡_ty³
 {

440 
	mINTRINSIC_DELAY
,

441 
	mDELAY_NORMALIZED
,

442 
	mDEMAND_ONLY


443 } 
	trou‹r_ba£_co¡_t
;

445 
	#NO_FIXED_CHANNEL_WIDTH
 -1

	)

478 
	ss_rou‹r_İts
 {

479 
	mfœ¡_™”_´es_çc
;

480 
	mš™Ÿl_´es_çc
;

481 
	m´es_çc_muÉ
;

482 
	macc_çc
;

483 
	mb’d_co¡
;

484 
	mmax_rou‹r_™”©iÚs
;

485 
	mbb_çùÜ
;

486 
rou‹r_ty³s_t
 
	mrou‹_ty³
;

487 
	mfixed_chªÃl_width
;

488 
rou‹r_®gÜ™hm_t
 
	mrou‹r_®gÜ™hm
;

489 
rou‹r_ba£_co¡_t
 
	mrou‹r_ba£_co¡_ty³
;

490 
	ma¡¬_çc
;

491 
	mmax_ü™iÿl™y
;

492 
	mü™iÿl™y_exp
;

493 } 
	trou‹r_İts_t
;

495 
	ee_sw™ch_block_ty³
 {

496 
	mSUBSET
,

497 
	mWILTON
,

498 
	mUNIVERSAL


499 } 
	tsw™ch_block_t
;

501 
	ee_Fc_ty³
 {

502 
	mABSOLUTE
,

503 
	mFRACTIONAL


505 
e_Fc_ty³
 
	tFc_ty³_t
;

532 
	ss_d‘_routšg_¬ch
 {

533 
e_Fc_ty³
 
	mFc_ty³
;

534 
	mFc_ouut
;

535 
	mFc_šput
;

536 
	mFc_·d
;

537 
sw™ch_block_t
 
	msw™ch_block_ty³
;

538 
	mnum_£gm’t
;

539 
	mnum_sw™ch
;

540 
	mTd–Ëss_sw™ch
;

541 
	mwœe_to_š_sw™ch
;

542 
	mR_mšW_nmos
;

543 
	mR_mšW_pmos
;

544 } 
	td‘a_routšg_¬ch_t
;

561 
	ss_£gm’t_šfo_t
 {

562 
	mäequ’cy
;

563 
	mËngth
;

564 
	mwœe_sw™ch
;

565 
	mİš_sw™ch
;

566 
	mäac_cb
;

567 
	mäac_sb
;

568 
boŞ—n
 
	mlÚglše
;

569 
	mRm‘®
;

570 
	mCm‘®
;

571 } 
	t£gm’t_šfo_t
;

580 
	ss_sw™ch_šf
 {

581 
boŞ—n
 
	mbufã»d
;

582 
	mR
;

583 
	mCš
;

584 
	mCout
;

585 
	mTd–
;

586 } 
	tsw™ch_šfo_t
;

603 
	st_£g_d‘as
 {

604 
	mËngth
;

605 
	m¡¬t
;

606 
boŞ—n
 
	mlÚglše
;

607 
boŞ—n
* 
	msb
;

608 
boŞ—n
* 
	mcb
;

609 
	mwœe_sw™ch
;

610 
	mİš_sw™ch
;

611 
	mRm‘®
;

612 
	mCm‘®
;

613 
	mšdex
;

614 } 
	t£gm’t_d‘as_t
;

618 
	ss_lšked_f_poš‹r
 {

619 
s_lšked_f_poš‹r
* 
	mÃxt
;

620 * 
	måŒ
;

635 
	et_¼_ty³
 {

636 
	mSOURCE
,

637 
	mSINK
,

638 
	mIPIN
,

639 
	mOPIN
,

640 
	mCHANX
,

641 
	mCHANY


642 } 
	t¼_ty³s_t
;

651 
	ss_Œaû
 {

652 
	mšdex
;

653 
	misw™ch
;

654 
s_Œaû
* 
	mÃxt
;

658 
	#NO_PREVIOUS
 -1

	)

696 
	st_¼_node
 {

697 
	mxlow
;

698 
	mxhigh
;

699 
	mylow
;

700 
	myhigh
;

701 
	m±c_num
;

702 
	mco¡_šdex
;

703 
	mm_u§ge
;

704 
	mÿ·c™y
;

705 
	mnum_edges
;

706 
¼_ty³s_t
 
	mty³
;

707 * 
	medges
;

708 * 
	msw™ches
;

709 
	mR
;

710 
	mC
;

711 } 
	t¼_node_t
;

734 
	st_¼_šdexed_d©a
 {

735 
	mba£_co¡
;

736 
	m§ved_ba£_co¡
;

737 
	mÜtho_co¡_šdex
;

738 
	m£g_šdex
;

739 
	mšv_Ëngth
;

740 
	mT_lš—r
;

741 
	mT_quad¿tic
;

742 
	mC_lßd
;

743 } 
	t¼_šdexed_d©a_t
;

746 
	ee_co¡_šdiûs
 {

747 
	mSOURCE_COST_INDEX
 = 0,

748 
	mSINK_COST_INDEX
,

749 
	mOPIN_COST_INDEX
,

750 
	mIPIN_COST_INDEX
,

751 
	mCHANX_COST_INDEX_START


	@vpr_utils.c

1 
	~"v´_ty³s.h
"

2 
	~"glob®s.h
"

3 
	~"v´_uts.h
"

9 
boŞ—n
 
	$is_İš
(
š
)

12 
işass
 = 
şb_pš_şass
[
š
];

13 ià(
şass_šf
[
işass
].
ty³
 =ğ
DRIVER
) {

14  
TRUE
;

16  
FALSE
;

18 
	}
}

23 
	$lßd_Úe_şb_çnout_couÁ
(
subblock_lut_size
,

24 
subblock_t
* 
subblock_šf
,

25 
num_subblocks
,

26 * 
num_u£s_of_şb_š
,

27 * 
num_u£s_of_sblk_İš
,

28 
işb
)

30 
isub
 = -1;

31 
isub
 = 0; isub < 
num_subblocks
; ++isub) {

39 
ouut_pš
 = 
subblock_šf
[
isub
].
ouut
;

40 ià(
ouut_pš
 !ğ
OPEN
) {

41 ià(
blocks
[
işb
].
Ãts
[
ouut_pš
] !ğ
OPEN
) {

42 ++
num_u£s_of_sblk_İš
[
isub
];

47 
š
 = -1;

48 
š
 = 0; ipš < 
subblock_lut_size
; ++ipin) {

49 
šput_pš
 = 
subblock_šf
[
isub
].
šputs
[
š
];

50 ià(
šput_pš
 !ğ
OPEN
 && iÅut_pš < 
max_pšs_³r_şb
) {

51 ++
num_u£s_of_şb_š
[
šput_pš
];

52 } ià(
šput_pš
 !ğ
OPEN
 && iÅut_pš >ğ
max_pšs_³r_şb
) {

55 ++
num_u£s_of_sblk_İš
[
šput_pš
 - 
max_pšs_³r_şb
];

62 
şock_pš
 = 
subblock_šf
[
isub
].
şock
;

63 ià(
şock_pš
 !ğ
OPEN
 && clock_pš < 
max_pšs_³r_şb
) {

64 ++
num_u£s_of_şb_š
[
şock_pš
];

65 } ià(
şock_pš
 !ğ
OPEN
 && clock_pš >ğ
max_pšs_³r_şb
) {

68 ++
num_u£s_of_sblk_İš
[
şock_pš
 - 
max_pšs_³r_şb
];

73 
	}
}

76 
¶aûr_co¡s_t
* 
	$š™_¶aûr_co¡s
()

78 
¶aûr_co¡s_t
* 
¶aûr_co¡s_±r
 = (¶aûr_co¡s_t*)
	`m®loc
((placer_costs_t));

80 
¶aûr_co¡s_±r
->
m_bb_co¡
 =…Ïûr_co¡s_±r->
m_timšg_co¡
 = 0.0;

81 
¶aûr_co¡s_±r
->
m_d–ay_co¡
 =…Ïûr_co¡s_±r->
m_tÙ®_co¡
 = 0.0;

83 
¶aûr_co¡s_±r
->
m_av_co¡
 =…Ïûr_co¡s_±r->
m_av_bb_co¡
 = 0.0;

84 
¶aûr_co¡s_±r
->
m_av_timšg_co¡
 =…Ïûr_co¡s_±r->
m_av_d–ay_co¡
 = 0.0;

86 
¶aûr_co¡s_±r
->
m_Ãw_bb_co¡
 =…Ïûr_co¡s_±r->
m_Ãw_timšg_co¡
 =…Ïûr_co¡s_±r->
m_d–ay_co¡
 = 0.0;

88 
¶aûr_co¡s_±r
->
m_šv”£_´ev_bb_co¡
 =…Ïûr_co¡s_±r->
m_šv”£_´ev_timšg_co¡
 = 0.0;

90  
¶aûr_co¡s_±r
;

91 
	}
}

93 
¶aûr_·¿s_t
* 
	$š™_¶aûr_·¿s
()

95 
¶aûr_·¿s_t
* 
¶aûr_·¿s
 = (¶aûr_·¿s_t*)
	`m®loc
((placer_paras_t));

96 
¶aûr_·¿s
->
m_fixed_pšs
 = 
FALSE
;

97 
¶aûr_·¿s
->
m_sum_of_squ¬es
 =…Ïûr_·¿s->
m_¶aû_d–ay_v®ue
 = 0.0;

98 
¶aûr_·¿s
->
m_width_çùÜ
 =…Ïûr_·¿s->
m_num_cÚÃùiÚs
 = 0;

100 
¶aûr_·¿s
->
m_max_d–ay
 =…Ïûr_·¿s->
m_ü™_expÚ’t
 = 0.0;

102 
¶aûr_·¿s
->
m_šÃr_ü™_™”_couÁ
 =…Ïûr_·¿s->
m_ou‹r_ü™_™”_couÁ
 = 0;

103 
¶aûr_·¿s
->
m_move_lim™
 =…Ïûr_·¿s->
m_šÃr_»compu‹_lim™
 = 0;

105 
¶aûr_·¿s
->
m_‹m³r
 = 0.0;

106 
¶aûr_·¿s
->
m_¿nge_lim™
 =…Ïûr_·¿s->
m_fš®_¾im
 =…Ïûr_·¿s->
m_šv”£_d–_¾im
 = 1.0;

108 
¶aûr_·¿s
->
m_tÙ®_™”
 =…Ïûr_·¿s->
m_sucûss_sum
 = 0;

109 
¶aûr_·¿s
->
m_sucûss_¿tio
 =…Ïûr_·¿s->
m_¡d_dev
 = 0.0;

111  
¶aûr_·¿s
;

112 
	}
}

114 
	$ä“_¶aûr_co¡s
(
¶aûr_co¡s_t
* 
¶aûr_co¡s
)

116 
	`ä“
(
¶aûr_co¡s
);

117 
¶aûr_co¡s
 = 
NULL
;

118 
	}
}

120 
	$ä“_¶aûr_·¿s
(
¶aûr_·¿s_t
* 
¶aûr_·¿s
)

122 
	`ä“
(
¶aûr_·¿s
);

123 
¶aûr_·¿s
 = 
NULL
;

124 
	}
}

	@vpr_utils.h

1 #iâdeà 
VPR_UTILS_H


2 
	#VPR_UTILS_H


	)

4 
	~"v´_ty³s.h
"

6 
boŞ—n
 
is_İš
(
š
);

10 
lßd_Úe_şb_çnout_couÁ
(
subblock_lut_size
, 
subblock_t
 *
subblock_šf
,

11 
num_subblocks
, * 
num_u£s_of_şb_š
,

12 * 
num_u£s_of_sblk_İš
, 
iblk
);

14 
¶aûr_co¡s_t
* 
š™_¶aûr_co¡s
();

16 
¶aûr_·¿s_t
* 
š™_¶aûr_·¿s
();

18 
ä“_¶aûr_co¡s
(
¶aûr_co¡s_t
* 
¶aûr_co¡s
);

20 
ä“_¶aûr_·¿s
(
¶aûr_·¿s_t
* 
¶aûr_·¿s
);

	@
1
.
0
75
1083
check_netlist.c
check_netlist.h
check_route.c
check_route.h
check_rr_graph.c
check_rr_graph.h
draw.c
draw.h
globals.h
graphics.c
graphics.h
hash.c
hash.h
heapsort.c
heapsort.h
main.c
net_delay.c
net_delay.h
path_delay.c
path_delay.h
path_delay2.c
path_delay2.h
path_delay_parallel.c
path_delay_parallel.h
place.c
place.h
place_and_route.c
place_and_route.h
place_parallel.c
place_parallel.h
print_netlist.c
print_netlist.h
read_arch.c
read_arch.h
read_netlist.c
read_netlist.h
read_place.c
read_place.h
route_breadth_first.c
route_breadth_first.h
route_common.c
route_common.h
route_export.h
route_timing.c
route_timing.h
route_tree_timing.c
route_tree_timing.h
rr_graph.c
rr_graph.h
rr_graph2.c
rr_graph2.h
rr_graph_area.c
rr_graph_area.h
rr_graph_indexed_data.c
rr_graph_indexed_data.h
rr_graph_sbox.c
rr_graph_sbox.h
rr_graph_timing_params.c
rr_graph_timing_params.h
rr_graph_util.c
rr_graph_util.h
segment_stats.c
segment_stats.h
stats.c
stats.h
test_h.c
timing_place.c
timing_place.h
timing_place_lookup.c
timing_place_lookup.h
util.c
util.h
vpr_types.h
vpr_utils.c
vpr_utils.h
